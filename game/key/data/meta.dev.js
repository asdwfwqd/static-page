!function(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};return e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=73)}([function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),i(33),i(2),i(5),i(4),i(7),i(13),i(11),i(14),i(1),i(15),i(3),i(12),i(6),i(10),i(71),i(72),i(29),i(32),i(26),i(27),i(28),i(30),i(31),i(39),i(43),i(40),i(41),i(47),i(45),i(46),i(42),i(44),i(24),i(25),i(23),i(19),i(21),i(22),i(20),i(17),i(16),i(57),i(60),i(61),i(59),i(58),i(55),i(56),i(37),i(36),i(38),i(18),i(54),i(52),i(53),i(50),i(51),i(35),i(34),i(49),i(48),i(66);var n=i(69),h=s(n);i(65),i(68),i(67);var o=i(70),a=s(o);i(64),i(62),i(63),i(9),i(8),e.default={Tab:a.default,Text:Text,Button:h.default}},function(t,e,i){"use strict";meta.Camera=function(){this.volume=new meta.math.AABBext(0,0,0,0),this.zoomBounds=null,this._wasResized=!1,this._autoZoom=!1,this._zoom=1,this.prevZoom=1,this.zoomRatio=1,this._draggable=!1,this._dragging=!1,this._moved=!1,this._center=!1,this._centerX=!0,this._centerY=!0,this._worldBounds=!1,this._followEntity=null,this.onResize=meta.createChannel(meta.Event.CAMERA_RESIZE),this.onMove=meta.createChannel(meta.Event.CAMERA_MOVE),this.init()},meta.Camera.prototype={init:function(){meta.engine.onResize.add(this._onResize,this),meta.subscribe(meta.Event.WORLD_RESIZE,this._onWorldResize,this),this.zoomBounds={width:-1,height:-1,minWidth:-1,minHeight:-1,maxWidth:-1,maxHeight:-1}},release:function(){this.onMove.release(),meta.engine.onResize.remove(this),meta.world.onResize.remove(this)},update:function(t){if(this._followEntity){var e=this._followEntity.volume,i=Math.floor(e.x)-Math.floor(this.volume.width/2),s=Math.floor(e.y)-Math.floor(this.volume.height/2);this.position(i,s)}},updateView:function(){this._autoZoom?this.updateAutoZoom():this.updateZoom();var t=meta.world;if(!this._moved){var e=0,i=0;this._center?(e=this._centerX?Math.floor((this.volume.width-t.width)/2):0,i=this._centerY?Math.floor((this.volume.height-t.height)/2):0):(e=0,i=0),this.volume.move(e,i)}this._wasResized&&(this.onResize.emit(this,meta.Event.CAMERA_RESIZE),this._wasResized=!1),this.onMove.emit(this,meta.Event.CAMERA_MOVE)},updateZoom:function(){this.prevZoom!==this._zoom&&(this.zoomRatio=1/this._zoom,this.volume.scale(this.zoomRatio,this.zoomRatio),this._wasResized=!0)},updateAutoZoom:function(){var t=meta.engine,e=this.zoomBounds.width,i=this.zoomBounds.height,s=t.width/e,n=t.height/i;this.prevZoom=this._zoom,this._zoom=s,n<s&&(this._zoom=n),t.adaptResolution()&&(e=this.zoomBounds.width,i=this.zoomBounds.height,s=t.width/e,n=t.height/i,this._zoom=s,n<s&&(this._zoom=n),this.volume.resize(t.width,t.height)),this.updateZoom()},bounds:function(t,e){this._autoZoom=!0,this._wasResized=!0,this.zoomBounds.width=t,this.zoomBounds.height=e,0===this.volume.width&&0===this.volume.height||this.updateView()},minBounds:function(t,e){this._autoZoom=!0,this._wasResized=!0,this.zoomBounds.minWidth=t,this.zoomBounds.minHeight=e,this.updateView()},maxBounds:function(t,e){this._autoZoom=!0,this._wasResized=!0,this.zoomBounds.maxWidth=t,this.zoomBounds.maxHeight=e,this.updateView()},_onInput:function(t,e){var i=Input.Event;e===i.MOVE?this._drag(t):e===i.DOWN?t.keyCode===Input.Key.BUTTON_LEFT&&this._startDrag(t):e===i.UP&&t.keyCode===Input.Key.BUTTON_LEFT&&this._endDrag(t)},_onResize:function(t,e){this.volume.resize(t.width,t.height),this._wasResized=!0,this.updateView()},_onWorldResize:function(t,e){this.updateView()},_startDrag:function(t){this._draggable&&(this._dragging=!0)},_endDrag:function(t){this._dragging=!1},_drag:function(t){if(this._dragging){var e=meta,i=(t.screenX-t.prevScreenX)*this.zoomRatio,s=(t.screenY-t.prevScreenY)*this.zoomRatio;if(this._moved=!0,this._worldBounds){var n=e.world.volume,h=this.volume.minX-i,o=this.volume.minY-s;h<n.minX?i-=n.minX-h:h+this.volume.width>n.maxX&&(i=this.volume.maxX-n.maxX),o<n.minY?s-=n.minY-o:o+this.volume.height>n.maxY&&(s=this.volume.maxY-n.maxY)}this.volume.move(-i,-s),this.onMove.emit(this,e.Event.CAMERA_MOVE)}},position:function(t,e){this.volume.x===t&&this.volume.y===e||(this.volume.position(t,e),this._moved=!0,this.updateView())},follow:function(t){return t instanceof Entity.Geometry?void(this._followEntity=t):void console.warn("(meta.Camera.follow): Invalid entity - should be part of Entity.Geometry")},set x(t){this.volume.x!==t&&(this.volume.position(t,this.volume.y),this._moved=!0,this.updateView())},set y(t){this.volume.y!==t&&(this.volume.position(this.volume.x,t),this._moved=!0,this.updateView())},get x(){return this.volume.x},get y(){return this.volume.y},get width(){return this.volume.width},get height(){return this.volume.height},set zoom(t){this._zoom!==t&&(this.prevZoom=this._zoom,this._zoom=t,this.updateView())},get zoom(){return this._zoom},set enableBorderIgnore(t){this._enableBorderIgnore=t,this.updateView()},get enableBorderIgnore(){return this._enableBorderIgnore},set draggable(t){if(this._draggable!==t){this._draggable=t;var e=[Input.Event.DOWN,Input.Event.UP,Input.Event.MOVE];t?meta.subscribe(e,this._onInput,this):(meta.unsubscribe(e,this),this._dragging=!1)}},get draggable(){return this._draggable},set autoZoom(t){this._autoZoom!==t&&(this._autoZoom=t,this._wasResized=!0,this.updateView())},get autoZoom(){return this._autoZoom},set worldBounds(t){this._worldBounds!==t&&(this._worldBounds=t,this._wasResized=!0,this.updateView())},get worldBounds(){return this._worldBounds},set center(t){this._center=t,this.updateView()},set centerX(t){this._centerX=t,this.updateView()},set centerY(t){this._centerY=t,this.updateView()},get center(){return this._center},get centerX(){return this._centerX},get centerY(){return this._centerY}}},function(t,e,i){"use strict";function s(t,e,i,n){for(var h=null,l=window,u=t.split("."),c=u.length-1,d=u[c],f=0;f<c;f++)h=l,l=l[u[f]],l||(l={},h[u[f]]=l);var m=r[t],p=l[d],v=function(t,e,i,s,n,h){o||this.init&&this.init(t,e,i,s,n,h)},g=null,_=null;e?(o=!0,g=new e,_=g.__proto__,o=!1):(o=!0,g=new meta.class,o=!1);for(var y in i){var x=Object.getOwnPropertyDescriptor(i,y);x.get||x.set?Object.defineProperty(g,y,x):e&&"function"==typeof i[y]&&"function"==typeof _[y]&&a.test(i[y])?g[y]=function(t,e){return function(i,s,n,h,o,a){var r=this._super;this._super=_[t],this._fn=e;var l=this._fn(i,s,n,h,o,a);return this._super=r,l}}(y,i[y]):g[y]=i[y]}if(v.prototype=g,v.prototype.__name__=t,v.prototype.__lastName__=d,v.prototype.constructor=g.init||null,l[d]=v,p)for(var y in p)v[y]=p[y];if(m){var b=null,w=m.classes;for(c=w.length,f=0;f<c;f++)b=w[f],s(b.name,v,b.prop,b.cb);delete r[t]}n&&n(v,t)}function n(){this.classes=[]}function h(t,e,i){this.name=t,this.prop=e,this.cb=i}var o=!1,a=/\b_super\b/,r={};meta.class=function(t,e,i,s){o||meta.class._construct(t,e,i,s)},meta.class._construct=function(t,e,i,o){if(!t)return void console.error("(meta.class) Invalid class name");i||(i=e,e=null),i||(i={});var a=null;if(e){for(var l=null,u=window,c=e.split("."),d=c.length-1,f=0;f<d;f++)l=u,u=u[c[f]],u||(u={},l[c[f]]=u);var m=c[d];if(a=u[m],!a){var p=r[e];return p||(p=new n,r[e]=p),void p.classes.push(new h(t,i,o))}}s(t,a,i,o)},meta.classLoaded=function(){var t=0,e=null,i=null,s=0;for(var n in r)for(e=r[n],console.error("Undefined class: "+n),i=e.classes,s=i.length,t=0;t<s;t++)console.error("Undefined class: "+i[t].name);e={}}},function(t,e,i){"use strict";function s(t){var e=t.prototype.__name__.split(".").slice(2),i=e.length-1;if(t instanceof meta.Controller)return void console.error("(meta.controller): Controller parent class should be meta.Controller");for(var s,n=window,h=n,o=0;o<i;o++)s=e[o],n=h[s],n||(n={},h[s]=n),h=n;var s=e[i];return n[s]?void console.error("(meta.controller): Scope is already in use: "+e.join(".")):(t.prototype.name=s,void(meta.engine.inited?n[s]=new t:meta.cache.ctrlsToCreate?meta.cache.ctrlsToCreate.push({cls:t,scope:n}):meta.cache.ctrlsToCreate=[{cls:t,scope:n}]))}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};meta.class("meta.Controller",{init:function(){this.view=meta.createView("__ctrl__"+this.__lastName__+meta.cache.ctrlUniqueID++),this.onInit&&this.onInit()},onInit:null,load:function(){this.flags&this.Flag.LOADED||this.onTryLoad&&!this.onTryLoad()||this.forceLoad()},forceLoad:function(){this.flags&this.Flag.LOADED||(0===(this.flags&this.Flag.FIRST_LOADED)&&(this.onFirstLoad&&this.onFirstLoad(),this.flags|=this.Flag.FIRST_LOADED),this.onLoad&&this.onLoad(),meta.engine.controllersReady.push(this),meta.cache.view.attachView(this.view),this.flags|=this.Flag.LOADED)},unload:function(){0!==(this.flags&this.Flag.LOADED)&&(this.onTryUnload&&!this.onTryUnload()||this.forceUnload())},forceUnload:function(){if(0!==(this.flags&this.Flag.LOADED)){if(this.onUnload&&this.onUnload(),this.onUpdate)for(var t=meta.engine.controllersUpdate,e=t.length,i=0;i<e;i++)if(t[i]===this){t.splice(i,1);break}meta.cache.view.detachView(this.view),this.flags&=~(this.Flag.LOADED|this.Flag.READY)}},onTryLoad:null,onFirstLoad:null,onLoad:null,onTryUnload:null,onUnload:null,onFirstReady:null,onReady:null,ready:function(){this.flags&this.Flag.READY||(0===(this.flags&this.Flag.FIRST_READY)&&(this.onFirstReady&&this.onFirstReady(),this.flags|=this.Flag.FIRST_READY),this.onReady&&this.onReady(),this.onUpdate&&meta.engine.controllersUpdate.push(this),this.flags|=this.Flag.READY)},onUpdate:null,Flag:{LOADED:1,READY:2,FIRST_LOADED:4,FIRST_READY:8},name:"",view:null,flags:0}),meta.controllers={},meta.cache.ctrlUniqueID=0,meta.controller=function(t,e,i){i||("object"===("undefined"==typeof e?"undefined":n(e))?(i=e,e="meta.Controller"):i=null),e||(e="meta.Controller"),meta.class("meta.controllers."+t,e,i,s)},meta.class("meta.Component",{owner:null}),meta.component=function(t,e,i){meta.class(t,e,i)}},function(t,e,i){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};meta.Device=function(){this.name="unknown",this.version="0",this.versionBuffer=null,this.vendors=["","webkit","moz","ms","o"],this.vendor="",this.support={},this.audioFormats=[],this.mobile=!1,this.isPortrait=!1,this.audioAPI=!1,this.hidden=null,this.visibilityChange=null,this.fullScreenRequest=null,this.fullScreenExit=null,this.fullScreenOnChange=null,this.fullscreen=!1,this.load()},meta.Device.prototype={load:function(){this.checkBrowser(),this.mobile=this.isMobileAgent(),this.checkConsoleCSS(),this.checkFileAPI(),this.support.onloadedmetadata="object"===s(window.onloadedmetadata),this.support.onkeyup="object"===s(window.onkeyup),this.support.onkeydown="object"===s(window.onkeydown),this.support.canvas=this.isCanvasSupport(),this.support.webgl=this.isWebGLSupport(),this.modernize()},checkBrowser:function(){var t,e,i,s={Chrome:[/Chrome\/(\S+)/],Firefox:[/Firefox\/(\S+)/],MSIE:[/MSIE (\S+);/],Opera:[/OPR\/(\S+)/,/Opera\/.*?Version\/(\S+)/,/Opera\/(\S+)/],Safari:[/Version\/(\S+).*?Safari\//]},n=navigator.userAgent,h=2;for(t in s)for(;e=s[t].shift();)if(i=n.match(e)){this.version=i[1].match(new RegExp("[^.]+(?:.[^.]+){0,"+--h+"}"))[0],this.name=t,this.versionBuffer=this.version.split(".");for(var o=this.versionBuffer.length,a=0;a<o;a++)this.versionBuffer[a]=parseInt(this.versionBuffer[a]);break}null===this.versionBuffer||"unknown"===this.name?console.warn("(meta.Device.checkBrowser) Could not detect browser."):"Chrome"===this.name||"Safari"===this.name||"Opera"===this.name?this.vendor="webkit":"Firefox"===this.name?this.vendor="moz":"MSIE"===this.name&&(this.vendor="ms")},checkConsoleCSS:function(){this.mobile||"Chrome"!==this.name&&"Opera"!==this.name?this.support.consoleCSS=!1:this.support.consoleCSS=!0},checkFileAPI:function(){window.File&&window.FileReader&&window.FileList&&window.Blob?this.support.fileAPI=!0:this.support.fileAPI=!1},modernize:function(){Number.MAX_SAFE_INTEGER||(Number.MAX_SAFE_INTEGER=9007199254740991),this.supportConsole(),this.supportPageVisibility(),this.supportFullScreen(),this.supportRequestAnimFrame(),this.supportPerformanceNow(),this.supportAudioFormats(),this.supportAudioAPI(),this.supportFileSystemAPI()},isMobileAgent:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},isCanvasSupport:function(){return!!window.CanvasRenderingContext2D},isWebGLSupport:function(){var t=document.createElement("canvas"),e=t.getContext("webgl")||t.getContext("experimental-webgl");return!!e},supportConsole:function(){window.console||(window.console={},window.console.log=meta.emptyFuncParam,window.console.warn=meta.emptyFuncParam,window.console.error=meta.emptyFuncParam)},supportPageVisibility:function(){void 0!==document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):void 0!==document.hidden?(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"):void 0!==document.hidden?(this.hidden="mozhidden",this.visibilityChange="mozvisibilitychange"):void 0!==document.hidden&&(this.hidden="mshidden",this.visibilityChange="msvisibilitychange")},supportFullScreen:function(){this._fullScreenRequest(),this._fullScreenExit(),this._fullScreenOnChange(),this.support.fullScreen=document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled},_fullScreenRequest:function(){var t=document.documentElement;void 0!==t.requestFullscreen?this.fullScreenRequest="requestFullscreen":void 0!==t.webkitRequestFullscreen?this.fullScreenRequest="webkitRequestFullscreen":void 0!==t.mozRequestFullScreen?this.fullScreenRequest="mozRequestFullScreen":void 0!==t.msRequestFullscreen&&(this.fullScreenRequest="msRequestFullscreen")},_fullScreenExit:function(){void 0!==document.exitFullscreen?this.fullScreenExit="exitFullscreen":void 0!==document.webkitExitFullscreen?this.fullScreenExit="webkitExitFullscreen":void 0!==document.mozCancelFullScreen?this.fullScreenExit="mozCancelFullScreen":void 0!==document.msExitFullscreen&&(this.fullScreenExit="msExitFullscreen")},_fullScreenOnChange:function(){void 0!==document.onfullscreenchange?this.fullScreenOnChange="fullscreenchange":void 0!==document.onwebkitfullscreenchange?this.fullScreenOnChange="webkitfullscreenchange":void 0!==document.onmozfullscreenchange?this.fullScreenOnChange="mozfullscreenchange":void 0!==document.onmsfullscreenchange&&(this.fullScreenOnChange="msfullscreenchange")},supportRequestAnimFrame:function(){window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}())},supportPerformanceNow:function(){void 0===window.performance&&(window.performance={}),void 0===window.performance.now&&(window.performance.now=Date.now)},supportAudioFormats:function(){var t=document.createElement("audio");t.canPlayType("audio/mp4")&&this.audioFormats.push("m4a"),t.canPlayType("audio/ogg")&&this.audioFormats.push("ogg"),t.canPlayType("audio/mpeg")&&this.audioFormats.push("mp3"),t.canPlayType("audio/wav")&&this.audioFormats.push("wav")},supportAudioAPI:function(){window.AudioContext||(window.AudioContext=window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext),window.AudioContext&&(this.audioAPI=!0)},supportFileSystemAPI:function(){window.requestFileSystem||(window.requestFileSystem=window.webkitRequestFileSystem||window.mozRequestFileSystem||window.oRequestFileSystem||window.msRequestFileSystem),window.requestFileSystem&&(this.support.fileSystemAPI=!0)}},meta.device=new meta.Device},function(module,exports,__webpack_require__){"use strict";meta.engine={create:function(){this.onCreate(),this.parseFlags(),this._createRenderer(),this._printInfo(),this.autoMetaTags&&this._addMetaTags();var t=this;this.cb={resize:function(e){t.updateResolution()},focus:function(e){t.handleFocus(!0)},blur:function(e){t.handleFocus(!1)}},window.addEventListener("resize",this.cb.resize,!1),window.addEventListener("orientationchange",this.cb.resize,!1),meta.device.hidden&&(this.cb.visibilityChange=function(){t.handleVisibilityChange()},document.addEventListener(meta.device.visibilityChange,this.cb.visibilityChange)),window.addEventListener("focus",this.cb.focus),window.addEventListener("blur",this.cb.blur),meta.device.support.fullScreen&&(this.cb.fullscreen=function(){t.onFullScreenChangeCB()},document.addEventListener(meta.device.fullScreenOnChange,this.cb.fullscreen)),meta.camera=new meta.Camera,meta.world=new meta.World(0,0),meta.resources=new Resource.Manager,meta.input=new Input.Manager,meta.physics=new Physics.Manager,meta.steering=new Steering.Manager;var e=meta.resources;e.onLoadingStart.add(this.onLoadingStart,this),e.onLoadingEnd.add(this.onLoadingEnd,this),this._initAll()},onCreate:function(){this.onUpdate=meta.createChannel(meta.Event.UPDATE),this.onResize=meta.createChannel(meta.Event.RESIZE),this.onAdapt=meta.createChannel(meta.Event.ADAPT),this.onBlur=meta.createChannel(meta.Event.BLUR),this.onFocus=meta.createChannel(meta.Event.FOCUS),this.onFullscreen=meta.createChannel(meta.Event.FULLSCREEN),this.onDebug=meta.createChannel(meta.Event.DEBUG);for(var t=meta.cache.createFuncs,e=t.length,i=0;i<e;i++)t[i]();meta.cache.createFuncs=null,this._container||(this._container=document.body),this._container.style.cssText=this.elementStyle},parseFlags:function parseFlags(){for(var flag,flagName,flagValue,flagSepIndex,flags=window.location.hash.substr(1).split(","),num=flags.length,n=0;n<num;n++)flag=flags[n],flagSepIndex=flag.indexOf("="),flagSepIndex>0&&(flagName=flag.substr(0,flagSepIndex).replace(/ /g,""),flagValue=eval(flag.substr(flagSepIndex+1).replace(/ /g,"")),meta.flags[flagName]=flagValue)},_initAll:function(){this.time.current=Date.now();var t=meta.cache,e=new meta.View("master");t.views.master=e,t.view=e;for(var i,s=t.ctrlsToCreate,n=s.length,h=0;h<n;h++)i=s[h],i.scope[i.cls.prototype.name]=new i.cls;for(t.ctrlsToCreate=null,n=t.initFuncs.length,h=0;h<n;h++)t.initFuncs[h]();t.initFuncs=null,console.log(" "),this.flags|=this.Flag.INITED,this._loadAll()},_loadAll:function(){meta._loadAllScripts()||this._handlePreload()},_handlePreload:function(){this.meta.renderer.load(),this.meta.input.onDown.add(this.handleKeyDown,this);for(var t=meta.cache,e=t.preloadFuncs.length,i=0;i<e;i++)t.preloadFuncs[i]();var s=meta.cache.view;s.flags|=s.Flag.ACTIVE,s._activate(),this._startMainLoop(),meta.resources.loading||this._handleLoad()},_handleLoad:function(){this.flags|=this.Flag.PRELOADED;for(var t=meta.cache,e=t.loadFuncs.length,i=0;i<e;i++)t.loadFuncs[i]();this.loadPlugins(),meta.resources.loading||this._handleReady()},_handleReady:function(){this.flags|=this.Flag.LOADED,this.readyPlugins();for(var t=meta.cache.readyFuncs.length,e=0;e<t;e++)meta.cache.readyFuncs[e]();this.flags|=this.Flag.READY,meta.renderer.needRender=!0},loadPlugins:function(){for(var t=this.plugins.length,e=0;e<t;e++)this.plugins[e].load()},readyPlugins:function(){for(var t=this.plugins.length,e=0;e<t;e++)this.plugins[e].ready()},_startMainLoop:function(){var t=this;this._renderLoop=function(){t.render()},this.render()},update:function(t){var e,i;if(this._updateTimers(meta.time.delta),this.flags&this.Flag.READY&&(i=this.controllersReady.length,i>0&&!this.meta.resources.loading)){var s;for(e=0;e<this.controllersReady.length;e++)s=this.controllersReady[e],s.flags&s.Flag.LOADED&&s.ready();this.controllersReady.length=0}if(this.flags&this.Flag.LOADED){for(i=this.updateFuncs.length,e=0;e<i;e++)this.updateFuncs[e](t);for(i=this.controllersUpdate.length,e=0;e<i;e++)this.controllersUpdate[e].onUpdate(t);this.onUpdate.emit(t)}this.meta.renderer.update(t),this.meta.camera.update(t)},render:function(){this.time.frameIndex++;var t=Date.now();this.time.pause?(this.time.delta=0,this.time.deltaF=0):(this.time.delta=t-this.time.current,this.time.delta>this.time.maxDelta&&(this.time.delta=this.time.maxDelta),this.time.delta*=this.time.scale,this.time.deltaF=this.time.delta/1e3,this.time.accumulator+=this.time.delta),t-this.time.fps>=1e3&&(this.time.fps=t,this.fps=this._fpsCounter,this._fpsCounter=0),this.update(this.time.deltaF),meta.renderer.render(this.time.deltaF);for(var e=this.renderFuncs.length,i=0;i<e;i++)this.renderFuncs[i](this.time.tDeltaF);this._fpsCounter++,this.time.current=t,requestAnimationFrame(this._renderLoop)},_updateTimers:function(t){var e,i,s,n=this.timers.length,h=this.timersRemove.length;if(h>0){var o=n-h;if(o>0)for(var i,s=0;s<h;s++)i=this.timers.indexOf(this.timersRemove[s]),i<o?this.timers.splice(i,1):this.timers.pop();else this.timers.length=0;n=o,this.timersRemove.length=0}for(s=0;s<n;s++)if(e=this.timers[s],!e.paused)for(e.tAccumulator+=t;e.tAccumulator>=e.tDelta;)if(e.tAccumulator-=e.tDelta,0!==e.numTimes&&e.func.call(e.owner,e),e.tStart+=e.tDelta,e.numTimes!==-1&&(e.numTimes--,e.numTimes<=0)){this.timersRemove.push(e),e.__index=-1;break}},sortAdaptions:function(){var t=meta,e=t.cache.resolutions;if(e){var i=e.length;if(!(i<=1)){e.sort(function(e,i){var s=t.math.length2(e.width,e.height),n=t.math.length2(i.width,i.height);return s-n});for(var s,n,h=e[0],o=1;o<i;o++)n=e[o-1],s=e[o],s.unitSize=s.height/h.height,s.zoomThreshold=n.unitSize+(s.unitSize-n.unitSize)/100*33;meta.maxUnitSize=e[i-1].unitSize,meta.maxUnitRatio=1/meta.maxUnitSize,t.camera.bounds(h.width,h.height)}}},adaptResolution:function(){var t=meta,e=t.cache.resolutions;if(!e)return!1;var i=e.length;if(i<1)return!1;for(var s,n=e[0],h=t.camera.zoom,o=i-1;o>=0;o--)if(s=e[o],h>=s.zoomThreshold){n=s;break}return n===t.cache.currResolution||(t.cache.currResolution=n,t.unitSize=n.unitSize,t.unitRatio=1/t.unitSize,this.onAdapt.emit(n,meta.Event.ADAPT),!0)},handleKeyDown:function(t,e){switch(t.keyCode){case Input.Key.TILDE:meta.debug=!meta.cache.debug,meta.renderer.needRender=!0}},onLoadingStart:function(t,e){this.flags|=this.Flag.LOADING;var i;this.preloaded?(i="Loading",meta.loading.load()):(i="Preloading",meta.preloading.load()),meta.device.support.consoleCSS?console.log("%c("+i+" started)","background: #eee; font-weight: bold;"):console.log("("+i+" started)")},onLoadingEnd:function(t,e){this.flags&=~this.Flag.LOADING;var i;this.preloaded?(i="Loading",meta.loading.unload()):(i="Preloading",meta.preloading.unload()),meta.device.support.consoleCSS?console.log("%c("+i+" ended)","background: #eee; font-weight: bold;"):console.log("("+i+" ended)"),this.preloaded?this._handleReady():this._handleLoad(),meta.renderer.needRender=!0},onScriptLoadingEnd:function(){this._handlePreload()},updateLoading:function(){this.loading||this.scriptLoading||this._ready()},updateResolution:function(){this._resize(this.meta.cache.width,this.meta.cache.height)},resize:function(t,e){var i=this.meta.cache;i.width=t||0,i.height=e||0,this._resize(i.width,i.height)},_resize:function(){var t=this.meta.cache.width,e=this.meta.cache.height,i=0,s=0;if(this._container===document.body?(i=window.innerWidth,s=window.innerHeight):(i=this._container.clientWidth,s=this._container.clientHeight),0===t&&(t=i),0===e&&(e=s),this._adapt){this.zoom=1;var n=i-t,h=s-e;n<h?this.zoom=i/t:this.zoom=s/e,t*=this.zoom,e*=this.zoom}if(t=Math.round(t),e=Math.round(e),this.canvas){var o=window.devicePixelRatio||1,a=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,r=o/a;this.width=Math.ceil(t*r),this.height=Math.ceil(e*r),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width=t*this.scaleX+"px",this.canvas.style.height=e*this.scaleY+"px",this._center&&(this.canvas.style.left=Math.floor(.5*(window.innerWidth-t))+"px",this.canvas.style.top=Math.floor(.5*(window.innerHeight-e))+"px"),this.updateImageSmoothing(),this._updateOffset(),this.onResize.emit(this,meta.Event.RESIZE),meta.renderer.needRender=!0}},scale:function(t,e){this.scaleX=t||1,this.scaleY=e||this.scaleX,this._resize(this.meta.cache.width,this.meta.cache.height)},handleFocus:function(t){this.focus!==t&&(this.focus=t,this.enablePauseOnBlur&&(this.pause=!t),t?this.onFocus.emit(t,meta.Event.FOCUS):this.onBlur.emit(t,meta.Event.BLUR))},handleVisibilityChange:function(){document[meta.device.hidden]?this.handleFocus(!1):this.handleFocus(!0)},onFullScreenChangeCB:function(){var t=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;meta.device.fullscreen=!!t,this.onFullscreen.emit(meta.device.fullscreen,meta.Event.FULLSCREEN)},onCtxLost:function(){console.log("(Context lost)")},onCtxRestored:function(){console.log("(Context restored)")},_addMetaTags:function(){if(!this.metaTagsAdded){var t=document.createElement("meta");t.setAttribute("http-equiv","Content-Type"),t.setAttribute("content","text/html; charset=utf-8"),document.head.appendChild(t);var e=document.createElement("meta");e.setAttribute("http-equiv","encoding"),e.setAttribute("content","utf-8"),document.head.appendChild(e);var i="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height",s=document.createElement("meta");s.setAttribute("name","viewport"),s.setAttribute("content",i),document.head.appendChild(s);var n=document.createElement("meta");n.setAttribute("name","apple-mobile-web-app-capable"),n.setAttribute("content","yes"),document.head.appendChild(n);var h=document.createElement("meta");h.setAttribute("name","apple-mobile-web-app-status-bar-style"),h.setAttribute("content","black-translucent"),document.head.appendChild(h),this.metaTagsAdded=!0}},_createRenderer:function(){this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id","meta-canvas"),this.canvas.style.cssText=this.canvasStyle,meta.renderer=new meta.CanvasRenderer,this.updateResolution(),this._container?this._container.appendChild(this.canvas):document.body.appendChild(this.canvas)},_updateOffset:function(){this.offsetLeft=0,this.offsetTop=0;var t=this._container;if(t.offsetParent)do this.offsetLeft+=t.offsetLeft,this.offsetTop+=t.offsetTop;while(t=t.offsetParent);var e=this._container.getBoundingClientRect();this.offsetLeft+=e.left,this.offsetTop+=e.top,e=this.canvas.getBoundingClientRect(),this.offsetLeft+=e.left,this.offsetTop+=e.top},_printInfo:function(){meta.device.support.consoleCSS?(console.log("%c META2D v"+meta.version+" ","background: #000; color: white; font-size: 12px; padding: 2px 0 1px 0;","http://meta2d.com"),console.log("%cBrowser: %c"+meta.device.name+" "+meta.device.version+"\t","font-weight: bold; padding: 2px 0 1px 0;","padding: 2px 0 1px 0;"),console.log("%cRenderer: %cCanvas ","font-weight: bold; padding: 2px 0 2px 0;","padding: 2px 0 2px 0;")):(console.log("META2D v"+meta.version+" http://meta2d.com "),console.log("Browser: "+meta.device.name+" "+meta.device.version+"\t"),console.log("Renderer: Canvas "))},fullscreen:function(t){var e=meta.device;if(e.fullscreen!==t)if(t){if(!e.support.fullScreen)return void console.warn("(meta.engine.fullscreen): Device does not support fullscreen mode");console.log(e.fullScreenRequest),document.documentElement[e.fullScreenRequest](Element.ALLOW_KEYBOARD_INPUT)}else console.log("exit"),document[meta.device.fullScreenExit]()},toggleFullscreen:function(){this.fullscreen(!meta.device.fullscreen)},set container(t){this._container!==t&&(this._container&&this._container.removeChild(this.canvas),t?this._container=t:this._container=document.body,this.canvas&&(this._container.appendChild(this.canvas),this.updateResolution()))},get container(){return this._container},updateImageSmoothing:function(){this.ctx.imageSmoothingEnabled?this.ctx.imageSmoothingEnabled=meta.cache.imageSmoothing:this.ctx[meta.device.vendor+"ImageSmoothingEnabled"]=meta.cache.imageSmoothing},set imageSmoothing(t){meta.cache.imageSmoothing=t,this.inited&&this.updateImageSmoothing()},get imageSmoothing(){return meta.cache.imageSmoothing},set cursor(t){this._container.style.cursor=t},get cursor(){return this._container.style.cursor},set center(t){this._center=t,this.updateResolution()},get center(){return this._center},set adapt(t){this._adapt=t,this.updateResolution()},get adapt(){return this._adapt},get inited(){return(this.flags&this.Flag.INITED)===this.Flag.INITED},get loading(){return(this.flags&this.Flag.LOADING)===this.Flag.LOADING},get preloaded(){return(this.flags&this.Flag.PRELOADED)===this.Flag.PRELOADED},get loaded(){return(this.flags&this.Flag.LOADED)===this.Flag.LOADED},get ready(){return(this.flags&this.Flag.READY)===this.Flag.READY},Flag:{LOADING:1,INITED:2,PRELOADED:4,LOADED:8,READY:16},onUpdate:null,onResize:null,onBlur:null,onFocus:null,onFullscreen:null,onDebug:null,elementStyle:"padding:0; margin:0;",canvasStyle:"position:absolute; overflow:hidden; translateZ(0); -webkit-backface-visibility:hidden; -webkit-perspective: 1000; -webkit-touch-callout: none; -webkit-user-select: none; zoom: 1;",meta:meta,time:meta.time,_container:null,width:0,height:0,offsetLeft:0,offsetTop:0,scaleX:1,scaleY:1,zoom:1,ratio:1,canvas:null,ctx:null,cb:null,autoInit:!0,autoMetaTags:!0,flags:0,focus:!1,pause:!1,webgl:!1,_center:!1,_adapt:!1,_updateLoop:null,_renderLoop:null,updateFuncs:[],renderFuncs:[],plugins:[],controllersReady:[],controllersUpdate:[],timers:[],timersRemove:[],fps:0,_fpsCounter:0,enablePauseOnBlur:!0,enableAdaptive:!0,unitSize:1,unitRatio:1,maxUnitSize:1,maxUnitRatio:1}},function(t,e,i){"use strict";meta.Event={UPDATE:"update",RESIZE:"resize",WORLD_RESIZE:"world-resize",CAMERA_MOVE:"camera-move",CAMERA_RESIZE:"camera-resize",BLUR:"blur",FOCUS:"focus",FULLSCREEN:"fullscreen",ADAPT:"adapt",DEBUG:"debug",RENDER_DEBUG:"debug-draw"},meta.Priority={LOW:0,MEDIUM:5e3,HIGH:1e4},meta.Cursor={ALIAS:"alias",ALL_SCROLL:"all-scroll",CELL:"cell",CONTEXT_MENU:"context-menu",COL_RESIZE:"col-resize",COPY:"copy",CROSSHAIR:"crosshair",DEFAULT:"default",E_RESIZE:"e-resize",EW_RESIZE:"ew-resize",GRAB:"grab",GRABBING:"grabbing",HELP:"help",MOVE:"move",N_RESIZE:"n-resize",NE_RESIZE:"ne-resize",NESW_RESIZE:"nesw-resize",NS_RESIZE:"ns-reisize",NW_RESIZE:"nw-resize",NWSE_RESIZE:"nwse-resize",NO_DROP:"no-drop",NONE:"none",NOT_ALLOWED:"not-allowed",POINTER:"pointer",PROGRESS:"progress",ROW_RESIZE:"row-resize",S_RESIZE:"s-resize",SE_RESIZE:"se-resize",SW_RESIZE:"sw-resize",TEXT:"text",VERTICAL_TEXT:"vertical-text",W_RESIZE:"w-resize",WAIT:"wait",ZOOM_IN:"zoom-in",ZOOM_OUT:"zoom-out",INITIAL:"initial"}},function(t,e,i){"use strict";meta.device.mobile&&(window.onerror=function(t,e,i){alert(e+": "+i+" "+t)})},function(t,e,i){"use strict";meta.createEngine=function(){meta.onDomLoad(function(){meta.classLoaded(),meta.engine.autoInit&&meta.engine.create()})},meta.loadScript=function(t,e){meta.engine&&meta.engine.isLoaded?meta._loadScript({s:t,c:e}):(meta.cache.scripts||(meta.cache.scripts=[]),meta.cache.scripts.push({s:t,c:e}))},meta._loadScript=function(t){var e=document.createElement("script"),i=document.scripts[0];"async"in i?(e.async=!1,e.onload=t.c,e.src=t.s,document.head.appendChild(e)):i.readyState?(meta.cache.pendingScripts||(meta.cache.pendingScripts=[]),meta.cache.pendingScripts.push(e),e.onreadystatechange=meta._onReadyStateChange,e.src=t.s):document.write("<script src='"+src+"' defer></script>")},meta._onReadyStateChange=function(){for(var t,e=meta.cache.pendingScripts;e[0]&&"loaded"===e[0].s.readyState;)t=e.shift(),t.s.onreadystatechange=null,
document.scripts[0].parentNode.insertBefore(t.s,firstScript),t.c&&t.c()},meta._loadAllScripts=function(){var t=meta.cache.scripts;if(!t)return!1;var e=t.length;if(0===e)return!1;var i,s=function t(){var e=meta.cache;e.numScriptsToLoad--;var i=meta.cache.scripts,s=i.length;if(s>0){e.numScriptsToLoad+=s,e.scripts=[];for(var n,h=0;h<s;h++)n=i[h],n.c=t,meta._loadScript(n)}0===e.numScriptsToLoad&&(e.scripts=null,meta.engine.onScriptLoadingEnd())},n=meta.cache;n.numScriptsToLoad+=t.length,n.scripts=[];for(var h=0;h<e;h++)i=t[h],i.c=s,meta._loadScript(i);return!0},meta.import=function(t){if(t){var e=t.split("/");e[0];meta.isUrl(t)||(t=meta.importUrl+t+"/"+t+".js"),meta.loadScript(t,null)}},meta.createEngine()},function(t,e,i){"use strict";meta.controller("meta.Loading",{onInit:function(){meta.preloading=this,meta.loading=this},onFirstLoad:function(){this.view.z=Number.MAX_SAFE_INTEGER-10,this.view.static=!0;var t=new Resource.SVG;t.fillStyle="#030303",t.fillRect(0,0,1,1),this.bg=new Entity.Geometry(t),this.bg.fitIn(meta.camera.width,meta.camera.height),this.view.attach(this.bg);var e=new Resource.SVG;e.fillStyle="#222",e.fillRect(0,0,100,4);var i=new Entity.Geometry(e);i.pivot(.5),i.anchor(.5),this.view.attach(i);var s=new Resource.SVG;s.fillStyle="white",s.fillRect(0,0,100,4),this.progress=new Entity.Geometry(s),this.progress.clipBounds(0,4),this.progress.pivot(.5),this.progress.anchor(.5),this.view.attach(this.progress)},onLoad:function(){meta.camera.onResize.add(this.onResize,this),meta.resources.onLoadingUpdate.add(this.onResourceLoaded,this)},onUnload:function(){meta.camera.onResize.remove(this),meta.resources.onLoadingUpdate.remove(this)},onResize:function(t){this.bg.fitIn(t.width,t.height)},onResourceLoaded:function(t){var e=Math.min(100/t.numTotalToLoad*(t.numTotalToLoad-t.numToLoad),100);this.progress.clipBounds(e,4)},bg:null,progress:null})},function(t,e,i){"use strict"},function(t,e,i){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};meta.Channel=function(t){this.name=t,this.subs=[],this.numSubs=0,this._emitting=!1,this._subsToRemove=null},meta.Channel.prototype={emit:function(t,e){this._emitting=!0;for(var i,s=0;s<this.numSubs;s++)i=this.subs[s],i.func.call(i.owner,t,e);if(this._emitting=!1,this._subsToRemove){for(var n=this._subsToRemove.length,h=0;h<n;h++)this.remove(this._subsToRemove[h]);this._subsToRemove=null}},add:function(t,e,i){if(i=i||0,!t)return console.warn("(meta.Channel.subscribe) No valid callback function passed."),!1;for(var s=0;s<this.numSubs;s++)if(this.subs[s].owner===e)return!1;var n=new meta.Subscriber(e,t,i);return this.subs.push(n),this.numSubs++,i?(this._havePriority=!0,this.subs.sort(this._sortFunc)):this._havePriority&&this.subs.sort(this._sortFunc),!0},remove:function(t){if(null===t||void 0===t)meta.channels[this.name]=null;else{if(this._emitting)return this._subsToRemove||(this._subsToRemove=[]),void this._subsToRemove.push(t);for(var e,i=0;i<this.numSubs;i++)if(e=this.subs[i],e.owner===t){this.subs[i]=this.subs[this.numSubs-1],this.subs.pop(),this.numSubs--;break}this._havePriority&&this.subs.sort(this._sortFunc)}},removeAll:function(){this.subs=[],this.numSubs=0},_sortFunc:function(t,e){return t.priority>e.priority?-1:1},_havePriority:!1},meta.Subscriber=function(t,e,i){this.owner=t,this.func=e,this.priority=i},meta.createChannel=function(t){if(!t)return console.warn("(meta.createChannel) No name was specified!"),null;var e=meta.channels[t];return e||(e=new meta.Channel(t),meta.channels[t]=e),e},meta.releaseChannel=function(t){return t?void(meta.channels[t]&&(meta.channels[t]=null)):void console.warn("(meta.releaseChannel) No name was specified!")},meta.subscribe=function(t,e,i,n){if("object"!==("undefined"==typeof i?"undefined":s(i)))return void console.warn("(meta.subscribe) No owner passed.");if(!e)return void console.warn("(meta.subscribe) No callback function passed.");if("string"!=typeof t){if("[object Array]"===Object.prototype.toString.call(t)){for(var h=t.length,o=0;o<h;o++)meta.subscribe(t[o],e,i,n);return}return void console.warn("(meta.subscribe) Wrong type for channel object: "+("undefined"==typeof t?"undefined":s(t)))}var a=meta.channels[t];if(a)t=a;else if(t=meta.createChannel(t),!t)return;t.add(e,i,n)},meta.unsubscribe=function(t,e){if("string"!=typeof t){if("[object Array]"===Object.prototype.toString.call(t)){for(var i=t.length,s=0;s<i;s++)meta.unsubscribe(t[s],e);return}return void console.warn("(meta.unsubscribe) Wrong type for channel object.")}return(t=meta.channels[t])?void t.remove(e):void console.warn("(meta.unsubscribe) No name was specified!")},meta.emit=function(t,e,i){return"string"!=typeof t||(t=meta.channels[t])?void t.emit(e,i):void console.warn("(meta.emit) No name was specified!")}},function(t,e,i){"use strict";meta.Timer=function(t,e,i,s){this.owner=t,this.id=meta.cache.timerIndex++,this.func=e,this.onRemove=null,this.tDelta=i,this.numTimes=s,void 0===this.numTimes&&(this.numTimes=-1),this.initNumTimes=this.numTimes,this.tAccumulator=0,this.tStart=Date.now(),this.__index=-1},meta.Timer.prototype={play:function(){this.__index===-1&&(this.__index=meta.engine.timers.push(this)-1)},stop:function(){this.__index!==-1&&(meta.engine.timersRemove.push(this),this.__index=-1)},pause:function(){this.paused=!0},resume:function(){this.paused=!1,this.tStart=Date.now()},reset:function(){this.tAccumulator=0,this.numTimes=this.initNumTimes,this.paused=!1,this.play()},onRemove:null,paused:!1},meta.createTimer=function(t,e,i,s){if("function"==typeof t&&(s=i,i=e,e=t,t=window),!e)return void console.warn("(meta.addTimer) Invalid function passed");var n=new meta.Timer(t,e,i,s);return n},meta.addTimer=function(t,e,i,s){var n=meta.createTimer(t,e,i,s);return n.play(),n}},function(t,e,i){"use strict";meta.emptyFunc=function(){},meta.emptyFuncParam=function(t){},meta.enumNames=function(t,e,i,s){for(var n,h=new Array(s-i),o=e.length,a=i;a<=s;a++)n=Math.floor(a/10),h[a]=t+e.substr(0,o-n-1)+a;return h},meta.getNameFromPath=function(t){var e=t.lastIndexOf("."),i=t.lastIndexOf("/");return e<0||t.length-e>5?t.slice(i+1):t.slice(i+1,e)},meta.randomItem=function(t){return t[meta.random.number(0,t.length-1)]},meta.loadFile=function(t,e){t instanceof File||console.warn("(meta.loadFile) Invalid file has been passed.");var i=new Resource.Texture(t,e);return i},meta.onDomLoad=function(t){if("interactive"===document.readyState||"complete"===document.readyState)return void t();var e=function e(i){t(),window.removeEventListener("DOMContentLoaded",e)};window.addEventListener("DOMContentLoaded",e)},meta.enumToString=function(t,e){if(void 0===t)return"unknown";for(var i in t)if(t[i]===e)return i;return"unknown"},meta.hexToRgb=function(t){t.length<6&&(t+=t.substr(1,4));var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}},meta.isUrl=function(t){return t.indexOf("http://")!==-1||t.indexOf("https://")!==-1},meta.toUpperFirstChar=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},meta.serialize=function(t){var e=[];for(var i in t)e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e.join("&")},meta.info=function(t){var e,i,s;if(meta.cache.infoView){e=meta.cache.infoView.entities[0],i=e.texture,s=e.children[0],s.text=t;var n=s.width,h=s.height+10;i.resize(n,h),i.fillRect(0,0,n,h)}else meta.cache.infoView=new meta.View("meta.info"),meta.cache.infoView.static=!0,s=new Entity.Text(t),s.anchor(.5),s.pivot(.5),i=new Resource.SVG,i.fillStyle="black",i.fillRect(0,0,s.width+10,s.height+10),e=new Entity.Geometry(i),e.z=999999,e.pivot(.5,0),e.anchor(.5,0),e.position(0,10),e.attach(s),meta.cache.infoView.attach(e),meta.view.attachView(meta.cache.infoView)},meta.adaptTo=function(t,e,i){if(meta.engine&&meta.engine.isInited)return void console.warn("[meta.adaptTo]:","Only usable before engine is initialized.");var s=meta.cache.resolutions;s||(s=[],meta.cache.resolutions=s);var n=i.charAt(i.length-1);"/"!==n&&(i+="/");var h={width:t,height:e,path:i,unitSize:1,zoomThreshold:1};s.push(h)},meta.removeFromArray=function(t,e){for(var i=e.length,s=0;s<i;s++)if(t===e[s]){e[s]=e[i-1],e.pop();break}},meta.shuffleArray=function(t){for(var e,i,s=meta.random,n=t.length;n;)i=s.number(0,--n),e=t[n],t[n]=t[i],t[i]=e;return t},meta.shuffleArrayRange=function(t,e,i){for(var s,n,i=i||0,h=meta.random;e>i;)n=h.number(0,--e),s=t[e],t[e]=t[n],t[n]=s;return t},meta.mapArray=function(t){for(var e={},i=t.length,s=0;s<i;s++)e[t[s]]=s;return e},meta.rotateArray=function(t){for(var e=t[0],i=t.length-1,s=0;s<i;s++)t[s]=t[s+1];t[i]=e},meta.nextPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t++,t},meta.toHex=function(t){var e=t.toString(16);return 1==e.length?"0"+e:e},meta.rgbToHex=function(t,e,i){return"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},meta.isSpace=function(t){return" "===t||"\t"===t||"\r"===t||"\n"===t},meta.isNewline=function(t){return"\r"===t||"\n"===t},meta.isDigit=function(t){return t>="0"&&t<="9"||"."===t},meta.isAlpha=function(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||"_"==t&&t<="$"},meta.isAlphaNum=function(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||"_"===t||"$"===t},meta.isBinOp=function(t){return"="===t||"!"===t||"<"===t||">"===t||"+"===t||"-"===t||"*"===t||"/"===t||"&"===t||"~"===t||"|"===t||"%"===t},meta.getClsFromPath=function(t){for(var e=null,i=window,s=t.length,n=0;n<s;n++)if(i=i[t[n]],!i)return null;return e},meta.decodeBinaryBase64=function(t){for(var e=atob(t),i=e.length,s=new Array(i/4),n=0,h=0;n<i;n+=4,h++)s[h]=e.charCodeAt(n)|e.charCodeAt(n+1)<<8|e.charCodeAt(n+2)<<16|e.charCodeAt(n+3)<<24;return s}},function(t,e,i){"use strict";meta.View=function(t){this.name=t,this.entities=[],this.children=null,this.parent=null,this.flags=0},meta.View.prototype={remove:function(){if("master"===this.name)return void console.warn("(meta.View.remove) Master view can't be removed");this.parent&&this.parent.detachView(this);for(var t=this.entities.length,e=0;e<t;e++)this.entities[e].remove();if(this.entities.length=0,this.children)for(t=this.children.length,e=0;e<t;e++)this.children[e].remove()},attach:function(t){return t instanceof Entity.Geometry?t.flags&this.Flag.REMOVED?void console.warn("(meta.View.attach) Trying to add entity that has been marked as removed"):t._view?void(t._view===this?console.warn("(meta.View.attach) Entity is already added to this view"):console.warn("(meta.View.attach) Entity is already added to some other view")):(t.parent!==this.entityParent&&(t.parent=this.entityParent),t.flags|=t.Flag.ROOT,t._view=this,0===this._x&&0===this._y||t.updatePos(),0!==this._z&&t.updateZ(),this.entities.push(t),this._attachChildren(t.children),void(this.flags&this.Flag.ACTIVE&&!(this.flags&this.Flag.INSTANCE_HIDDEN)&&meta.renderer.addEntity(t,!1))):void console.warn("(meta.View.attach) Trying to add invalid entity")},_attachChildren:function(t){if(t)for(var e,i=t.length,s=0;s<i;s++)e=t[s],e.removed||(e._view=this,this._attachChildren(e.children))},detach:function(t){if(!(t.flags&this.Flag.REMOVED)){if(!t._view)return void console.warn("(meta.View.detach) Entity does not have view.");if(t._view!==this)return void console.warn("(meta.View.detach) Entity is part of other view: "+t._view.name);var e=this.entities.length,i=this.entities.indexOf(t);i>-1&&(this.entities[i]=this.entities[e-1],this.entities.pop()),this.flags&this.Flag.ACTIVE&&!(this.flags&this.Flag.INSTANCE_HIDDEN)&&(meta.renderer.removeEntity(t),t._view=null)}},attachView:function(t){if(!t)return this.parent?void console.warn("(meta.View.attach) No view was passed."):void meta.cache.view.attachView(this);if("string"==typeof t){var e=meta.cache.views[t];if(!e)return void console.warn("(meta.View.attach) No such view found: "+t);t=e}else if(!(t instanceof meta.View))return void console.warn("(meta.View.attach) Trying to attach invalid view object.");return t.parent?void console.warn("(meta.View.attach) View is already part of other view."):(this.children?this.children.push(t):this.children=[t],t.parent=this,void(this.flags&this.Flag.ACTIVE&&t._activate()))},detachView:function(t){if(!t)return this.parent?void this.parent.detachView(this):void console.warn("(meta.View.detachView) No view was been passed.");if("string"==typeof t){var e=meta.cache.views[t];if(!e)return void console.warn('(meta.View.detachView) No such view found: "'+t+'"');t=e}if(!t.parent)return void console.warn("(meta.View.detachView) View has not parents to detach from");if(this.children)for(var i=this.children.length,s=0;s<i;s++)if(this.children[s]===t){this.children[s]=this.children[i-1],this.children.pop();break}t.parent=null,this.flags&this.Flag.ACTIVE&&t._deactivate()},detachViews:function(){for(var t,e=this.children.length,i=0;i<e;i++)t=this.children[i],t.detachView(t)},_activate:function(){if(this.flags|=this.Flag.ACTIVE,!(this.flags&this.Flag.INSTANCE_HIDDEN)&&(meta.renderer.addEntities(this.entities),this.children))for(var t=this.children.length,e=0;e<t;e++)this.children[e]._activate()},_deactivate:function(){if(this.flags&=~this.Flag.ACTIVE,!(this.flags&this.Flag.INSTANCE_HIDDEN)&&(meta.renderer.removeEntities(this.entities),this.children))for(var t=this.children.length,e=0;e<t;e++)this.children[e]._deactivate()},get active(){return(this.flags&this.Flag.ACTIVE)===this.Flag.ACTIVE},_updateHidden:function(){if(this.flags&this.Flag.INSTANCE_HIDDEN){if(this.flags&this.Flag.HIDDEN)return;if(this.parent.flags&this.Flag.INSTANCE_HIDDEN)return;this.flags&=~this.Flag.INSTANCE_HIDDEN,this.flags&this.Flag.ACTIVE&&meta.renderer.removeEntities(this.entities)}else{if(!(this.flags&this.Flag.HIDDEN||this.parent.flags&this.Flag.INSTANCE_HIDDEN))return;this.flags|=this.Flag.INSTANCE_HIDDEN,this.flags&this.Flag.ACTIVE&&meta.renderer.addEntities(this.entities)}if(this.children)for(var t=this.children.length,e=0;e<t;e++)this.children[e]._updateHidden()},set hidden(t){t?this.flags|=this.Flag.HIDDEN:this.flags&=~this.Flag.HIDDEN,this._updateHidden()},get hidden(){return(this.flags&this.Flag.HIDDEN)===this.Flag.HIDDEN},updateEntity:function(t){0!==(this.flags&this.Flag.ACTIVE)&&(this.flags&this.Flag.INSTANCE_HIDDEN||(t.flags&t.Flag.INSTANCE_ENABLED?meta.renderer.addEntity(t):meta.renderer.removeEntity(t)))},set x(t){if(this._x!==t){this._x=t;for(var e=this.entities.length,i=0;i<e;i++)this.entities[i].updatePos()}},set y(t){if(this._y!==t){this._y=t;for(var e=this.entities.length,i=0;i<e;i++)this.entities[i].updatePos()}},set z(t){this._z=t;for(var e=this.entities.length,i=0;i<e;i++)this.entities[i].updateZ()},get x(){return this._x},get y(){return this._y},get z(){return this._z},get tween(){return this._tween||(this._tween=new meta.Tween(this)),this._tween},set static(t){if(this.flags&this.Flag.ACTIVE)return void console.error("(meta.View.set::static) Can`t change static mode if view is already active");t?(this.flags|=this.Flag.STATIC,this.entityParent=meta.renderer.staticHolder,this.entityBuffer=meta.renderer.entitiesStatic,this.entityBufferRemove=meta.renderer.entitiesStaticRemove):(this.flags&=~this.Flag.STATIC,this.entityParent=meta.renderer.holder,this.entityBuffer=meta.renderer.entities,this.entityBufferRemove=meta.renderer.entitiesRemove);for(var e=this.entities.length,i=0;i<e;i++)this.entities[i].parent=this.entityParent},get static(){return(this.flags&this.Flag.STATIC)===this.Flag.STATIC},set debugger(t){if(this.flags&this.Flag.ACTIVE)return void console.error("(meta.View.set::debugger) Can`t change debugger mode if view is already active");t?(this.flags|=this.Flag.DEBUGGER,this.entityParent=meta.renderer.staticHolder,this.entityBuffer=meta.renderer.entitiesDebug,this.entityBufferRemove=meta.renderer.entitiesDebugRemove):(this.flags&=~this.Flag.DEBUGGER,this.entityParent=meta.renderer.holder,this.entityBuffer=meta.renderer.entities,this.entityBufferRemove=meta.renderer.entitiesRemove);for(var e=this.entities.length,i=0;i<e;i++)this.entities[i].parent=this.entityParent},get debugger(){return(this.flags&this.Flag.DEBUGGER)===this.Flag.DEBUGGER},Flag:{HIDDEN:1,INSTANCE_HIDDEN:2,ACTIVE:4,STATIC:8,DEBUGGER:16},_x:0,_y:0,_z:0,_tween:null,entityParent:null,entityBuffer:null,entityBufferRemove:null},meta.createView=function(t){if(!t||"string"!=typeof t)return void console.error("(meta.createView) Invalid name of the view");var e=meta.cache.views[t];return e?void console.error("(meta.createView) View with a name - "+t+", already exist"):(e=new meta.View(t),meta.cache.views[t]=e,e)},meta.setView=function(t){if(!t)return void console.error("(meta.setView) No view passed");var e=meta.cache;if("string"==typeof t){var i=t;t=e.views[i],t||(console.warn("(meta.setView) Creating an empty view, could be unintended - "+i),t=new meta.View(i),e.views[i]=t)}var s=e.view;return t===s?void console.warn("(meta.setView) Cannot modify master view"):t.parentView?void console.warn("(meta.setView) View is already attached to master or other view"):(e.view.detachViews(),void e.view.attachView(t))},meta.getView=function(t){if(!t)return console.error("(meta.getView) No name specified"),null;var e=meta.cache.views[t];return e||(e=new meta.View(t),meta.cache.views[t]=e),e},meta.attachView=function(t){var e=meta.cache;if("string"==typeof t){var i=e.views[t];if(!i)return void console.warn("(meta.attachView) No such view found: "+t);t=i}return t.parentView?void console.warn("(meta.attachView) View already has parent attached"):void e.view.attachView(t)},meta.detachView=function(t){var e=meta.cache;if("string"==typeof t){var i=e.views[t];if(!t)return void console.warn("(meta.detachView) No such view found: "+t);t=i}return t.parentView?void e.view.detachView(t):void console.warn("(meta.detachView) View does not have parent attached")},Object.defineProperty(meta,"view",{set:function(t){meta.setView(t)},get:function(){return meta.cache.view}})},function(t,e,i){"use strict";meta.class("meta.World",{init:function(t,e){this.volume=new meta.math.AABB(0,0,0,0),this.volumes=[this.volume],this.onResize=meta.createChannel(meta.Event.WORLD_RESIZE),meta.camera.onResize.add(this._updateBounds,this)},bounds:function(t,e,i,s){this.volume.set(t,e,i-t,s-e),this.centerX=t+(i-t)/2,this.centerY=e+(s-e)/2,this._adapt=!1},_updateBounds:function(t,e){this._adapt&&(this.volume.set(0,0,Math.ceil(t.width),Math.ceil(t.height)),this.centerX=t.width/2,this.centerY=t.height/2)},removeVolume:function(t){for(var e=this.volumes.length,i=0;i<e;i++)if(this.volumes[i]===t){this.volumes[i]=this.volumes[e-1],this.volumes.pop();break}},get randX(){return meta.random.number(this.volume.minX,this.volume.maxX)},get randY(){return meta.random.number(this.volume.minY,this.volume.maxY)},set adapt(t){this._adapt=t,t&&this._updateBounds(meta.camera,0)},get adapt(){return this._adapt},get width(){return this.volume.width},get height(){return this.volume.height},onResize:null,volume:null,centerX:0,centerY:0,volumes:null,_adapt:!0,_screenBounds:!0})},function(t,e,i){"use strict";meta.component("Component.Anim",{set:function(t){return t?(this.texture=t,void(t.frames>1?(this.texture=t,this.fps=t.fps,this.__tAnim=0,this.reverse?this._frame=t.frames-1:this._frame=0,this.autoPlay&&meta.renderer.addAnim(this)):this.__index!==-1&&meta.renderer.removeAnim(this))):(this.__index!==-1&&meta.renderer.removeAnim(this),void(this.texture=null))},play:function(t,e){return this.texture?(this.loop=t||!1,this.fps=e||this.texture.fps,void meta.renderer.addAnim(this)):void console.warn("(Component.Anim.play) Invalid texture")},pause:function(){meta.renderer.removeAnim(this)},resume:function(){meta.renderer.addAnim(this)},stop:function(){this.reverse?this._frame=texture.frames-1:this._frame=0,meta.renderer.removeAnim(this)},reset:function(){this.reverse?this._frame=texture.frames-1:this._frame=0,meta.renderer.addAnim(this)},onEnd:null,onCancel:null,update:function(t){if(this.__tAnim+=t,!(this.__tAnim<this.__delay)){var e=this.__tAnim/this.__delay|0;this.__tAnim-=e*this.__delay,this.reverse?(this._frame-=e,this._frame<0&&(this.pauseLastFrame?(meta.renderer.removeAnim(this),this._frame=0):this.loop?this._frame=(this.texture.frames+this._frame)%this.texture.frames:(meta.renderer.removeAnim(this),this._frame=this.texture.frames-1),this.onEnd&&this.onEnd.call(this.owner))):(this._frame+=e,this._frame>=this.texture.frames&&(this.pauseLastFrame?(meta.renderer.removeAnim(this),this._frame=this.texture.frames-1):this.loop?this._frame=this._frame%this.texture.frames:(meta.renderer.removeAnim(this),this._frame=0),this.onEnd&&this.onEnd.call(this.owner))),this.owner.renderer.needRender=!0}},set frame(t){this._frame=t,this.owner.renderer.needRender=!0},get frame(){return this._frame},set fps(t){this._fps=t,this.__delay=1/(t*this._speed)},get fps(){return this._fps},set speed(t){this._speed=t,this.__delay=1/(fps*this._speed)},get speed(){return this._speed},set paused(t){t?this.pause():this.resume()},get paused(){return!0},loop:!0,reverse:!1,autoPlay:!0,pauseLastFrame:!1,_fps:0,_speed:1,_frame:0,__index:-1,__delay:0,__tAnim:0})},function(t,e,i){"use strict";meta.class("Component.Basic",{set updating(t){if(t){if(this._updating)return;if(this._updating=!0,this.owner.flags&this.owner.Flag.INSTANCE_ENABLED)if(this._updateIndex>-1){var e=meta.renderer.compsUpdateRemove,i=e.indexOf(this);e[i]=null}else{var s=meta.renderer.compsUpdate;s.push(this),this._updateIndex=s.length}}else{if(!this._updating)return;this._updating=!1,this._updateIndex>-1&&meta.renderer.compsUpdateRemove.push(this)}},get updating(){return this._updating},owner:null,_updating:!1,_updateIndex:-1})},function(t,e,i){"use strict";meta.controller("meta.debugger",{onFirstLoad:function(){this.view.debugger=!0,this.view.z=1e6;var t=new Resource.SVG;t.fillRect(0,0,200,290),this.holder=new Entity.Geometry(t),this.holder.anchor(0,1),this.holder.pivot(0,1),this.view.attach(this.holder);var e=new Entity.Text;e.position(10,10),e.text="fps: 60",this.holder.attach(e);var i=new Entity.Text;i.position(10,25),this.holder.attach(i);var s=new Entity.Text;s.position(10,40),s.text="entities: 0, static: 0",this.holder.attach(s);var n=new Entity.Text;n.position(10,65),this.holder.attach(n);var h=new Entity.Text;h.text="world:",h.position(10,90),this.holder.attach(h);var o=new Entity.Text;o.position(20,105),this.holder.attach(o);var a=new Entity.Text;a.position(20,120),this.holder.attach(a);var r=new Entity.Text;r.position(20,135),this.holder.attach(r);var l=new Entity.Text;l.text="camera:",l.position(10,155),this.holder.attach(l);var u=new Entity.Text;u.position(20,170),this.holder.attach(u);var c=new Entity.Text;c.position(20,185),this.holder.attach(c);var d=new Entity.Text;d.position(20,200),this.holder.attach(d);var f=new Entity.Text;f.position(20,215),this.holder.attach(f);var m=new Entity.Text;m.text="cursor:",m.position(10,235),this.holder.attach(m);var p=new Entity.Text;p.position(20,250),this.holder.attach(p);var v=new Entity.Text;v.position(20,265),this.holder.attach(v),this.txt={fps:e,memory:i,entities:s,resolution:n,worldBoundsMin:o,worldBoundsMax:a,worldResolution:r,cameraBoundsMin:u,cameraBoundsMax:c,cameraResolution:d,cameraZoom:f,world:p,screen:v}},onLoad:function(){this.timer=meta.addTimer(this,this.updateStats,1e3),meta.input.onMove.add(this.handleInputMove,this),meta.engine.onResize.add(this.handleResize,this),meta.world.onResize.add(this.handleWorldResize,this),meta.camera.onResize.add(this.handleCameraResize,this),meta.camera.onMove.add(this.handleCameraMove,this),this.handleInputMove(meta.input,0),this.handleResize(meta.engine),this.handleWorldResize(meta.world,0),this.handleCameraResize(meta.camera,0),this.handleCameraMove(meta.camera,0),this.updateStats()},onUnload:function(){meta.input.onMove.remove(this),meta.engine.onResize.remove(this),meta.world.onResize.remove(this),meta.camera.onResize.remove(this),meta.camera.onMove.remove(this),this.timer.stop()},updateStats:function(){var t=meta.engine.fps;if(t!==this.fps&&(this.txt.fps.text="fps: "+t,this.fps=t),window.performance.memory){var e=(window.performance.memory.usedJSHeapSize/1048576).toFixed(2);e!==this.memory&&(this.txt.memory.text="memory: "+e+"mb",this.memory=e)}var i=meta.renderer.entities.length,s=meta.renderer.entitiesStatic.length,n=i+s;n!==this.numEntities&&(this.txt.entities.text="entities: "+i+", static: "+s,this.numEntities=n)},handleInputMove:function(t,e){this.txt.world.text="world: "+t.x+", "+t.y,this.txt.screen.text="screen: "+t.screenX+", "+t.screenY},handleCameraMove:function(t,e){var i=t.volume;this.txt.cameraBoundsMin.text="boundsMin: "+Math.round(i.minX)+", "+Math.round(i.minY),this.txt.cameraBoundsMax.text="boundsMax: "+Math.round(i.maxX)+", "+Math.round(i.maxY),this.txt.cameraResolution.text="width: "+i.width+", height: "+i.height},handleCameraResize:function(t,e){this.txt.cameraZoom.text="zoom: "+t.zoom.toFixed(3)},handleResize:function(t,e){this.txt.resolution.text="width: "+t.width+", height: "+t.height},handleWorldResize:function(t,e){var i=t.volume;this.txt.worldBoundsMin.text="boundsMin: "+Math.round(i.minX)+", "+Math.round(i.minY),this.txt.worldBoundsMax.text="boundsMax: "+Math.round(i.maxX)+", "+Math.round(i.maxY),this.txt.worldResolution.text="width: "+i.width+", height: "+i.height},txt:null})},function(t,e,i){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};meta.class("Entity.Geometry",{init:function(t){this.listeners=null,this.volume=new meta.math.AABBext,this.anim=new Component.Anim,this.anim.owner=this,this.initArg(t),this.onCreate&&this.onCreate(t)},initArg:function(t){if("object"===("undefined"==typeof t?"undefined":s(t)))if(t instanceof Resource.Texture)this.texture=t;else for(var e in t)this[e]=t[e];else"string"==typeof t&&(this.texture=t)},onCreate:null,set enabled(t){if(t){if(this.flags&this.Flag.ENABLED)return;this.flags|=this.Flag.ENABLED}else{if(0===(this.flags&this.Flag.ENABLED))return;this.flags&=~this.Flag.ENABLED}this._updateEnabled(!0)},get enabled(){return(this.flags&this.Flag.ENABLED)===this.Flag.ENABLED},_updateEnabled:function(t){if(this.flags&this.Flag.INSTANCE_ENABLED){if(this.flags&this.Flag.ENABLED&&this.parent.flags&this.Flag.INSTANCE_ENABLED)return;this.flags&=~this.Flag.INSTANCE_ENABLED}else{if(!(this.flags&this.Flag.ENABLED&&this.parent.flags&this.Flag.INSTANCE_ENABLED))return;this.flags|=this.Flag.INSTANCE_ENABLED}if(this.children)for(var e=this.children.length,i=0;i<e;i++)this.children[i]._updateEnabled(!1);t&&this._view&&this._view.updateEntity(this)},_activate:function(){if(this.flags|=this.Flag.ACTIVE,this.flags&this.Flag.UPDATING&&(this.updating=!0),0===this._anchorX&&0===this._anchorY||this._updateAnchor(),this.components!==this.parent.components){var t;for(var e in this.components)t=this.components[e],t.onActiveEnter&&t.onActiveEnter()}},_deactivate:function(){if(this.flags&=~(this.Flag.ACTIVE|this.Flag.RENDER),this.components!==this.parent.components){var t;for(var e in this.components)t=this.components[e],t.onActiveExit&&t.onActiveExit()}},remove:function(){this.flags&this.Flag.REMOVED||(this.flags|=this.Flag.REMOVED,this.flags&this.Flag.ACTIVE?this.renderer.removeEntity(this):this._remove())},_remove:function(){this._texture&&(this._texture.unsubscribe(this),this._texture=null),this.tween&&this.tween.clear(),this.view&&this.view.detach(this),this.onRemove&&this.onRemove()},onRemove:null,update:null,draw:null,updatePos:function(){if(this.volume.x=this._x+this.totalOffsetX,this.volume.y=this._y+this.totalOffsetY,this.volume.updatePos(),this.node&&this.renderer.culling.update(this),this.children)for(var t,e=this.children.length,i=0;i<e;i++)t=this.children[i],t.flags&this.Flag.IGNORE_PARENT_POS||(t._parentX=this.volume.x-this.volume.pivotPosX-this.offsetPosX,t._parentY=this.volume.y-this.volume.pivotPosY-this.offsetPosY,t.updateTotalOffset());this.renderer.needRender=!0},updateTotalOffset:function(){this.totalOffsetX=this.offsetPosX+this._parentX+this.anchorPosX,this.totalOffsetY=this.offsetPosY+this._parentY+this.anchorPosY,this._view&&(this.totalOffsetX+=this._view._x,this.totalOffsetY+=this._view._y),this.updatePos()},position:function(t,e){this._x===t&&this._y===e||(this._x=t,this._y=e,this.updatePos())},move:function(t,e){0===t&&0===e||(this._x+=t,this._y+=e,this.updatePos())},moveForward:function(t){var e=this._x+t*Math.cos(this.volume.angle-1.57079),i=this._y+t*Math.sin(this.volume.angle-1.57079);this._x===e&&this._y===i||(this._x=e,this._y=i,this.updatePos())},moveDirected:function(t,e){var i=this._x+-t*Math.cos(this.volume.angle-1.57079+e),s=this._y+-t*Math.sin(this.volume.angle-1.57079+e);this._x===i&&this._y===s||(this._x=i,this._y=s,this.updatePos())},strafe:function(t){var e=this._x+-t*Math.cos(this._angleRad+Math.PI),i=this._y+-t*Math.sin(this._angleRad+Math.PI);this._x===e&&this._y===i||(this._x=e,this._y=i,this.updatePos())},set x(t){this._x=t,this.updatePos()},set y(t){this._y=t,this.updatePos()},get x(){return this._x},get y(){return this._y},get absX(){return this.volume.x},get absY(){return this.volume.y},set z(t){this._z!==t&&(this._z=t,this.updateZ())},get z(){return this._z},updateZ:function(){if(this.totalZ=this._z+this._parentZ,this._view&&(this.totalZ+=this._view._z),this.children)for(var t,e=this.children.length,i=0;i<e;i++)t=this.children[i],t._parentZ=this.totalZ+1e-5,t.updateZ();this.renderer.needSort=!0},offset:function(t,e){this._offsetX===t&&this._offsetY===e||(this._offsetX=t,this._offsetY=e,this._texture?(this.offsetPosX=Math.round(this._offsetX+this._texture.offsetX),this.offsetPosY=Math.round(this._offsetY+this._texture.offsetY)):(this.offsetPosX=Math.round(this._offsetX),this.offsetPosY=Math.round(this._offsetY)),this.updateTotalOffset())},set offsetX(t){this._offsetX!==t&&(this._offsetX=t,this._texture?this.offsetPosX=Math.round((this._offsetX+this._texture.offsetX)*this.volume.scaleX):this.offsetPosX=Math.round(this._offsetX*this.volume.scaleX),this.updateTotalOffset(),this.updatePos())},set offsetY(t){this._offsetY!==t&&(this._offsetY=t,this._texture?this.offsetPosY=Math.round((this._offsetY+this._texture.offsetY)*this.volume.scaleY):this.offsetPosY=Math.round(this._offsetY*this.volume.scaleX),this.updateTotalOffset(),this.updatePos())},get offsetX(){return this._offsetX},get offsetY(){return this._offsetY},pivot:function(t,e){this.volume.pivot(t,e),this.renderer.needRender=!0},set pivotX(t){this.volume.pivot(t,this.volume.pivotY),this.renderer.needRender=!0},set pivotY(t){this.volume.pivot(this.volume.pivotX,t),this.renderer.needRender=!0},get pivotX(){return this.volume.pivotX},get pivotY(){return this.volume.pivotY},anchor:function(t,e){void 0===e&&(e=t),this._anchorX=t,this._anchorY=e,this._updateAnchor()},_updateAnchor:function(){if(this._static){var t=meta.engine;this.anchorPosX=this.parent.volume.width*t.zoom*this._anchorX,this.anchorPosY=this.parent.volume.height*t.zoom*this._anchorY}else this.anchorPosX=this.parent.volume.width*this._anchorX,this.anchorPosY=this.parent.volume.height*this._anchorY;this.updateTotalOffset()},set anchorX(t){this._anchorX=t,this._updateAnchor()},set anchorY(t){this._anchorY=t,this._updateAnchor()},get anchorX(){return this._anchorX},get anchroY(){return this._anchorY},set angle(t){t=t*Math.PI/180,this.volume.angle!==t&&(this._angle=t,this.updateAngle())},set angleRad(t){this._angle!==t&&(this._angle=t,this.updateAngle(t))},get angle(){return 180*this._angle/Math.PI},get angleRad(){return this._angle},updateAngle:function(){if(this.flags&this.Flag.IGNORE_PARENT_ANGLE?this.volume.rotate(this._angle):this.volume.rotate(this._angle+this.parent.volume.angle),this.node&&this.renderer.culling.update(this),this.children)for(var t,e=this.children.length,i=0;i<e;i++)t=this.children[i],t.flags&this.Flag.IGNORE_PARENT_ANGLE||t.updateAngle();this.renderer.needRender=!0;
},scale:function(t,e){void 0===e&&(e=t),this._scaleX=t,this._scaleY=e,this._updateScale()},_updateScale:function(){if(this.volume.scale(this._scaleX*this._parentScaleX,this._scaleY*this._parentScaleY),this._texture?(this.totalOffsetX=Math.round((this._offsetX+this._texture.offsetX)*this.volume.scaleX),this.totalOffsetY=Math.round((this._offsetY+this._texture.offsetY)*this.volume.scaleY)):(this.totalOffsetX=Math.round(this._offsetX*this.volume.scaleX),this.totalOffsetY=Math.round(this._offsetY*this.volume.scaleY)),this._updateAnchor(),this.children)for(var t,e=this.children.length,i=0;i<e;i++)t=this.children[i],t.flags&this.Flag.IGNORE_PARENT_SCALE||(t._parentScaleX=this.volume.scaleX,t._parentScaleY=this.volume.scaleY,t._updateScale(),t._updateAnchor());this.renderer.needRender=!0},fitIn:function(t,e){this.volume.width<1?this.volume.height<1?this.volume.resize(1,1):this.volume.resize(1,this.volume.initHeight):this.volume.height<1&&this.volume.resize(this.volume.initWidth,1),this.flags|=this.Flag.FIT_IN,this.scale(t/this.volume.initWidth,e/this.volume.initHeight)},resetFitIn:function(){this.flags&=~this.Flag.FIT_IN,this.scale(1,1),this.updateFromTexture()},set scaleX(t){this._scaleX!==t&&(this._scaleX=t,this._updateScale())},set scaleY(t){this._scaleY!==t&&(this._scaleY=t,this._updateScale())},get scaleX(){return this._scaleX},get scaleY(){return this._scaleY},flip:function(t,e){this.volume.flip(t,e),this.renderer.needRender=!0},set flipX(t){this.flip(t,this.volume.flipY)},set flipY(t){this.flip(this.volume.flipX,t)},get flipX(){return this.volume.flipX},get flipY(){return this.volume.flipY},set alpha(t){this._alpha!==t&&(this._alpha=t,this.updateAlpha())},get alpha(){return this._alpha},updateAlpha:function(){if(this.totalAlpha=this._alpha*this.parent.totalAlpha,this.totalAlpha<0?this.totalAlpha=0:this.totalAlpha>1&&(this.totalAlpha=1),this.children)for(var t,e=this.children.length,i=0;i<e;i++)t=this.children[i],t.flags&this.Flag.IGNORE_PARENT_ALPHA||t.updateAlpha();this.volume.__transformed=1,this.renderer.needRender=!0},resize:function(t,e){if(this.volume.width!==t||this.volume.height!==e){if(this.volume.resize(t,e),this.updatePos(),this._updateResize(),this.children)for(var i=this.children.length,s=0;s<i;s++)this.children[s]._updateResize();this.renderer.needRender=!0}},set width(t){this.texture&&(this.volume.width!==t?this.flags|=this.Flag.DYNAMIC_CLIP:this.flags&=~this.Flag.DYNAMIC_CLIP),this.resize(t,this.volume.height)},set height(t){this.texture&&(this.volume.height!==t?this.flags|=this.Flag.DYNAMIC_CLIP:this.flags&=~this.Flag.DYNAMIC_CLIP),this.resize(this.volume.width,t)},get width(){return this.volume.width},get height(){return this.volume.height},_updateResize:function(){this._updateAnchor(),this.onResize&&this.onResize()},onResize:null,clip:function(t){t instanceof Entity.Geometry?this.clipVolume=t.volume:t instanceof meta.math.AABB?this.clipVolume=t:this.clipVolume=null,this.renderer.needRender=!0},clipBounds:function(t,e){this.clipVolume?this.clipVolume.set(0,0,t,e):this.clipVolume=new meta.math.AABB(0,0,t,e),this.flags|=this.Flag.CLIP_BOUNDS,this.renderer.needRender=!0},_onTextureEvent:function(t,e){var i=Resource.Event;e===i.LOADED?this.loaded=!0:e===i.UNLOADED?this.loaded=!1:e===i.REMOVED&&(this.texture=null),this.updateFromTexture()},_onLoadingEnd:function(t,e){var i=meta.resources.textures[this._textureName];i?this.texture=i:console.warn("(Entity.Geometry) Unavailable texture - "+this._textureName),meta.resources.onLoadingEnd.remove(this)},updateFromTexture:function(){if(this._texture?(this.flags&this.Flag.FIT_IN&&this.scale(this.volume.width/this._texture.width,this.volume.height/this._texture.height),this.volume.resize(this._texture.width,this._texture.height),this.totalOffsetX=Math.round((this._offsetX+this._texture.offsetX)*this.volume.scaleX),this.totalOffsetY=Math.round((this._offsetY+this._texture.offsetY)*this.volume.scaleY)):(this.flags&this.Flag.FIT_IN?this.scale(this.volume.width,this.volume.height):this.volume.resize(1,1),this.totalOffsetX=Math.round(this._offsetX*this.volume.scaleX),this.totalOffsetY=Math.round(this._offsetY*this.volume.scaleY)),this._updateAnchor(),this.children)for(var t=this.children.length,e=0;e<t;e++)this.children[e]._updateAnchor()},onTextureChange:null,set texture(t){if(this._texture!==t){if(this._texture&&this._texture.unsubscribe(this),t){if("string"==typeof t){if(this._texture=meta.resources.textures[t],!this._texture)return void(meta.resources.loading?(this._textureName=t,meta.resources.onLoadingEnd.add(this._onLoadingEnd,this)):console.warn("(Entity.Geometry) Unavailable texture - "+t))}else this._texture=t;this._texture.subscribe(this._onTextureEvent,this),this._texture._loaded&&(this.updateFromTexture(),this.flags|=this.Flag.LOADED)}else this._texture=t,this.flags&=~this.Flag.LOADED;this.anim.set(this._texture),this.onTextureChange&&this.onTextureChange()}},get texture(){return this._texture},set updating(t){if(t){if(this.__updateIndex!==-1)return;this.flags|=this.Flag.UPDATING,this.flags&this.Flag.ACTIVE&&(this.__updateIndex=this.renderer.entitiesUpdate.push(this)-1)}else{if(this.__updateIndex===-1)return;this.flags&=~this.Flag.UPDATING,this.flags&this.Flag.ACTIVE&&(this.renderer.entitiesUpdateRemove.push(this),this.__updateIndex=-1)}},get updating(){return(this.flags&this.Flag.UPDATING)===this.Flag.UPDATING},_setView:function(t,e){if(this._view!==t){if(e)if(t){if(t.flags&t.Flag.ACTIVE&&!(t.flags&t.Flag.INSTANCE_HIDDEN)){if(this._view=t,this.children)for(var i=this.children.length,s=0;s<i;s++)this.children[s]._setView(t,!1);return void this.renderer.addEntity(this)}this.renderer.removeEntity(this)}else this._view&&this.renderer.removeEntity(this);if(this._view=t,this.children)for(var i=this.children.length,s=0;s<i;s++)this.children[s]._setView(t,!1)}},attach:function(t){return t?t===this?void console.warn("(Entity.Geometry.attach) Trying to attach themself"):t._view?void console.warn("(Entity.Geometry.attach) Trying to attach entity that has already been attached to other entity"):(t.parent=this,this.children?this.children.push(t):(this.children=[t],1===this.scaleX&&1===this.scaleY||this._updateScale()),0===(t.flags&this.Flag.IGNORE_PARENT_POS)&&(t._parentX=this.volume.x-this.volume.pivotPosX-this.offsetPosX,t._parentY=this.volume.y-this.volume.pivotPosY-this.offsetPosY,t.updateTotalOffset()),this.updateZ(),0!==this.volume.angle&&this.updateAngle(),1!==this.totalAlpha&&this.updateAlpha(),t._updateHidden(),void(this._view&&t._setView(this._view,!0))):void console.warn("(Entity.Geometry.attach) Invalid entity passed")},_detach:function(t){t.parent=this.renderer.holder,t.updatePos(),t.updateZ(),t._setView(null,!0),0!==this.volume.angle&&t.updateAngle(),1!==this.totalAlpha&&t.updateAlpha(),t._updateHidden()},detach:function(t){if(!t)return void console.warn("(Entity.Geometry.detach) Invalid entity has been passed");if(t.parent!==this)return void console.warn("(Entity.Geometry.detach) Entity has different parent from this");var e=this.children.indexOf(t);this.children[e]=this.children[this.children.length-1],this.children.pop(),this._detach(t)},detachAll:function(){if(this.children){for(var t=this.children.length,e=0;e<t;e++)this._detach(this.children[e]);this.children.length=0}},get view(){return this._view},_updateHidden:function(){if(this.flags&this.Flag.INSTANCE_HIDDEN){if(this.flags&this.Flag.HIDDEN)return;if(this.parent.flags&this.Flag.INSTANCE_HIDDEN&&0===(this.flags&this.Flag.IGNORE_PARENT_HIDDEN))return;this.flags&=~this.Flag.INSTANCE_HIDDEN}else{if(!(this.flags&this.Flag.HIDDEN||this.parent.flags&this.Flag.INSTANCE_HIDDEN&&0===(this.flags&this.Flag.IGNORE_PARENT_HIDDEN)))return;this.flags|=this.Flag.INSTANCE_HIDDEN}if(this.children)for(var t=this.children.length,e=0;e<t;e++)this.children[e]._updateHidden()},set hidden(t){if(t){if(this.flags&this.Flag.HIDDEN)return;this.flags|=this.Flag.HIDDEN}else{if(0===(this.flags&this.Flag.HIDDEN))return;this.flags&=~this.Flag.HIDDEN}this._updateHidden()},get hidden(){return(this.flags&this.Flag.HIDDEN)===this.Flag.HIDDEN},set state(t){this._state!==t&&(this.onStateExit&&this.onStateExit(),this._state=t,this.onStateEnter&&this.onStateEnter())},get state(){return this._state},onStateChange:null,set picking(t){if(t){if(this.flags&this.Flag.PICKING)return;this.flags|=this.Flag.PICKING,this.flags&this.Flag.RENDER&&this.renderer.entitiesPicking.push(this)}else{if(0===(this.flags&this.Flag.PICKING))return;this.flags&=~this.Flag.PICKING,this.flags&this.Flag.RENDER&&this.renderer.entitiesPickingRemove.push(this)}},get picking(){return(this.flags&this.Flag.PICKING)===this.Flag.PICKING},isPointInside:function(t,e){if(1==this.volume.__transformed){var i=t-this.volume.x,s=e-this.volume.y;t=i*this.volume.cos+s*this.volume.sin+this.volume.x,e=s*this.volume.cos-i*this.volume.sin+this.volume.y}return this.volume.vsPoint(t,e)},isPointInsidePx:function(t,e){var i=this.volume;if(1==i.__transformed){var s=t-i.x,n=e-i.y;t=s*i.cos+n*i.sin+i.x,e=n*i.cos-s*i.sin+i.y}if(!this.volume.vsPoint(t,e))return!1;var s=(t-i.minX)/i.scaleX|0,n=(e-i.minY)/i.scaleY|0,h=this._texture.getPixelAt(s,n);return h[3]>50},onDown:null,onUp:null,onClick:null,onDbClick:null,onDrag:null,onDragStart:null,onDragEnd:null,onHover:null,onHoverEnter:null,onHoverExit:null,dragStart:function(t,e){this._dragOffsetX=t-this.volume.x,this._dragOffsetY=e-this.volume.y},dragTo:function(t,e){t-=this.totalOffsetX+this._dragOffsetX,e-=this.totalOffsetY+this._dragOffsetY,this.volume.x===t&&this.volume.y===e||this.position(t,e)},addTimer:function(t,e,i){var s=meta.addTimer(this,t,e,i);return this.timers?this.timers.push(s):this.timers=[s],s},set tween(t){if(!t)return void(this._tween=null);if(this._tweenCache?(this._tweenCache.stop(),this._tweenCache=new meta.Tween.Cache(this)):this._tweenCache=new meta.Tween.Cache(this),t instanceof meta.Tween.Link)this._tweenCache.tween=t.tween;else{if(!(t instanceof meta.Tween))return void console.warn("(Entity.Geometry.set::tween) Ivalid object! Should be meta.Tween or meta.Tween.Link object");this._tweenCache.tween=t}var e=this._tweenCache.tween;e.autoPlay&&(e.cache=this._tweenCache,e.play())},get tween(){return this._tweenCache||(this.tween=new meta.Tween),this._tweenCache.tween.cache=this._tweenCache,this._tweenCache.tween},addComponent:function(t,e){if("string"==typeof t&&(t=Component[t]),!t)return console.warn("(Entity.Geometry.addComponent) Adding an invalid component"),null;var i=t.prototype.__lastName__;if(this.components&&this.components[i])return console.warn("(Entity.Geometry.addComponent) Entity already has component: "+i),null;var s=new t(this);if(s.owner=this,e)for(var n in e)s[n]=e[n];return this.parent.components===this.components&&(this.components={}),this.components[i]=s,s.onAdd&&s.onAdd(),s},removeComponent:function(t){var e=this.components[t];if(!e||"object"!==("undefined"==typeof e?"undefined":s(e)))return void console.warn("(Entity.Geometry.removeComponent) No such component added: "+t);for(var i=!1,n=this.components.length,h=0;h<n;h++)if(this.components[h]===e){this.components[h]=this.components[n-1],this.components.pop(),i=!0;break}return i?(e.unload&&e.unload(),void(this[t]=null)):void console.warn("(Entity.Geometry.removeComponent) No such components added in: "+t)},removeAllComponents:function(){if(components)for(var t=this.components.length,e=0;e<t;e++)this.removeComponent(this.components[e])},lookAt:function(t,e){this.flags&this.Flag.IGNORE_PARENT_ANGLE?this.angleRad=-Math.atan2(t-this.volume.x,e-this.volume.y)+Math.PI:this.angleRad=-Math.atan2(t-this.volume.x,e-this.volume.y)+Math.PI-this.parent.volume.angle},on:function(t,e){if(!this.listeners){var i={};return i[t]=[e],void(this.listeners=i)}var s=this.listeners[t];s?s.push(t):this.listeners[t]=[e]},off:function(t,e){var i=this.listeners[t];if(i){var s=i.indexOf(e);s!==-1&&(i[s]=i[i.length-1],i.pop())}},emit:function(t,e){var i=this.listeners[t];if(i)for(var s=0;s<i.length;s++)i[s](e)},set loaded(t){if(t){if(this.flags&this.Flag.LOADED)return;this.flags|=this.Flag.LOADED}else{if(0===(this.flags&this.Flag.LOADED))return;this.flags&=~this.Flag.LOADED}},get loaded(){return(this.flags&this.Flag.LOADED)===this.Flag.LOADED},renderDebug:null,set debug(t){if(t){if(this.flags&this.Flag.DEBUG)return;this.flags|=this.Flag.DEBUG,this.renderer.numDebug++}else{if(0===(this.flags&this.Flag.DEBUG))return;this.flags&=~this.Flag.DEBUG,this.renderer.numDebug--}this.renderer.needRender=!0},get debug(){return(this.flags&this.Flag.DEBUG)===this.Flag.DEBUG},Flag:{ENABLED:1,INSTANCE_ENABLED:2,HIDDEN:4,INSTANCE_HIDDEN:8,ACTIVE:16,INSTANCE_ACTIVE:32,VISIBILE:64,ROOT_HOLDER:128,UPDATING:256,REMOVED:512,IGNORE_PARENT_POS:1024,IGNORE_PARENT_Z:2048,IGNORE_PARENT_ANGLE:4096,IGNORE_PARENT_ALPHA:8192,IGNORE_PARENT_SCALE:16384,IGNORE_PARENT_HIDDEN:32768,RENDER:65536,RENDER_REMOVE:1<<17,DEBUG:1<<18,DYNAMIC_CLIP:1<<19,FIT_IN:1<<20,CLIP_BOUNDS:1<<21,LOADED:1<<22,PICKING:1<<25,ROOT:1<<26},renderer:null,parent:null,_view:null,node:null,_texture:null,_x:0,_y:0,_parentX:0,_parentY:0,_z:0,totalZ:0,_parentZ:0,_angle:0,_alpha:1,totalAlpha:1,_scaleX:1,_scaleY:1,_parentScaleX:1,_parentScaleY:1,_offsetX:0,_offsetY:0,offsetPosX:0,offsetPosY:0,_anchorX:0,_anchorY:0,anchorPosX:0,anchorPosY:0,totalOffsetX:0,totalOffsetY:0,_dragOffsetX:0,_dragOffsetY:0,volume:null,clipVolume:null,children:null,anim:null,_state:"",timers:null,_tweenCache:null,components:{},hover:!1,pressed:!1,dragged:!1,__debug:!1,__updateIndex:-1,flags:0})},function(t,e,i){"use strict";meta.class("Entity.ParticleEmitter","Entity.Geometry",{onCreate:function(){this.particles=[],this.preset="meteor"},update:function(t){if(this.elapsed+=t,this.elapsed>this.duration)return void(this.updating=!1);if(this.emissionRate>0){var e=1/this.emissionRate;this.emissionCounter+=t;var i=Math.floor(this.emissionCounter/e);if(i>0){this.emissionCounter-=i*e,i>this.particles.length-this.numActive&&(i=this.particles.length-this.numActive);for(var s=this.numActive+i,n=this.numActive;n<s;n++)this.initParticle(this.particles[n]);this.numActive=s}}for(var h,o=0;o<this.numActive;o++)h=this.particles[o],h.life-=t,h.life<=0?(this.numActive--,this.particles[o]=this.particles[this.numActive],this.particles[this.numActive]=h):this.updateParticle(h,t);this.renderer.needRender=!0},initParticle:function(t){t.x=meta.random.numberF(-1,1)*this.xVar,t.y=meta.random.numberF(-1,1)*this.yVar,t.life=this.life+meta.random.numberF(-1,1)*this.lifeVar;var e=this.speed+meta.random.numberF(-1,1)*this.speedVar,i=this.startAngle+meta.random.numberF(-1,1)*this.startAngleVar;t.velX=Math.cos(Math.PI*i/180)*e,t.vecY=-Math.sin(Math.PI*i/180)*e,t.radialAccel=this.radialAccel+this.radialAccelVar*meta.random.numberF(-1,1),t.tangentialAccel=this.tangentialAccel+this.tangentialAccelVar*meta.random.numberF(-1,1),this._textureTinting&&(t.color[0]=this.startColor[0]+this.startColorVar[0]*meta.random.numberF(-1,1),t.color[1]=this.startColor[1]+this.startColorVar[1]*meta.random.numberF(-1,1),t.color[2]=this.startColor[2]+this.startColorVar[2]*meta.random.numberF(-1,1),t.color[3]=this.startColor[3]+this.startColorVar[3]*meta.random.numberF(-1,1),this._endColor[0]=this.endColor[0]+this.endColorVar[0]*meta.random.numberF(-1,1),this._endColor[1]=this.endColor[1]+this.endColorVar[1]*meta.random.numberF(-1,1),this._endColor[2]=this.endColor[2]+this.endColorVar[2]*meta.random.numberF(-1,1),this._endColor[3]=this.endColor[3]+this.endColorVar[3]*meta.random.numberF(-1,1),t.colorDelta[0]=(this._endColor[0]-this.startColor[0])/t.life,t.colorDelta[1]=(this._endColor[1]-this.startColor[1])/t.life,t.colorDelta[2]=(this._endColor[2]-this.startColor[2])/t.life,t.colorDelta[3]=(this._endColor[3]-this.startColor[3])/t.life),t.scale=this.startScale+this.startScaleVar*meta.random.numberF(-1,1);var s=this.endScale+this.endScaleVar*meta.random.numberF(-1,1);t.scaleDelta=(s-t.scale)/t.life},updateParticle:function(t,e){t.forcesX=this.gravityX*e,t.forcesY=this.gravityY*e,t.velX+=t.forcesX,t.vecY+=t.forcesY,t.x+=t.velX*e,t.y+=t.vecY*e,t.color&&(t.color[0]+=t.colorDelta[0]*e,t.color[1]+=t.colorDelta[1]*e,t.color[2]+=t.colorDelta[2]*e,t.color[3]+=t.colorDelta[3]*e),t.scale+=this.scaleDelta},draw:function(t){if(this._texture.loaded){var e=(meta.time.deltaF,this.texture.canvas),i=this.volume.minX-.5*e.width,s=this.volume.minY-.5*e.height;this._textureAdditive?t.globalCompositeOperation="lighter":t.globalCompositeOperation="source-over";for(var n,h,o=0;o<this.numActive;o++)n=this.particles[o],h=n.color,h[3]>1&&(h[3]=1),h[3]<0&&(h[3]=0),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._ctx.globalCompositeOperation="source-over",this._ctx.globalAlpha=h[3],this._ctx.drawImage(e,0,0),this._ctx.globalCompositeOperation="source-atop",this._ctx.fillStyle="rgba("+(0|h[0])+", "+(0|h[1])+", "+(0|h[2])+", 1.0)",this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height),this._ctx.globalCompositeOperation="source-over",this._ctx.globalAlpha=h[3],t.drawImage(this.texture.canvas,i+n.x,s+n.y)}},play:function(){this.updating=!0},pause:function(){this.updating=!1},togglePlay:function(){this.updating?this.pause():this.play()},reset:function(){this.numActive=0,this.elapsed=0},set texture(t){t?this._texture=t:(this._svgTexture||(this._svgTexture=new Resource.SVG,this._svgTexture.fillStyle="white",this._svgTexture.circle(this._radius)),this._texture=this._svgTexture),this._texture.loaded?this.updateTintCanvas():this.texture.subscribe(this.onTextureEvent,this)},get texture(){return this._texture},updateTintCanvas:function(){this._canvas||(this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d")),this._canvas.width=this._texture.width,this._canvas.height=this._texture.height},onTextureEvent:function(t,e){this.updateTintCanvas(),this._texture.unsubscribe(this)},set totalParticles(t){var e=this.particles.length;this.particles.length=t;for(var i=e;i<t;i++)this.particles[i]=new this.Particle;this.numActive>t&&(this.numActive=t)},get totalParticles(){return this.particles.length},set textureAdditive(t){this._textureAdditive=t},get textureAdditive(){return this._textureAdditive},set textureTinting(t){this._textureTinting=t},get textureTinting(){return this._textureTinting},set radius(t){this._radius=t,this._texture===this._svgTexture&&(this._svgTexture.clear(),this._svgTexture.circle(this._radius),this.updateTintCanvas())},get radius(){return this._radius},set preset(t){var e=this.presets[t];for(var i in e)this[i]!==e[i]&&(this[i]=e[i]);this.textureAdditive=this._textureAdditive},Particle:function(){this.life=0,this.x=0,this.y=0,this.velX=0,this.velY=0,this.radialAccel=0,this.tangentialAccel=0,this.forcesX=0,this.forcesY=0,this.color=new Float32Array(4),this.colorDelta=new Float32Array(4),this.scale=1,this.scaleDelta=1},particles:null,numActive:0,emissionRate:0,emissionCounter:0,elapsed:0,duration:1/0,life:1,lifeVar:0,xVar:0,yVar:0,speed:0,speedVar:0,startAngle:0,startAngleVar:0,startScale:1,startScaleVar:0,endScale:1,endScaleVar:0,gravityX:0,gravityY:0,radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,startColor:null,startColorVar:null,endColor:null,endColorVar:null,_endColor:new Float32Array(4),_canvas:null,_ctx:null,_svgTexture:null,_radius:10,_textureAdditive:!1,presets:{empty:{totalParticles:50,emissionRate:10,life:1,lifeVar:0},meteor:{totalParticles:45,emissionRate:40,life:1,lifeVar:.1,xVar:2,yVar:2,speed:15,speedVar:5,angle:90,angleVar:360,gravityX:-200,gravityY:-200,radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,startColor:[255,42,0,1],startColorVar:[0,0,51,.1],endColor:[0,0,0,1],endColorVar:[0,0,0,0],scale:1,scaleVar:1,endScale:1,endScaleVar:1,textureAdditive:!0,radius:10}}})},function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),a=function(t){function e(t){s(this,e);var i=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._bitmapFont=null,i._text="",i._lineBuffer=new Array,i._wordBuffer=new Array,i._limitWidth=0,i._maxWidth=0,i._font="Tahoma",i._fontSize=12,i._fontSizePx="12px",i._color="#fff",i._style="",i._textAlign="left",i._outline=!1,i._outlineColor="#000",i._outlineWidth=1,i._shadow=!0,i._shadowColor="#000",i._shadowBlur=3,i._shadowOffsetX=0,i._shadowOffsetY=0,t&&(i.text=t),i}return h(e,t),o(e,[{key:"onCreate",value:function(t){this.texture=new Resource.Texture,this._texture.resize(this._fontSize,this._fontSize),this._lineBuffer=new Array(1),this.text=t}},{key:"updateTxt",value:function(){var t=this._texture.ctx;this._bitmapFont?this.updateTxt_bitmapFont(t):this.updateTxt_canvasFont(t),this.renderer.needRender=!0}},{key:"updateTxt_bitmapFont",value:function(t){if(this._bitmapFont.loaded){for(var e,i,s,n,h=this._bitmapFont.texture.canvas,o=this._bitmapFont.chars,a=null,r=this._bitmapFont.height,l=this._lineBuffer.length,u=0;u<l;u++){for(s=this._lineBuffer[u],e=s.length,i=0,n=0;n<e;n++)a=o[s.charCodeAt(n)],a&&(i+=a.kerning);i>this._maxWidth&&(this._maxWidth=i)}this._texture.clear(),this._texture.resize(this._maxWidth,r*l);var c=0,d=0;for(u=0;u<l;u++){for(s=this._lineBuffer[u],e=s.length,n=0;n<e;n++)a=o[s.charCodeAt(n)],a&&(a.width<1||a.height<1||(t.drawImage(h,a.x,a.y,a.width,a.height,c,d+a.offsetY,a.width,a.height),c+=a.kerning));d+=r,c=0}}}},{key:"updateTxt_canvasFont",value:function(t){t.font=this._style+" "+this._fontSizePx+" "+this._font,this._maxWidth=0;var e,i=this._lineBuffer.length;if(this._limitWidth>0)e=this.calcLineBuffer(t),i=e.length;else{e=this._lineBuffer;for(var s,n=0;n<i;n++)s=t.measureText(e[n]),s.width>this._maxWidth&&(this._maxWidth=s.width)}var h=0,o=0;this._shadow&&(this._maxWidth+=2*this._shadowBlur,h+=this._shadowBlur),"right"===this._textAlign?h+=this._maxWidth:"center"===this._textAlign&&(h+=this._maxWidth/2);var a=1.3*this._fontSize;this._texture.resize(Math.ceil(this._maxWidth),Math.ceil(a*i)),t.clearRect(0,0,this.volume.initWidth,this.volume.initHeight),t.font=this._style+" "+this._fontSizePx+" "+this._font,t.textAlign=this._textAlign,t.fillStyle=this._color,t.textBaseline="top",this._shadow&&(t.shadowColor=this._shadowColor,t.shadowOffsetX=this._shadowOffsetX,t.shadowOffsetY=this._shadowOffsetY,t.shadowBlur=this._shadowBlur),this._outline&&(t.lineWidth=this._outlineWidth,t.strokeStyle=this._outlineColor);for(var n=0;n<i;n++)t.fillText(e[n],h,o),this._outline&&t.strokeText(e[n],o,o),o+=a}},{key:"calcLineBuffer",value:function(t){for(var e,i,s,n,h=[],o="",a=0,r=this._lineBuffer.length,l=0;l<r;l++)if(i=this._wordBuffer[l],s=i.length,1===s)e=i[0],n=t.measureText(e),n.width>this._maxWidth&&(this._maxWidth=n.width),h.push(e);else for(var u=0;u<s;u++)e=i[u],n=o?t.measureText(" "+e):t.measureText(e),a+n.width>this._limitWidth?(h.push(o),this._maxWidth<a&&(this._maxWidth=a),u===s-1?(h.push(e),this._maxWidth<n.width&&(this._maxWidth=n.width),a=0,o=null):(o=e,a=n.width)):(o?o+=" "+e:o=e,u===s-1?(h.push(o),this._maxWidth<a+n.width&&(this._maxWidth=a+n.width),o=0,a=0):a+=n.width);return h}},{key:"_onFontEvent",value:function(t,e){this.updateTxt()}},{key:"text",set:function(t){if(void 0!==t)if("number"==typeof t)this._text=t+"",this._lineBuffer[0]=this._text;else{this._text=t;var e=t.indexOf("\n");e!==-1?this._lineBuffer=t.split("\n"):this._lineBuffer[0]=this._text}else this._text="",this._lineBuffer[0]=this._text;if(this._limitWidth>0){var i=this._lineBuffer.length;this._wordBuffer.length=i;for(var s=0;s<i;s++)this._wordBuffer[s]=this._lineBuffer[s].split(" ")}this.updateTxt()},get:function(){return this._text}},{key:"font",set:function(t){var e=meta.resources.fonts[t];if(e){if(this._bitmapFont=e,!e._loaded)return this._texture.clear(),void e.subscribe(this._onFontEvent,this)}else this._font=t,this._bitmapFont=null;this.updateTxt()},get:function(){return this._font}},{key:"size",set:function(t){this._fontSize=t,this._fontSizePx=t+"px",this.updateTxt()},get:function(){return this._fontSize}},{key:"color",set:function(t){this._color=t,this.updateTxt()},get:function(){return this._color}},{key:"style",set:function(t){this._style!==t&&(this._style=t,this.updateTxt())},get:function(){return this._style}},{key:"outlineColor",set:function(t){this._outlineColor!==t&&(this._outlineColor=t,this._outline=!0,this.updateTxt())},get:function(){return this._outlineColor}},{key:"outlineWidth",set:function(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._outline=!0,this.updateTxt())},get:function(){return this._outlineWidth}},{key:"outline",set:function(t){this._outline!==t&&(this._outline=t,this.updateTxt())},get:function(){return this._outline}},{key:"shadow",set:function(t){this._shadow!==t&&(this._shadow=t,this.updateTxt())},get:function(){return this._shadow}},{key:"shadowColor",set:function(t){this._shadowColor!==t&&(this._shadowColor=t,this._shadow=!0,this.updateTxt())},get:function(){return this._shadowColor}},{key:"shadowBlur",set:function(t){this._shadowBlur!==t&&(this._shadowBlur=t,this._shadow=!0,this.updateTxt())},get:function(){return this._shadowBlur}},{key:"align",get:function(){return this._textAlign},set:function(t){this._textAlign!==t&&(this._textAlign=t,this.updateTxt())}},{key:"shadowOffsetX",set:function(t){this._shadowOffsetX!==t&&(this._shadowOffsetX=t,this._shadow=!0,this.updateTxt())},get:function(){return this._shadowOffsetY}},{key:"shadowOffsetY",set:function(t){this._shadowOffsetY!==t&&(this._shadowOffsetY=t,this._shadow=!0,this.updateTxt())},get:function(){return this._shadowOffsetY}},{key:"limitWidth",set:function(t){this._limitWidth!==t&&(this._limitWidth=t,this._wordBuffer||(this._wordBuffer=[]),this.text=this._text)},get:function(){return this._limitWidth}}]),e}(Entity.Geometry);Entity.Text=a,e.default=a},function(t,e,i){"use strict";meta.class("Entity.Tiling","Entity.Geometry",{onCreate:function(t){var e=(meta.camera.volume,new Resource.Texture);e.ctx.globalCompositeOperator="copy",this.texture=e,this.tile(t)},draw:function(t){var e=0|this.volume.minX,i=0|this.volume.minY;t.transform(this.volume.m11,this.volume.m12,this.volume.m21,this.volume.m22,0|this.volume.x,0|this.volume.y),t.beginPath(),t.rect(-this.volume.initPivotPosX,-this.volume.initPivotPosY,this.volume.width,this.volume.height),t.clip();for(var s=this.tileTexture.canvas,n=this.tileTexture.fullWidth,h=this.tileTexture.fullHeight,o=this._tileOffsetX,a=this._tileOffsetY,i=0;i<this._drawTilesY;i++){for(var e=0;e<this._drawTilesX;e++)t.drawImage(s,o,a),o+=n;o=this._tileOffsetX,a+=h}},tile:function(t){if(this.tileTexture&&!this.tileTexture._loaded&&this.tileTexture.unsubscribe(this),"string"==typeof t){if(this.tileTexture=meta.resources.textures[t],!this.tileTexture)return void console.warn("(Entity.Tiling.tile) Could not find texture with a name - "+t)}else this.tileTexture=t;return this.tileTexture._loaded?void this.updateTiling():void this.tileTexture.subscribe(this.onTextureEvent,this)},options:function(t){this.tileX=t.tileX||0,this.tileY=t.tileY||0,void 0!==t.wrap&&(this.wrap=t.wrap);var e=t.follow||!1;e!==this.follow?meta.subscribe(meta.Event.CAMERA_MOVE,this.onResize,this):meta.unsubscribe(meta.Event.CAMERA_MOVE,this),this.follow=e,this.updateSize()},resize:function(t,e){this._origWidth=t,this._origHeight=e,this._super(t,e),this.updateSize()},updateTiling:function(){if(this.tileTexture._loaded){var t=this.tileTexture.fullWidth,e=this.tileTexture.fullHeight,i=this._scrollX,s=this._scrollY;if(this.follow){var n=meta.camera.volume;i-=n.minX,s-=n.minY}0===this.tileX?i>0?this._tileOffsetX=i%t-t:this._tileOffsetX=i%t:this._tileOffsetX=i,0===this.tileY?s>0?this._tileOffsetY=s%e-e:this._tileOffsetY=s%e:this._tileOffsetY=s,this._drawTilesX=Math.ceil((this._texture.fullWidth-this._tileOffsetX)/t),this._drawTilesY=Math.ceil((this._texture.fullHeight-this._tileOffsetY)/e),this._tileOffsetX-=this.volume.initPivotPosX,this._tileOffsetY-=this.volume.initPivotPosY,this.tileX>0&&this._drawTilesX>this.tileX&&(this._drawTilesX=this.tileX),this.tileY>0&&this._drawTilesY>this.tileY&&(this._drawTilesY=this.tileY),this.renderer.needRender=!0}},updateSize:function(){if(this.tileTexture&&this.tileTexture._loaded){var t=1,e=1;t=this._origWidth>0?this._origWidth:0===this.tileX?this.parent.width:this.tileTexture.fullWidth*this.tileX,e=this._origHeight>0?this._origHeight:0===this.tileY?this.parent.height:this.tileTexture.fullHeight*this.tileY,this._texture.resizeSilently(t,e),this.volume.resize(t,e),this.updateTiling()}},onTextureEvent:function(t,e){e===Resource.Event.LOADED&&(this.tileTexture.unsubscribe(this),this.updateSize())},onResize:function(t,e){this.updateSize()},scroll:function(t,e){this._scrollX=t,this._scrollY=e,this.updateTiling()},tileTexture:null,follow:!1,tileX:0,tileY:0,_scrollX:0,_scrollY:0,_tileScaleX:1,_tileScaleY:1,_drawTilesX:0,_drawTilesY:0,_tileOffsetX:0,_tileOffsetY:0,_origWidth:0,_origHeight:0})},function(t,e,i){"use strict";window.Entity={},Entity.Event={INPUT_UP:"entityUp",INPUT_DOWN:"entityDown",CLICK:"entityClick",DBCLICK:"entityDbClick",DRAG:"drag",DRAG_START:"dragStart",DRAG_END:"dragEnd",HOVER:"hover",HOVER_ENTER:"hoverEnter",HOVER_EXIT:"hoverExit",STATE_CHANGE:"stateChange"}},function(t,e,i){"use strict";window.Input={BUTTON_ENUM_OFFSET:2e3},Input.Event={DOWN:"inputDown",UP:"inputUp",MOVE:"inputMove",CLICK:"inputClick",DBCLICK:"inputDbClick"},Input.Key={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,NUM_0:48,NUM_1:49,NUM_2:50,NUM_3:51,NUM_4:52,NUM_5:53,NUM_6:54,NUM_7:55,NUM_8:56,NUM_9:57,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL:110,DIVIDE:111,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,SQUARE_BRACKET_LEFT:91,SQUARE_BRACKET_RIGHT:91,PARENTHESES_LEFT:91,PARENTHESES_RIGHT:91,BRACES_LEFT:91,BRACES_RIGHT:92,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,PLUS:187,MINUS:189,TILDE:192,APOSTROPHE:222,BUTTON_LEFT:0+Input.BUTTON_ENUM_OFFSET,BUTTON_MIDDLE:1+Input.BUTTON_ENUM_OFFSET,BUTTON_RIGHT:2+Input.BUTTON_ENUM_OFFSET}},function(t,e,i){"use strict";meta.class("Input.Manager",{init:function(){var t=this.numKeys+this.numInputs+1;this.keys=new Array(t),this.touches=[],this.pressed={},this.trapTouch=!0,this.keybind={},this._event={event:null,type:"",x:0,y:0,prevScreenX:0,prevScreenY:0,screenX:0,screenY:0,keyCode:0,entity:null,keyboard:!1},this._addEventListeners(),this._loadIgnoreKeys(),meta.engine.onBlur.add(this.resetInput,this),this.keyID=new Array(t);var e=Input.Key;for(var i in e)this.keyID[e[i]]=i},_addEventListeners:function(){this.onDown=meta.createChannel(Input.Event.DOWN),this.onUp=meta.createChannel(Input.Event.UP),this.onMove=meta.createChannel(Input.Event.MOVE),this.onClick=meta.createChannel(Input.Event.CLICK),this.onDbClick=meta.createChannel(Input.Event.DBCLICK);var t=this;window.addEventListener("mousedown",function(e){t.handleMouseDown(e)}),window.addEventListener("mouseup",function(e){t.handleMouseUp(e)}),window.addEventListener("mousemove",function(e){t.handleMouseMove(e)}),window.addEventListener("dblclick",function(e){t.handleMouseDbClick(e)}),window.addEventListener("touchstart",function(e){
t.handleTouchDown(e)}),window.addEventListener("touchend",function(e){t.handleTouchUp(e)}),window.addEventListener("touchmove",function(e){t.handleTouchMove(e)}),window.addEventListener("touchcancel",function(e){t.handleTouchUp(e)}),window.addEventListener("touchleave",function(e){t.handleTouchUp(e)}),meta.device.support.onkeydown&&window.addEventListener("keydown",function(e){t.handleKeyDown(e)}),meta.device.support.onkeyup&&window.addEventListener("keyup",function(e){t.handleKeyUp(e)})},handleKeyDown:function(t){var e=t.keyCode;if(document.activeElement===document.body&&(window.top&&this._iframeKeys[e]&&t.preventDefault(),void 0!==this._cmdKeys[e]&&this._numCmdKeys++,void 0!==this._ignoreKeys[e]&&this._numCmdKeys<=0&&t.preventDefault()),!(this.blockInput||this.stickyKeys&&this.keys[e])){if("Meta"===t.keyIdentifier)this.metaPressed=!0;else if(this.metaPressed)return;if(this.keys[e]=1,this.pressed[this.keyID[e]]=1,this._keybindMap&&this._keybindMap[e])for(var i=this._keybindMap[e],s=i.length,n=0;n<s;n++)this.keybind[i[n]]=1;if(this._event.event=t,this._event.prevScreenX=0,this._event.prevScreenY=0,this._event.screenX=0,this._event.screenY=0,this._event.x=0,this._event.y=0,this._event.keyCode=e,this._event.keyboard=!0,this.onDown.emit(this._event,Input.Event.DOWN),this.keyRepeat){if(!this._inputTimer){var h=this;this._inputTimer=meta.addTimer(this,function(){h._event.keyCode=h._repeatKey,h.onDown.emit(h._event,Input.Event.DOWN)},this.keyRepeat)}this._repeatKey=e,this._inputTimer.resume(),this._inputTimer.tAccumulator=0}}},handleKeyUp:function(t){var e=t.keyCode;if(document.activeElement===document.body&&(window.top&&this._iframeKeys[e]&&t.preventDefault(),void 0!==this._cmdKeys[e]&&this.keys[e]&&this._numCmdKeys--,void 0===this._ignoreKeys[e]&&this._numCmdKeys<=0&&t.preventDefault()),!this.blockInput){if(this.metaPressed=!1,this.keys[e]=0,this.pressed[this.keyID[e]]=0,this._keybindMap&&this._keybindMap[e])for(var i=this._keybindMap[e],s=i.length,n=0;n<s;n++)this.keybind[i[n]]=0;this._event.event=t,this._event.prevScreenX=0,this._event.prevScreenY=0,this._event.prevX=0,this._event.prevY=0,this._event.x=0,this._event.y=0,this._event.keyCode=e,this._event.keyboard=!0,this.onUp.emit(this._event,Input.Event.UP),this.keyRepeat&&this._inputTimer&&this._inputTimer.pause()}},handleMouseDown:function(t){if(!this.blockInput){var e=t.button+Input.BUTTON_ENUM_OFFSET;if(this.keys[e]=1,this.pressed[this.keyID[e]]=e,this._keybindMap&&this._keybindMap[e])for(var i=this._keybindMap[e],s=i.length,n=0;n<s;n++)this.keybind[i[n]]=1;var h=meta,o=h.camera;this.prevScreenX=this.screenX,this.prevScreenY=this.screenX,this.screenX=(t.pageX-this.engine.offsetLeft)*this.engine.scaleX*this.engine.ratio,this.screenY=(t.pageY-this.engine.offsetTop)*this.engine.scaleY*this.engine.ratio,this.x=this.screenX*o.zoomRatio+o.volume.x|0,this.y=this.screenY*o.zoomRatio+o.volume.y|0,this._event.event=t,this._event.prevScreenX=this.prevScreenX,this._event.prevScreenY=this.prevScreenY,this._event.screenX=this.screenX,this._event.screenY=this.screenY,this._event.x=this.x,this._event.y=this.y,this._event.keyCode=e,this._event.keyboard=!1,this.onDown.emit(this._event,Input.Event.DOWN),this._event.entity=null}},handleMouseUp:function(t){if(!this.blockInput){var e=t.button+Input.BUTTON_ENUM_OFFSET;if(this.keys[e]=0,this.pressed[this.keyID[e]]=0,this._keybindMap&&this._keybindMap[e])for(var i=this._keybindMap[e],s=i.length,n=0;n<s;n++)this.keybind[i[n]]=0;var h=meta,o=h.camera;this.prevScreenX=this.screenX,this.prevScreenY=this.screenY,this.screenX=(t.pageX-this.engine.offsetLeft)*this.engine.scaleX*this.engine.ratio,this.screenY=(t.pageY-this.engine.offsetTop)*this.engine.scaleY*this.engine.ratio,this.x=this.screenX*o.zoomRatio+o.volume.x|0,this.y=this.screenY*o.zoomRatio+o.volume.y|0,this._event.event=t,this._event.prevScreenX=this.prevScreenX,this._event.prevScreenY=this.prevScreenY,this._event.screenX=this.screenX,this._event.screenY=this.screenY,this._event.x=this.x,this._event.y=this.y,this._event.keyCode=e,this._event.keyboard=!1,this.onUp.emit(this._event,Input.Event.UP),this.onClick.emit(this._event,Input.Event.CLICK),this._event.entity=null}},handleMouseMove:function(t){if(document.activeElement===document.body&&this.trapTouch&&t.preventDefault(),!this.blockInput){var e=meta,i=e.camera;this.prevScreenX=this.screenX,this.prevScreenY=this.screenY,this.screenX=(t.pageX-this.engine.offsetLeft)*this.engine.scaleX*this.engine.ratio,this.screenY=(t.pageY-this.engine.offsetTop)*this.engine.scaleY*this.engine.ratio,this.x=this.screenX*i.zoomRatio+i.volume.x|0,this.y=this.screenY*i.zoomRatio+i.volume.y|0,this._event.event=t,this._event.prevScreenX=this.prevScreenX,this._event.prevScreenY=this.prevScreenY,this._event.screenX=this.screenX,this._event.screenY=this.screenY,this._event.x=this.x,this._event.y=this.y,this._event.keyCode=-1,this._event.keyboard=!1,this.onMove.emit(this._event,Input.Event.MOVE),this._event.entity=null}},handleMouseDbClick:function(t){if(!this.blockInput){var e=t.button;if(this.keys[e]=0,this.pressed[this.keyID[e]]=0,this._keybindMap&&this._keybindMap[e])for(var i=this._keybindMap[e],s=i.length,n=0;n<s;n++)this.keybind[i[n]]=0;var h=meta,o=h.camera;if(this.prevScreenX=this.screenX,this.prevScreenY=this.screenY,this.screenX=(t.pageX-this.engine.offsetLeft)*this.engine.scaleX*this.engine.ratio,this.screenY=(t.pageY-this.engine.offsetTop)*this.engine.scaleY*this.engine.ratio,this.x=this.screenX*o.zoomRatio+o.volume.x|0,this.y=this.screenY*o.zoomRatio+o.volume.y|0,this._event.event=t,this._event.prevScreenX=this.prevScreenX,this._event.prevScreenY=this.prevScreenY,this._event.screenX=this.screenX,this._event.screenY=this.screenY,this._event.x=this.x,this._event.y=this.y,this._event.keyCode=e,this._event.keyboard=!1,this.onDbClick.emit(this._event,Input.Event.DBCLICK),this._onUpCBS&&this._onUpCBS[e])for(var a=this._onUpCBS[e],r=a.length,l=0;l<r;l++)a[l](this._event,Input.Event.UP);this._event.entity=null}},handleTouchDown:function(t){document.activeElement===document.body&&this.trapTouch&&t.preventDefault();for(var e,i,s,n,h,o,a=meta,r=a.camera,l=t.changedTouches,u=l.length,c=0;c<u;c++){o=this.touches.length-1,e=t.changedTouches[c],this.touches.push(e.identifier),this.numTouches++,i=(e.pageX-this.engine.offsetLeft)*this.engine.scaleX*this.engine.ratio,s=(e.pageY-this.engine.offsetTop)*this.engine.scaleY*this.engine.ratio,n=i*r.zoomRatio+r.volume.x|0,h=s*r.zoomRatio+r.volume.y|0;var d=o+Input.BUTTON_ENUM_OFFSET;if(this.keys[d]=1,o<3&&(this.pressed[this.keyID[d]]=1,this._keybindMap&&this._keybindMap[d]))for(var f=this._keybindMap[d],m=f.length,p=0;p<m;p++)this.keybind[f[p]]=1;this._event.event=t,this._event.prevScreenX=i,this._event.prevScreenY=s,this._event.screenX=i,this._event.screenY=s,this._event.x=n,this._event.y=h,this._event.keyCode=d,this._event.keyboard=!1,0===o&&(this.screenX=i,this.screenY=s,this.x=n,this.y=h),this.onDown.emit(this._event,Input.Event.DOWN),this._event.entity=null}},handleTouchUp:function(t){document.activeElement===document.body&&this.trapTouch&&t.preventDefault();for(var e,i,s,n,h,o,a=meta,r=a.camera,l=t.changedTouches,u=l.length,c=0;c<u;c++)if(e=t.changedTouches[c],i=this._getTouchID(e.identifier),i!==-1){this.touches.splice(i,1),this.numTouches--,s=(e.pageX-this.engine.offsetLeft)*this.engine.scaleX*this.engine.ratio,n=(e.pageY-this.engine.offsetTop)*this.engine.scaleY*this.engine.ratio,h=s*r.zoomRatio+r.volume.x|0,o=n*r.zoomRatio+r.volume.y|0;var d=i+Input.BUTTON_ENUM_OFFSET;if(this.keys[d]=0,i<3&&(this.pressed[this.keyID[d]]=0,this._keybindMap&&this._keybindMap[d]))for(var f=this._keybindMap[d],m=f.length,p=0;p<m;p++)this.keybind[f[p]]=0;this._event.event=t,0===i?(this.prevScreenX=this.screenX,this.prevScreenY=this.screenY,this.screenX=s,this.screenY=n,this.x=h,this.y=o,this._event.prevScreenX=this.prevScreenX,this._event.prevScreenY=this.prevScreenY):(this._event.prevScreenX=0,this._event.prevScreenY=0),this._event.screenX=s,this._event.screenY=n,this._event.x=h,this._event.y=o,this._event.keyCode=i,this._event.keyboard=!1,this.onUp.emit(this._event,Input.Event.UP),this.onClick.emit(this._event,Input.Event.CLICK),this._event.entity=null}},handleTouchMove:function(t){document.activeElement===document.body&&this.trapTouch&&t.preventDefault();for(var e,i,s,n,h,o,a=meta,r=a.camera,l=t.changedTouches,u=l.length,c=0;c<u;c++)if(e=t.changedTouches[c],i=this._getTouchID(e.identifier),i!==-1){s=(e.pageX-this.engine.offsetLeft)*this.engine.scaleX*this.engine.ratio,n=(e.pageY-this.engine.offsetTop)*this.engine.scaleY*this.engine.ratio,h=s*r.zoomRatio+r.volume.x|0,o=n*r.zoomRatio+r.volume.y|0;var d=i+Input.BUTTON_ENUM_OFFSET;this._event.event=t,0===i?(this.prevScreenX=this.screenX,this.prevScreenY=this.screenY,this.screenX=s,this.screenY=n,this.x=h,this.y=o,this._event.prevScreenX=this.prevScreenX,this._event.prevScreenY=this.prevScreenY):(this._event.prevScreenX=s,this._event.prevScreenY=n),this._event.screenX=0,this._event.screenY=0,this._event.x=h,this._event.y=o,this._event.keyCode=d,this._event.keyboard=!1,this.onMove.emit(this._event,Input.Event.MOVE),this._event.entity=null}},resetInput:function(){var t;this._event.event=null,this._event.prevX=0,this._event.prevY=0,this._event.x=0,this._event.y=0,this._event.keyCode=0,this._event.keyboard=!1,this.metaPressed=!1;this.numKeys+this.numInputs;for(t=0;t<this.numTotalKeys;t++)this.keys[t]&&(this.keys[t]=0,this._event.keyCode=t,this.onKeyUp.emit(this._event,Input.Event.UP));if(this.pressed={},this.keybind={},this._numCmdKeys=0,this.numTouches){for(t=0;t<this.numTouches;t++)this._event.keyCode=t,this.onUp.emit(this._event,Input.Event.UP);this.touches.length=0,this.numTouches=0}},getEvent:function(){return this._event.event=null,this._event.prevScreenX=this.prevScreenX,this._event.prevScreenY=this.prevScreenY,this._event.screenX=this.screenX,this._event.screenY=this.screenY,this._event.x=this.inputX,this._event.y=this.inputY,this._event.keyCode=-1,this._event},_loadIgnoreKeys:function(){this._ignoreKeys=[],this._ignoreKeys[8]=1,this._ignoreKeys[9]=1,this._ignoreKeys[13]=1,this._ignoreKeys[17]=1,this._ignoreKeys[91]=1,this._ignoreKeys[38]=1,this._ignoreKeys[39]=1,this._ignoreKeys[40]=1,this._ignoreKeys[37]=1,this._ignoreKeys[124]=1,this._ignoreKeys[125]=1,this._ignoreKeys[126]=1,this._cmdKeys=[],this._cmdKeys[91]=1,this._cmdKeys[17]=1,this._iframeKeys=[],this._iframeKeys[37]=1,this._iframeKeys[38]=1,this._iframeKeys[39]=1,this._iframeKeys[40]=1},_ignoreFKeys:function(t){this._ignoreKeys[112]=t,this._ignoreKeys[113]=t,this._ignoreKeys[114]=t,this._ignoreKeys[115]=t,this._ignoreKeys[116]=t,this._ignoreKeys[117]=t,this._ignoreKeys[118]=t,this._ignoreKeys[119]=t,this._ignoreKeys[120]=t,this._ignoreKeys[121]=t,this._ignoreKeys[122]=t,this._ignoreKeys[123]=t},set ignoreFKeys(t){t?this._ignoreFKeys(1):this._ignoreFKeys(0)},get ignoreFKeys(){return!!this._ignoreKeys[112]},_getTouchID:function(t){for(var e=0;e<this.numTouches;e++)if(this.touches[e]===t)return e;return-1},addKeybind:function(t,e){this._keybindMap||(this._keybindMap=new Array(this.numKeys+this.numInputs+1));for(var i,s=e.length,n=0;n<s;n++)i=e[n],this._keybindMap[i]?this._keybindMap[i].push(t):this._keybindMap[i]=[t]},isDown:function(t){return this.keys[t]},isUp:function(t){return!this.keys[t]},onDown:null,onUp:null,onMove:null,onClick:null,onDbClick:null,engine:meta.engine,keyID:null,keys:null,touches:null,pressed:null,keybind:null,_keybindMap:null,blockInput:!1,stickyKeys:!0,metaPressed:!1,keyRepeat:0,_inputTimer:null,_repeatKey:0,numKeys:256,numInputs:10,numTouches:0,x:0,y:0,screenX:0,screenY:0,prevScreenX:0,prevScreenY:0,_event:null,_ignoreKeys:null,_cmdKeys:null,_iframeKeys:null,_numCmdKeys:0})},function(t,e,i){"use strict";meta.math.AABB=function(t,e,i,s){this.x=t||0,this.y=e||0,this.width=i||0,this.height=s||0,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.pivotPosX=this.width*this.pivotX,this.pivotPosY=this.height*this.pivotY,this.minX=this.x,this.minY=this.y,this.maxX=this.x+this.width,this.maxY=this.y+this.height},meta.math.AABB.prototype={set:function(t,e,i,s){this.x=t||0,this.y=e||0,this.width=i||0,this.height=s||0,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.pivotPosX=this.width*this.pivotX,this.pivotPosY=this.height*this.pivotY,this.minX=this.x,this.minY=this.y,this.maxX=this.x+this.width,this.maxY=this.y+this.height},position:function(t,e){this.x=t,this.y=e,this.minX=this.x-this.pivotPosX,this.minY=this.y-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},move:function(t,e){this.x+=t,this.y+=e,this.minX+=t,this.minY+=e,this.maxX+=t,this.maxY+=e},resize:function(t,e){this.width=t,this.height=e,this.halfWidth=t/2,this.halfHeight=e/2,this.pivotPosX=this.width*this.pivotX,this.pivotPosY=this.height*this.pivotY,this.minX=this.x-this.pivotPosX,this.minY=this.y-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},pivot:function(t,e){void 0===e&&(e=t),this.pivotX=t,this.pivotY=e,this.pivotPosX=this.width*this.pivotX,this.pivotPosY=this.height*this.pivotY,this.minX=this.x-this.pivotPosX,this.minY=this.y-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},vsAABB:function(t){return!(this.maxX<t.minX||this.minX>t.maxX)&&!(this.maxY<t.minY||this.minY>t.maxY)},vsBorderAABB:function(t){return!(this.maxX<=t.minX||this.minX>=t.maxX)&&!(this.maxY<=t.minY||this.minY>=t.maxY)},vsAABBIntersection:function(t){return this.maxX<t.minX||this.minX>t.maxX?0:this.maxY<t.minY||this.minY>t.maxY?0:this.minX>t.minX||this.minY>t.minY?1:this.maxX<t.maxX||this.maxY<t.maxY?1:2},vsPoint:function(t,e){return!(this.minX>t||this.maxX<t)&&!(this.minY>e||this.maxY<e)},vsBorderPoint:function(t,e){return!(this.minX>=t||this.maxX<=t)&&!(this.minY>=e||this.maxY<=e)},getSqrDistance:function(t,e){var i,s=0;return t<this.minX&&(i=this.minX-t,s+=i*i),t>this.maxX&&(i=t-this.maxX,s+=i*i),e<this.minY&&(i=this.minY-e,s+=i*i),e>this.maxY&&(i=e-this.maxY,s+=i*i),s},getDistanceVsAABB:function(t){var e=this.minX+(this.maxX-this.minX)/2,i=this.minY+(this.maxY-this.minY)/2,s=t.minX+(t.maxY-t.minY)/2,n=t.minY+(t.maxY-t.minY)/2,h=s-e,o=n-i;return Math.sqrt(h*h+o*o)},isUndefined:function(){return void 0===this.maxY},genCircle:function(){var t,e=this.maxX-this.minX,i=this.maxY-this.minY;return t=e>i?e/2:i/2,new meta.math.Circle(this.x,this.y,t)},print:function(t){t?console.log("(AABB) "+t+" minX: "+this.minX+" minY: "+this.minY+" maxX: "+this.maxX+" maxY: "+this.maxY):console.log("(AABB) minX: "+this.minX+" minY: "+this.minY+" maxX: "+this.maxX+" maxY: "+this.maxY)},pivotX:0,pivotY:0,type:meta.math.VolumeType.AABB}},function(t,e,i){"use strict";meta.math.AABBext=function(){this.x=0,this.y=0,this.width=0,this.height=0,this.halfWidth=0,this.halfHeight=0,this.initWidth=0,this.initHeight=0,this.minX=0,this.minY=0,this.maxX=0,this.maxY=0},meta.math.AABBext.prototype={position:function(t,e){this.x=t,this.y=e,this.minX=this.x-this.pivotPosX,this.minY=this.y-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},move:function(t,e){this.x+=t,this.y+=e,this.minX+=t,this.minY+=e,this.maxX+=t,this.maxY+=e},updatePos:function(){this.minX=this.x-this.pivotPosX,this.minY=this.y-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},pivot:function(t,e){void 0===e&&(e=t),this.pivotX=t,this.pivotY=e,this.initPivotPosX=this.initWidth*this.pivotX|0,this.initPivotPosY=this.initHeight*this.pivotY|0,this.updatePivotPos()},updatePivotPos:function(){this.scaleX>0?this.pivotPosX=this.pivotX*this.width:this.pivotPosX=(1-this.pivotX)*this.width,this.scaleY>0?this.pivotPosY=this.pivotY*this.height:this.pivotPosY=(1-this.pivotY)*this.height,this.minX=this.x-this.pivotPosX,this.minY=this.y-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},resize:function(t,e){this.initWidth=t,this.initHeight=e,this.initPivotPosX=t*this.pivotX|0,this.initPivotPosY=e*this.pivotY|0,this.width=t*Math.abs(this.scaleX)|0,this.height=e*Math.abs(this.scaleY)|0,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.updatePivotPos()},scale:function(t,e){this.scaleX=t*this.flipX,this.scaleY=e*this.flipY,this.width=Math.floor(this.initWidth*t),this.height=Math.floor(this.initHeight*e),this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.updatePosTransform()},flip:function(t,e){void 0===t?(this.flipX=-this.flipX,this.scaleX*=-1):this.flipX!==t&&(this.flipX=t,this.scaleX*=-1),void 0===e||this.flipY!==e&&(this.flipY=e,this.scaleY*=-1),this.updatePosTransform()},rotate:function(t){var e=2*Math.PI,t=t%e;t<0&&(t+=e),this.angle=t,this.sin=Math.sin(t),this.cos=Math.cos(t),this.m11=this.cos*this.scaleX,this.m12=this.sin*this.scaleX,this.m21=-this.sin*this.scaleY,this.m22=this.cos*this.scaleY,this.__transformed=1},updatePosTransform:function(){this.scaleX>0?this.pivotPosX=this.pivotX*this.width:this.pivotPosX=(1-this.pivotX)*this.width,this.scaleY>0?this.pivotPosY=this.pivotY*this.height:this.pivotPosY=(1-this.pivotY)*this.height,this.minX=this.x-this.pivotPosX,this.minY=this.y-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height,this.m11=this.cos*this.scaleX,this.m12=this.sin*this.scaleX,this.m21=-this.sin*this.scaleY,this.m22=this.cos*this.scaleY,this.__transformed=1},vsAABB:function(t){return!(this.maxX<=t.minX||this.minX>=t.maxX)&&!(this.maxY<=t.minY||this.minY>=t.maxY)},vsAABBIntersection:function(t){return this.maxX<t.minX||this.minX>t.maxX?0:this.maxY<t.minY||this.minY>t.maxY?0:this.minX>=t.minX||this.minY>=t.minY?1:this.maxX<=t.maxX||this.maxY<=t.maxY?1:2},vsPoint:function(t,e){return!(this.minX>=t||this.maxX<=t)&&!(this.minY>=e||this.maxY<=e)},getSqrDistance:function(t,e){var i,s=0;return t<this.minX&&(i=this.minX-t,s+=i*i),t>this.maxX&&(i=t-this.maxX,s+=i*i),e<this.minY&&(i=this.minY-e,s+=i*i),e>this.maxY&&(i=e-this.maxY,s+=i*i),s},getDistanceVsAABB:function(t){var e=this.minX+(this.maxX-this.minX)/2,i=this.minY+(this.maxY-this.minY)/2,s=t.minX+(t.maxY-t.minY)/2,n=t.minY+(t.maxY-t.minY)/2,h=s-e,o=n-i;return Math.sqrt(h*h+o*o)},genCircle:function(){var t,e=this.maxX-this.minX,i=this.maxY-this.minY;return t=e>i?e/2:i/2,new meta.math.Circle(this.x,this.y,t)},print:function(t){t?console.log("(Volume) "+t+" minX: "+this.minX+" minY: "+this.minY+" maxX: "+this.maxX+" maxY: "+this.maxY):console.log("(Volume) minX: "+this.minX+" minY: "+this.minY+" maxX: "+this.maxX+" maxY: "+this.maxY)},pivotX:0,pivotY:0,pivotPosX:0,pivotPosY:0,initPivotPosX:0,initPivotPosY:0,anchorPosX:0,anchorPosY:0,scaleX:1,scaleY:1,flipX:1,flipY:1,angle:0,sin:0,cos:1,m11:1,m12:0,m21:0,m22:1,__transformed:0,type:meta.math.VolumeType.AABB}},function(t,e,i){"use strict";meta.math.Circle=function(t,e,i){this.x=t,this.y=e,this.radius=i,this.minX=t-i,this.minY=e-i,this.maxX=t+i,this.maxY=e+i},meta.math.Circle.prototype={position:function(t,e){this.x=t,this.y=e,this.minX=t-this.radius,this.minY=e-this.radius,this.maxX=t+this.radius,this.maxY=e+this.radius},move:function(t,e){this.x+=t,this.y+=e,this.minX+=t,this.minY+=e,this.maxX+=t,this.maxY+=e},vsPoint:function(t,e){return 2*(this.x-t)+2*(this.y-e)<=2*radius},vsAABB:function(t){},vsCircle:function(t){var e=t.x-this.x,i=t.y-this.y,s=this.radius+t.radius;return e*e+i*i<s*s},overlapCircle:function(t){var e=Math.sqrt((this.x-t.x)*(this.y-t.y));return e>this.radius+t.radius?0:e<=Math.abs(this.radius+t.radius)?1:2},genAABB:function(){return new meta.math.AABB(this.x-this.radius,this.y-this.radius,this.x+this.radius,this.y+this.radius)},print:function(t){t?console.log("["+t+"] x:",this.x,"y:",this.y,"raidus:",this.radius):console.log("x:",this.x,"y:",this.y,"raidus:",this.radius)},type:meta.math.VolumeType.CIRCLE}},function(t,e,i){"use strict";meta.math={degToRad:function(t){return t*Math.PI/180},radToDeg:function(t){return 180*t/Math.PI},radiansToPoint:function(t,e,i,s){var n=i-t,h=s-e;return Math.atan(n/h)},clamp:function(t,e,i){return t<e?e:t>i?i:t},map:function(t,e,i,s,n){return t==e?s:(t-e)*(n-s)/(i-e)+s},length:function(t,e,i,s){var n=i-t,h=s-e;return Math.sqrt(n*n+h*h)},length2:function(t,e){return Math.sqrt(t*t+e*e)},limit:function(t,e){return t>e?e:t<-e?-e:t},lerp:function(t,e,i){return t+(e-t)*i},lookAt:function(t,e,i,s){return Math.atan2(i-t,e-s)},lookAtEntity:function(t,e){return meta.math.lookAt(t.x,t.y,e.x,e.y)},VolumeType:{AABB:0,CIRCLE:1,SEGMENT:2}}},function(t,e,i){"use strict";meta.math.Matrix4=function(){this.m=new Float32Array(16),this.m[0]=1,this.m[5]=1,this.m[10]=1,this.m[15]=1},meta.math.Matrix4.prototype={reset:function(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=0,this.m[4]=0,this.m[5]=1,this.m[6]=0,this.m[7]=0,this.m[8]=0,this.m[9]=0,this.m[10]=1,this.m[11]=0,this.m[12]=0,this.m[13]=0,this.m[14]=0,this.m[15]=1},scale:function(t,e,i){this.m[0]=t,this.m[5]=e,this.m[10]=i},ortho:function(t,e,i,s,n,h){this.m[0]=2/(e-t),this.m[1]=0,this.m[2]=0,this.m[3]=0,this.m[4]=0,this.m[5]=2/(s-i),this.m[6]=0,this.m[7]=0,this.m[8]=0,this.m[9]=0,this.m[10]=-2/(h-n),this.m[11]=0,this.m[12]=-(e+t)/(e-t),this.m[13]=-(s+i)/(s-i),this.m[14]=-(h+n)/(h-n),this.m[15]=1}}},function(t,e,i){"use strict";meta.math.Random=function(){this.seed=0,this.a=0,this.m=0,this.q=0,this.r=0,this.oneOverM=0,this.init()},meta.math.Random.prototype={init:function(){this.setSeed(3456789012,!0)},generate:function(){var t=Math.floor(this.seed/this.q),e=this.seed%this.q,i=this.a*e-this.r*t;return i>0?this.seed=i:this.seed=i+this.m,this.seed*this.oneOverM},number:function t(e,i){var t=this.generate();return Math.round((i-e)*t+e)},numberF:function(t,e){var i=this.generate();return(e-t)*i+t},setSeed:function(t,e){if(void 0!==e&&(e=!0),e===!0){var i=new Date;this.seed=t+16777215*i.getSeconds()+65535*i.getMinutes()}else this.seed=t;this.a=48271,this.m=2147483647,this.q=Math.floor(this.m/this.a),this.r=this.m%this.a,this.oneOverM=1/this.m}},meta.random=new meta.math.Random},function(t,e,i){"use strict";meta.math.Vector2=function(t,e){this.x=t,this.y=e},meta.math.Vector2.prototype={reset:function(){this.x=0,this.y=0},set:function(t,e){this.x=t,this.y=e},add:function(t,e){this.x+=t,this.y+=e},addValue:function(t){this.x+=x,this.y+=y},addVec:function(t){this.x+=t.x,this.y+=t.y},sub:function(t,e){this.x-=t,this.y-=e},subValue:function(t){this.x-=t,this.y-=t},subVec:function(t){this.x-=t.x,this.y-=t.y},mul:function(t,e){this.x*=t,this.y*=e},mulValue:function(t){this.x*=t,this.y*=t},mulVec:function(t){this.x*=t.x,this.y*=t.y},div:function(t,e){this.x/=t,this.y/=e},divValue:function(t){this.x/=t,this.y/=t},divVec:function(t){this.x/=t.x,this.y/=t.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);t>0?(this.x/=t,this.y/=t):(this.x=0,this.y=0)},dot:function(t){return this.x*t.x+this.y*t.y},truncate:function(t){var e=Math.sqrt(this.x*this.x+this.y*this.y);e>t&&(this.x*=t/e,this.y*=t/e)},limit:function(t){this.x>t?this.x=t:this.x<-t&&(this.x=-t),this.y>t?this.y=t:this.y<-t&&(this.y=-t)},clamp:function(t,e,i,s){this.x=Math.min(Math.max(this.x,t),i),this.y=Math.min(Math.max(this.y,e),s)},lengthSq:function(){return this.x*this.x+this.y*this.y},heading:function(){var t=Math.atan2(-this.y,this.x);return-t+.5*Math.PI},perp:function(){var t=this.x;this.x=-this.y,this.y=t},reflect:function(t){var e=this.dot(t);this.x-=2*e*t.x,this.y-=2*e*t.y},print:function(t){t?console.log('[vec "'+t+'"] x: '+this.x+" y: "+this.y):console.log("[vec] x: "+this.x+" y: "+this.y)}}},function(t,e,i){"use strict";window.meta={version:"0.83 dev",importUrl:"http://meta2d.com/store/",device:null,resources:null,renderer:null,camera:null,input:null,physics:null,steering:null,channels:[],modules:{},loading:null,preloading:null,flags:{webGL:!0,audioAPI:!0,culling:!0},time:{delta:0,deltaF:0,maxDelta:250,scale:1,curr:0,fps:0,current:0,update:0,accumulator:0,frameIndex:0,updateFreq:100},cache:{width:0,height:0,metaTagsAdded:!1,timerIndex:0,createFuncs:[],initFuncs:[],preloadFuncs:[],loadFuncs:[],readyFuncs:[],view:null,views:{},scripts:null,pendingScripts:null,numScriptsToLoad:0,resolutions:null,currResolution:null,imageSmoothing:!0,infoView:null},set onCreate(t){this.cache.createFuncs.push(t),this.engine&&this.engine.inited&&t()},set onInit(t){this.cache.initFuncs.push(t),this.engine&&this.engine.inited&&t()},set onPreload(t){this.cache.preloadFuncs.push(t),this.engine&&this.engine.preloaded&&t()},set onLoad(t){this.cache.loadFuncs.push(t),this.engine&&this.engine.loaded&&t()},set onReady(t){this.cache.readyFuncs.push(t),this.engine&&this.engine.ready&&t()},set onUpdate(t){this.engine.updateFuncs.push(t)},set onRender(t){this.engine.renderFuncs.push(t)},set debug(t){this.cache.debug!==t&&(this.cache.debug=t,t?(meta.emit(meta.Event.DEBUG,t,meta.Event.DEBUG),meta.debugger.load()):(meta.emit(meta.Event.DEBUG,t,meta.Event.DEBUG),meta.debugger.unload()))},get debug(){return this.cache.debug},loadCfg:function(t){console.log(t)}}},function(t,e,i){"use strict";meta.component("Physics.Body",{onAdd:function(){this.velocity=new meta.math.Vector2(0,0),this.acceleration=new meta.math.Vector2(0,0),this.speed=new meta.math.Vector2(0,0),this._volume=this.owner.volume},onActiveEnter:function(){meta.physics.add(this)},onActiveExit:function(){meta.physics.remove(this)},step:function(t){if(this.colliding=!1,this.volume.position(this.owner.volume.x,this.owner.volume.y),this.haveTarget){var e=meta.math.length(this.volume.x,this.volume.y,this.targetX,this.targetY);e<=this.speed*t?(this.volume.position(this.targetX,this.targetY),this.stop()):(this._vec.x=this.targetX-this.volume.x,this._vec.y=this.targetY-this.volume.y,this._vec.normalize(),this.velocity.x=this._vec.x*this.speed,this.velocity.y=this._vec.y*this.speed)}this.velocity.x+=this.acceleration.x*t,this.velocity.y+=this.acceleration.y*t,this.volume.move(this.velocity.x*t,this.velocity.y*t),this.acceleration.x=0,this.acceleration.y=0},applyForce:function(t){this.acceleration.x+=t.x/this.invMass,this.acceleration.y+=t.y/this.invMass},moveTo:function(t,e,i,s){this.targetX=t,this.targetY=e,this.haveTarget=!0,this.speed=i||600,this.moveToCB=s||null},stop:function(){this.speed=0,this.velocity.x=0,this.velocity.y=0,this.haveTarget&&(this.haveTarget=!1,this.moveToCB&&(this.moveToCB.call(this.owner),this.moveToCB=null)),this.onStop&&this.onStop.call(this.owner)},onStop:null,set volume(t){t instanceof meta.math.Circle?this.type=1:this.type=0,this._volume=t,this._volume.position(this.owner.volume.x,this.owner.volume.y)},get volume(){return this._volume},set mass(t){this._mass=t,0===t?this.invMass=0:this.invMass=1/t},get mass(){return this._mass},type:0,_volume:null,_mass:1,invMass:1,restitution:.6,velocity:null,moveX:0,moveY:0,worldBounds:!1,ghost:!1,bouncing:!1,colliding:!1,targetX:0,targetY:0,haveTarget:!1,moveToCB:null,maxSpeed:Number.MAX_VALUE,acceleration:null,accelerationMod:1,_vec:new meta.math.Vector2(0,0),__index:-1})},function(t,e,i){"use strict";meta.class("Physics.Manager",{init:function(){this.bodies=[],this.bodiesRemove=[],this.manifold=new this.Manifold,this.start(),meta.renderer.onRenderDebug.add(this.renderDebug,this)},update:function(t){this.bodiesRemove.length>0&&this.removeBodies();for(var e=null,i=null,s=this.bodies.length,n=0;n<s;n++)e=this.bodies[n],e.step(t),e.worldBounds&&this.bodyVsWorld(e);var h,o=0;for(n=0;n<s;n++){for(e=this.bodies[n],o=n+1;o<s;o++)i=this.bodies[o],0===e._mass&&0===i._mass||this.bodyVsBody(e,i)&&(e.colliding=!0,i.colliding=!0,e.onCollision&&(this.manifold.entity=i.owner,e.onCollision(this.manifold)),i.onCollision&&(this.manifold.entity=e.owner,i.onCollision(this.manifold)));h=e.owner,h.position(e.volume.x-h.totalOffsetX,e.volume.y-h.totalOffsetY)}},bodyVsWorld:function(t){for(var e,i=meta.world.volumes,s=i.length,n=0;n<s;n++)e=i[n],e!==t.volume&&(0===e.type?this.bodyVsWorldBox(t,e):this.bodyVsWorldCircle(t,e))},bodyVsWorldBox:function(t,e){var i=(meta.world,t.volume),s=i.x,n=i.y,h=!1;i.minX<e.minX?(s=e.minX+(i.x-i.minX),this.manifold.normal.x=1,h=!0,t.bouncing?t.velocity.x*=-1:t.velocity.x=0):i.maxX>e.maxX?(s+=e.maxX-i.maxX,this.manifold.normal.x=-1,h=!0,t.bouncing?t.velocity.x*=-1:t.velocity.x=0):this.manifold.normal.x=0,i.minY<e.minY?(n=e.minY+(i.y-i.minY),this.manifold.normal.y=1,h=!0,t.bouncing?t.velocity.y*=-1:t.velocity.y=0):i.maxY>e.maxY?(n+=e.maxY-i.maxY,this.manifold.normal.y=-1,h=!0,t.bouncing?t.velocity.y*=-1:t.velocity.y=0):this.manifold.normal.y=0,h&&(i.position(s,n),t.onCollision&&(this.manifold.entity=null,t.onCollision.call(t,this.manifold)))},bodyVsWorldCircle:function(t){var e=shape.x-volume.x,i=shape.y-volume.y,s=shape.radius-volume.radius,n=e*e+i*i;if(n>=s*s){var h=Math.sqrt(n);0!==h?(this.manifold.penetration=s-h,this.manifold.normal.x=-e/h,this.manifold.normal.y=-i/h):(this.manifold.penetration=volume1.radius,this.manifold.normal.x=1,this.manifold.normal.y=0),volume.move(this.manifold.penetration*this.manifold.normal.x,this.manifold.penetration*this.manifold.normal.y);var o=t.velocity.dot(this.manifold.normal);t.velocity.x-=2*o*this.manifold.normal.x,t.velocity.y-=2*o*this.manifold.normal.y}},boxVsCircle_world:function(t){},circleVsCircle_world:function(t){},bodyVsBody:function(t,e){var i=t.volume.type,s=e.volume.type;if(0===i){if(0===s)return this.boxVsBox(t,e);if(1===s)return this.boxVsCircle(t,e)}else if(1===i){if(0===s)return this.boxVsCircle(e,t);if(1===s)return this.circleVsCircle(t,e)}return!1},boxVsBox:function(t,e){var i=t.volume,s=e.volume,n=s.minX+s.halfWidth-(i.minX+i.halfWidth),h=i.halfWidth+s.halfWidth-Math.abs(n);if(h<=0)return!1;var o=s.minY+s.halfHeight-(i.minY+i.halfHeight),a=i.halfHeight+s.halfHeight-Math.abs(o);return!(a<=0)&&(h<a?(n<0?this.manifold.normal.set(-1,0):this.manifold.normal.set(1,0),this.manifold.penetration=h):(o<0?this.manifold.normal.set(0,-1):this.manifold.normal.set(0,1),this.manifold.penetration=a),0===e._mass&&i.move(-this.manifold.penetration*this.manifold.normal.x,-this.manifold.penetration*this.manifold.normal.y),0===t._mass&&s.move(this.manifold.penetration*this.manifold.normal.x,this.manifold.penetration*this.manifold.normal.y),!0)},circleVsCircle:function(t,e){var i=t.volume,s=e.volume,n=s.x-i.x,h=s.y-i.y,o=i.radius+s.radius,a=n*n+h*h;if(a>o*o)return!1;var r=Math.sqrt(a);0!==r?(this.manifold.penetration=o-r,this.manifold.normal.x=-n/r,this.manifold.normal.y=-h/r):(this.manifold.penetration=i.radius,this.manifold.normal.x=1,this.manifold.normal.y=0);var l=1/(t._mass+e._mass),u=this.manifold.penetration*(t._mass*l);return i.move(u*this.manifold.normal.x,u*this.manifold.normal.y),t.velocity.reflect(this.manifold.normal),this.manifold.normal.x=-this.manifold.normal.x,this.manifold.normal.y=-this.manifold.normal.y,u=this.manifold.penetration*(e._mass*l),s.move(u*this.manifold.normal.x,u*this.manifold.normal.y),e.velocity.reflect(this.manifold.normal),!0},boxVsCircle:function(t,e){var i=t.volume,s=e.volume,n=s.x-(i.minX+i.halfWidth),h=s.y-(i.minY+i.halfHeight),o=.5*(i.maxX-i.minX),a=.5*(i.maxY-i.minY),r=Math.min(Math.max(n,-o),o),l=Math.min(Math.max(h,-a),a);if(n===r&&h===l)Math.abs(n)>Math.abs(h)?(this.manifold.normal.y=0,n<0?(this.manifold.normal.x=-1,this.manifold.penetration=i.halfWidth+n+s.radius):(this.manifold.normal.x=1,this.manifold.penetration=i.halfWidth-n+s.radius)):(this.manifold.normal.x=0,h<0?(this.manifold.normal.y=-1,this.manifold.penetration=i.halfHeight+h+s.radius):(this.manifold.normal.y=1,this.manifold.penetration=i.halfHeight-h+s.radius));else{var u=n-r,c=h-l,d=u*u+c*c;if(d>s.radius*s.radius)return!1;this.manifold.penetration=Math.sqrt(d)-s.radius,this.manifold.normal.x=-u,this.manifold.normal.y=-c,this.manifold.normal.normalize()}var f=1/(t._mass+e._mass),m=this.manifold.penetration*(t._mass*f);return i.move(m*-this.manifold.normal.x,m*-this.manifold.normal.y),m=this.manifold.penetration*(e._mass*f),s.move(m*this.manifold.normal.x,m*this.manifold.normal.y),t.bouncing&&t.velocity.reflect(this.manifold.normal),e.bouncing&&e.velocity.reflect(this.manifold.normal),!0},renderDebug:function(t){if(0!==this.bodies.length){
var e=t.ctx,i=meta.camera._zoom,s=meta.camera.volume;e.save(),e.setTransform(i,0,0,i,-Math.floor(s.x*i),-Math.floor(s.y*i)),e.fillStyle=this.debugColor,e.globalAlpha=.8;for(var n,h,o=t.entities,a=o.length,r=0;r<a;r++)h=o[r],0!==(h.flags&h.Flag.RENDER)&&(n=o[r].components.Body,n&&this.drawVolume(e,n.volume));e.restore()}},drawVolume:function(t,e){0===e.type?t.fillRect(Math.floor(e.minX),Math.floor(e.minY),Math.ceil(e.width),Math.ceil(e.height)):1===e.type&&(t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),e.radius,0,2*Math.PI,!1),t.fill())},add:function(t){return t?t.__index!==-1?void console.warn("(Physics) Body is already in use"):(t.__index=this.bodies.length,void this.bodies.push(t)):void console.warn("(Physics) Invalid body passed")},remove:function(t){if(!t)return void console.warn("(Physics) Invalid body passed");if(t.__index===-1)return void console.warn("(Physics) Body is not in use");if(this.stopped){var e=this.bodies.length-1,i=this.bodies[e];t!==i&&(i.__index=t.__index,this.bodies[t.__index]=i),t.__index=-1,this.bodies.length=e}else this.bodiesRemove.push(t)},removeBodies:function(){for(var t,e,i=this.bodiesRemove.length,s=this.bodies.length,n=0;n<i;n++)t=this.bodiesRemove[n],e=this.bodies[s-1],t!==e&&(e.__index=t.__index,this.bodies[t.__index]=e),t.__index=-1,s--;this.bodies.length=s,this.bodiesRemove.length=0,console.log(s)},start:function(){this.stopped=!1,meta.engine.onUpdate.add(this.update,this)},stop:function(){this.stopped=!0,this.removeBodies(),meta.engine.onUpdate.remove(this)},Manifold:function(){this.entity=null,this.normal=new meta.math.Vector2(0,0),this.penetration=0},bodies:null,bodiesRemove:null,gravity:new meta.math.Vector2(0,0),wind:new meta.math.Vector2(0,0),friction:25,manifold:null,_relativeVel:new meta.math.Vector2(0,0),_impulseX:0,_impulseY:0,_percent:.8,_slop:.01,debugColor:"#00ff00",stopped:!1})},function(t,e,i){"use strict";meta.class("meta.CanvasRenderer","meta.Renderer",{init:function(){this._super(),this.ctx=meta.engine.canvas.getContext("2d"),meta.engine.ctx=this.ctx},clear:function(){this._transparent?this.ctx.clearRect(0,0,this.engine.width,this.engine.height):(this.ctx.fillStyle=this._bgColor,this.ctx.fillRect(0,0,this.engine.width,this.engine.height))},renderFrame:function(){this.clear(),this.ctx.save();this.camera._zoom;this.setProjection(this.perspectiveProjection),this.renderEntities(this.entities),this.entitiesStatic.length>0&&(this.setProjection(this.orthoProjection),this.renderEntities(this.entitiesStatic)),this.ctx.restore()},renderDebugDrame:function(){this.ctx.save(),this.setProjection(this.orthoProjection),this.renderEntities(this.entitiesDebug),this.ctx.restore()},renderEntities:function(t){for(var e,i=t.length,s=0;s<i;s++)e=t[s],e.flags&this.entityFlag.INSTANCE_HIDDEN||(e.draw?this.drawEntityCustom(e):this.drawEntity(e))},renderDebugVolumes:function(){meta.engine.flags&meta.engine.Flag.LOADING||(this.ctx.save(),this.setProjection(this.perspectiveProjection),this.culling&&meta.debug&&this.culling.drawDebug(this.ctx),this.ctx.lineWidth=2,this._renderVolumes(this.entities),this.entitiesStatic.length>0&&(this.setProjection(this.orthoProjection),this._renderVolumes(this.entitiesStatic)),this.ctx.restore())},_renderVolumes:function(t){for(var e,i=t.length,s=0;s<i;s++)e=t[s],e.flags&this.entityFlag.INSTANCE_HIDDEN||(e.flags&this.entityFlag.DEBUG||this.meta.cache.debug)&&(e.flags&this.entityFlag.PICKING?(this.ctx.strokeStyle="green",this.ctx.fillStyle="green"):(this.ctx.strokeStyle="red",this.ctx.fillStyle="red"),this.drawVolume(e),e.renderDebug&&e.renderDebug())},drawEntity:function(t){var e=t._texture;if(e&&t._texture._loaded){var i=t.volume;if(0!==i.width&&0!==i.height){if(t.clipVolume&&(this.ctx.save(),this.ctx.beginPath(),t.flags&t.Flag.CLIP_BOUNDS?this.ctx.rect(Math.floor(t.volume.minX),Math.floor(t.volume.minY),t.clipVolume.width,t.clipVolume.height):this.ctx.rect(Math.floor(t.clipVolume.minX),Math.floor(t.clipVolume.minY),t.clipVolume.width,t.clipVolume.height),this.ctx.closePath(),this.ctx.clip()),t.flags&t.Flag.DYNAMIC_CLIP)return void(i.width>0&&i.height>0&&this.ctx.drawImage(e.canvas,0,0,i.width,i.height,Math.floor(i.minX),Math.floor(i.minY),i.width,i.height));i.__transformed?(this.ctx.globalAlpha=t.totalAlpha,this.ctx.transform(i.m11,i.m12,i.m21,i.m22,Math.floor(i.x),Math.floor(i.y)),e.frames?e.drawFrame(this.ctx,-i.initPivotPosX,-i.initPivotPosY,t.anim._frame):e.draw(this.ctx,-i.initPivotPosX,-i.initPivotPosY),this.ctx.globalAlpha=1,this.resetProjection()):e.frames?e.drawFrame(this.ctx,Math.floor(i.minX),Math.floor(i.minY),t.anim._frame):e.draw(this.ctx,Math.floor(i.minX),Math.floor(i.minY)),t.clipVolume&&this.ctx.restore()}}},drawEntityCustom:function(t){var e=t.volume;t.clipVolume&&(this.ctx.save(),this.ctx.beginPath(),t.flags&t.Flag.CLIP_BOUNDS?this.ctx.rect(Math.floor(t.volume.minX),Math.floor(t.volume.minY),t.clipVolume.width,t.clipVolume.height):this.ctx.rect(Math.floor(t.clipVolume.minX),Math.floor(t.clipVolume.minY),t.clipVolume.width,t.clipVolume.height),this.ctx.closePath(),this.ctx.clip()),e.__transformed?(this.ctx.globalAlpha=t.totalAlpha,this.ctx.transform(e.m11,e.m12,e.m21,e.m22,Math.floor(e.x),Math.floor(e.y)),t.draw(this.ctx,-e.initPivotPosX,-e.initPivotPosY),this.ctx.globalAlpha=1,this.resetProjection()):t.draw(this.ctx,Math.floor(e.minX),Math.floor(e.minY)),t.clipVolume&&this.ctx.restore()},drawVolume:function(t){var e=t.volume;if(0===e.__transformed){var i=Math.floor(e.minX),s=Math.floor(e.minY),n=Math.ceil(e.maxX),h=Math.ceil(e.maxY);this.ctx.beginPath(),this.ctx.moveTo(i,s),this.ctx.lineTo(n,s),this.ctx.lineTo(n,h),this.ctx.lineTo(i,h),this.ctx.lineTo(i,s-1),this.ctx.stroke(),this.ctx.fillRect(Math.floor(e.x)-3,Math.floor(e.y)-3,6,6)}else{this.ctx.save(),this.ctx.translate(Math.floor(e.x),Math.floor(e.y)),this.ctx.rotate(t.volume.angle),this.ctx.translate(-Math.floor(e.x),-Math.floor(e.y));var i=Math.floor(e.minX),s=Math.floor(e.minY),n=Math.ceil(e.maxX),h=Math.ceil(e.maxY);this.ctx.beginPath(),this.ctx.moveTo(i,s),this.ctx.lineTo(n,s),this.ctx.lineTo(n,h),this.ctx.lineTo(i,h),this.ctx.lineTo(i,s-1),this.ctx.stroke(),this.ctx.fillRect(Math.floor(e.x)-3,Math.floor(e.y)-3,6,6),this.ctx.restore()}},updateBgColor:function(){},perspectiveProjection:function(){var t=this.camera._zoom;this.ctx.setTransform(t,0,0,t,-Math.floor(this.cameraVolume.x*t),-Math.floor(this.cameraVolume.y*t))},orthoProjection:function(){this.ctx.setTransform(1,0,0,1,0,0)},resetProjection:null,setProjection:function(t){this.resetProjection=t,t.call(this)},entityFlag:null,viewFlag:null})},function(t,e,i){"use strict";meta.class("meta.Renderer",{init:function(){var t=Entity.Geometry.prototype,e=meta.View.prototype;this.entityFlag=t.Flag,this.viewFlag=e.Flag;var i=meta.cache.view;this.holder=new Entity.Geometry,this.holder._view=i,this.staticHolder=new Entity.Geometry,this.staticHolder._view=i,this.layerHolder=new Entity.TilemapOrthoLayer,this._view=i;var s=this.holder.Flag.ENABLED|this.holder.Flag.INSTANCE_ENABLED|this.holder.Flag.LOADED;t.flags=s,t.renderer=this,t.parent=this.holder,Entity.TileGeometry.prototype.parent=this.layerHolder,this.holder.flags=s|this.holder.Flag.ROOT_HOLDER,this.staticHolder.flags=s|this.holder.Flag.ROOT_HOLDER,this.entities=[],this.entitiesRemove=[],this.entitiesStatic=[],this.entitiesStaticRemove=[],this.entitiesDebug=[],this.entitiesDebugRemove=[],e.entityParent=this.holder,e.entityBuffer=this.entities,e.entityBufferRemove=this.entitiesRemove,meta.flags.culling&&(this.culling=new meta.SparseGrid),this.onRenderDebug=meta.createChannel(meta.Event.RENDER_DEBUG)},load:function(){this.engine=meta.engine,this.camera=meta.camera,this.cameraVolume=this.camera.volume,this.chn={onDown:meta.createChannel(Entity.Event.INPUT_DOWN),onUp:meta.createChannel(Entity.Event.INPUT_UP),onClick:meta.createChannel(Entity.Event.CLICK),onDbClick:meta.createChannel(Entity.Event.DBCLICK),onDrag:meta.createChannel(Entity.Event.DRAG),onDragStart:meta.createChannel(Entity.Event.DRAG_START),onDragEnd:meta.createChannel(Entity.Event.DRAG_END),onHover:meta.createChannel(Entity.Event.HOVER),onHoverEnter:meta.createChannel(Entity.Event.HOVER_ENTER),onHoverExit:meta.createChannel(Entity.Event.HOVER_EXIT)},meta.input.onDown.add(this.onInputDown,this,meta.Priority.HIGH),meta.input.onUp.add(this.onInputUp,this,meta.Priority.HIGH),meta.input.onMove.add(this.onInputMove,this,meta.Priority.HIGH),meta.input.onDbClick.add(this.onInputDbClick,this,meta.Priority.HIGH),meta.engine.onAdapt.add(this.onAdapt,this),meta.camera.onResize.add(this.onCameraResize,this),meta.camera.onMove.add(this.onCameraMove,this),meta.engine.updateResolution()},update:function(t){this.entitiesRemove.length>0&&this._removeEntities(this.entities,this.entitiesRemove),this.entitiesStaticRemove.length>0&&this._removeEntities(this.entitiesStatic,this.entitiesStaticRemove),this.entitiesDebugRemove.length>0&&this._removeEntities(this.entitiesDebug,this.entitiesDebugRemove),this._removeFromBuffer(this.entitiesUpdate,this.entitiesUpdateRemove),this._removeFromBuffer(this.entitiesUpdate,this.entitiesUpdateRemove),this._removeFromBuffer(this.entitiesAnim,this.entitiesAnimRemove),this._removeFromBuffer(this.entitiesPicking,this.entitiesPickingRemove),this._removeFromBuffer(this.tweens,this.tweensRemove),this._removeFromBufferEx(this.compsUpdate,this.compsUpdateRemove),this.__updating=!0;for(var e=this.entitiesUpdate.length,i=0;i<e;i++)this.entitiesUpdate[i].update(t);for(e=this.compsUpdate.length,i=0;i<e;i++)this.compsUpdate[i].update(t);for(e=this.tweens.length,i=0;i<e;i++)this.tweens[i].update(t);this.__updating=!1,this.needSort&&(this.sort(this.entities),this.sort(this.entitiesStatic),this.sort(this.entitiesPicking),this.sort(this.entitiesDebug),this.needSort=!1,this.needRender=!0)},render:function(t){for(var e=this.entitiesAnim.length,i=0;i<e;i++)this.entitiesAnim[i].update(t);if(this.needRender){this.renderFrame();var s=this._renderFuncs.length;for(i=0;i<s;i++)this._renderFuncs[i].render(t);this.needRender=!1;var n=this.meta.cache.debug||this.numDebug>0;n&&(this.renderDebugVolumes(),this.onRenderDebug.emit(this),this.renderDebugDrame())}},_removeEntities:function(t,e){var i=t.length;this._numRemove=0,this._removeStartID=Number.MAX_SAFE_INTEGER,this._removeEntitiesGroup(t,e,!1);for(var s,n=this._removeStartID+1;n<i;n++)s=t[n],s&&(this._removeStartID===-1&&console.log("ERROR"),t[this._removeStartID++]=s);t[-1]&&console.log("ERROR REMOVE"),t.length-=this._numRemove,e.length=0,this.needRender=!0},_removeEntitiesGroup:function(t,e,i){for(var s,n,h=Entity.Geometry.prototype.Flag.RENDER_REMOVE,o=e.length,a=0;a<o;a++)s=e[a],(i||s.flags&h)&&(this._numRemove++,n=t.indexOf(s),t[n]=null,n<this._removeStartID&&(this._removeStartID=n),s._deactivate(),s.__updateIndex!==-1&&(this.entitiesUpdateRemove.push(s),s.__updateIndex=-1),s.flags&s.Flag.PICKING&&this.entitiesPickingRemove.push(s),s.flags&s.Flag.REMOVED&&s._remove(),s.children&&this._removeEntitiesGroup(t,s.children,!0),s.flags&=~s.Flag.RENDER_REMOVE)},_removeFromBuffer:function(t,e){var i=e.length;if(i>0){var s=t.length,n=s-i;if(n>0)for(var h,o=0;o<i;o++)h=t.indexOf(e[o]),t.splice(h,1);else t.length=0;e.length=0}},_removeFromBufferEx:function(t,e){var i=e.length;if(i>0){var s,n=t.length;if(i===n){for(s=0;s<i;s++)t[s]._updateIndex=-1;t.length=0}else{var h,o;for(s=0;s<i;s++)h=e[s],h&&(o=t[--n],o._updateIndex=h._updateIndex,h._updateIndex=-1,t[h._updateIndex]=o);t.length=n}e.length=0}},sort:function(t){t.sort(this.sortFunc)},sortFunc:function(t,e){return t.totalZ-e.totalZ},makeEntityVisible:function(t){t.flags&t.Flag.RENDER||(t.flags|=t.Flag.RENDER,t.flags&t.Flag.RENDER_REMOVE?t.flags&=~t.Flag.RENDER_REMOVE:(t.flags&t.Flag.PICKING&&this.entitiesPicking.push(t),t._view.entityBuffer.push(t)),this.needSort=!0,this.needRender=!0)},makeEntityInvisible:function(t){0!==(t.flags&t.Flag.RENDER)&&(t.flags&=~t.Flag.RENDER,t.flags|=t.Flag.RENDER_REMOVE,t._view.entityBufferRemove.push(t))},addEntity:function(t,e){0!==(t.flags&t.Flag.INSTANCE_ENABLED)&&(t._view.entityBuffer!==this.entities?this.makeEntityVisible(t):this.culling?(t._view.entityBuffer===this.entities&&(t.node=new meta.SparseNode(this)),this.culling.add(t)):this.makeEntityVisible(t),this._addEntity(t,e))},_addEntity:function(t,e){if(t._activate(),t.children)for(var i=t.children,s=i.length,n=0;n<s;n++)this.addEntity(i[n],e)},addEntities:function(t){for(var e=t.length,i=0;i<e;i++)this.addEntity(t[i],!1)},_removeEntity:function(t){0!==(t.flags&t.Flag.ACTIVE)&&(t.flags&t.Flag.RENDER_REMOVE||(t.flags|=t.Flag.RENDER_REMOVE,t.flags&=~t.Flag.RENDER))},removeEntity:function(t){0!==(t.flags&t.Flag.ACTIVE)&&(t.flags&t.Flag.RENDER_REMOVE||(t.flags|=t.Flag.RENDER_REMOVE,t.flags&=~t.Flag.RENDER,t._view.entityBufferRemove.push(t)))},removeEntities:function(t){if(0!==t.length){var e=t[0]._view.entityBufferRemove;e.push.apply(e,t);for(var i=t.length,s=0;s<i;s++)this._removeEntity(t[s])}},addAnim:function(t){t.__index===-1&&(t.__index=this.entitiesAnim.push(t)-1)},removeAnim:function(t){t.__index!==-1&&(this.entitiesAnimRemove.push(t),t.__index=-1)},onInputDown:function(t,e){this.enablePicking&&(this._checkHover(t),this.hoverEntity&&(t.entity=this.hoverEntity,this.pressedEntity=this.hoverEntity,this.pressedEntity.pressed=!0,this.pressedEntity.onDown&&this.pressedEntity.onDown.call(this.pressedEntity,t),this.chn.onDown.emit(t,Entity.Event.INPUT_DOWN)))},onInputUp:function(t,e){this.enablePicking&&this.pressedEntity&&(this._checkHover(t),t.entity=this.hoverEntity,this.pressedEntity.pressed=!1,this.pressedEntity.onUp&&this.pressedEntity.onUp.call(this.pressedEntity,e),this.chn.onUp.emit(this.pressedEntity,Entity.Event.INPUT_UP),this.pressedEntity===this.hoverEntity&&(this.pressedEntity.onClick&&this.pressedEntity.onClick.call(this.pressedEntity,t),this.chn.onClick.emit(t,Entity.Event.CLICK)),this.pressedEntity.dragged&&(t.entity=this.pressedEntity,this.pressedEntity.dragged=!1,this.pressedEntity.onDragEnd&&this.pressedEntity.onDragEnd.call(this.pressedEntity,t),this.chn.onDragEnd.emit(t,Entity.Event.DRAG_END),t.entity=this.hoverEntity),this.pressedEntity=null)},onInputMove:function(t,e){if(this.enablePicking)return this._checkHover(t),this._checkDrag(t)?void(t.entity=this.hoverEntity):void(t.entity=this.hoverEntity)},onInputDbClick:function(t,e){this.enablePicking&&(this._checkHover(t),this.hoverEntity?(t.entity=this.hoverEntity,this.hoverEntity.onDbClick&&this.hoverEntity.onDbClick.call(this.hoverEntity,t),this.chn.onDbClick.emit(t,Entity.Event.DBCLICK)):t.entity=null)},_checkHover:function(t){for(var e,i=this.entitiesPicking.length,s=i-1;s>=0;s--)if(e=this.entitiesPicking[s],!(e.flags&e.Flag.INSTANCE_HIDDEN)){if(this.enablePixelPicking){if(e._view&&e._view.flags&e._view.Flag.STATIC){if(!e.isPointInsidePx(t.screenX,t.screenY))continue}else if(!e.isPointInsidePx(t.x,t.y))continue}else if(e._view&&e._view.flags&e._view.Flag.STATIC){if(!e.isPointInside(t.screenX,t.screenY))continue}else if(!e.isPointInside(t.x,t.y))continue;return this.hoverEntity!==e?(this.hoverEntity&&(t.entity=this.hoverEntity,this.hoverEntity.hover=!1,this.hoverEntity.onHoverExit&&this.hoverEntity.onHoverExit.call(this.hoverEntity,t),this.chn.onHoverExit.emit(t,Entity.Event.HOVER_EXIT)),t.entity=e,e.hover=!0,e.onHoverEnter&&e.onHoverEnter.call(e,t),this.chn.onHoverEnter.emit(t,Entity.Event.HOVER_ENTER),this.hoverEntity=e):(t.entity=e,e.onHover&&e.onHover.call(e,t),this.chn.onHover.emit(t,Entity.Event.HOVER)),void(t.entity=null)}this.hoverEntity&&(t.entity=this.hoverEntity,this.hoverEntity.hover=!1,this.hoverEntity.onHoverExit&&this.hoverEntity.onHoverExit.call(this.hoverEntity,t),this.chn.onHoverExit.emit(t,Entity.Event.HOVER_EXIT)),this.hoverEntity=null},_checkDrag:function(t){return!this.pressedEntity||(t.entity=this.pressedEntity,this.pressedEntity.dragged?(this.pressedEntity.onDrag&&this.pressedEntity.onDrag.call(this.pressedEntity,t),this.chn.onDrag.emit(t,Entity.Event.DRAG)):(this.pressedEntity.dragged=!0,this.pressedEntity.onDragStart&&this.pressedEntity.onDragStart.call(this.pressedEntity,t),this.chn.onDragStart.emit(t,Entity.Event.DRAG_START)),!1)},_updateResize:function(t){for(var e,i=t.length,s=0;s<i;s++)e=t[s],e.parent.flags&e.Flag.ROOT_HOLDER&&e._updateResize()},onCameraResize:function(t,e){this.holder.resize(t.width,t.height),this.staticHolder.resize(meta.engine.width,meta.engine.height),this._updateResize(this.entities),this._updateResize(this.entitiesStatic),this._updateResize(this.entitiesDebug),this.culling&&this.culling.calc()},onCameraMove:function(t,e){this.culling&&this.culling.calc(),this.needRender=!0},onAdapt:function(t,e){},getUniqueID:function(){return this.__uniqueID++},set bgColor(t){this._bgColor=t,this.updateBgColor(),this.needRender=!0},get bgColor(){return this._bgColor},set transparent(t){this._transparent=t,this.updateBgColor(),this.needRender=!0},get transparent(){return this._transparent},addRender:function(t){this._renderFuncs.push(t)},removeRender:function(t){for(var e=this._renderFuncs.length,i=0;i<e;i++)if(this._renderFuncs[i]===t){this._renderFuncs[i]=this._renderFuncs[e-1],this._renderFuncs.pop();break}},onRenderDebug:null,meta:meta,engine:null,chn:null,culling:null,holder:null,staticHolder:null,layerHolder:null,camera:null,cameraVolume:null,cameraDefault:null,cameraUI:null,_removeStartID:0,_numRemove:0,entities:null,entitiesRemove:null,numEntities:0,entitiesUpdate:[],entitiesUpdateRemove:[],entitiesAnim:[],entitiesAnimRemove:[],entitiesPicking:[],entitiesPickingRemove:[],hoverEntity:null,pressedEntity:null,enablePicking:!0,enablePixelPicking:!1,entitiesStatic:null,entitiesStaticRemove:null,entitiesDebug:null,entitiesDebugRemove:null,compsUpdate:[],compsUpdateRemove:[],tweens:[],tweensRemove:[],needRender:!0,needSort:!1,needSortDebg:!1,useSparseGrid:!1,_renderFuncs:[],currZ:0,numDebug:0,_bgColor:"#ddd",_transparent:!1,__uniqueID:0,__updating:!1})},function(t,e,i){"use strict";meta.SparseGrid=function(){this.cells=[],this.cellWidth=meta.flags.cullingWidth||256,this.cellHeight=meta.flags.cullingHeight||256,this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.newMinX=0,this.newMinY=0,this.newMaxX=0,this.newMaxY=0},meta.SparseGrid.prototype={calc:function(){var t=meta.camera.volume,e=Math.floor(t.minX/this.cellWidth),i=Math.floor(t.minY/this.cellHeight),s=Math.floor(t.maxX/this.cellWidth),n=Math.floor(t.maxY/this.cellHeight);if(e!==this.startX||i!==this.startY||s!==this.endX||n!==this.endY){var h,o,a,r;if(e>this.endX||s<this.startX||i>this.endY||n<this.startY){for(r=this.startY;r<=this.endY;r++)for(a=this.startX;a<=this.endX;a++)h=a<<16|65535&r,o=this.cells[h],o&&(o.visible=0,this.makeInvisible(o.data));for(r=i;r<=n;r++)for(a=e;a<=s;a++)h=a<<16|65535&r,o=this.cells[h],o&&(o.visible=1,this.makeVisible(o.data))}else for(var l=e<this.startX?e:this.startX,u=i<this.startY?i:this.startY,c=s>this.endX?s:this.endX,d=n>this.endY?n:this.endY,r=u;r<=d;r++)for(var a=l;a<=c;a++)if(a>=e&&a<=s&&r>=i&&r<=n){if(a<this.startX||a>this.endX||r<this.startY||r>this.endY){if(h=a<<16|65535&r,o=this.cells[h],!o)continue;o.visible=1,this.makeVisible(o.data)}}else{if(h=a<<16|65535&r,o=this.cells[h],!o)continue;o.visible&&(o.visible=0,this.makeInvisible(o.data))}this.startX=e,this.startY=i,this.endX=s,this.endY=n}},makeVisible:function(t){for(var e,i=meta.renderer,s=t.length,n=0;n<s;n++)e=t[n],0===e.node.numVisible&&i.makeEntityVisible(e),e.node.numVisible++},makeInvisible:function(t){for(var e,i=meta.renderer,s=t.length,n=0;n<s;n++)e=t[n],e.node.numVisible--,0===e.node.numVisible&&i.makeEntityInvisible(e)},add:function(t){var e=t.node,i=t.volume;this.calcBounds(i);for(var s,n,h=this.newMinY;h<=this.newMaxY;h++)for(var o=this.newMinX;o<=this.newMaxX;o++)n=o<<16|65535&h,s=this.cells[n],s?(s.data.push(t),s.visible&&e.numVisible++):(s=new this.Cell,s.data.push(t),this.cells[n]=s,o>=this.startX&&o<=this.endX&&h>=this.startY&&h<=this.endY&&(s.visible=1,e.numVisible++));e.minX=this.newMinX,e.minY=this.newMinY,e.maxX=this.newMaxX,e.maxY=this.newMaxY,e.numVisible>0&&meta.renderer.makeEntityVisible(t)},remove:function(t){for(var e,i,s,n,h=(t.volume,t.node),o=h.minY;o<h.maxY;o++)for(var a=h.minX;a<h.maxX;a++)for(i=a<<16|65535&o,e=this.cells[i].data,n=e.length,s=0;s<n;s++)if(e[s]===t){e[s]=e[n-1],e.pop();break}h.minX=0,h.minY=0,h.maxX=0,h.maxY=0,t.node.numVisible>0&&(t.node.numVisible=0,meta.renderer.makeEntityInvisible(t))},update:function(t){if(0!==(t.flags&t.Flag.ACTIVE)){var e=t.node,i=t.volume;if(this.calcBounds(i),e.minX!==this.newMinX||e.minY!==this.newMinY||e.maxX!==this.newMaxX||e.maxY!==this.newMaxY){var s,n,h,o,a,r,l=e.numVisible;if(e.minX>this.newMaxX||e.maxX<this.newMinX||e.minY>this.newMaxY||e.maxY<this.newMinY){for(a=e.minY;a<=e.maxY;a++)for(r=e.minX;r<=e.maxX;r++)h=r<<16|65535&a,n=this.cells[h].data,o=n.indexOf(t),n[o]=n[n.length-1],n.pop();for(e.numVisible=0,a=this.newMinY;a<=this.newMaxY;a++)for(r=this.newMinX;r<=this.newMaxX;r++)h=r<<16|65535&a,s=this.cells[h],s?(s.data.push(t),s.visible&&e.numVisible++):(s=new this.Cell,s.data.push(t),this.cells[h]=s,r>=this.startX&&r<=this.endX&&a>=this.startY&&a<=this.endY&&(s.visible=1,e.numVisible++))}else{var u=this.newMinX<e.minX?this.newMinX:e.minX,c=this.newMinY<e.minY?this.newMinY:e.minY,d=this.newMaxX>e.maxX?this.newMaxX:e.maxX,f=this.newMaxY>e.maxY?this.newMaxY:e.maxY;for(a=c;a<=f;a++)for(r=u;r<=d;r++)r>=e.minX&&r<=e.maxX&&a>=e.minY&&a<=e.maxY?(r>this.newMaxX||r<this.newMinX||a>this.newMaxY||a<this.newMinY)&&(h=r<<16|65535&a,s=this.cells[h],n=s.data,o=n.indexOf(t),n[o]=n[n.length-1],n.pop(),r>=this.startX&&r<=this.endX&&a>=this.startY&&a<=this.endY&&(s.visible=1,e.numVisible--)):(h=r<<16|65535&a,s=this.cells[h],s?(s.data.push(t),s.visible&&e.numVisible++):(s=new this.Cell,s.data.push(t),this.cells[h]=s,r>=this.startX&&r<=this.endX&&a>=this.startY&&a<=this.endY&&(s.visible=1,e.numVisible++)))}0===e.numVisible?l>0&&meta.renderer.makeEntityInvisible(t):0===l&&meta.renderer.makeEntityVisible(t),e.minX=this.newMinX,e.minY=this.newMinY,e.maxX=this.newMaxX,e.maxY=this.newMaxY}}},calcBounds:function(t){if(0!==t.angle){var e,i,s,n,h=t.sin,o=t.cos,a=t.x+-t.pivotPosX*o- -t.pivotPosY*h,r=t.y+-t.pivotPosX*h+-t.pivotPosY*o,l=t.width*o,u=t.height*o,c=t.width*h,d=t.height*h;t.angle<Math.PI?t.angle<1.5707963267948966?(e=a-d,s=a+l,i=r,n=r+u+c):(e=a-d+l,s=a,i=r+u,n=r+c):t.angle<4.71238898038469?(e=a+l,s=a-d,i=r+c+u,n=r):(e=a,s=a+l-d,i=r+c,n=r+u),this.newMinX=Math.floor(e/this.cellWidth),this.newMinY=Math.floor(i/this.cellHeight),this.newMaxX=Math.floor(s/this.cellWidth),this.newMaxY=Math.floor(n/this.cellHeight)}else this.newMinX=Math.floor(t.minX/this.cellWidth),this.newMinY=Math.floor(t.minY/this.cellHeight),this.newMaxX=Math.floor(t.maxX/this.cellWidth),this.newMaxY=Math.floor(t.maxY/this.cellHeight)},drawDebug:function(t){if(this.debug){t.save(),t.lineWidth=1,t.strokeStyle="#43a6e2",t.fillStyle="#c9e3f3";for(var e,i,s=this.startY;s<=this.endY;s++)for(var n=this.startX;n<=this.endX;n++)e=n*this.cellWidth+.5,i=s*this.cellHeight+.5,t.beginPath(),t.rect(e,i,this.cellWidth,this.cellHeight),t.stroke();t.restore()}},Cell:function(){this.data=[],this.visible=0},debug:!0},meta.SparseNode=function(t){this.owner=t,this.numVisible=0,this.minX=0,this.minY=0,this.maxX=0,this.maxY=0}},function(t,e,i){"use strict";var s={};s.Event={FAILED:"res-failed",UNLOADED:"res-unloaded",LOADED:"res-loaded",RESIZE:"res-resize",CHANGED:"res-changed",ADDED:"res-added",REMOVED:"res-removed",LOADING_START:"res-loading-started",LOADING_END:"res-loading-ended",LOADING_UPDATE:"red-loadig-update"},s.Type={BASIC:1,TEXTURE:2,SOUND:3,SPRITE_SHEET:4,FONT:5},s.TextureType={UNKNOWN:-1,CANVAS:0,WEBGL:1},window.Resource=s},function(t,e,i){"use strict";meta.class("Resource.AudioManager",{init:function(){var t=Resource.Sound.prototype;meta.device.audioAPI&&meta.flags.audioAPI?(this.context=new AudioContext,this.gainNode=this.context.createGain(),this.gainNode.connect(this.context.destination),this.gainNode.gain.value=this._volume,t._context=this.context,t._prepare=t._prepare_WebAudio,t._loadFromPath=t._loadFromPath_WebAudio,t._createInstance=t._createInstance_WebAudio,t.steps=2,meta.device.support.consoleCSS?console.log("%cAudio: %cWebAudio ","font-weight: bold; padding: 2px 0 2px 0;","padding: 2px 0 2px 0;"):console.log("Audio: WebAudio")):(this.audioAPI=!1,t._prepare=t._prepare_Audio,t._loadFromPath=t._loadFromPath_Audio,t._createInstance=t._createInstance_Audio,t._syncLoading=!0,meta.device.support.consoleCSS?console.log("%cAudio: %c<audio> ","font-weight: bold; padding: 2px 0 1px 0; width: 500px;","padding: 2px 0 1px 0;"):console.log("Audio: <audio>"))},set volume(t){if(this._volume=meta.math.clamp(t,0,1),!this._mute)if(this.audioAPI)this.gainNode.gain.value=this._volume;else{var e=meta.resources.resources[Resource.Type.SOUND];for(var i in e)e[i].volume=this._volume}},get volume(){return this._volume},set mute(t){if(this._mute!==t){this._mute=t;var e;if(e=t?0:this._volume,this.audioAPI)this.gainNode.gain.value=e;else{var i=meta.resources.resources[Resource.Type.SOUND];for(var s in i)i[s].volume=e}}},get mute(){return this._mute},context:null,gainNode:null,_volume:.5,_mute:!1,audioAPI:!0})},function(t,e,i){"use strict";meta.class("Resource.Basic",{init:function(t,e){this.id=meta.resources.getUniqueID(),e&&(this.tag=e),this.onInit&&this.onInit(t,e)},onInit:null,subscribe:function(t,e){return this.chn||(this.chn=meta.createChannel("__res"+this.id)),this.chn.add(t,e)},unsubscribe:function(t){this.chn&&(this.chn.remove(t),0===this.chn.numSubs&&(this.chn.remove(),this.chn=null))},emit:function(t,e){this.chn&&this.chn.emit(t,e)},set loaded(t){t?this._loaded?(this._loaded=t,this.emit(this,Resource.Event.CHANGED)):(this._loaded=t,this.emit(this,Resource.Event.LOADED)):this._loaded&&(this._loaded=t,this.emit(this,Resource.Event.UNLOADED))},get loaded(){return this._loaded},Flag:{ADDED:8},id:0,flags:0,type:Resource.Type.BASIC,name:"unknown",path:"",fullPath:"",tag:"",chn:null,_loaded:!1,loading:!1,used:!1,steps:1,currStep:0})},function(t,e,i){"use strict";meta.class("Resource.Font","Resource.Basic",{onInit:function(t,e){t&&this.load(meta.resources.rootPath+t)},load:function(t){if(!this.loading&&(this.loaded=!1,t)){this.path=t;var e=this.path.lastIndexOf(".");e===-1||this.path.length-e>4?(this.path+=".fnt",this.format="fnt"):this.format=this.path.substr(e+1);var i=this["parse_"+this.format];if(!i)return void console.warn("(Resource.Font.load) Unsupported format: "+this.format);this.chars=new Array(256),meta.resources.addToLoad(this),this.texture=new Resource.Texture(t),this.texture.subscribe(this._onTextureEvent,this);var s=this;meta.ajax({url:this.path,success:function(t){i.call(s,t)},error:function(){s._onError()}})}},_onError:function(){meta.resources.loadFailed(this)},parse_fnt:function(t){for(this.tokenizer.setup(t),this.tokenizer.nextToken();0!==this.tokenizer.token.type;)this._parseToken_fnt();var e;for(var i in this.chars)e=this.chars[i],e.offsetY>this._minOffsetY&&(e.offsetY-=this._minOffsetY);this._loadedFormat=!0,this.texture._loaded&&(meta.resources.loadSuccess(this),this.loaded=!0)},_parseToken_fnt:function(){var t=this.tokenizer.token,e=t.line;switch(t.str){case"char":for(var i=new this.Rect;t=this.tokenizer.nextToken(),t.line===e;)switch(t.str){case"id":this.tokenizer.nextToken(),t=this.tokenizer.nextToken(),this.chars[t.value]=i;break;case"x":this.tokenizer.nextToken(),t=this.tokenizer.nextToken(),i.x=t.value;break;case"y":this.tokenizer.nextToken(),t=this.tokenizer.nextToken(),i.y=t.value;break;case"yoffset":this.tokenizer.nextToken(),t=this.tokenizer.nextToken(),i.offsetY=t.value,t.value<this._minOffsetY&&0!==t.value&&(this._minOffsetY=t.value);break;case"width":this.tokenizer.nextToken(),t=this.tokenizer.nextToken(),i.width=t.value;break;case"height":this.tokenizer.nextToken(),t=this.tokenizer.nextToken(),i.height=t.value,this.height<t.value&&(this.height=t.value);break;case"xadvance":this.tokenizer.nextToken(),t=this.tokenizer.nextToken(),i.kerning=t.value}break;default:this.tokenizer.nextToken()}},_onTextureEvent:function(t,e){switch(e){case Resource.Event.LOADED:this._loadedFormat&&(meta.resources.loadSuccess(this),this.loaded=!0);break;case Resource.Event.FAILED:}},Rect:function(){this.x=0,this.y=0,this.width=0,this.height=0,this.kerning=0,this.offsetY=0},tokenizer:meta.tokenizer,type:Resource.Type.FONT,format:"",texture:null,chars:null,height:1,_loadedFormat:!1,_minOffsetY:Number.MAX_VALUE})},function(t,e,i){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};meta.class("Resource.Manager",{init:function(){this.onAdded=meta.createChannel(Resource.Event.ADDED),this.onRemoved=meta.createChannel(Resource.Event.REMOVED),this.onLoaded=meta.createChannel(Resource.Event.LOADED),this.onLoadingStart=meta.createChannel(Resource.Event.LOADING_START),this.onLoadingEnd=meta.createChannel(Resource.Event.LOADING_END),this.onLoadingUpdate=meta.createChannel(Resource.Event.LOADING_UPDATE),this.textures={},this.spriteSheets={},this.fonts={},this.sounds={},this.data=[],this.data[Resource.Type.TEXTURE]=this.textures,this.data[Resource.Type.SPRITE_SHEET]=this.spriteSheets,this.data[Resource.Type.FONT]=this.fonts,this.data[Resource.Type.SOUND]=this.sounds,meta.audio=new Resource.AudioManager,meta.engine.onAdapt.add(this.onAdapt,this)},add:function(t){if(!(t.flags&t.Flag.ADDED)){t.flags|=t.Flag.ADDED,"unknown"===t.name&&t.path&&(t.name=t.tag+meta.getNameFromPath(t.path));var e=this.data[t.type];return e[t.name]?(console.warn("(Resource.Manager.add) There is already a resource("+meta.enumToString(Resource.Type,t.type)+") added with a name: "+t.name),null):(e[t.name]=t,this.onAdded.emit(t,Resource.Event.ADDED),t)}},remove:function(t){var e=this.data[t.type];return e[t.name]?(delete e[t.name],t.emit(this,Resource.Event.REMOVED),void this.onRemoved.emit(t,Resource.Event.REMOVED)):void console.warn("(Resource.Manager.remove) Resource("+meta.enumToString(Resource.Type,t.type)+")("+t.name+") is not added to the manager.")},createTexture:function(t){var e;return t?(e=this.textures[t],e||(e=new Resource.Texture,e.name=t)):e=new Resource.Texture,e._loaded=!1,this.add(e),e},createAnim:function(t,e,i){var s=meta.resources.textures;if(s[t])return console.warn("(meta.createAnim) There is already texture with a name - "+t),null;var n=new Resource.Texture;return n.name=t,n.createAnim(e),n.fps=i||9,meta.resources.add(n),n},createAnimEx:function(t,e,i,s){var n=meta.resources.textures;if(n[t])return console.warn("(meta.createAnimEx) There is already texture with a name - "+t),null;var h=new Resource.Texture;return h.name=t,h.createAnimEx(e,i),h.fps=s||9,meta.resources.add(h),h},_updateLoading:function(){if(this.numToLoad--,this.onLoadingUpdate.emit(this,Resource.Event.LOADING_UPDATE),0===this.numToLoad){var t;for(var e in this.textures)t=this.textures[e],t._loaded||(console.log("(Resource.Manager.loadSuccess) Texture requested but not loaded: "+t.name),this.remove(t));this.numTotalToLoad=0,this.loading=!1,this.onLoadingEnd.emit(this,Resource.Event.LOADING_END)}},loadFile:function(t,e){this.loading||(this.loading=!0,this.onLoadingStart.emit(this,Resource.Event.LOADING_START)),this.numToLoad++,this.numTotalToLoad++;var i=this;meta.ajax({url:t,success:function(t){e&&e(t),i._updateLoading()},error:function(){i._updateLoading()}})},addToLoad:function(t){this.loading||this.silentLoad||(this.loading=!0,this.onLoadingStart.emit(this,Resource.Event.LOADING_START)),this.add(t),t.loading=!0,t.currStep=0,this.numToLoad+=t.steps,this.numTotalToLoad+=t.steps},loadSuccess:function(t){t.currStep++,this.numLoaded++,t.loading=!1,this.onLoaded.emit(t,Resource.Event.LOADED),this._updateLoading()},loadFailed:function(t){this.numLoaded+=t.steps-t.currStep,this._updateLoading(),t.loading=!1},nextStep:function(t){t.currStep<t.steps&&(t.currStep++,this.numLoaded++,this._updateLoading())},addToQueue:function(t){this._syncQueue||(this._syncQueue=[]),
this._syncQueue.push(t)},loadNextFromQueue:function(){this.isSyncLoading=!1,this._syncQueue&&this._syncQueue.length&&(this._syncQueue[this._syncQueue.length-1].forceLoad(!0),this._syncQueue.pop())},onAdapt:function(t,e){var i,s=meta.unitRatio;for(var n in textures)i=this.textures[n],i.unitRatio=s,i.load()},preloadResource:function(t,e,i,n){if(i){var h=i.lastIndexOf("/");h!==i.length-1&&(i+="/")}else i="";if(e instanceof Array)for(var o=e.length,a=0;a<o;a++)this._addResource(t,e[a],i,n);else{if("object"!==("undefined"==typeof e?"undefined":s(e))&&"string"!=typeof e)return!1;this._addResource(t,e,i,n)}return!0},_addResource:function(t,e,i,n){var h;return"object"===("undefined"==typeof e?"undefined":s(e))?(e.path&&(e.path=i+e.path),h=new t(e,n)):h=new t(i+e,n),h},loadTexture:function(t,e,i){this.preloadResource(Resource.Texture,t,e,i)},loadSpriteSheet:function(t,e,i){this.preloadResource(Resource.SpriteSheet,t,e,i)},loadFont:function(t,e,i){this.preloadResource(Resource.Font,t,e,i)},loadSound:function(t,e,i){this.preloadResource(Resource.Sound,t,e,i)},getUniqueID:function(){return++this._uniqueID},data:null,textures:null,spriteSheets:null,fonts:null,sounds:null,rootPath:"",numLoaded:0,numToLoad:0,numTotalToLoad:0,_syncQueue:null,isSyncLoading:!1,_uniqueID:0,loading:!1,onAdded:null,onRemoved:null,onLoaded:null,onLoadingStart:null,onLoadingEnd:null,onLoadingUpdate:null})},function(t,e,i){"use strict";meta.class("Resource.SVG","Resource.Texture",{fillRect:function(t,e,i,s){0===(this.flags&this.TextureFlag.RESIZED)&&this.resizeSilently(i+t,s+e),this.ctx.fillStyle=this._fillStyle,this.ctx.fillRect(t,e,i,s),this.loaded=!0},line:function(t,e,i,s){if(0===(this.flags&this.TextureFlag.RESIZED)){var n,h,o,a;t<i?(n=t,h=i):(n=i,h=t),e<s?(o=e,a=s):(o=s,a=e),this.resizeSilently(h,a)}this.ctx.strokeStyle=this._strokeStyle,this.ctx.lineWidth=this._lineWidth,this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(i,s),this.ctx.stroke(),this.loaded=!0},rect:function(t,e,i,s){var n;n=this._lineWidth%2===1?.5:0,0===(this.flags&this.TextureFlag.RESIZED)&&(n?this.resizeSilently(i+t+1,s+e+1):this.resizeSilently(i+t,s+e)),this.ctx.save(),this.ctx.translate(n,n),this.ctx.beginPath(),this.ctx.rect(t,e,i,s),this._fillStyle&&(this.ctx.fillStyle=this._fillStyle,this.ctx.fill()),!this._strokeStyle&&this._fillStyle||(this.ctx.lineWidth=this._lineWidth,this.ctx.strokeStyle=this._strokeStyle,this.ctx.stroke()),this.ctx.restore(),this.loaded=!0},circle:function(t){var e=this._lineWidth,i=2*(t+e);0===(this.flags&this.TextureFlag.RESIZED)&&this.resizeSilently(i,i),this.ctx.beginPath(),this.ctx.arc(t+e,t+e,t,0,2*Math.PI,!1),this.ctx.closePath(),this._fillStyle&&(this.ctx.fillStyle=this._fillStyle,this.ctx.fill()),!this._strokeStyle&&this._fillStyle||(this.ctx.lineWidth=this._lineWidth,this.ctx.strokeStyle=this._strokeStyle,this.ctx.stroke()),this.loaded=!0},tileAuto:function(t,e,i,s){if("string"==typeof t){var n=meta.resources.textures[t];if(!n)return void console.warn("(Resource.Texture.tileAuto): Could not get texture with name: "+t);t=n}else if(!t)return void console.warn("(Resource.Texture.tileAuto): Invalid texture");if(!t._loaded){this.loaded=!1;var h=this;return void t.subscribe(function(n,o){h.tileAuto(t,e,i,s)},this)}i=i||0,s=s||0;var o=Math.ceil(this.fullWidth/t.fullWidth)||1,a=Math.ceil(this.fullHeight/t.fullHeight)||1,r=o*(t.fullWidth+i)+i,l=a*(t.fullHeight+s)+s,u=i,c=s;e&&(u=.5*-(r-this.fullWidth),c=.5*-(l-this.fullHeight));for(var d=u,f=c,m=0;m<o;m++){for(var p=0;p<a;p++)this.ctx.drawImage(t.canvas,d,f),f+=t.frameHeight+s;d+=t.frameWidth+i,f=c}this.loaded=!0},tile:function(t,e,i,s,n){if("string"==typeof t){var h=meta.resources.textures[t];if(!h)return void console.warn("(Resource.Texture.tile): Could not get texture with name: "+t);t=h}else if(!t)return void console.warn("(Resource.Texture.tile): Invalid texture");if(!t._loaded){this.loaded=!1;var o=this;return void t.subscribe(function(t,h){o.tile(t,e,i,s,n)},this)}var a=e*(t.fullWidth+s)+s,r=i*(t.fullHeight+n)+n;this.resizeSilently(a,r);for(var l=s,u=n,c=l,d=u,f=0;f<e;f++){for(var m=0;m<i;m++)this.ctx.drawImage(t.canvas,c,d),d+=t.frameHeight+n;c+=t.frameWidth+s,d=u}this.loaded=!0},shape:function(t){var e,i,s,n=(meta,1),h=Number.POSITIVE_INFINITY,o=h,a=Number.NEGATIVE_INFINITY,r=a,l=t.length;for(e=0;e<l;e+=2)i=t[e]*n|0,s=t[e+1]*n|0,i<h&&(h=i),s<o&&(o=s),i>a&&(a=i),s>r&&(r=s),t[e]=i,t[e+1]=s;h>0&&(h=0),o>0&&(o=0);var u=this.ctx,c=this._lineWidth/2,d=-h+c,f=-o+c;for(0===(this.flags&this.TextureFlag.RESIZED)&&this.resizeSilently(a-h+this._lineWidth,r-o+this._lineWidth),u.lineWidth=this._lineWidth,this._lineCap&&(u.lineCap=this._lineCap),this._lineDash&&u.setLineDash(this._lineDash),u.translate(.5,.5),u.beginPath(),u.moveTo(t[0]+d,t[1]+f),e=2;e<l;e+=2)u.lineTo(t[e]+d,t[e+1]+f);this.closePath&&u.closePath(),this._fillStyle&&(this.ctx.fillStyle=this._fillStyle,this.ctx.fill()),!this._strokeStyle&&this._fillStyle||(this.ctx.lineWidth=this._lineWidth,this.ctx.strokeStyle=this._strokeStyle,this.ctx.stroke()),this.loaded=!0},arc:function(t,e,i,s){if(0===(this.flags&this.TextureFlag.RESIZED)){var n=2*(t+this._lineWidth);this.resizeSilently(n,n)}this.ctx.beginPath(),this.ctx.arc(t+this._lineWidth,t+this._lineWidth,t,e,i,!1),this.closePath&&this.ctx.closePath(),this._fillStyle&&(this.ctx.fillStyle=this._fillStyle,this.ctx.fill()),!this._strokeStyle&&this._fillStyle||(this.ctx.lineWidth=this._lineWidth,this.ctx.strokeStyle=this._strokeStyle,this.ctx.stroke()),this.loaded=!0},roundRect:function(t,e,i){var s;s=this._lineWidth%2===1?.5:0,0===(this.flags&this.TextureFlag.RESIZED)&&(s?this.resizeSilently(t+1,e+1):this.resizeSilently(t,e));var n=Math.ceil(this._lineWidth/2);this.ctx.save(),this.ctx.translate(s,s),this.ctx.beginPath(),this.ctx.moveTo(n+i,n),this.ctx.lineTo(t-n-i,n),this.ctx.quadraticCurveTo(t-n,n,t-n,n+i),this.ctx.lineTo(t-n,e-n-i),this.ctx.quadraticCurveTo(t-n,e-n,t-n-i,e-n),this.ctx.lineTo(n+i,e-n),this.ctx.quadraticCurveTo(n,e-n,n,e-n-i),this.ctx.lineTo(n,i+n),this.ctx.quadraticCurveTo(n,n,n+i,n),this.ctx.closePath(),this._fillStyle&&(this.ctx.fillStyle=this._fillStyle,this.ctx.fill()),!this._strokeStyle&&this._fillStyle||(this.ctx.lineWidth=this._lineWidth,this.ctx.strokeStyle=this._strokeStyle,this.ctx.stroke()),this.ctx.restore(),this.loaded=!0},gradient:function t(e){for(var t=this.ctx.createLinearGradient(0,0,0,this.fullHeight),i=e.length,s=0;s<i;s+=2)t.addColorStop(e[s],e[s+1]);this.ctx.clearRect(0,0,this.fullWidth,this.fullHeight),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.fullWidth,this.fullHeight),this.loaded=!0},grid:function(t,e,i,s){var n=t*i,h=e*s;0===(this.flags&this.TextureFlag.RESIZED)&&this.resizeSilently(n+this.lineWidth,h+this.lineWidth),this.ctx.strokeStyle=this.strokeStyle,this.ctx.lineWidth=this.lineWidth;var o=.5*this.lineWidth;this.ctx.save(),this.ctx.translate(o,o);for(var a=0,r=0;r<=t;r++)this.ctx.moveTo(a,0),this.ctx.lineTo(a,h),a+=i;a=0;for(var l=0;l<=e;l++)this.ctx.moveTo(-o,a),this.ctx.lineTo(n+o,a),a+=s;this.ctx.stroke(),this.ctx.restore(),this.loaded=!0},set lineWidth(t){this._lineWidth=t},get lineWidth(){return this._lineWidth},set fillStyle(t){this._fillStyle=t},get fillStyle(){return this._fillStyle},set strokeStyle(t){this._strokeStyle=t},get strokeStyle(){return this._strokeStyle},Cache:function(t,e){this.name=t,this.data=e},_lineWidth:2,_lineCap:"",_lineDash:"",_fillStyle:"",_strokeStyle:"",closePath:!1})},function(t,e,i){"use strict";meta.class("Resource.Sound","Resource.Basic",{onInit:function(t,e){this._instances=[],this._prepare(),"string"==typeof t&&this.load(t)},_prepare:null,_prepare_Audio:function(){var t=this;this._context=this._getInstance(),this._context.audio.addEventListener("error",function(){t.format?t._onLoadFailed():t._loadNextExtension()}),this._numInstancesUsed=0},_prepare_WebAudio:function(){var t=this;this._request=new XMLHttpRequest,this._request.responseType="arraybuffer",this._request.onreadystatechange=function(){t._onStateChange()},this._gainNode=meta.audio.context.createGain(),this._gainNode.connect(meta.audio.gainNode)},load:function(t){if(!this.loading){var e=t.lastIndexOf(".");e!==-1&&t.length-e<=5?(this.format=t.substr(e+1,t.length-e-1),this.path=meta.resources.rootPath+t.substr(0,e)):this.path=meta.resources.rootPath+t,this.loading=!0,this.loaded=!1,meta.resources.addToLoad(this),this._loadNextExtension()}},_loadNextExtension:function(){var t,e=meta.device.audioFormats,i=e.length;if(this.format){for(var s=!1,n=0;n<i;n++)if(this.format===e[n]){s=!0;break}if(!s)return console.log("(Resource.Sound) Trying to load unsupported sound format: "+this.format),void this._onLoadFailed();t=this.path+"."+this.format}else{if(this._requestFormat++,this._requestFormat>i)return void this._onLoadFailed();t=this.path+"."+meta.device.audioFormats[this._requestFormat-1]}this._loadFromPath(t)},_loadFromPath:null,_loadFromPath_WebAudio:function(t){this._request.open("GET",t,!0),this._request.send()},_loadFromPath_Audio:function(t){this._context.audio.src=t,this._context.audio.load()},_onStateChange:function(){if(4===this._request.readyState)if(200===this._request.status){meta.resources.nextStep(this);var t=this;this._context.decodeAudioData(this._request.response,function(e){t._onDecodeSuccess(e)},function(e){t._onDecodeError(e)}),this._request=null}else this.format?this._onLoadFailed():this._loadNextExtension()},_onDecodeSuccess:function(t){this.format||(this.path+="."+meta.device.audioFormats[this._requestFormat-1]),this._buffer=t,this._loading=!1,this.loaded=!0,meta.resources.loadSuccess(this);for(var e,i=this._instances.length,s=0;s<i;s++)e=this._instances[s],e.autoPlay&&e.play()},_onDecodeError:function(t){console.log(t),this.format||(this.path+="."+meta.device.audioFormats[this._requestFormat-1]),console.warn("(Resource.Sound.load) Error decoding file: "+this.path),this._loading=!1,meta.resources.loadFailed(this)},_onLoadFailed:function(){if(!this.format){var t=meta.device.audioFormats[this._requestFormat-1];t&&(this.path+="."+t)}console.warn("(Resource.Sound.load) Error loading file: "+this.path),this._loading=!1,meta.resources.loadFailed(this)},onEnd:null,play:function(t,e){meta.audio.audioAPI&&(this._gainNode.gain.value=this._volume);var i=this._getInstance();i.play(t,e)},stop:function(){meta.audio.audioAPI&&(this._gainNode.gain.value=0);for(var t=0;t<this._numInstancesUsed;t++)this._instances[t].stop()},pause:function(){meta.audio.audioAPI&&(this._gainNode.gain.value=0);for(var t=0;t<this._numInstancesUsed;t++)this._instances[t].pause()},resume:function(){meta.audio.audioAPI&&(this._gainNode.gain.value=this._volume);for(var t=0;t<this._numInstancesUsed;t++)this._instances[t].resume()},_createInstance:null,_createInstance_WebAudio:function(){return new Resource.AudioInstance(this)},_createInstance_Audio:function(){return new Resource.AudioInstance_Audio(this)},_getInstance:function(){this._instances.length===this._numInstancesUsed&&this._instances.push(this._createInstance());var t=this._instances[this._numInstancesUsed];return t.id=this._numInstancesUsed,this._numInstancesUsed++,t},_clearInstance:function(t){this._numInstancesUsed--;var e=this._instances[this._numInstancesUsed];e.id=t.id,this._instances[t.id]=e,this._instances[this._numInstancesUsed]=t},set volume(t){if(this._volume!==t)if(this._volume=t,meta.audio.audioAPI)this._gainNode.gain.value=t;else for(var e=this._instances.length,i=0;i<e;i++)this._instances[i].volume=t},get volume(){return this._volume},get playing(){var t=this._instances[0];return!!t&&t.playing},get paused(){var t=this._instances[0];return!!t&&t.paused},get looping(){var t=this._instances[0];return!!t&&t.looping},get duration(){if(meta.audio.audioAPI){if(this._buffer)return this._buffer.duration;var t=this._instances[0];return t?t.audio.duration:0}return 0},set currentTime(t){var e=this._instances[0];e&&(e.currentTime=t)},get currentTime(){var t=this._instances[0];return t?t.currentTime:0},type:Resource.Type.SOUND,format:"",_instances:null,_numInstancesUsed:0,_context:null,_buffer:null,_request:null,_requestFormat:0,_gainNode:null,_volume:1}),Resource.AudioInstance=function(t){this.parent=t,this.id=-1,this.source=null,this.looping=!1,this.paused=!1,this.playing=!1,this.offset=0,this.tStart=0,this.tPaused=0;var e=this;this.onEndFunc=function(){e.parent.onEnd&&e.parent.onEnd(e.parent),e.paused||(e.looping?(e.source.disconnect(),e.play(!0,0)):e.parent._clearInstance(e))}},Resource.AudioInstance.prototype={play:function(t,e){t=t||!1,e=e||0,this.paused=!1,this.parent._loaded?(this.playing=!0,this.autoPlay?this.autoPlay=!1:(this.looping=t,this.offset=e),this.source=meta.audio.context.createBufferSource(),this.source.buffer=this.parent._buffer,this.source.connect(this.parent._gainNode),this.source.onended=this.onEndFunc,this.offset<0?this.offset=0:this.offset>this.source.buffer.duration&&(this.offset=this.source.buffer.duration),this.source.start(0,this.offset),this.tStart=this.source.context.currentTime-this.offset):(this.autoPlay=!0,this.looping=t,this.offset=e)},stop:function(){this.source&&(this.paused=!1,this.looping=!1,this.source.stop(this.source.context.currentTime+.2))},pause:function(){this.paused||(this.paused=!0,this.playing?this.tPaused=this.source.context.currentTime-this.tStart:this.tPaused=0,this.source&&(this.source.disconnect(this.parent._gainNode),this.source.stop(0)))},resume:function(){this.play(this.looping,this.tPaused)},set currentTime(t){this.stop(),this.play(this.looping,t)},get currentTime(){return this.playing?this.source.context.currentTime-this.tStart:0},autoPlay:!1},Resource.AudioInstance_Audio=function(t){this.parent=t,this.id=-1,this.looping=!1,this.paused=!1,this.playing=!1,this.offset=0,this.audio=new Audio,this.audio.preload="auto",this._canPlay=!1,this._metaLoaded=!1,this._loaded=!1;var e=this;this._canPlayFunc=function(){e.audio.removeEventListener("canplaythrough",e._canPlayFunc),e._canPlay=!0,meta.device.support.onloadedmetadata&&e._metaLoaded&&e._onLoaded()},this._metaFunc=function(){e.audio.removeEventListener("loadedmetadata",e._metaFunc),e._metaLoaded=!0,e.canPlay&&e._onLoaded()},this._onEndedFunc=function(){e._onEnd()},this._addEvents(t)},Resource.AudioInstance_Audio.prototype={play:function(t,e){t=t||!1,e=e||0,this.paused=!1,this._loaded?(this.playing=!0,this.autoPlay?this.autoPlay=!1:(this.looping=t,this.offset=e),this.audio.currentTime=this.offset,this.audio.play()):(this.autoPlay=!0,this.looping=t,this.offset=e)},stop:function(){this.playing=!1,this.audio.pause(),this.parent._clearInstance(this)},pause:function(){this.playing=!1,this.audio.pause()},resume:function(){this.playing=!0,this.audio.play()},_addEvents:function(){this.audio.addEventListener("canplaythrough",this._canPlayFunc,!1),meta.device.support.onloadedmetadata&&this.audio.addEventListener("loadedmetadata",this._metaFunc,!1),this.audio.addEventListener("ended",this._onEndedFunc,!1),this.parent._loaded&&(this.audio.src=this.parent.fullPath,this.audio.load())},_onLoaded:function(){if(!this.parent._loaded){this.parent.format||(this.parent.path+="."+meta.device.audioFormats[this.parent._requestFormat-1]),this.parent._loading=!1,this.parent.loaded=!0,this.parent.fullPath=this.parent.path+"."+this.parent.format;for(var t,e=this.parent._instances,i=this.parent._instances.length,s=1;s<i;s++)t=e[s],t.audio.src=this.parent.fullPath,t.audio.load();meta.resources.loadSuccess(parent),meta.resources.loadNextFromQueue()}this._loaded=!0,this.autoPlay&&this.play(!1,0)},_onEnd:function(){this.looping?(this.audio.play(),this.audio.currentTime=0):this.playing&&(this.playing=!1,this.parent._clearInstance(this))},set currentTime(t){this.playing?this.audio.currentTime=t||0:(this.audio.play(),this.audio.currentTime=t||0,this.audio.pause())},get currentTime(){return this.audio.currentTime},set volume(t){var e=t*meta.audio._volume;this.audio.volume=e},autoPlay:!1}},function(t,e,i){"use strict";meta.class("Resource.SpriteSheet","Resource.Basic",{onInit:function(t,e){if("string"==typeof t)e=t,t=void 0;else for(var i in t)this[i]=t[i];if(e){var s=e.lastIndexOf(".");s!==-1&&e.length-s<=5&&(this.format=e.substr(s+1,e.length-s-1),e=e.substr(0,s)),this.path=meta.resources.rootPath+e,this.format||(this.format="xml"),this.load(this.path)}},load:function(){if(!this.loading){this.loading=!0,this.loaded=!1,this._atlasLoaded=!1,this.texture?"string"==typeof this.texture&&(this.texture=new Resource.Texture(this.texture)):this.texture=new Resource.Texture(this.path),this.texture.subscribe(this._onTextureEvent,this);var t=this,e=this.path+"."+this.format;this._request=new XMLHttpRequest,this._request.open("GET",e,!0),this._request.onreadystatechange=function(){t._onStateChange()},this._request.send(),meta.resources.addToLoad(this)}},loadData:function(t,e){e=e||this.format,e||(e="xml"),this.format=e;var i=!1;if("xml"===e){var s=new DOMParser,n=s.parseFromString(t,"text/xml");i=this.loadXML(n)}else if("json"===e){var h=JSON.parse(t);i=this.loadJSON(h)}else if("plist"===e){var s=new DOMParser,o=s.parseFromString(t,"text/xml");i=this.loadPlist(o)}else console.warn("(Resource.SpriteSheet.loadData):","Trying to load an unsupported format - "+this.format);return this.loaded=i,i},_createTexture:function(t,e,i,s,n){var h=meta.resources.createTexture(t);return h.ptr=this.texture,h.canvas=this.texture.canvas,h.x=e,h.y=i,h.width=s,h.height=n,h.loaded=!0,h},loadFromImg:function(t,e,i,s,n){var h=this;this.texture=new Resource.Texture(t),this.texture.subscribe(function(){h._generateFromImg(e,i,s,n)})},_generateFromImg:function(t,e,i,s){var n=t+2*s,h=t+2*s,o=this.texture.trueFullWidth/n,a=this.texture.trueFullHeight/h,r=Math.floor(o),l=Math.floor(a),u=r*l;this.frames=new Array(u);var c,d,f=i,m=0;if(o!==r||a!==l)for(var p,v,g,_,y=this.texture.trueFullWidth,x=this.texture.trueFullHeight,b=0;b<l;b++){p=0,v+=e,_=v>x?x-v:0;for(var w=0;w<r;w++)p+=t,g=p>y?y-p:0,c=w*t+w*(2*i)+f,d=b*e+b*(2*i)+f,this.frames[m]=this._createTexture(this.texture.name+"$$"+m,c,d,t+g,e+_),m++}else for(var b=0;b<l;b++)for(var w=0;w<r;w++)c=w*t+w*(2*i)+f,d=b*e+b*(2*i)+f,this.frames[m]=this._createTexture(this.texture.name+"$$"+m,c,d,t,e),m++;this.loaded=!0},loadXML:function(t){if(!t)return console.warn("(Resource.SpriteSheet.loadXML) Invalid XML file."),!1;for(var e,i=t.documentElement.childNodes,s=i.length,n=0;n<s;n++)if(e=i[n],"SubTexture"===e.nodeName)this._createTexture(e.getAttribute("name"),parseInt(e.getAttribute("x")),parseInt(e.getAttribute("y")),parseInt(e.getAttribute("width")),parseInt(e.getAttribute("height")));else if("sprite"===e.nodeName)this._createTexture(e.getAttribute("n"),parseInt(e.getAttribute("x")),parseInt(e.getAttribute("y")),parseInt(e.getAttribute("w")),parseInt(e.getAttribute("h")));else if("dict"===e.nodeName)return this.loadPlist(t);return!0},loadPlist:function(t){if(!t)return console.warn("(Resource.SpriteSheet.loadPlist) Invalid Plist file"),!1;for(var e,i=t.documentElement.childNodes,s=i.length,n=0;n<s;n++)if(e=i[n],"dict"===e.nodeName)return this._loadPlist_dict(e)},_loadPlist_dict:function(t){for(var e=t.childNodes,i=e.length,s="",n=0;n<i;n++)if(t=e[n],"key"===t.nodeName)s=t.textContent;else if("dict"===t.nodeName){if(!s)continue;"frames"===s&&this._loadPlist_frames(t)}},_loadPlist_frames:function(t){for(var e=t.childNodes,i=e.length,s="",n=0;n<i;n++)t=e[n],"key"===t.nodeName?s=t.textContent:"dict"===t.nodeName&&this._loadPlist_frame(t,s)},_loadPlist_frame:function(t,e){for(var i,s=t.childNodes,n=s.length,h="",o=0;o<n;o++)if(t=s[o],"key"===t.nodeName)h=t.textContent;else if("string"===t.nodeName&&"frame"===h)return i=t.textContent.match(/[0-9]+/g),void this._createTexture(e,parseInt(i[0]),parseInt(i[1]),parseInt(i[2]),parseInt(i[3]))},loadJSON:function(t){return t?(t.frames instanceof Array?this._loadJSON_array(t):this._loadJSON_hash(t),!0):(console.warn("(Resource.SpriteSheet.loadFromJSON) Invalid JSON file."),!1)},_loadJSON_array:function(t){for(var e,i,s=t.frames,n=s.length,h=0;h<n;h++)e=s[h],i=e.frame,this._createTexture(e.filename,i.x,i.y,i.w,i.h)},_loadJSON_hash:function(t){var e,i=t.frames;for(var s in i)e=i[s].frame,this._createTexture(s,e.x,e.y,e.w,e.h)},_onTextureEvent:function(t,e){e===Resource.Event.LOADED&&(this.texture.unsubscribe(this),this._atlasLoaded&&(this.loadData(this._response,this.format),meta.resources.loadSuccess(this),this._response=null))},_onStateChange:function(){4===this._request.readyState&&(200===this._request.status?(this._atlasLoaded=!0,this._response=this._request.response,this._request=null,this.texture._loaded&&(this.loadData(this._response,this.format),meta.resources.loadSuccess(this),this._response=null)):(this._loaded=!1,this._request.onreadystatechange=null,this._request=null,meta.resources.loadFailed(this)))},type:Resource.Type.SPRITE_SHEET,format:"",texture:null,frames:null,_request:null,_response:null,_atlasLoaded:!1})},function(t,e,i){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};meta.class("Resource.Texture","Resource.Basic",{onInit:function(t,e){if(this.generate(),t instanceof File)this.loadFile(t);else{var i="undefined"==typeof t?"undefined":s(t);if("string"===i)this.load(t);else if("object"===i){for(var n in t)this[n]=t[n];t.frames?this.animated=!0:(this.framesX>1||this.framesY>1)&&(this.frames=this.framesX*this.framesY,this.animated=!0),this.path&&this.load(this.path)}}},remove:function(){meta.resources.remove(this)},generate:function(){this.loaded=!0,this.canvas=document.createElement("canvas"),this.canvas.width=this.trueFullWidth,this.canvas.height=this.trueFullHeight,this.ctx=this.canvas.getContext("2d")},load:function(t){if(!this.loading&&(this.loaded=!1,t)){this.path=t;var e=this.path.lastIndexOf(".");(e===-1||this.path.length-e>4)&&(this.path+=".png"),meta.cache.currResolution?this.fullPath=meta.resources.rootPath+meta.cache.currResolution.path+this.path:this.fullPath=meta.resources.rootPath+this.path;var i=this,s=new Image;s.onload=function(){return s.complete?(i.createFromImg(s),void meta.resources.loadSuccess(i)):(console.warn("(Resource.Texture.load) Could not load texture from - "+s.src),void meta.resources.loadFailed(i))},s.onerror=function(t){meta.resources.loadFailed(i),i.emit(this,Resource.Event.FAILED)},s.src=this.fullPath,meta.resources.addToLoad(this)}},loadFile:function(t){if(!this.loading){this.loaded=!1,this.path=window.URL.createObjectURL(t),this.fullPath=this.path;var e=this,i=new Image;i.onload=function(){return i.complete?(e.createFromImg(i),meta.resources.loadSuccess(e),window.URL.revokeObjectURL(e.path),void console.log(e.name)):(console.warn("(Resource.Texture.load) Could not load texture from - "+i.src),void meta.resources.loadFailed(e))},i.onerror=function(t){meta.resources.loadFailed(e),e.emit(this,Resource.Event.FAILED)},i.src=this.fullPath,meta.resources.addToLoad(this)}},createFromImg:function(t){this._loaded&&this.clear(),this.resizeSilently(t.width,t.height),this.ctx.drawImage(t,0,0),this.unitRatio=meta.unitRatio,this._reloading=!1,this.loaded=!0},calcFrame:function(){this.animated?this.frames>1&&1===this.framesX&&1===this.framesY?(this.framesX=this.trueFullWidth/this.frameWidth,this.framesY=this.trueFullHeight/this.frameHeight):(this.frameWidth=this.trueFullWidth/this.framesX,this.frameHeight=this.trueFullHeight/this.framesY):(this.frameWidth=this.trueFullWidth,this.frameHeight=this.trueFullHeight)},_createCachedImg:function(){this._cachedImg||(this._cachedImg=document.createElement("canvas"),this._cachedImg.width=this.trueFullWidth,this._cachedImg.height=this.trueFullHeight,this._cachedCtx=this._cachedImg.getContext("2d"))},convertToAnim:function(t,e,i,s){this.frameWidth=t,this.frameHeight=e,this.frames=i,this.fps=s||9,this.animated=!0,this._loaded&&this.calcFrame()},createAnim:function(t){this._numToLoad=0;var e,i,s,n,h=meta.resources.textures,o=t.length;this.frameData=new Array(o),this.frames=o;for(var a=0;a<o;a++)i=t[a],n=i.lastIndexOf("."),n!==-1?(s=i.substr(s+1),i=i.substr(0,n)):s="",e=h[i],e||(e=meta.resources.createTexture(i)),e._loaded||(e.subscribe(this._handleTextureFrameEvent,this),this._numToLoad++),this.frameData[a]=new this.Frame(e,0,0);0===this._numToLoad&&this._prepareFromFrameData()},createAnimEx:function(t,e){this._numToLoad=0;var i,s,n,h,o=meta.resources.textures,a=t.length;this.frameData=new Array(a),this.frames=a;for(var r=0;r<a;r++)s=t[r],h=s.lastIndexOf("."),h!==-1?(n=s.substr(n+1),s=s.substr(0,h)):n="",i=o[s],i||(i=new Resource.Texture(e+s+n)),i._loaded||(this._numToLoad++,i.subscribe(this._handleTextureFrameEvent,this)),this.frameData[r]=new this.Frame(i,0,0);0===this._numToLoad&&this._prepareFromFrameData()},_prepareFromFrameData:function(){var t=this.frameData[0].texture;this.width=t.width,this.height=t.height,this.loaded=!0},_handleTextureFrameEvent:function(t,e){e===Resource.Event.LOADED&&(this._numToLoad--,t.unsubscribe(this)),0===this._numToLoad&&this._prepareFromFrameData()},resize:function(t,e){this.trueFullWidth===t&&this.trueFullHeight===e||(this.resizeSilently(t,e),this.loaded=!0)},resizeSilently:function(t,e){if(this.trueFullWidth!==t||this.trueFullHeight!==e){this.flags|=this.TextureFlag.RESIZED,this.trueFullWidth=t,this.trueFullHeight=e,this.calcFrame();var i=meta.engine.unitRatio;this.width=this.frameWidth*i+.5|0,this.height=this.frameHeight*i+.5|0,this.fullWidth=this.trueFullWidth*i+.5|0,this.fullHeight=this.trueFullHeight*i+.5|0,this.halfWidth=.5*this.width,this.halfHeight=.5*this.height,this._loaded&&this.canvas.width>1&&this.canvas.height>1?(this._tmpImg.width=this.canvas.width,this._tmpImg.height=this.canvas.height,this._tmpCtx.drawImage(this.canvas,0,0),this.canvas.width=this.trueFullWidth,this.canvas.height=this.trueFullHeight,this.ctx.drawImage(this._tmpImg,0,0)):(this.canvas.width=this.trueFullWidth,this.canvas.height=this.trueFullHeight)}},upResize:function(t,e){t<this.trueFullWidth&&(t=this.trueFullWidth),e<this.trueFullHeight&&(e=this.trueFullHeight),this.resize(t,e)},draw:function(t,e,i){this.ptr?t.drawImage(this.ptr.canvas,this.x,this.y,this.width,this.height,e,i,this.width,this.height):t.drawImage(this.canvas,e,i)},drawFrame:function(t,e,i,s){this.frameData?this.frameData[s].texture.draw(t,e,i):t.drawImage(this.canvas,this.frameWidth*(s%this.framesX),this.frameHeight*Math.floor(s/this.framesX),this.frameWidth,this.frameHeight,e,i,this.frameWidth,this.frameHeight)},clear:function(){this.ctx.clearRect(0,0,this.trueFullWidth,this.trueFullHeight)},drawOver:function(t,e,i){if(!t)return void console.warn("(Resource.Texture.drawOver) No texture specified.");if(e=e||0,i=i||0,"string"==typeof t){var s=meta.resources.textures[t];if(!s)return void console.warn("(Resource.Texture.drawOver) No such texture with name - "+t);t=s}if(t.textureType===Resource.TextureType.WEBGL){if(!t._canvasCache)return t._canvasCache=new Resource.Texture(Resource.TextureType.CANVAS,t.path),t._canvasCache.load(),t=t._canvasCache,this._loadCache={name:"drawOver",texture:t,x:e,y:i},this.loaded=!1,void t.subscribe(this.onTextureCacheEvent,this);t=t._canvasCache}var n=this.ctx;if(this.textureType&&(this._createCachedImg(),n=this._cachedCtx),n.drawImage(t.image,e,i),this.textureType){var h=meta.ctx;h.bindTexture(h.TEXTURE_2D,this.image),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,this._cachedImg)}this.loaded=!0},generateAlphaMask:function(){if(!this._loaded)return void console.warn("(Resource.Texture.generateMask): Texture is not loaded yet.");if(0!==this.textureType)return void console.warn("([)Resource.Texture.generateMask): Only canvas textures are supported currently.");var t=new Resource.Texture(Resource.TextureType.CANVAS);t.resize(this.trueFullWidth,this.trueFullHeight);for(var e=this.ctx.getImageData(0,0,this.trueFullWidth,this.trueFullHeight),i=e.data,s=i.length,n=0;n<s;n+=4)i[n]=255,i[n+1]=255,i[n+2]=255;return t.ctx.putImageData(e,0,0),t.loaded=!0,t},onTextureCacheEvent:function(t,e){e===Resource.Event.LOADED&&(t.unsubscribe(this),"drawOver"===this._loadCache.name?this.drawOver(this._loadCache.texture,this._loadCache.x,this._loadCache.y):this[this._loadCache.name](this._loadCache.data),this._loadCache=null)},offset:function(t,e){this.offsetX=t,this.offsetY=e,this._loaded&&this.emit(this,Resource.Event.CHANGED)},getData:function(){return this.ctx.getImageData(0,0,this.frameWidth,this.frameHeight).data},getPixelAt:function(t,e){return this.ctx.getImageData(t,e,1,1).data},applyCanvas:function(t){this.canvas=t,this.ctx=t.getContext("2d"),this.resize(t.width,t.height)},TextureFlag:{RESIZED:1},Frame:function(t,e,i){this.texture=t,this.x=e,this.y=i},type:Resource.Type.TEXTURE,ptr:null,canvas:null,ctx:null,flags:0,x:0,y:0,width:0,height:0,_width:0,_height:0,fullWidth:0,fullHeight:0,trueFullWidth:0,trueFullHeight:0,_widthRatio:0,_heightRatio:0,offsetX:0,offsetY:0,unitRatio:1,fps:9,frames:1,framesX:1,framesY:1,frameData:null,reloading:!1,_tmpImg:null,_tmpCtx:null,_cachedImg:null,_cachedCtx:null,_numToLoad:0,_loadCache:null,_canvasCache:null}),Resource.Texture.prototype._tmpImg=document.createElement("canvas"),Resource.Texture.prototype._tmpCtx=Resource.Texture.prototype._tmpImg.getContext("2d")},function(t,e,i){"use strict";Steering.Component=function(){this.vel=new meta.math.Vector2(0,0),this.accel=new meta.math.Vector2(0,0),this.target=new meta.math.Vector2(0,0),this.f=3,this.maxSpeed=4,this.maxForce=.1},Steering.Component.prototype={onActiveEnter:function(){meta.steering.add(this)},update:function(t){this.arrive(),this.vel.addVec(this.accel),this.vel.limit(this.maxSpeed),this.owner.move(this.vel.x,this.vel.y),this.owner.angleRad=this.vel.heading(),this.accel.mulValue(0)},seek:function(){var t=this.owner.volume,e=new meta.math.Vector2(this.target.x-t.x,this.target.y-t.y);e.normalize(),e.mulValue(this.maxSpeed);var i=new meta.math.Vector2(e.x-this.vel.x,e.y-this.vel.y);i.limit(this.maxForce),this.accel.addVec(i)},arrive:function(){var t=this.owner.volume,e=new meta.math.Vector2(this.target.x-t.x,this.target.y-t.y),i=e.length();if(e.normalize(),i<100){var n=s(i,0,100,0,this.maxSpeed);e.mulValue(n)}else e.mulValue(this.maxSpeed);var h=new meta.math.Vector2(e.x-this.vel.x,e.y-this.vel.y);h.limit(this.maxForce),this.accel.addVec(h)}};var s=function(t,e,i,s,n){return s+(n-s)*((t-e)/(i-e))}},function(t,e,i){"use strict";meta.class("Steering.Manager",{init:function(){this.agents=[],meta.engine.onUpdate.add(this.update,this)},update:function(t){for(var e=this.agents.length,i=0;i<e;i++)this.agents[i].update(t)},add:function(t){this.agents.push(t)},agents:null})},function(t,e,i){"use strict";meta.class("Entity.Circle","Entity.SVG",{init:function(){this.pivot(.5),this.volume.resize(2*this.radius,2*this._radius)},draw:function(t){t.globalAlpha=this._alpha,t.beginPath(),t.arc(this.volume.x,this.volume.y,this.radius,0,2*Math.PI,!1),this._fillStyle&&(t.fillStyle=this._fillStyle,t.fill()),!this._strokeStyle&&this._fillStyle||(t.lineWidth=this._lineWidth,t.strokeStyle=this._strokeStyle,t.stroke())},set radius(t){this._radius=t,this.volume.resize(2*t,2*t),this.updateTotalOffset()},get radius(){return this._radius},_radius:20})},function(t,e,i){"use strict";meta.class("Entity.Gradient","Entity.Geometry",{init:function(){this.clear()},draw:function(t){t.fillStyle=this._gradient,t.fillRect(0|this.volume.minX,0|this.volume.minY,0|this.volume.width,0|this.volume.height)},clear:function(){this._gradient=meta.engine.ctx.createLinearGradient(0,0,0,this.volume.height),this._points=[]},colorStops:function(t){for(var e=meta.engine.ctx.createLinearGradient(0,0,0,this.volume.height),i=t.length,s=0;s<i;s+=2)e.addColorStop(t[s],t[s+1]);this._gradient=e,this.renderer.needDraw=!0},_updateResize:function(){this._gradient=meta.engine.ctx.createLinearGradient(0,0,0,this.volume.height),this._super()},set gradient(t){t||(t=meta.engine.ctx.createLinearGradient(0,0,0,this.volume.height)),this._gradient=t,this.renderer.needDraw=!0},get gradient(){return this._gradient},Point:function(t,e){
this.point=t,this.hex=e},_gradient:null,_points:null})},function(t,e,i){"use strict";meta.class("Entity.Line","Entity.SVG",{draw:function(t){this.globalAlpha=this._alpha,t.lineWidth=this._lineWidth,t.strokeStyle=this._strokeStyle,t.beginPath(),t.moveTo(this.volume.x,this.volume.y),t.lineTo(this.toX,this.toY),t.stroke(),this.globalAlpha=1},to:function(t,e){this.toX===t&&this.toY===e||(this.toX=t,this.toY=e,this.renderer.needRender=!0)},toX:0,toY:0})},function(t,e,i){"use strict";meta.class("Entity.Rect","Entity.SVG",{draw:function(t){t.beginPath(),t.rect(this.volume.minX,this.volume.minY,this.volume.width,this.volume.height),this._fillStyle&&(t.fillStyle=this._fillStyle,t.fill()),!this._strokeStyle&&this._fillStyle||(t.lineWidth=this._lineWidth,t.strokeStyle=this._strokeStyle,t.stroke())}})},function(t,e,i){"use strict";meta.class("Entity.SVG","Entity.Geometry",{set lineWidth(t){this._lineWidth=t,this.renderer.needRender=!0},get lineWidth(){return this._lineWidth},set strokeStyle(t){this._strokeStyle=t,this.renderer.needRender=!0},get strokeStyle(){return this._strokeStyle},set fillStyle(t){this._fillStyle=t,this.renderer.needRender=!0},get fillStyle(){return this._fillStyle},_lineWidth:2,_strokeStyle:"",_fillStyle:""})},function(t,e,i){"use strict";meta.class("Component.TileBody","Component.Basic",{update:function(t){if(this.needMoving){var e=this.owner.volume,i=meta.math.length(e.x-this.owner.totalOffsetX,e.y-this.owner.totalOffsetY,this.targetX,this.targetY);if(i<=this.speed*t)this.owner.position(this.targetX,this.targetY),this.targets&&this.targets.length>0?this.moveToCells(this.targets):this.needMoving=!1,this.onMoveDone&&this.onMoveDone.call(this);else{this._tmpVec.x=this.targetX-e.x+this.owner.totalOffsetX,this._tmpVec.y=this.targetY-e.y+this.owner.totalOffsetY,this._tmpVec.normalize();var s=this.speed*t;this.owner.move(this._tmpVec.x*s,this._tmpVec.y*s)}}},moveToCell:function(t,e){var i=this.owner.parent.cellPos;i.cellX=t,i.cellY=e,this.owner.parent.getPosEx(i),this.targetX=i.x,this.targetY=i.y,this.needMoving=!0,this.updating=!0},moveToCells:function(t){if(0!==t.length){this.targets=t;var e=this.targets.pop();this.moveToCell(e.x,e.y)}},stopMoving:function(){this.needMoving=!1,this.updating=!1,this.target=null},onMoveDone:null,needMoving:!1,target:null,targets:null,targetCellX:0,targetY:0,speed:250,_tmpVec:new meta.math.Vector2(0,0)})},function(t,e,i){"use strict";meta.class("Entity.TileGeometry","Entity.Geometry",{updatePos:function(){this._super(),this.parent._calcEntityCell(this)},setCell:function(t,e){this.cellX=t,this.cellY=e,this.parent._calcEntityPos(this)},_setView:function(t,e){},cellX:0,cellY:0,_cellId:-1,_cellIndex:-1})},function(t,e,i){"use strict";meta.class("Entity.Tilemap","Entity.Geometry",{init:function(t,e,i,s){this._super(),t&&("string"==typeof t?this.load(t):this.create(t,e,i,s))},initArg:function(t){},load:function(t){if(!t)return void console.warn("(Entity.Tilemap.load): Invalid path specified");var e=t.lastIndexOf(".")+1,i=t.lastIndexOf("/"),s=t.substr(e);this.path=t,this.folderPath=t.substr(0,i+1),this.loaded=!1,this.tilesets=[];var n=this,h=this["_parse_"+s];return h?void meta.resources.loadFile(t,function(t){h.call(n,t)}):void console.warn("(Entity.Tilemap.load): Unsupported file format: "+s)},create:function(t,e,i,s,n){this.properties={},this.tilesX=t,this.tilesY=e,this.tileWidth=i,this.tileHeight=s,this.type=n?n:"orthogonal",this.resize(t*i,e*s),this.tilesets=[],this.detachAll()},createTileset:function(t,e,i,s,n,h,o){if(t<1)return void console.warn("(Entity.Tilemap.createTileset) gid argument should be 1 or larger number");var a=null,r=null;r=meta.resources.spriteSheets[e],r||(r=new Resource.SpriteSheet,r.name=e,r.loadFromImg(i,s,n,h||0,o||0),meta.resources.spriteSheets[e]=r),a=r.texture;var l=new meta.Tileset(t,a,r,s,n);return this.tilesets.push(l),r.loaded||r.subscribe(this.handleTilesetEvent,this)&&(this.loaded=!1,this.numToLoad++),0===this.numToLoad&&this.finishLoading(),l},createLayer:function(t,e,i,s){var n;switch(this.type){case this.Type.ORTHOGONAL:n=new Entity.TilemapOrthoLayer;break;case this.Type.ISOMETRIC:n=new Entity.TilemapIsoLayer;break;case this.Type.HEXAGONAL:n=new Entity.TilemapHexLayer;break;default:console.warn("(Entity.Tilemap.createLayer) Trying to create unsupported layer type")}return n.tilesX=void 0===e?this.tilesX:e,n.tilesY=void 0===i?this.tilesY:i,n.tileWidth=this.tileWidth,n.tileHeight=this.tileHeight,n.tileHalfWidth=.5*this.tileWidth,n.tileHalfHeight=.5*this.tileHeight,n.properties={},this.attach(n),n.data=t,s&&(n.name=s),n},finishLoading:function(){for(var t,e=0,i=this.tilesets.length,s=0;s<i;s++)t=this.tilesets[s];if(this.children)for(i=this.children.length,s=0;s<i;s++){var n=this.children[s];n instanceof Entity.TilemapLayer&&(n.tileOffset(0,e),n.updateFromData())}this.loaded=!0},_parse_json:function(t){var e=JSON.parse(t);this.create(e.width,e.height,e.tilewidth,e.tileheight),this.properties=e.properties||{};for(var i,s,n=e.tilesets,h=n.length,o=0;o<h;o++)s=n[o],i=this.createTileset(s.firstgid,s.name,this.folderPath+s.image,s.tilewidth,s.tileheight),i.properties=s.tileproperties||{};var a,r,l=e.layers;for(h=l.length,o=0;o<h;o++)r=l[o],a=this.createLayer(r.data,r.width,r.height,r.name),r.properties&&(a.properties=r.properties||{}),r.visible&&(a.visible=r.visible);0===this.numToLoad&&(this.loaded=!0)},_parse_tmx:function(t){var e=new DOMParser,i=e.parseFromString(t,"text/xml"),s=i.documentElement;this.create(parseInt(s.getAttribute("width")),parseInt(s.getAttribute("height")),parseInt(s.getAttribute("tilewidth")),parseInt(s.getAttribute("tileheight")),s.getAttribute("orientation"));for(var n=s.childNodes,h=n.length,o=0;o<h;o++)if(s=n[o],1===s.nodeType)switch(s.nodeName){case"tileset":this._parse_tmx_tileset(s);break;case"layer":this._parse_tmx_layer(s);break;case"properties":this.properties=this._parse_tmx_properties(s)}0===this.numToLoad&&(this.loaded=!0)},_parse_tmx_tileset:function(t){for(var e,i,s="",n={},h=t.childNodes,o=h.length,a=0;a<o;a++)if(i=h[a],1===i.nodeType)switch(i.nodeName){case"image":s=this.folderPath+i.getAttribute("source");break;case"tile":e=this._parse_tmx_tile(i),e&&(n[i.getAttribute("id")]=e)}var r=t.getAttribute("spacing"),l=r?parseInt(r):0,u=t.getAttribute("margin"),c=u?parseInt(u):0,d=this.createTileset(parseInt(t.getAttribute("firstgid")),t.getAttribute("name"),s,parseInt(t.getAttribute("tilewidth")),parseInt(t.getAttribute("tileheight")),c,l);d.properties=n},_parse_tmx_tile:function(t){for(var e,i=null,s=t.childNodes,n=s.length,h=0;h<n;h++)if(e=s[h],1===e.nodeType)switch(e.nodeName){case"properties":i=this._parse_tmx_properties(e)}return i},_parse_tmx_layer:function(t){var e=t.getAttribute("name"),i=parseInt(t.getAttribute("width")),s=parseInt(t.getAttribute("height")),n=!0,h=t.getAttribute("visible");h&&(n=parseInt(n));for(var o,a=null,r=t.childNodes,l=r.length,u=0;u<l;u++)if(t=r[u],1===t.nodeType)switch(t.nodeName){case"data":o=this._parse_tmx_data(t,i,s);break;case"properties":a=this._parse_tmx_properties(t)}var c=this.createLayer(o,i,s,e);a&&(c.properties=a),c.hidden=!n},_parse_tmx_data:function(t,e,i){var s,n=e*i,h=t.getAttribute("encoding");if(h){var o=null;if("csv"===h){if(o=t.textContent.split(","),o.length!==n)return void console.warn("(Entity.Tilemap._parse_tmx): Layer resolution does not match with data size");s=new Uint32Array(n);for(var a=0;a<n;a++)s[a]=parseInt(o[a])}else{if("base64"!==h)return void console.warn("(Entity.Tilemap._parse_tmx): Unsupported layer encoding used: "+h);var r=t.getAttribute("compression");if(r)return void console.warn("(Entity.Tilemap._parse_tmx): Unsupported compression - "+r);s=meta.decodeBinaryBase64(t.textContent)}}else{var l=0,u=t.childNodes;for(n=u.length,s=new Uint32Array(n),a=0;a<n;a++)t=u[a],1===t.nodeType&&(s[l++]=parseInt(t.getAttribute("gid")))}return s},_parse_tmx_properties:function(t){for(var e,i={},s=t.childNodes,n=s.length,h=0;h<n;h++)e=s[h],1===e.nodeType&&(i[e.getAttribute("name")]=e.getAttribute("value"));return i},getLayer:function(t){if(!t)return null;if(!this.children)return null;for(var e=this.children.length,i=0;i<e;i++)if(this.children[i].name===t)return this.children[i];return null},handleTilesetEvent:function(t,e){e===Resource.Event.LOADED&&(this.numToLoad--,0===this.numToLoad&&this.finishLoading())},Type:{UNKNOWN:"",ORTHOGONAL:"orthogonal",ISOMETRIC:"isometric",HEXAGONAL:"hexagonal"},LayerInfoFlag:{FLIP_HORIZONTALLY:2147483648,FLIP_VERTICALLY:1073741824,FLIP_DIAGONALLY:536870912},tilesets:null,properties:null,path:"",folderPath:"",numToLoad:0,tilesX:0,tilesY:0,tileWidth:0,tileHeight:0,type:"orthogonal"}),meta.Tileset=function(t,e,i,s,n){this.gid=t,this.texture=e,this.spriteSheet=i,this.properties=null,this.tileWidth=s,this.tileHeight=n},meta.Tileset.prototype={getCell:function(t){return this.spriteSheet?(t-=this.gid,this.spriteSheet.frames[t]):this.texture}}},function(t,e,i){"use strict";meta.class("Entity.TilemapHexLayer","Entity.TilemapLayer",{draw:function(t){if(0!==(this.parent.flags&this.Flag.LOADED)&&!(this.layerFlags&this.LayerFlag.CONVERTED_TO_ENTITIES)){var e,i=(meta.camera.volume,0),s=this.tilesX,n=0,h=this.tilesY,o=0,a=this.offsetY,r=0,l=0,u=0;if(i=0,n=0,s=this.tilesX,h=this.tilesY,this._dataFlags)for(var c=n;c<this.tilesY;c++){l=-(c*halfWidth)+(this.tilesX-1)*halfWidth+o,u=c*halfHeight-halfHeight+a;for(var d=i;d<s;d++)e=this._dataInfo[r++],e&&t.drawImage(e.canvas,e.posX,e.posY,e.width,e.height,l,u,e.width,e.height),l+=halfWidth,u+=halfHeight}else for(var f,l=0,u=0,m=0,c=n;c<this.tilesY;c++){for(var d=i;d<this.tilesX;d++)f=this._dataInfo[r++],f&&t.drawImage(f.canvas,f.x,f.y,f.width,f.height,l,u,f.width,f.height),l+=this.tileWidth;m^=1,l=this.tileHalfWidth*m,u+=3}}},calcEntityCell:function(t){},getPos:function(t,e){var i=this.tilesX*this.tileHalfWidth-e*this.tileHalfWidth-this.tileHalfWidth+t*this.tileHalfWidth,s=s=e*this.tileHalfHeight+this.tileOffsetY+t*this.tileHalfHeight;return[i,s]},getWorldPos:function(t,e){var i=this.tilesX*this.tileHalfWidth-e*this.tileHalfWidth-this.tileHalfWidth+t*this.tileHalfWidth+this.volume.minX,s=s=e*this.tileHalfHeight+this.tileOffsetY+t*this.tileHalfHeight+this.volume.minY;return[i,s]},getPosEx:function(t){t.x=this.tilesX*this.tileHalfWidth-t.cellY*this.tileHalfWidth-this.tileHalfWidth+t.cellX*this.tileHalfWidth,t.y=y=t.cellY*this.tileHalfHeight+this.tileOffsetY+t.cellX*this.tileHalfHeight},getWorldPosEx:function(t){t.x=this.tilesX*this.tileHalfWidth-t.cellY*this.tileHalfWidth-this.tileHalfWidth+t.cellX*this.tileHalfWidth+this.volume.minX,t.y=y=t.cellY*this.tileHalfHeight+this.tileOffsetY+t.cellX*this.tileHalfHeight+this.volume.minY},getPosX:function(t,e){var i=this.tilesX*this.tileHalfWidth-e*this.tileHalfWidth-this.tileHalfWidth+t*this.tileHalfWidth;return i},getPosY:function(t,e){var i=e*this.tileHalfHeight+this.tileOffsetY+t*this.tileHalfHeight;return i},getGridFromWorldPos:function(t,e){var i=t-this.tilesX*this.tileHalfWidth-(this.volume.x+this.offsetX),s=e-(this.volume.y-this.offsetY),n=Math.floor((s/this.tileHalfHeight+i/this.tileHalfWidth)/2),h=Math.floor((s/this.tileHalfHeight-i/this.tileHalfWidth)/2);return[n,h]}})},function(t,e,i){"use strict";meta.class("Entity.TilemapIsoLayer","Entity.TilemapLayer",{draw:function(t,e,i){if(0!==(this.parent.flags&this.Flag.LOADED)){var s,n,h,o,a,r=(meta.camera.volume,meta.renderer),l=0,u=this.tilesX,c=0,d=(this.tilesY,0);if(this._dataFlags)for(var a=c;a<this.tilesY;a++){n=this.tilesX*this.tileHalfWidth-a*this.tileHalfWidth-this.tileHalfWidth+e,h=a*this.tileHalfHeight+this.tileOffsetY+i;for(var o=l;o<u;o++)s=this._dataInfo[d],s&&t.drawImage(s.canvas,s.x,s.y,s.width,s.height,n,h+this.tileHeight-s.height,s.width,s.height),d++,n+=this.tileHalfWidth,h+=this.tileHalfHeight}else for(var a=c;a<this.tilesY;a++){n=this.tilesX*this.tileHalfWidth-a*this.tileHalfWidth-this.tileHalfWidth+e,h=a*this.tileHalfHeight+this.tileOffsetY+i;for(var o=l;o<this.tilesX;o++){if(s=this._dataInfo[d],s&&t.drawImage(s.canvas,s.x,s.y,s.width,s.height,n,h+this.tileHeight-s.height,s.width,s.height),this._cells){var f=this._cells[d];if(f)for(var m=f.length,p=0;p<m;p++){var v=f[p];v.texture&&r.drawEntity(v)}}d++,n+=this.tileHalfWidth,h+=this.tileHalfHeight}}}},_calcEntityCell:function(t){var e=t.x-this.tilesX*this.tileHalfWidth,i=t.y;t.cellX=Math.floor((i/this.tileHalfHeight+e/this.tileHalfWidth)/2),t.cellY=Math.floor((i/this.tileHalfHeight-e/this.tileHalfWidth)/2),this._updateEntityCell(t)},_calcEntityPos:function(t){var e=this.tilesX*this.tileHalfWidth-t.cellY*this.tileHalfWidth-this.tileHalfWidth+t.cellX*this.tileHalfWidth,i=t.cellY*this.tileHalfHeight+this.tileOffsetY+t.cellX*this.tileHalfHeight;t._x=e+this.tileHalfWidth,t._y=i+this.tileHalfHeight,t.updatePos()},getPos:function(t,e){var i=this.tilesX*this.tileHalfWidth-e*this.tileHalfWidth+t*this.tileHalfWidth,s=e*this.tileHalfHeight+t*this.tileHalfHeight+this.tileHalfHeight+this.tileOffsetY;return[i,s]},getWorldPos:function(t,e){var i=this.tilesX*this.tileHalfWidth-e*this.tileHalfWidth+t*this.tileHalfWidth+this.volume.minX,s=e*this.tileHalfHeight+t*this.tileHalfHeight+this.tileHalfHeight+this.tileOffsetY+this.volume.minY;return[i,s]},getPosEx:function(t){t.x=this.tilesX*this.tileHalfWidth-t.cellY*this.tileHalfWidth+t.cellX*this.tileHalfWidth,t.y=t.cellY*this.tileHalfHeight+t.cellX*this.tileHalfHeight+this.tileHalfHeight+this.tileOffsetY},getWorldPosEx:function(t){t.x=this.tilesX*this.tileHalfWidth-t.cellY*this.tileHalfWidth+t.cellX*this.tileHalfWidth+this.volume.minX,t.y=t.cellY*this.tileHalfHeight+t.cellX*this.tileHalfHeight+this.tileHalfHeight+this.tileOffsetY+this.volume.minY},getPosX:function(t,e){var i=this.tilesX*this.tileHalfWidth-e*this.tileHalfWidth+t*this.tileHalfWidth;return i},getPosY:function(t,e){var i=e*this.tileHalfHeight+t*this.tileHalfHeight+this.tileOffsetY+this.tileOffsetY;return i},getCellFromPos:function(t,e){var i=t-this.tilesX*this.tileHalfWidth-this.offsetX,s=e-this.offsetY,n=Math.floor((s/this.tileHalfHeight+i/this.tileHalfWidth)/2),h=Math.floor((s/this.tileHalfHeight-i/this.tileHalfWidth)/2);return[n,h]},getCellFromWorldPos:function(t,e){var i=t-this.tilesX*this.tileHalfWidth-(this.volume.x+this.offsetX),s=e-(this.volume.y-this.offsetY),n=Math.floor((s/this.tileHalfHeight+i/this.tileHalfWidth)/2),h=Math.floor((s/this.tileHalfHeight-i/this.tileHalfWidth)/2);return[n,h]},getCellFromPosEx:function(t){var e=t.x-this.tilesX*this.tileHalfWidth-this.offsetX,i=t.y-this.offsetY;t.cellX=Math.floor((i/this.tileHalfHeight+e/this.tileHalfWidth)/2),t.cellY=Math.floor((i/this.tileHalfHeight-e/this.tileHalfWidth)/2)},getCellFromWorldPosEx:function(t){var e=t.x-this.tilesX*this.tileHalfWidth-(this.volume.x+this.offsetX),i=t.y-(this.volume.y-this.offsetY);t.cellX=Math.floor((i/this.tileHalfHeight+e/this.tileHalfWidth)/2),t.cellY=Math.floor((i/this.tileHalfHeight-e/this.tileHalfWidth)/2)}})},function(t,e,i){"use strict";meta.class("Entity.TilemapLayer","Entity.Geometry",{renderDebug:function(){if(this._cells)for(var t,e=meta.renderer,i=0;i<this.numTiles;i++)t=this._cells[i],t&&e._renderVolumes(t)},updateFromData:function(){if(this.resize(this.tilesX*this.tileWidth+this.tileOffsetX,this.tilesY*this.tileHeight+this.tileOffsetY),this._dataInfo?this._dataInfo.length!==this.numTiles&&(this._dataInfo.length=this.numTiles):this._dataInfo=new Array(this.numTiles),this._cells)for(var t,e=(Entity.TileGeometry,this.children.length),i=0;i<e;i++)t=this.children[i];this._tilesets=this.parent.tilesets,this._numTilesets=this._tilesets.length;for(var i=0;i<this.numTiles;i++)this._updateDataInfoCell(i);this.renderer.needRender=!0},_updateDataInfoCell:function(t){if(this._data){var e=this._data[t];if(e){if(536870912&e||1073741824&e||2147483648&e){this._dataFlags||(this._dataFlags=new Uint32Array(this._data.length));var i=0;i|=536870912&e,i|=1073741824&e,i|=2147483648&e,this._dataFlags[t]=i,e&=536870911}for(var s=this._tilesets[0],n=1;n<this._numTilesets&&!(e<this._tilesets[n].gid);n++)s=this._tilesets[n];this._dataInfo[t]=s.getCell(e)}else this._dataInfo[t]=null}},_updateEntityCell:function(t){if(this._cells){var e,i;if(i=t.cellX<0||t.cellX>=this.tilesX?this.numTiles+1:t.cellY<0||t.cellY>=this.tilesY?this.numTiles+1:t.cellX+t.cellY*this.tilesX,t._cellId!==i){if(t._cellId!==-1)if(e=this._cells[t._cellId],e.length>1){var s=e.pop();s._cellIndex=t._cellIndex,e[t._cellIndex]=s}else e.length=0;t._cellId=i,e=this._cells[t._cellId],e?(t._cellIndex=e.length,e.push(t)):(e=[t],this._cells[t._cellId]=e,t._cellIndex=0)}}},setGid:function(t,e,i){var s=t+e*this.tilesX;this._data[s]=i,this.parent.loaded&&(this._updateDataInfoCell(s),this.renderer.needRender=!0)},getGid:function(t,e){var i=t+e*this.tilesX;return i<0?0:i>=this.numTiles?0:this.data[i]},getInfo:function(t,e){var i=t+e*this.tilesX;return i<0?null:i>=this.numTiles?null:this._dataInfo[i]},getFlags:function(t,e){var i=t+e*this.tilesX;return i<0?null:i>=this.numTiles?null:this._dataFlags[i]},getPropertiesFromPos:function(t,e){return this.getProperties(this.getGid(t,e))},getProperties:function(t){if(t<=0)return null;for(var e=this._tilesets[0],i=1;i<this._numTilesets&&!(t<this._tilesets[i].gid);i++)e=this._tilesets[i];var s=e.properties[t-e.gid];return s?s:null},saveData:function(){if(!this.data)return void console.warn("(Entity.Tilemap.saveData) No data available for saving");this.savedData?this.savedData.length!==this.numTiles&&(this.savedData.length=this.numTiles):this.savedData=new Uint32Array(this.numTiles);for(var t=0;t<this.numTiles;t++)this.savedData[t]=this.data[t]},restoreData:function(){if(!this.savedData)return void console.warn("(Entity.Tilemap.restoreData) No saved data available");if(this.savedData.length!==this.numTiles)return console.warn("(Entity.Tilemap.restoreData): Incompatible data saved"),void(this.savedData=null);for(var t=0;t<this.numTiles;t++)this.data[t]=this.savedData[t];this.updateFromData()},convertToEntities:function(t){this.layerFlags|=this.LayerFlag.CONVERTED_TO_ENTITIES,this.parent.flags&this.Flag.LOADED&&this._convertToEntities(t),this.enabled=!1},_convertToEntities:function(t){t=t||1;for(var e,i,s=0,n=0;n<this.tilesY;n++)for(var h=0;h<this.tilesX;h++)e=this._dataInfo[s++],e&&(i=new Entity.Geometry(e),i.position(this.getPosX(h,n),this.getPosY(h,n)),i.pivot(0,1),i.z=t*n,meta.view.attach(i))},attach:function(t){t instanceof Entity.TileGeometry&&(this._cells||(this._cells=new Array(this.numTiles)),t.parent=this,0!==t._x||0!==t._y?this._calcEntityCell(t):this._calcEntityPos(t)),this._super(t),t._activate(),t.flags&t.Flag.PICKING&&this.renderer.entitiesPicking.push(t)},_attachToCell:function(t){t.layerParent=this,t.flags&t.Flag.PICKING&&this.renderer.entitiesPicking.push(t)},detach:function(t){},tileOffset:function(t,e){this.tileOffsetX=t,this.tileOffsetY=e,this.offset(t,-e)},set data(t){this._data=t||null,this.numTiles=this.tilesX*this.tilesY,this.parent.flags&this.Flag.LOADED&&this.updateFromData()},get data(){return this._data},LayerFlag:{CONVERTED_TO_ENTITIES:2},name:"Undefined",tilesX:0,tilesY:0,numTiles:0,tileWidth:1,tileHeight:1,tileHalfWidth:0,tileHalfHeight:0,tileOffsetX:0,tileOffsetY:0,properties:null,cellPos:null,_data:null,_dataInfo:null,_dataFlags:null,_cells:null,_cellUnresolved:null,_tilesets:null,_numTilesets:0,layerFlags:0}),Entity.TilemapLayer.CellPos=function(t,e){this.cellX=t,this.cellY=e,this.x=0,this.y=0},Entity.TilemapLayer.prototype.cellPos=new Entity.TilemapLayer.CellPos(0,0)},function(t,e,i){"use strict";meta.class("Entity.TilemapOrthoLayer","Entity.TilemapLayer",{gridFromPos:function(t,e){var i=Math.floor((t-this.volume.minX)/this.tileWidth),s=Math.floor((e-this.volume.minY)/this.tileHeight);return[i,s]},draw:function(t){if(0!==(this.parent.flags&this.Flag.LOADED)){var e=meta.camera.volume,i=Math.floor((e.minX-this.volume.minX)/this.tileWidth),s=Math.floor((e.minY-this.volume.minY)/this.tileHeight),n=Math.ceil((e.maxX-this.volume.minX)/this.tileWidth),h=Math.ceil((e.maxY-this.volume.minY)/this.tileHeight);i<0&&(i=0),s<0&&(s=0),n>this.tilesX&&(n=this.tilesX),h>this.tilesY&&(h=this.tilesY);var o,a=Math.floor(i*this.tileWidth),r=Math.floor(s*this.tileHeight),l=0,u=0|a,c=0|r;if(this._dataFlags)for(var d=0,f=s;f<h;f++){l=i+f*this.tilesX;for(var m=i;m<n;m++){if(info=this._dataInfo[l],info)if(d=this._dataFlags[l]){var p=1,v=1,g=0,_=0;t.save(),536870912&d?(t.rotate(Math.PI/2),2147483648&d&&1073741824&d?(p=-1,g=this.tileWidth,_=this.tileHeight):2147483648&d?_=this.tileWidth:1073741824&d?(p=-1,v=-1,g=this.tileWidth):v=-1):(2147483648&d&&(p=-1,g=this.tileWidth),1073741824&d&&(v=-1,_=this.tileHeight)),t.scale(p,v),t.drawImage(info.canvas,info.posX,info.posY,this.tileWidth,this.tileHeight,u*p-g,c*v-_,this.tileWidth,this.tileHeight),t.restore()}else t.drawImage(info.canvas,info.posX,info.posY,info.width,info.height,u,c,info.width,info.height);l++,u+=this.tileWidth}u=0|a,c+=this.tileHeight}else for(var f=s;f<h;f++){l=i+f*this.tilesX;for(var m=i;m<n;m++){if(o=this._dataInfo[l],o&&t.drawImage(o.canvas,o.x,o.y,o.width,o.height,u,c-o.height+this.tileHeight,o.width,o.height),this._cells){var y=this._cells[l];if(y)for(var x=y.length,b=0;b<x;b++){var w=y[b];w.texture&&w._texture.draw(t,w.volume.x-w.volume.pivotPosX,w.volume.y-w.volume.pivotPosY)}}l++,u+=this.tileWidth}u=a,c+=this.tileHeight}}},_calcEntityCell:function(t){t.cellX=Math.floor((t.volume.x-t.totalOffsetX)/this.tileWidth),t.cellY=Math.floor((t.volume.y-t.totalOffsetY)/this.tileHeight),this._updateEntityCell(t)},_calcEntityPos:function(t){var e=t.cellX*this.tileWidth+this.tileHalfWidth,i=t.cellY*this.tileHeight+this.tileHalfHeight;t._x=e,t._y=i,t.updatePos()},getPos:function(t,e){var i=this.tilesX*this.tileHalfWidth-e*this.tileHalfWidth-this.tileHalfWidth+t*this.tileHalfWidth,s=s=e*this.tileHalfHeight+this.tileOffsetY+t*this.tileHalfHeight;return[i,s]},getWorldPos:function(t,e){var i=this.tilesX*this.tileHalfWidth-e*this.tileHalfWidth-this.tileHalfWidth+t*this.tileHalfWidth+this.volume.minX,s=s=e*this.tileHalfHeight+this.tileOffsetY+t*this.tileHalfHeight+this.volume.minY;return[i,s]},getPosEx:function(t){t.x=this.tilesX*this.tileHalfWidth-t.cellY*this.tileHalfWidth-this.tileHalfWidth+t.cellX*this.tileHalfWidth,t.y=t.cellY*this.tileHalfHeight+this.tileOffsetY+t.cellX*this.tileHalfHeight},getWorldPosEx:function(t){t.x=this.tilesX*this.tileHalfWidth-t.cellY*this.tileHalfWidth-this.tileHalfWidth+t.cellX*this.tileHalfWidth+this.volume.minX,t.y=t.cellY*this.tileHalfHeight+this.tileOffsetY+t.cellX*this.tileHalfHeight+this.volume.minY},getPosX:function(t,e){var i=this.tilesX*this.tileHalfWidth-e*this.tileHalfWidth-this.tileHalfWidth+t*this.tileHalfWidth;return i},getPosY:function(t,e){var i=e*this.tileHalfHeight+this.tileOffsetY+t*this.tileHalfHeight;return i+20}})},function(t,e,i){"use strict";meta.Tween.Easing={linear:function(t){return t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quartIn:function(t){return t*t*t*t},quartOut:function(t){return 1- --t*t*t*t},quartInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},quintIntOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sineIn:function(t){return 1-Math.cos(t*Math.PI/2)},sineOut:function(t){return Math.sin(t*Math.PI/2)},sineIntOut:function(t){return.5*(1-Math.cos(Math.PI*t))},expoIn:function(t){return 0===t?0:Math.pow(1024,t-1)},expoOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},expoInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var e,i=.1,s=.4;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=s/4):e=s*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/s)))},elasticOut:function(t){var e,i=.1,s=.4;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=s/4):e=s*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/s)+1)},elasticInOut:function(t){var e,i=.1,s=.4;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=s/4):e=s*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?-.5*(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/s)):i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/s)*.5+1)},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},backInOut:function(t){var e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)},bounceIn:function(t){return 1-meta.Tween.Easing.bounceOut(1-t)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bounceInOut:function(t){return t<.5?.5*meta.Tween.Easing.bounceIn(2*t):.5*meta.Tween.Easing.bounceOut(2*t-1)+.5}}},function(t,e,i){"use strict";meta.Tween.Link=function(t,e,i,s){this.tween=t,this.startValues={},this.endValues=e,this.duration=i,this._onDone=s||null},meta.Tween.Link.prototype={play:function(){return this.tween.play(),this},stop:function(){return this.tween.stop(),this},paused:function(t){return this.tween.paused(t),this},resume:function(){return this.tween.resume(),this},clear:function(){return this.tween.clear(),this},reset:function(){return this.tween.reset(),this},update:function(t){var e,i,s,n=this._easing(t),h=this.tween.cache.owner;for(var o in this.endValues)e=this.startValues[o],i=this.endValues[o],"string"==typeof e&&(i=e+parseFloat(i,4)),s=e+(i-e)*n,this.rounding&&(s=Math.round(s)),h[o]=s},next:function(){return this.tween.next(),this},wait:function(t,e){return this.tween.wait(t,e)},frameDelay:function(t){return this.tFrameDelay=t,this},round:function(t){return void 0===t&&(t=!0),this.isRounding=t,this},repeat:function(t){return this.tween.repeat(t),this},reverse:function(t){return this.tween.reverse=t,this},easing:function(t){return"function"==typeof t?this._easing=t:this._easing=meta.Tween.Easing[t],void 0===this._easing&&(this._easing=meta.Tween.Easing.linear),this},onStart:function(t){return this._onStart=t,this},onDone:function(t){return this.tween.onDone=t,this},onTick:function(t){return this._onTick=t,this},to:function(t,e,i){return this.tween.to(t,e,i)},group:function(t){return this.tween.group(t)},_easing:meta.Tween.Easing.linear,_onStart:null,_onDone:null,_onTick:null,tFrameDelay:0,rounding:!1}},function(t,e,i){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};meta.Tween=function(){this.cache=null,this.chain=[]},meta.Tween.prototype={play:function(){if(this.cache){var t=this.cache;if(!t.owner)return this;if(t.owner.removed)return this;t.paused=!1,t.numRepeat=this.numRepeat,this.next(),this._play()}else this.autoPlay=!0;return this},_play:function(){this.cache.__index===-1&&(this.cache.__index=meta.renderer.tweens.push(this.cache)-1,this._group&&this._group.activeUsers++)},stop:function(t){if(this.cache.__index!==-1)return this.cache.link=null,this.cache.index=0,meta.renderer.tweensRemove.push(this.cache),this.cache.__index=-1,t&&t(this.cache.owner),this._group&&(this._group.activeUsers--,0===this._group.activeUsers&&this._group.callback&&this._group.callback()),this},paused:function(t){return void 0===t&&(t=!0),this.cache.paused=t,this},resume:function(){return this.cache.paused=!1,this},clear:function(){return this.stop(null),this.chain.length=0,this._group&&(this._group.users--,this._group=null),this},reset:function(){var t=this.cache;if(t.index=0,t.link=this.chain[0],!t.link)return this;for(var e in t.link.startValues)t.owner[e]=t.link.startValues[e];return this.stop(!1),this},next:function(){var t=!1,e=this.cache;if(e.index===this.chain.length){if(0===e.numRepeat)return this.stop(),this.onDone&&this.onDone.call(this.cache),this;if(e.index=0,e.numRepeat!==-1&&(e.numRepeat--,0===e.numRepeat))return this.stop(),this.onDone&&this.onDone.call(this.cache),this;t=!0}e._done=!1;var i,s=this.chain[e.index++],n=e.owner;if(t)for(i in s.startValues)n[i]=s.startValues[i];else for(i in s.endValues)s.startValues[i]=n[i];return s._onStart&&s._onStart.call(this),e._tStart=meta.time.current,e._tFrame=0,e.link=s,this},repeat:function(t){return void 0===t&&(t=-1),this.numRepeat=t,this},set reverse(t){return void 0===t&&(t=!0),this.cache.reverse=t,this},get reverse(){return this.cache.reverse},update:function(t){var e=this.cache;if(!e.link)return void this.stop(!1);e._tFrame+=meta.time.delta;var i=e.link,s=(meta.time.current-e._tStart)/i.duration;if(s>1&&(s=1),e._done){if(e.tFrameDelay<i.tDelay)return}else i.endValues&&(i.update(s),i._onTick&&i._onTick.call(this.cache));if(1===s){if(!e._done)return void(e._done=!0);i._onDone&&i._onDone.call(this.cache),this.next()}},to:function(t,e,i){var s=new meta.Tween.Link(this,t,e,i);return this.chain.push(s),s},wait:function(t,e){var i=new meta.Tween.Link(this,null,t,e);return this.chain.push(i),i},group:function(t){return t?this._group?(console.warn("(meta.Tween.group) Tween already is part of a group."),this):("object"===("undefined"==typeof t?"undefined":s(t))&&(this._group=t),this._group.users++,this):(console.warn("(meta.Tween.group) No group name specified."),this)},autoPlay:!1,_group:null,_removeFlag:0,numRepeat:0},meta.Tween.Cache=function(t){this.owner=t,this.tween=null,this.link=null,this.index=0,this.numRepeat=0,this._tStart=0,this._tFrame=0,this.onDone=null,this._done=!1,this.__index=-1},meta.Tween.Cache.prototype={update:function(t){this.tween.cache=this,this.tween.update(t),this.tween.cache=null},stop:function(){this.tween.cache=this,this.tween.stop(),this.tween.cache=null},paused:!1,reverse:!1,_flags:0},meta.Tween.Group=function(t,e){"function"==typeof t&&(e=t,t=""),this.name=t,this.users=0,this.activeUsers=0,this.callback=e||null}},function(t,e,i){"use strict";meta.class("UI.Checkbox","Entity.Geometry",{_initParams:function(t){t?this.style=meta.createStyle(t,UI.ctrl.coreStyle.checkbox):this.style=UI.ctrl.style.checkbox;var e=this,i=new Entity.Geometry;i.style=this._style.childStyle,i.anchor(.5),i.pickable=!1,i.onChange=function(){e._onChildChange(this)},this.attach(i),this.state="off",this._onClick=this.toggle},toggle:function(){var t=this.children[0];this.group?t.state="on":"on"===t.state?t.state="off":t.state="on"},_onChange:function(){this.children[0].state=this._state,this.group&&"on"===this._state&&this.group._onStateChange(this)},_onChildChange:function(t){this.state=this.children[0]._state},set checked(t){this.state=t?"on":"off"},get checked(){return"on"===this._state},set text(t){this._text?this._text.setText(t):(this._text=new Entity.Text(t),this._text.size=12,this._text.color="#ffffff",this.attach(this._text),this._text.anchor(.5),this._text.pickable=!1)},get text(){return this._text?this._text._text:""},_text:null,group:null,value:""})},function(t,e,i){"use strict";meta.class("UI.Controller","meta.Controller",{onFirstReady:function(){var t=new Resource.Texture;t.fillRect({color:"#111",width:120,height:30});var e=new Resource.Texture;e.fillRect({color:"#ff0000",width:120,height:30}),this.coreStyle={button:{"*:hover":{cursor:"pointer"},"*:pressed, *:drag":{cursor:"pointer",offsetX:1,offsetY:1}},checkbox:{"*:hover":{cursor:"pointer"},"*:pressed, *:drag":{cursor:"pointer",offsetX:1,offsetY:1}}},this.style={button:{"*":{texture:t},"*:hover":{texture:e,cursor:"pointer"},"*:pressed":{texture:e,cursor:"pointer",offsetX:1,offsetY:1}},checkbox:{"*":{texture:t},"*:hover":{texture:e,cursor:"pointer"},"*:pressed":{texture:e,cursor:"pointer",offsetX:1,offsetY:1},"[off]":{texture:t},"[on]":{texture:e}}}},coreStyle:null,style:null})},function(t,e,i){"use strict";meta.class("UI.Group","Entity.Geometry",{
add:function(t){t.group&&t.detach(),this.children||(t.state="on",this._value=t.value),this.attach(t),t.group=this},_onStateChange:function(t){this.prevValue=this._value,this._value=t.value;for(var e,i=this.children.length,s=0;s<i;s++)e=this.children[s],e!==t&&(this.children[s].state="off");this.onChange(this)},set value(t){if(this.children)for(var e=this.children.length,i=0;i<e;i++)if(this.children[i].value===t){this.children[i].state="on";break}},get value(){return this._value},prevValue:"",_value:""})},function(t,e,i){"use strict";meta.class("UI.ProgressBar","Entity.Geometry",{init:function(t,e){this._super(t);var i=new Entity.Geometry(e);this.attach(i),this.updateUnits()},updateProgress:function(){var t=Math.floor(this._fillWidth/100*this._value),e=this.children[0];e.width=t},updateUnits:function(){var t=this.children[0]._texture;t._loaded&&(this._fillWidth=t.fullWidth)},set min(t){this._min!==t&&(this._min=t,this.updateProgress())},set max(t){this._max!==t&&(this._max=t,this.updateProgress())},set value(t){t<this._min?t=this._min:t>this._max&&(t=this._max),this._value!==t&&(this._value=t,this.updateProgress())},set percents(t){this._max-this._min},get min(){return this._min},get max(){return this._max},get value(){return this._value},get percents(){return this._percents},set fillTexture(t){this.children[0].texture=t,this.updateProgress()},get fillTexture(){return this.children[0]._texture},_min:0,_max:100,_value:100,_unit:1,_fillWidth:1})},function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),a=2,r=function(t){function e(t){s(this,e);var i=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i._label=null,i}return h(e,t),o(e,[{key:"onCreate",value:function(){this.picking=!0}},{key:"onHoverEnter",value:function(t){meta.engine.cursor="pointer"}},{key:"onHoverExit",value:function(t){meta.engine.cursor="auto"}},{key:"onDown",value:function(){this.move(a,a)}},{key:"onUp",value:function(){this.move(-a,-a)}},{key:"_createLabel",value:function(t){t||(t=""),this._label=new Entity.Text(t),this._label.pivot(.5),this._label.anchor(.5),this._label.pickable=!1,this._label.size=12,this._label.color="#ffffff",this.attach(this._label)}},{key:"text",set:function(t){this._label?this._label.text=t:this._createLabel(t)},get:function(){return this._label?this._label.text:""}},{key:"label",get:function(){return this._label||this._createLabel(),this._label}}]),e}(Entity.Geometry);e.default=r},function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),a=function(t){function e(t){s(this,e);var i=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i._textureOn=null,i._textureOff=null,i._checked=!1,i.picking=!0,i}return h(e,t),o(e,[{key:"updateState",value:function(){this.texture=this.checked?this._textureOn:this._textureOff}},{key:"onClick",value:function(){this.checked=!0,this.updateState()}},{key:"textureOn",set:function(t){this._textureOn!==t&&(this._textureOn=t,this.updateState())},get:function(){return this._textureOn}},{key:"textureOff",set:function(t){this._textureOff!==t&&(this._textureOff=t,this.updateState())},get:function(){return this._textureOff}},{key:"checked",set:function(t){this._checked!==t&&(this._checked=t,this.updateState(),this.emit("change",t))},get:function(){return this._checked}}]),e}(Entity.Geometry);e.default=a},function(module,exports,__webpack_require__){"use strict";meta.ajax=function(params){var data=meta.serialize(params.data),xhr=new XMLHttpRequest;return"html"===params.dataType?params.responseType="document":"script"===params.dataType||"json"===params.dataType?params.responseType="text":void 0===params.dataType?(params.responseType="GET",xhr.overrideMimeType("text/plain")):params.responseType=params.dataType,void 0===params.type&&(params.type="GET"),xhr.open(params.type,params.url,!0),xhr.onload=function(){4===xhr.readyState&&200===xhr.status?void 0!==params.success&&("document"===params.responseType?params.success(xhr.responseXML):"script"===params.dataType?params.success(eval(xhr.responseText)):"json"===params.dataType?params.success(JSON.parse(xhr.responseText)):params.success(xhr.responseText)):void 0!==params.error&&params.error()},xhr.send(data),xhr}},function(t,e,i){"use strict";meta.Tokenizer=function(){this.currChar=0,this.buffer=null,this.bufferLength=0,this.cursor=0,this.token={type:0,str:"",value:0,line:0}},meta.Tokenizer.prototype={setup:function(t){this.buffer=t,this.bufferLength=t.length,this.cursor=0},nextToken:function(){for(this.token.type=0,this.token.str="",this.token.value=0,this.nextChar();meta.isSpace(this.currChar);)this.nextChar();if(meta.isAlpha(this.currChar)){for(this.token.str+=this.currChar,this.nextChar();meta.isAlphaNum(this.currChar);)this.token.str+=this.currChar,this.nextChar();switch(this.cursor--,this.token.str){case"true":this.token.type=this.Type.BOOL,this.token.value=1;break;case"false":this.token.type=this.Type.BOOL;break;case"NaN":this.token.type=this.Type.NUMBER,this.token.value=NaN;break;default:this.token.type=this.Type.NAME}return this.token}if(meta.isDigit(this.currChar)){for(this.token.str+=this.currChar,this.nextChar();meta.isDigit(this.currChar);)this.token.str+=this.currChar,this.nextChar();return this.cursor--,"."===this.token.str?(this.token.type=this.Type.SYMBOL,this.token.value=this.token.str,this.token):(this.token.type=this.Type.NUMBER,this.token.value=parseFloat(this.token.str),this.token)}if(meta.isBinOp(this.currChar))return this.token.str=this.currChar,this.token.type=this.Type.BINOP,this.token;if('"'===this.currChar||"'"===this.currChar){var t=this.currChar;this.nextChar();for(var e=this.peekChar();;){if(this.currChar===t){this.currChar===e&&(this.token.str+=this.currChar,this.nextChar());break}if("\0"===this.currChar)return this.token.type=this.Type.EOF,this.token;this.token.str+=this.currChar,this.nextChar()}return this.token.type=this.Type.STRING,this.token}return"\0"===this.currChar?(this.token.type=this.Type.EOF,this.token):(this.token.type=this.Type.SYMBOL,this.token.str=this.currChar,this.token)},nextChar:function(){this.currChar=this.peekChar(),this.cursor++,"\n"!==this.currChar&&"\0"!==this.currChar||this.token.line++},peekChar:function(){return this.cursor>=this.bufferLength?"\0":this.buffer.charAt(this.cursor)},Type:{EOF:0,NUMBER:1,BOOL:2,NAME:3,STRING:4,BINOP:5,SYMBOL:6}},meta.tokenizer=new meta.Tokenizer},function(t,e,i){t.exports=i(0)}]);