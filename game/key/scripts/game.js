!function(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=136)}([function(t,e,i){"use strict";meta.controller("Sounds",{muted:!1,musicPlaying:null,onFirstLoad:function(){document.addEventListener("visibilitychange",this.handleVisibility.bind(this)),window.addEventListener("blur",this.handleBlur.bind(this)),window.addEventListener("focus",this.handleFocus.bind(this)),this.musicPlaying=[],this.muted=!1,meta.audio.mute=this.muted},play:function(t,e){meta.resources.sounds[t].play(e)},playMusic:function(t,e){this.play(t,e)},stop:function(t){meta.resources.sounds[t]?meta.resources.sounds[t].stop():console.log("Sound not found:",t)},muteMusic:function(t,e){e?meta.resources.sounds[t]&&meta.resources.sounds[t].pause():meta.resources.sounds[t]&&meta.resources.sounds[t].resume()},handleBlur:function(){meta.audio.mute=!0},handleFocus:function(){meta.audio.mute=!1},handleVisibility:function(){this.muted=document.hidden,meta.audio.mute=this.muted}})},function(t,e,i){"use strict";meta.class("Model.ShareProxy",{id:"ShareProxy",domain:null,protocol:null,url:null,metaFbURL:null,metaTwURL:null,metaTags:null,twDescription:null,init:function(t){this.initArg(t),this.url=window.location.href,this.protocol=window.location.protocol,this.domain=window.location.host,this.metaTags=document.getElementsByTagName("meta");for(var e=0;e<this.metaTags.length;e++)"og:url"==this.metaTags[e].getAttribute("property")&&(this.metaFbURL=this.metaTags[e].getAttribute("content")),"twitter:url"==this.metaTags[e].getAttribute("name")&&(this.metaTwURL=this.metaTags[e].getAttribute("content")),"twitter:description"==this.metaTags[e].getAttribute("name")&&(this.twDescription=this.metaTags[e].getAttribute("content"));meta.subscribe(ScreenEventsChannel,this.onEvent,this)},initArg:function(t){for(var e in t)this[e]=t[e]},shareFB:function(t){FB.ui({method:"share",href:this.metaFbURL},function(t){}),this.sendShareAnalytics("facebook")},shareTwitter:function(){window.open("http://twitter.com/share?url="+encodeURIComponent(this.metaTwURL+"/")+"&text="+encodeURIComponent(this.twDescription),"","left=0,top=0,width=550,height=450,personalbar=0,toolbar=0,scrollbars=0,resizable=0"),this.sendShareAnalytics("twitter")},sendShareAnalytics:function(t){App.getProxy("AnalyticsProxy").sendGameShared(t)}})},function(t,e,i){"use strict";console.log=function(){},console.warn=function(){},i(0),i(12),i(21),i(125),i(119),i(120),i(121),i(122),i(123),i(126),i(124),i(10),i(9),i(6),i(8),i(7),i(5),i(50),i(40),i(54),i(55),i(56),i(39),i(37),i(69),i(36),i(49),i(51),i(52),i(14),i(17),i(15),i(19),i(18),i(16),i(20),i(13),i(1),i(11),i(1),i(22),i(3),i(4),i(0),i(25),i(24),i(23),i(29),i(30),i(26),i(27),i(28),i(31),i(33),i(34),i(132),i(32),i(128),i(129),i(127),i(135),i(35),i(48),i(46),i(45),i(38),i(60),i(41),i(47),i(42),i(131),i(134),i(130),i(133),i(58),i(59),i(62),i(67),i(76),i(70),i(71),i(53),i(74),i(77),i(57),i(80),i(81),i(82),i(84),i(85),i(86),i(83),i(87),i(73),i(68),i(63),i(72),i(79),i(78),i(66),i(65),i(64),i(75),i(61),i(88),i(89),i(93),i(96),i(94),i(92),i(90),i(91),i(95),i(115),i(116),i(117),i(118),i(98),i(102),i(103),i(110),i(108),i(107),i(99),i(104),i(105),i(109),i(111),i(100),i(101),i(114),i(112),i(97),i(106),i(113),i(44),i(43),meta.onPreload=function(){console.log("(main.js) onPreload"),meta.resources.loadTexture(s,"images/preload/"),meta.resources.loadFont(n),meta.resources.loadFile("data/locale.json",function(t){GameSettings.Strings=JSON.parse(t)})},meta.onLoad=function(){if(console.log("(main.js) onLoad"),GameSettings.textType=meta.device.mobile?"Mobile":"Desktop",meta.renderer.bgColor="#000000",meta.camera.bounds(GameSettings.cameraBounds.w,GameSettings.cameraBounds.h),meta.engine.webgl=!0,meta.input.trapTouch=!1,meta.device.mobile){var t=new View.Rotate({id:ScreenConstants.ROTATE});t.build();var e=!1,i=function(){var i=Math.abs(window.innerHeight)>Math.abs(window.innerWidth);e||i?e&&i&&(meta.emit(ScreenEventsChannel,null,ScreenEvents.ROTATION_PORTRAIT),e=!1,meta.audio.mute=!1,meta.engine.time.pause=!1,t.setPortrait(!1),t.view.detachView()):(e=!0,meta.audio.mute=!0,meta.engine.time.pause=!0,t.setPortrait(!0),t.view.attachView()),window.scrollTo(0,0)};meta.rotationChecker=i,window.addEventListener("resize",i.bind(this),!1),window.addEventListener("orientationchange",i.bind(this),!1)}App.load(),App.addProxy(new Model.ProgressProxy),App.addProxy(new Model.AnalyticsProxy),App.addProxy(new Model.OasisProxy),App.addProxy(new Model.ShareProxy),Screens.load(),Screens.makeView(ScreenConstants.LOADER),Screens.makeView(ScreenConstants.PAUSE),Screens.setView(ScreenConstants.LOADER),meta.device.mobile&&i(),App.addProxy(new Model.ShareProxy),Sounds.load()};var s=["ui-preloader-fill","ui-preloader-base","ui-preloader-bg","../../data/ui-title-firsttothekey","../../data/ui-title-logo"],n=[],a=0,h="images",o=["tiles/race-road1","tiles/dune-road-snow","tiles/dune-road-rock","tiles/dune-road-t1","tiles/dune-road-t2","tiles/globe-floor1","../data/ui-header-car-text","../data/ui-header-gun-text",{path:"effects/explosion.png",fps:12,framesX:3,framesY:4,frames:12},{path:"effects/hit-outer.png",fps:30,framesX:4,framesY:2,frames:8},{path:"effects/hit-yellow.png",fps:30,framesX:4,framesY:1,frames:4},{path:"effects/hit-white-2.png",fps:30,framesX:4,framesY:2,frames:8},{path:"sprites/all-fx-explode1.png",fps:12,framesX:2,framesY:3,frames:6},{path:"sprites/all-fx-explode2.png",fps:12,framesX:4,framesY:3,frames:10},{path:"sprites/all-fx-explode3.png",fps:12,framesX:3,framesY:4,frames:10},{path:"sprites/all-coin-collect.png",fps:12,framesX:3,framesY:3,frames:9},{path:"sprites/all-coin-spawn.png",fps:12,framesX:2,framesY:2,frames:4},{path:"sprites/all-coin.png",fps:12,framesX:3,framesY:2,frames:6},{path:"sprites/all-portal-dune.png",fps:12,framesX:3,framesY:3,frames:8},{path:"sprites/all-portal-globe.png",fps:12,framesX:3,framesY:3,frames:8},{path:"sprites/all-portal-race.png",fps:12,framesX:3,framesY:3,frames:8},{path:"sprites/ui-oasis-transition-portrait.png",fps:12,framesX:2,framesY:2,frames:4},{path:"sprites/ui-oasis-transition-landscape.png",fps:12,framesX:2,framesY:2,frames:4},{path:"sprites/dune-enemy-boss-frontgun.png",fps:6,framesX:4,framesY:2,frames:7},{path:"sprites/dune-enemy-boss-topgun.png",fps:6,framesX:5,framesY:1,frames:5},{path:"sprites/dune-enemy-boss-legs",fps:6,framesX:2,framesY:3,frames:6},{path:"sprites/dune-enemy-boss-radar",fps:12,framesX:2,framesY:2,frames:4},{path:"sprites/dune-enemy-drone-idle.png",fps:12,framesX:2,framesY:2,frames:4},{path:"sprites/dune-enemy-troop-run.png",fps:12,framesX:3,framesY:2,frames:6},{path:"sprites/dune-enemy-troop-kill.png",fps:16,framesX:5,framesY:2,frames:7},{path:"sprites/dune-enemy-troop-shoot2.png",fps:12,framesX:2,framesY:3,frames:6},{path:"sprites/dune-enemy-spaceinvader.png",fps:4,framesX:1,framesY:2,frames:2},{path:"sprites/dune-player-walk-gun1.png",fps:12,framesX:4,framesY:2,frames:7},{path:"sprites/dune-player-walk-gun2.png",fps:12,framesX:4,framesY:2,frames:7},{path:"sprites/dune-player-walk-gun3.png",fps:12,framesX:4,framesY:2,frames:7},{path:"sprites/dune-player-walk-gun4.png",fps:12,framesX:4,framesY:2,frames:7},{path:"sprites/race-enemy-car-idle.png",fps:12,framesX:3,framesY:2,frames:4},{path:"sprites/race-enemy-heavy-idle.png",fps:8,framesX:3,framesY:2,frames:4},{path:"sprites/race-enemy-heavy-crash.png",fps:18,framesX:4,framesY:3,frames:12},{path:"sprites/race-player-batmobile-idle.png",fps:12,framesX:3,framesY:2,frames:5},{path:"sprites/race-player-batmobile-turn.png",fps:12,framesX:2,framesY:1,frames:2},{path:"sprites/race-player-mysterymachine-idle.png",fps:12,framesX:3,framesY:2,frames:4},{path:"sprites/race-player-mysterymachine-turn.png",fps:12,framesX:3,framesY:3,frames:8},{path:"sprites/race-player-racecar-idle.png",fps:12,framesX:3,framesY:2,frames:5},{path:"sprites/race-player-racecar-turn.png",fps:12,framesX:2,framesY:3,frames:5},{path:"sprites/race-player-thundercats-idle.png",fps:12,framesX:2,framesY:2,frames:3},{path:"sprites/race-player-thundercats-turn.png",fps:12,framesX:3,framesY:3,frames:8},{path:"sprites/globe-decal-hive-energy.png",fps:12,framesX:3,framesY:2,frames:6},{path:"sprites/globe-decal-light.png",fps:12,framesX:2,framesY:3,frames:5},{path:"sprites/globe-player-run.png",fps:12,framesX:4,framesY:2,frames:8}],l=["textures/shared-texture-atlas.json","textures/game-texture-atlas.json"],r=["47_full_8-bits-racing-car-game-theme_0095.mp3","144_full_old-scroll-game_0171.mp3","sfx-button-negative.mp3","sfx-button-play-now.mp3","sfx-button-positive.mp3","sfx-collect-coin.mp3","sfx-collect-health.mp3","sfx-dune-footstep-boss.mp3","sfx-dune-pickup-emit.mp3","sfx-dune-weapon-1.mp3","sfx-dune-weapon-2.mp3","sfx-dune-weapon-3.mp3","sfx-dune-weapon-4.mp3","sfx-dune-weapon-boss.mp3","sfx-dune-weapon-drone.mp3","sfx-dune-weapon-troop.mp3","sfx-event-side-impact.mp3","sfx-explosion-1.mp3","sfx-explosion-2.mp3","sfx-explosion-3.mp3","sfx-explosion-boss.mp3","sfx-game-start.mp3","sfx-mine-place.mp3","sfx-oasis-transition-goggles.mp3","sfx-oasis-transition-loop.mp3","sfx-portal-entered.mp3","sfx-race-light.mp3","sfx-race-gogogo.mp3","sfx-race-jump.mp3","sfx-race-wrecking-ball-impact.mp3","sfx-race-wrecking-ball-swing.mp3","sfx-race-wrecking-ball-warning.mp3","sfx-shoppe-purchase.mp3"],c=1,u=0,m={IMAGES:"images",TMX:"tmx",SOUND:"sound",SPRITESHEET:"spritesheet",DONE:"done"};meta.onReady=function(){if(++u,console.log("SIMPLE COUNT",u,"phase",h,"stage",a,"total load",c),meta.emit(LoaderEventsChannel,{num:u/3,end:u/c==1},LoaderEvents.RESOURCE_LOADED),h===m.IMAGES)++a,meta.resources.silentLoad=!0,1===a?(u=0,window.dispatchEvent(new Event("resize")),meta.resources.loadTexture(o,"images/")):2===a&&a>=1&&(h=m.SPRITESHEET,a=0,meta.resources.loadSpriteSheet(l,"images/"));else if(h===m.SPRITESHEET)console.log("loading stage",a,l.length),a=0,h=m.SOUND,++a,++c,meta.resources.loadSound(r,"audio/"),h=m.DONE;else if(h===m.DONE){var t=App.getProxy("AnalyticsProxy");t.sendLoadEvent(),console.log("(main.js) LOADING COMPLETE > making views ---------------"),this.timer=meta.createTimer(this,d.bind(this),1e3,1),this.timer.play()}};var d=function(){Screens.makeView(ScreenConstants.ASSETS),Screens.makeView(ScreenConstants.HOME),Screens.makeView(ScreenConstants.INTRO),Screens.makeView(ScreenConstants.GAME_DUNE),Screens.makeView(ScreenConstants.GAME_GLOBE),Screens.makeView(ScreenConstants.GAME_RACE),Screens.makeView(ScreenConstants.SHOPPE),Screens.makeView(ScreenConstants.TRANSITION);var t=Screens.findView(ScreenConstants.LOADER);this.timer=meta.createTimer(t,t.loaderOut.bind(t),1e3,1),this.timer.play()}},function(t,e,i){"use strict";meta.controller("App",{id:"App",proxies:null,load:function(){this.proxies=[]},addProxy:function(t){for(var e=0;e<this.proxies.length;e++)if(this.proxies[e]===t)return;this.proxies.push(t)},getProxy:function(t){for(var e=0;e<this.proxies.length;e++)if(this.proxies[e].id==t)return this.proxies[e]}})},function(t,e,i){"use strict";meta.controller("Screens",{nextScreen:null,views:null,onLoad:function(){this.views=[],meta.createChannel(ScreenEventsChannel),meta.createChannel(GameEventsChannel),meta.subscribe(ScreenEventsChannel,this.onScreenEvent,this)},makeView:function(t,e){var i=this.findView(t);if(null===i){switch(t){case ScreenConstants.ASSETS:i=new View.Assets({id:t}),i.build();break;case ScreenConstants.GAME_DUNE:i=new View.GameDune({id:t}),i.build();break;case ScreenConstants.GAME_RACE:i=new View.GameRace({id:t}),i.build();break;case ScreenConstants.GAME_GLOBE:i=new View.GameGlobe({id:t}),i.build();break;case ScreenConstants.INTRO:i=new View.Intro({id:t}),i.build();break;case ScreenConstants.SHOPPE:i=new View.Shoppe({id:t}),i.build();break;case ScreenConstants.HOME:i=new View.Home({id:t}),i.build();break;case ScreenConstants.LOADER:i=new View.Loader({id:t}),i.build();break;case ScreenConstants.PAUSE:i=new View.Pause({id:t}),i.build();break;case ScreenConstants.ROTATE:i=new View.Rotate({id:t}),i.build();break;case ScreenConstants.TRANSITION:i=new View.GameTransition({id:t}),i.build()}null!==i&&(this.views.push(i),i.disable())}else console.warn("(Screens.js) view [",t,"] already exists")},findView:function(t){for(var e=null,i=0;i<this.views.length;i++)if(this.views[i].id===t){e=this.views[i];break}return e},setView:function(t){var e=this.findView(t);if(!e)return void console.warn("(Screens.js) view [",t,"] not found or doesn't exist");meta.emit(ScreenEventsChannel,e.id,ScreenEvents.ENABLE),meta.setView(e.view)},gotoNextScreen:function(){this.setView(this.nextScreen)},onTransitionPoint:function(t){},onScreenEvent:function(t,e){}})},function(t,e,i){"use strict";Math.clamp=function(t,e,i){return t<e?e:Math.min(t,i)},Math.repeat=function(t,e){return Math.clamp(t-Math.floor(t/e)*e,0,e)},Math.pingPong=function(t,e){return t=Math.repeat(t,2*e),e-Math.abs(t-e)}},function(t,e,i){"use strict";console.log("(geometryFix.js) isPointInside fix added");Entity.Geometry.prototype.isPointInside=function(t,e){if(1==this.volume.__transformed){var i=t-this.volume.x,s=e-this.volume.y;t=i*this.volume.cos+s*this.volume.sin+this.volume.x,e=s*this.volume.cos-i*this.volume.sin+this.volume.y}return t*=window.devicePixelRatio||1,e*=window.devicePixelRatio||1,this.volume.vsPoint(t,e)}},function(t,e,i){"use strict";console.log("(ie11Fix) IE 11 fix added"),HTMLElement.prototype.getBoundingClientRect=function(){var t=HTMLElement.prototype.getBoundingClientRect;return function(){try{return t.apply(this,arguments)}catch(t){return{left:"",right:"",top:"",bottom:""}}}}()},function(t,e,i){"use strict";if(console.log("(localeStorageFix.js) localStorage & Android Snapchat fixes added"),window.localStorage||Object.defineProperty(window,"localStorage",new function(){var t=[],e={};Object.defineProperty(e,"getItem",{value:function(t){return t?this[t]:null},writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(e,"key",{value:function(e){return t[e]},writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(e,"setItem",{value:function(t,e){t&&(document.cookie=escape(t)+"="+escape(e)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")},writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(e,"length",{get:function(){return t.length},configurable:!1,enumerable:!1}),Object.defineProperty(e,"removeItem",{value:function(t){t&&(document.cookie=escape(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")},writable:!1,configurable:!1,enumerable:!1}),this.get=function(){var i;for(var s in e)i=t.indexOf(s),-1===i?e.setItem(s,e[s]):t.splice(i,1),delete e[s];for(t;t.length>0;t.splice(0,1))e.removeItem(t[0]);for(var n,a,h=0,o=document.cookie.split(/\s*;\s*/);h<o.length;h++)n=o[h].split(/\s*=\s*/),n.length>1&&(e[a=unescape(n[0])]=unescape(n[1]),t.push(a));return e},this.configurable=!1,this.enumerable=!0}),"object"==typeof localStorage)try{localStorage.setItem("localStorage",1),localStorage.removeItem("localStorage")}catch(t){Storage.prototype._setItem=Storage.prototype.setItem,Storage.prototype.setItem=function(){}}},function(t,e,i){"use strict";console.log("(spritesheetFix.js) drawFrame fix added"),Resource.Texture.prototype.drawFrame=function(t,e,i,s){this.frameData?this.frameData[s].texture.draw(t,e,i):t.drawImage(this.canvas,0|(this.frameWidth*(s%this.framesX)||this.x),0|(this.frameHeight*Math.floor(s/this.framesX)||this.y),0|(this.frameWidth||this.width),0|(this.frameHeight||this.height),e,i,0|(this.frameWidth||this.width),0|(this.frameHeight||this.height))}},function(t,e,i){"use strict";meta.flags.culling=!1;if(window.location.search)for(var s=window.location.search.substr(1).split("&"),n=s.length;n--;){s[n].split("=")}},function(t,e,i){"use strict";meta.class("Model.AnalyticsProxy",{id:"AnalyticsProxy",initialPlaySent:!1,init:function(t){this.initArg(t),this.sendLoadStart()},initArg:function(t){for(var e in t)this[e]=t[e]},sendLoadStart:function(){dataLayer.push({event:"ready_player_one",action:"game",label:"load_start"}),gtag("event","page_view","loader")},sendLoadEvent:function(){dataLayer.push({event:"ready_player_one",action:"game",label:"load_success"}),gtag("event","action","load_success")},sendHome:function(){dataLayer.push({event:"ready_player_one",action:"game",label:"home"}),gtag("event","page_view","home")},sendInitialPlay:function(){this.initialPlaySent||(this.initialPlaySent=!0,this.sendStartGame())},sendIntro:function(){dataLayer.push({event:"ready_player_one",action:"game",label:"intro"}),gtag("event","page_view","intro")},sendStartGame:function(){dataLayer.push({event:"ready_player_one",action:"game",label:"start"}),gtag("event","action","start")},sendRunStart:function(t){dataLayer.push({event:"ready_player_one",action:"game",label:"run_start"}),gtag("event","page_view","game"),gtag("event","action","run_start")},sendRunEnd:function(){dataLayer.push({event:"ready_player_one",action:"game",label:"run_end"}),gtag("event","page_view","shoppe"),gtag("event","action","run_end")},sendWorldEnter:function(t){dataLayer.push({event:"ready_player_one",action:"game",label:"world_enter/"+t}),gtag("event","world_enter",{game:t})},sendWorldLeave:function(t){dataLayer.push({event:"ready_player_one",action:"game",label:"world_leave/"+t}),gtag("event","world_leave",{game:t})},sendGameRestart:function(){dataLayer.push({event:"ready_player_one",action:"game",label:"restart"}),gtag("event","action","restart")},sendGameShared:function(t){dataLayer.push({event:"ready_player_one",action:"share",label:t}),gtag("event","share",t)}})},function(t,e,i){"use strict";window.GameSettings={SHOW_DEBUG:!1,CAMERA_MOVE_FACTOR:.625,CAMERA_PAN_TIME:1300,LANE_WIDTH:135,LANE_PAD:409,LANE_TRANSITION:140,PORTAL_DUNE:"portalDune",PORTAL_GLOBE:"portalGlobe",PORTAL_RACE:"portalRace",SHIELD_TIME:3e3,cameraBounds:{w:636,h:1140},textType:"Mobile"},window.EnemyPatterns={BOSS:"boss",CIRCLE_A:"circleA",CIRCLE_B:"circleB",GRID:"grid",LINE_A:"lineA",LINE_B:"lineB",LINE_C:"lineC",TANK:"tank"},window.ProgressConfig={levels:["d_0","r_0","b_0"]},window.RaceGIDs={OBSTACLE_1:1,OBSTACLE_2:2,OBSTACLE_3:3,OBSTACLE_4:4,OBSTACLE_5:5,OBSTACLE_6:6,OBSTACLE_7:7,JUMP:14,HOLE:15,BARRICADE:16,LAMP_POST:20,ENEMY:20,CHASE_ENEMY:25,PICKUP:30,PORTAL:98},window.DamageRatings={ENEMY_BOSS_BULLET:35,ENEMY_DRONE_BULLET:20,ENEMY_INVADER_COLLISION:20,ENEMY_TROOPER_BULLET:15,ENEMY_LIGHT_COLLISION:15,ENEMY_HEAVY_COLLISION:30,ENEMY_MINE:25,ENEMY_MISSILE:30,STATIC_OBSTACLE:10,STATIC_OBSTACLE_SIDE:7},window.RaceCollisions={MISSILE:"RaceMissile",STATIC_OBSTACLE:"RaceStaticObstacle",STATIC_OBSTACLE_SIDE:"RaceStaticObstacleSide",CHASE_ENEMY:"RaceChaseEnemy",TANK:"RaceEnemy"},window.PlayerStats={COINS:"raceCoins",HEALTH:"raceHealth",SHIELD:"raceShield"}},function(t,e,i){"use strict";meta.class("Model.OasisProxy",{id:"OasisProxy",init:function(t){this.initArg(t)},initArg:function(t){for(var e in t)this[e]=t[e]},generateDuneLevel:function(){var t=DuneLevelConfig.slice(0);return new Data.DuneData({data:t})},generateGlobeLevel:function(){for(var t,e,i=[],s=0;s<10;s++)t=Math.floor(Math.random()*GlobeLevelConfig.length),e=GlobeLevelConfig[t].data,i.push(e);return new Data.GlobeData({data:i})},generateRaceLevel:function(){var t=1+Math.floor(3*Math.random()),e=RaceLevelConfig.slice(0);return new Data.RaceData({data:e,wreckingBallOn:t})}})},function(t,e,i){"use strict";window.DuneGunTypes={STANDARD:{id:"standard",numID:1,texture:"dune-player-walk-gun3",fireRate:.7,moveRate:10,damage:0,radius:0,muzzleFlash:"dune-fx-muzzle-v",muzzleX:44,muzzleY:50,bullet:"dune-fx-bullet-v",addCasing:!1,shoppe:"ui-gun-vgun",anim:"",price:0,sound:"sfx-dune-weapon-1"},MACHINEGUN:{id:"machinegun",numID:2,texture:"dune-player-walk-gun4",fireRate:.3,moveRate:15,damage:0,radius:0,muzzleFlash:"dune-fx-muzzle-rail",muzzleX:39,muzzleY:30,bullet:"dune-fx-bullet-rail",addCasing:!0,shoppe:"ui-gun-eraser",anim:"",price:150,sound:"sfx-dune-weapon-2"},RPG:{id:"rpg",numID:3,texture:"dune-player-walk-gun1",fireRate:1.2,moveRate:6,damage:0,radius:270,muzzleFlash:"dune-fx-muzzle-rpg",muzzleX:48,muzzleY:34,bullet:"dune-fx-bullet-rpg",addCasing:!0,shoppe:"ui-gun-rpg",anim:"",price:300,sound:"sfx-dune-weapon-3"},ARMOR_PIERCING:{id:"armorpiercing",numID:4,texture:"dune-player-walk-gun2",fireRate:1,moveRate:11,damage:0,radius:0,muzzleFlash:"dune-fx-muzzle-ripper",muzzleX:50,muzzleY:58,bullet:"dune-fx-bullet-ripper",addCasing:!0,shoppe:"ui-gun-ripper",anim:"",price:450,sound:"sfx-dune-weapon-4"}},window.DuneGunTypesArray=[DuneGunTypes.STANDARD,DuneGunTypes.MACHINEGUN,DuneGunTypes.RPG,DuneGunTypes.ARMOR_PIERCING],window.RaceVehiclesTypes={STANDARD:{id:"mysterymachine",numID:1,armor:1,pivotX:.46,turnX:.46,turnY:.5,shadowX:-35,shadowY:-82,turnRate:3,shoppe:"ui-car-mystery",price:0},UPGRADE_1:{id:"racecar",numID:2,armor:.9,pivotX:.45,turnX:.45,turnY:.5,shadowX:-50,shadowY:-75,turnRate:2,shoppe:"ui-car-racer",price:150},UPGRADE_2:{id:"batmobile",numID:3,armor:.6,pivotX:.45,turnX:.45,turnY:.5,shadowX:-34,shadowY:-80,turnRate:1,shoppe:"ui-car-batmobile",price:300},UPGRADE_3:{id:"thundercats",numID:4,armor:.3,pivotX:.45,turnX:.53,turnY:.35,shadowX:-60,shadowY:-104,turnRate:2,shoppe:"ui-car-tank",price:450}},window.RaceVehiclesTypesArray=[RaceVehiclesTypes.STANDARD,RaceVehiclesTypes.UPGRADE_1,RaceVehiclesTypes.UPGRADE_2,RaceVehiclesTypes.UPGRADE_3],meta.class("Model.ProgressProxy",{id:"ProgressProxy",current:0,max:0,coins:0,_playerData:null,_equippedWeapon:null,purchasedWeapons:[],_equippedVehicle:null,purchasedVehicles:[],set equippedVehicle(t){this._equippedVehicle=this.getVehicleByID(t.id),this.save()},get equippedVehicle(){return this._equippedVehicle},set equippedWeapon(t){this._equippedWeapon=this.getWeaponByID(t.id),this.save()},get equippedWeapon(){return this._equippedWeapon},init:function(t){this.initArg(t),null!==localStorage.getItem("rpo__coins")?(this.coins=parseInt(localStorage.getItem("rpo__coins")),this._equippedVehicle=JSON.parse(localStorage.getItem("rpo__equippedVehicle")),this._equippedWeapon=JSON.parse(localStorage.getItem("rpo__equippedWeapon")),this.purchasedVehicles=JSON.parse(localStorage.getItem("rpo__purchasedVehicles")),this.purchasedWeapons=JSON.parse(localStorage.getItem("rpo__purchasedWeapons"))):(this.coins=0,this.purchasedVehicles=[RaceVehiclesTypes.STANDARD],this.purchasedWeapons=[DuneGunTypes.STANDARD],this._equippedVehicle=this.purchasedVehicles[0],this._equippedWeapon=this.purchasedWeapons[0]),this.save()},initArg:function(t){for(var e in t)this[e]=t[e]},get playerData(){return this._playerData},get currentLevel(){return this.current},get maxLevels(){return this.max},save:function(){localStorage.setItem("rpo__equippedVehicle",JSON.stringify(this._equippedVehicle)),localStorage.setItem("rpo__equippedWeapon",JSON.stringify(this._equippedWeapon)),localStorage.setItem("rpo__purchasedVehicles",JSON.stringify(this.purchasedVehicles)),localStorage.setItem("rpo__purchasedWeapons",JSON.stringify(this.purchasedWeapons)),localStorage.setItem("rpo__coins",this.coins)},updateStats:function(){},getWeaponByID:function(t){for(var e=DuneGunTypesArray.length;--e>=0;)if(DuneGunTypesArray[e].id===t)return DuneGunTypesArray[e]},getVehicleByID:function(t){for(var e=RaceVehiclesTypesArray.length;--e>=0;)if(RaceVehiclesTypesArray[e].id===t)return RaceVehiclesTypesArray[e]},purchaseItem:function(t){var e;"gun"===t.catalogue?(e=this.getWeaponByID(t.id),this.purchasedWeapons.push(e),this._equippedWeapon=e):(e=this.getVehicleByID(t.id),this.purchasedVehicles.push(e),this._equippedVehicle=e),this.coins-=t.price,this.save()}})},function(t,e,i){"use strict";window.DuneLevelConfig=[{id:"0",data:[{triggerY:0,type:EnemyPatterns.LINE_C,class:"Character.DuneEnemy",num:4,fireRate:.65,side:1},{triggerY:400,type:EnemyPatterns.LINE_C,class:"Character.DuneEnemy",num:4,fireRate:.65,side:-1},{triggerY:700,type:EnemyPatterns.GRID,class:"Character.DuneEnemy",num:6,fireRate:.65,side:-1},{triggerY:900,type:EnemyPatterns.GRID,class:"Character.DuneEnemy",num:6,fireRate:.65,side:1}]},{id:"1",data:[{triggerY:0,type:EnemyPatterns.LINE_C,class:"Character.DuneEnemy",num:3,fireRate:.2,side:-1},{triggerY:400,type:EnemyPatterns.LINE_C,class:"Character.DuneEnemy",num:3,fireRate:.2,side:1}]},{id:"2",data:[{triggerY:0,type:EnemyPatterns.LINE_C,class:"Character.DuneEnemy",num:4,fireRate:.25,side:-1},{triggerY:300,type:EnemyPatterns.LINE_C,class:"Character.DuneEnemy",num:4,fireRate:.25,side:-1},{triggerY:600,type:EnemyPatterns.LINE_C,class:"Character.DuneEnemy",num:4,fireRate:.25,side:-1}]},{id:"3",data:[{triggerY:0,type:EnemyPatterns.LINE_C,class:"Character.DuneEnemy",num:4,fireRate:.25,side:1},{triggerY:300,type:EnemyPatterns.LINE_C,class:"Character.DuneEnemy",num:4,fireRate:.25,side:1},{triggerY:600,type:EnemyPatterns.LINE_C,class:"Character.DuneEnemy",num:4,fireRate:.25,side:1}]},{id:"4",data:[{triggerY:0,type:EnemyPatterns.CIRCLE_A,class:"Character.DuneEnemy",num:5,fireRate:.25,side:1},{triggerY:300,type:EnemyPatterns.CIRCLE_A,class:"Character.DuneEnemy",num:5,fireRate:.25,side:1}]},{id:"5",data:[{triggerY:0,type:EnemyPatterns.CIRCLE_B,class:"Character.DuneEnemy",num:8,fireRate:.4,side:1},{triggerY:500,type:EnemyPatterns.GRID,class:"Character.DuneEnemy",num:6,fireRate:.65,side:1},{triggerY:1e3,type:EnemyPatterns.CIRCLE_A,class:"Character.DuneEnemy",num:4,fireRate:.4,side:-1}]},{id:"5",data:[{triggerY:0,type:EnemyPatterns.GRID,class:"Character.DuneEnemy",num:4,fireRate:.7,side:1},{triggerY:400,type:EnemyPatterns.GRID,class:"Character.DuneEnemy",num:4,fireRate:.7,side:-1},{triggerY:1200,type:EnemyPatterns.LINE_C,class:"Character.DuneEnemy",num:5,fireRate:.4,side:1}]},{id:"6",data:[{triggerY:0,type:EnemyPatterns.GRID,class:"Character.DuneEnemy",num:2,fireRate:1,side:1},{triggerY:200,type:EnemyPatterns.GRID,class:"Character.DuneEnemy",num:3,fireRate:1,side:-1},{triggerY:400,type:EnemyPatterns.GRID,class:"Character.DuneEnemy",num:2,fireRate:1,side:1},{triggerY:600,type:EnemyPatterns.GRID,class:"Character.DuneEnemy",num:3,fireRate:1,side:-1}]},{id:"7",data:[{triggerY:0,type:EnemyPatterns.CIRCLE_A,class:"Character.DuneEnemy",num:4,fireRate:.65,side:-1},{triggerY:500,type:EnemyPatterns.CIRCLE_B,class:"Character.DuneEnemy",num:4,fireRate:.65,side:1},{triggerY:950,type:EnemyPatterns.GRID,class:"Character.DuneEnemy",num:6,fireRate:1.2,side:1},{triggerY:1350,type:EnemyPatterns.GRID,class:"Character.DuneEnemy",num:6,fireRate:1.2,side:-1}]},{id:"8",data:[{triggerY:0,type:EnemyPatterns.CIRCLE_A,class:"Character.DuneEnemy",num:4,fireRate:.65,side:-1},{triggerY:500,type:EnemyPatterns.CIRCLE_B,class:"Character.DuneEnemy",num:4,fireRate:.55,side:1},{triggerY:1400,type:EnemyPatterns.LINE_C,class:"Character.DuneEnemy",num:2,fireRate:.65,side:1},{triggerY:1300,type:EnemyPatterns.GRID,class:"Character.DuneEnemy",num:6,fireRate:.65,side:-1}]},{id:"9",data:[{triggerY:0,type:EnemyPatterns.GRID,class:"Character.DuneEnemy",num:4,fireRate:.65,side:-1},{triggerY:500,type:EnemyPatterns.CIRCLE_A,class:"Character.DuneEnemy",num:4,fireRate:.5,side:1},{triggerY:900,type:EnemyPatterns.GRID,class:"Character.DuneEnemy",num:6,fireRate:.65,side:1},{triggerY:1300,type:EnemyPatterns.LINE_B,class:"Character.DuneEnemy",num:3,fireRate:.65,side:-1}]},{id:"10",data:[{triggerY:0,type:EnemyPatterns.TANK,class:"Character.DuneTank",num:1,fireRate:2,side:-1}]},{id:"11",data:[{triggerY:0,type:EnemyPatterns.TANK,class:"Character.DuneTank",num:1,fireRate:2,side:-1},{triggerY:700,type:EnemyPatterns.TANK,class:"Character.DuneTank",num:1,fireRate:2,side:-1}]},{id:"12",data:[{triggerY:0,type:EnemyPatterns.TANK,class:"Character.DuneTank",num:1,fireRate:2,side:-1},{triggerY:1300,type:EnemyPatterns.LINE_C,class:"Character.DuneEnemy",num:4,fireRate:.65,side:1},{triggerY:1700,type:EnemyPatterns.LINE_C,class:"Character.DuneEnemy",num:4,fireRate:.65,side:-1}]},{id:"11",data:[{triggerY:0,type:EnemyPatterns.BOSS,class:"Character.DuneBoss",num:1,fireRate:.75,side:1}]}]},function(t,e,i){"use strict";meta.class("Data.DuneData",{data:null,init:function(t){this.initArg(t)},initArg:function(t){for(var e in t)this[e]=t[e]}})},function(t,e,i){"use strict";window.GlobeLevelConfig=[{data:[[0,0,0,1,0],[0,0,100,1,100],[0,0,0,1,0],[0,0,0,100,1],[0,0,0,0,1]]},{data:[[0,0,1,0,0],[0,0,1,100,0],[0,0,1,0,0],[0,0,1,100,0],[0,0,1,0,0]]},{data:[[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,0,1,0,0]]},{data:[[1,0,0,0,0],[1,0,0,0,0],[1,100,0,0,0],[1,100,0,0,0],[1,0,0,0,0]]},{data:[[0,0,0,1,0],[0,0,0,1,0],[0,1,0,0,0],[0,1,0,0,0],[0,1,0,0,0]]}]},function(t,e,i){"use strict";meta.class("Data.GlobeData",{data:null,init:function(t){this.initArg(t)},initArg:function(t){for(var e in t)this[e]=t[e]}})},function(t,e,i){"use strict";window.RaceLevelConfig=[{collision:[[0,0,0,0,0],[0,0,0,0,3],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[15,15,15,15,15],[15,15,15,15,15],[15,15,15,15,15],[14,16,14,16,14],[0,0,0,0,0]],item:[[0,{gid:20,delay:100,speed:5},0,0,0],[0,0,0,0,0],[0,30,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,30,0,0]]},{collision:[[0,0,0,0,0],[0,3,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,3,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],item:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,{gid:25,delay:1e3,speed:3},0,0,0]]},{collision:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],item:[[{gid:20,delay:1e3,speed:3},0,0,0,{gid:20,delay:300,speed:1}],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]},{collision:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],item:[[0,0,{gid:20,delay:100,speed:4},0,{gid:20,delay:1e3,speed:1}],[0,0,0,0,0],[0,0,30,0,0],[0,0,0,0,0],[0,0,0,0,0],[98,0,30,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,30,0,0],[0,0,0,0,0]]},{collision:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,1,0],[0,0,0,1,0],[0,0,0,1,0],[0,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[0,0,0,0,0]],item:[[0,{gid:20,delay:200,speed:6},{gid:20,delay:1500,speed:2},0,0],[0,0,0,0,98],[0,30,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,30,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]},{collision:[[0,0,0,0,0],[1,0,0,0,0],[1,0,0,0,5],[1,0,0,0,4],[0,0,0,0,5],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],item:[[0,0,{gid:20,delay:1200,speed:1},0,0],[0,0,0,0,0],[0,0,30,0,0],[0,0,0,30,0],[98,0,30,0,0],[0,0,0,30,0],[0,0,30,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]},{collision:[[0,0,0,0,0],[7,7,0,0,0],[6,5,0,0,0],[7,7,0,0,0],[0,0,0,0,0],[0,0,0,7,7],[0,0,0,5,6],[0,0,0,7,7],[0,0,0,0,0],[0,0,0,0,0]],item:[[{gid:20,delay:1200,speed:2},0,0,0,0],[0,0,0,0,0],[0,0,0,30,0],[0,0,0,0,0],[0,0,0,0,0],[0,98,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]},{collision:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[15,15,15,15,15],[15,15,15,15,15],[15,15,15,15,15],[16,14,14,14,16],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],item:[[{gid:20,delay:800,speed:3},30,0,98,{gid:20,delay:400,speed:2}],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]},{collision:[[0,0,30,0,0],[0,0,0,0,0],[7,7,0,0,7],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[7,7,0,7,7],[0,0,0,0,0],[0,0,0,0,0]],item:[[0,0,{gid:20,delay:0,speed:1},0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,30,0,0],[0,0,30,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]},{collision:[[0,0,0,0,0],[0,0,0,0,0],[5,0,0,0,6],[6,0,0,0,0],[5,6,0,0,0],[4,0,0,0,0],[5,0,0,0,0],[0,0,0,0,5],[0,0,0,0,0],[0,0,0,0,0]],item:[[0,0,30,{gid:20,delay:0,speed:2},0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,30,0,0],[0,0,30,0,0],[98,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]},{collision:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[5,6,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],item:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]},{collision:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],item:[[{gid:20,delay:900,speed:3},0,0,{gid:20,delay:0,speed:2},0],[0,0,0,0,0],[0,98,0,98,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]}]},function(t,e,i){"use strict";meta.class("Data.RaceData",{data:null,wreckingBallOn:-1,init:function(t){this.initArg(t)},initArg:function(t){for(var e in t)this[e]=t[e]}})},function(t,e,i){"use strict";window.ScreenConstants={ASSETS:"assets",HOME:"home",INTRO:"intro",STACKS:"stacks",GAME_DUNE:"gameDune",GAME_RACE:"gameRace",GAME_GLOBE:"gameGlobe",SHOPPE:"shoppe",GAME_UI:"gameUI",GAME_DUNE_UI:"gameDuneUI",GAME_GLOBE_UI:"gameGlobeUI",GAME_RACE_UI:"gameRaceUI",LOADER:"loader",PAUSE:"pauseWarning",RESPAWN:"respawn",ROTATE:"rotateWarning",TRANSITION:"transition",WIN:"win"}},function(t,e,i){"use strict"},function(t,e,i){"use strict";meta.class("View.Assets","View.BaseScreen",{build:function(){this.view=meta.createView(this.id);var t=new Resource.SVG;t.fillStyle="#00000",t.rect(0,0,meta.camera.width,meta.camera.height);var e=new Entity.Geometry(t);e.pivot(.5),e.anchor(.5),e.z=-10,this.view.attach(e);var i=new Entity.RaceWreckingBall({x:.5*meta.camera.width});this.view.attach(i),meta.subscribe(ScreenEventsChannel,this.onScreenEvent,this)},transitionIn:function(){},transitionOut:function(){},onScreenEvent:function(t,e){switch(e){case ScreenEvents.ENABLE:this.id===t&&this.transitionIn()}}})},function(t,e,i){"use strict";meta.class("View.BaseGame","View.BaseScreen",{IS_RETINA:!1,laneHalfWidth:0,lanePad:0,laneTransition:0,laneWidth:0,scrollRate:100,visibilityListener:null,bulletImpacts:null,cameraRig:null,explosionPool:null,ground:null,hero:null,levelBuilder:null,level:null,portal:null,tutorialText:null,countdown:null,musicID:null,transition:null,ui:null,minY:0,maxY:0,build:function(){this.basicBuild()},basicBuild:function(){this.view=meta.createView(this.id),this.IS_RETINA=(window.devicePixelRatio||1)>1,this.laneWidth=GameSettings.LANE_WIDTH,this.laneHalfWidth=.5*this.laneWidth,this.lanePad=GameSettings.LANE_PAD,this.laneTransition=GameSettings.LANE_TRANSITION,meta.subscribe(ScreenEventsChannel,this.onScreenEvent,this)},subscribeToEvents:function(){this.visibilityListener=document.addEventListener("visibilitychange",this.handleFocus),meta.subscribe(GameEventsChannel,this.onEvent,this),this.subscribeToInteractionEvents()},unsubscribeFromEvents:function(){document.removeEventListener("visibilitychange",this.handleFocus),this.visibilityListener=null,meta.unsubscribe(GameEventsChannel,this),this.unsubscribeFromInteraction()},subscribeToInteractionEvents:function(){meta.subscribe(Input.Event.DOWN,this.onInputDown,this)},unsubscribeFromInteraction:function(){meta.unsubscribe(Input.Event.DOWN,this)},addBulletImpacts:function(){},addCameraRig:function(){this.cameraRig=new Entity.CameraRig({hero:this.hero,game:this}),this.view.attach(this.cameraRig),meta.camera.follow(this.cameraRig),this.cameraRig.startFollow()},addDecals:function(){},addExplosionPool:function(){this.explosionPool=new Entity.EffectPool(Entity.Explosion)},addGround:function(){},addHero:function(){},addLevel:function(){},addPortal:function(){},addTransition:function(){null===this.transition&&(this.transition=Screens.findView(ScreenConstants.TRANSITION)),this.view.attachView(this.transition.view),this.transition.onResize(),this.transition.playIn()},addUI:function(){},saveCoins:function(){if(null!=this.ui){App.getProxy("ProgressProxy").coins=parseInt(this.ui.coins.text)}},startCountdown:function(){},startMusic:function(){null!==this.musicID&&Sounds.play(this.musicID,!0)},startLevel:function(){this.addGround(),this.addDecals(),this.addExplosionPool(),this.addBulletImpacts(),this.addHero(),this.addLevel(),this.addCameraRig(),this.addPortal(),this.addUI(),this.addTransition(),this.startMusic()},stopLevel:function(){this.cameraRig.stopFollow(),meta.camera.y=0,meta.camera.x=0,meta.camera._followEntity=null,this.ground.stopScroll(),this.stopMusic()},stopMusic:function(){null!==this.musicID&&Sounds.stop(this.musicID)},enable:function(){this.subscribeToEvents(),this.startLevel()},disable:function(){this.unsubscribeFromEvents()},onHeroDeath:function(){Screens.setView(ScreenConstants.SHOPPE)},onHeroDeathComplete:function(){},onPickup:function(t){switch(this.hero.handlePickup(t),t){case PlayerStats.COINS:meta.emit(GameEventsChannel,{coins:5,camX:this.cameraRig.absX,heroX:this.hero.absX,srcX:this.hero.lane,srcY:this.hero.absY},GameEvents.COIN_COLLECTED);break;case PlayerStats.HEALTH:meta.emit(GameEventsChannel,{health:this.hero.health,camX:this.cameraRig.absX,heroX:this.hero.absX,srcX:this.hero.lane,srcY:this.hero.absY},GameEvents.UPDATE_UI_HEALTH);break;case PlayerStats.SHIELD:}},onWin:function(){},onWinComplete:function(){},tearDownView:function(t){},onInputDown:function(t,e){null!==this.hero&&(t.keyCode===Input.Key.LEFT?this.hero.changeLane(-1):t.keyCode===Input.Key.RIGHT?this.hero.changeLane(1):t.keyCode!==Input.Key.BUTTON_LEFT&&1999!==t.keyCode||((this.IS_RETINA?t.x+t.screenX:t.x)<this.hero.lane*GameSettings.LANE_WIDTH-GameSettings.LANE_PAD?this.hero.changeLane(-1):this.hero.changeLane(1)),this.emitOnLaneChange&&meta.emit(GameEventsChannel,this.hero.lane,GameEvents.LANE_CHANGE))},emitOnLaneChange:!0,onEvent:function(t,e){switch(e){case GameEvents.HERO_DEATH:this.onHeroDeath();break;case GameEvents.PAUSE_FOLLOW:this.emitOnLaneChange=!1;break;case GameEvents.RESUME_FOLLOW:this.emitOnLaneChange=!0}},onScreenEvent:function(t,e){switch(e){case ScreenEvents.ENABLE:this.enabled=this.id===t}}})},function(t,e,i){"use strict";meta.class("View.BaseScreen",{id:null,view:null,isEnabled:null,cameraZoom:1,init:function(t){this.initArg(t),this.isEnabled=!1},initArg:function(t){for(var e in t)this[e]=t[e]},get enabled(){return this.isEnabled},set enabled(t){this.isEnabled=t,t?this.enable():this.disable()},enable:function(){this.isEnabled=!0},disable:function(){this.isEnabled=!1},handleFocus:function(){document.hidden||meta.emit(ScreenEventsChannel,null,ScreenEvents.SHOW_PAUSE)},handleBlur:function(){meta.emit(ScreenEventsChannel,null,ScreenEvents.SHOW_PAUSE)},build:function(){},clearTweens:function(){},transitionIn:function(){},transitionOut:function(){},onEvent:function(t,e){},subscribeToEvents:function(){this.visibilityListener=document.addEventListener("visibilitychange",this.handleFocus.bind(this)),this.blurListener=window.addEventListener("blur",this.handleBlur.bind(this))},unsubscribeFromEvents:function(){document.removeEventListener("visibilitychange",this.handleFocus),window.removeEventListener("blur",this.handleBlur),this.visibilityListener=null}})},function(t,e,i){"use strict";meta.class("View.GameDune","View.BaseGame",{enemyBulletHits:null,damageRadius:null,build:function(){this.basicBuild(),this.ui=new View.GameUI({id:ScreenConstants.GAME_DUNE_UI,gameView:this.view}),this.ui.build(),this.levelBuilder=new Utility.DuneLevelBuilder({game:this}),this.musicID="47_full_8-bits-racing-car-game-theme_0095"},addBulletImpacts:function(){this.bulletImpacts=new Entity.EffectPool(Entity.BulletHit),this.enemyBulletHits=new Entity.EffectPool(Entity.BulletHitEnemy),this.damageRadius=new Entity.DuneBlastRadius({x:-1e3,y:-1e3}),this.view.attach(this.damageRadius)},addDecals:function(){this.decals=new Entity.DuneDecals({z:-9}),this.view.attach(this.decals)},addGround:function(){this.ground=new Entity.Ground("dune-road-snow"),this.ground.options({tileX:1}),this.ground.height=1200,this.ground.scrollRate=this.scrollRate=250,this.ground.pivot(.5,0),this.ground.z=-10,this.view.attach(this.ground)},addHero:function(){var t=App.getProxy("ProgressProxy");this.hero=new Character.DuneHero({game:this,gunType:t.equippedWeapon,gameY:.5*meta.camera.height+300}),this.view.attach(this.hero)},addLevel:function(){App.getProxy("AnalyticsProxy").sendWorldEnter("dune");var t=App.getProxy("OasisProxy"),e=t.generateDuneLevel();this.level=this.levelBuilder.build(e),this.level.ground=this.ground,this.explosionPool.container=this.level.fxContainer,this.bulletImpacts.container=this.level.fxContainer,this.enemyBulletHits.container=this.level.fxContainer,this.level.decals=this.decals},addUI:function(){this.view.attachView(this.ui.view),this.ui.onResize()},onHeroDeath:function(){this.onLose()},onWin:function(t){Sounds.play("sfx-portal-entered"),this.saveCoins(),this.unsubscribeFromEvents(),meta.createTimer(this,function(){this.tearDownView(!0),t===GameSettings.PORTAL_RACE?Screens.setView(ScreenConstants.GAME_RACE):Screens.setView(ScreenConstants.GAME_GLOBE)},500,1).play(),this.transition.playOut()},onLose:function(){this.saveCoins(),this.hero.autoFire=!1,this.level.stop(),this.unsubscribeFromEvents(),meta.createTimer(this,function(){this.tearDownView(!0),Screens.setView(ScreenConstants.SHOPPE)},1500,1).play(),meta.createTimer(this,function(){this.transition.playOut()},1e3,1).play()},tearDownView:function(t){App.getProxy("AnalyticsProxy").sendWorldLeave("dune"),App.getProxy("ProgressProxy").save(),this.view.detachView(this.ui.view),this.view.detachView(this.transition.view),t&&this.view.remove(),this.stopLevel(),meta.camera._followEntity=null,meta.camera.y=0,meta.camera.bounds(GameSettings.cameraBounds.w,GameSettings.cameraBounds.h),this.hero.destroy(),this.level.destroy(),this.ground.destroy(),this.cameraRig.destroy(),this.hero.remove(),this.level.remove(),this.ground.remove(),this.cameraRig.remove(),this.damageRadius.remove(),this.hero=null,this.level=null,this.ground=null,this.cameraRig=null},onEvent:function(t,e){switch(e){case GameEvents.DUNE_LEVEL_LOSE:this.onHeroDeath();break;case GameEvents.PLACE_BULLET_HIT:Sounds.play("sfx-event-side-impact"),this.bulletImpacts.placeEffect(t);break;case GameEvents.PLACE_BULLET_HIT_ENEMY:Sounds.play("sfx-event-side-impact"),this.enemyBulletHits.placeEffect(t);break;case GameEvents.PLACE_EXPLOSION:t.type?Sounds.play("sfx-explosion-"+(t.type+1)):Sounds.play("sfx-explosion-1"),this.explosionPool.placeEffect(t);break;case GameEvents.PLACE_DAMAGE_RADIUS:this.damageRadius.place(t.x,t.y,t.radius,this.view.entities,t.damage);break;case GameEvents.DUNE_PORTAL_ENTERED:this.onWin(t);break;case GameEvents.DUNE_PICKUP:this.onPickup(t);break;case GameEvents.PAUSE_FOLLOW:this.emitOnLaneChange=!1;break;case GameEvents.RESUME_FOLLOW:this.emitOnLaneChange=!0}}})},function(t,e,i){"use strict";meta.class("View.GameGlobe","View.BaseGame",{build:function(){this.basicBuild(),this.ui=new View.GameUI({id:ScreenConstants.GAME_GLOBE_UI,gameView:this.view}),this.ui.build(),this.levelBuilder=new Utility.GlobeLevelBuilder({game:this}),this.musicID="47_full_8-bits-racing-car-game-theme_0095"},addBulletImpacts:function(){this.collectEffect=new Entity.EffectPool(Entity.BulletHitEnemy)},addDecals:function(){this.decals=new Entity.GlobeDecals({z:-4}),this.view.attach(this.decals)},addGround:function(){this.ground=new Entity.Ground("globe-floor1"),this.ground.options({tileX:3}),this.ground.height=1200,this.ground.scrollRate=this.scrollRate=500,this.ground.pivot(.5,0),this.ground.z=-5,this.view.attach(this.ground),this.ground.startScroll()},addHero:function(){this.hero=new Character.GlobeHero({texture:"globe-player-run",game:this,autoFire:!1,gameY:800}),this.view.attach(this.hero)},addLevel:function(){App.getProxy("AnalyticsProxy").sendWorldEnter("globe");var t=App.getProxy("OasisProxy"),e=t.generateGlobeLevel();this.level=this.levelBuilder.build(e),this.level.reset(),this.collectEffect.container=this.level.fxContainer,this.explosionPool.container=this.level.fxContainer,this.level.decals=this.decals},addUI:function(){this.view.attachView(this.ui.view),this.ui.onResize()},stopLevel:function(){this.cameraRig.stopFollow(),this.ground.stopScroll(),this.level.updating=!1},onHeroDeath:function(){this.onLose()},onLose:function(){this.saveCoins(),this.enabled=!1,this.stopLevel(),meta.createTimer(this,function(){this.tearDownView(!0),Screens.setView(ScreenConstants.SHOPPE)},500,1).play(),this.transition.playOut()},onWin:function(){Sounds.play("sfx-portal-entered"),this.saveCoins(),this.enabled=!1,this.stopLevel(),meta.createTimer(this,function(){this.tearDownView(!0),Screens.setView(ScreenConstants.GAME_DUNE)},500,1).play(),this.transition.playOut()},tearDownView:function(t){App.getProxy("AnalyticsProxy").sendWorldLeave("globe"),App.getProxy("ProgressProxy").save(),this.level.cleanUp(),this.stopMusic(),meta.camera._followEntity=null,meta.camera.y=0,meta.camera.bounds(GameSettings.cameraBounds.w,GameSettings.cameraBounds.h),this.view.detach(this.hero),this.view.detach(this.cameraRig),this.view.detach(this.decals),this.hero=null,this.cameraRig=null;for(var e=0;e<this.view.entities.length;e++)this.view.detach(this.view.entities[e]),this.view.entities[e]=null;this.explosionPool.cleanUp(),this.explosionPool=null,this.view.entities=[]},onEvent:function(t,e){switch(e){case GameEvents.HERO_DEATH:this.onHeroDeath();break;case GameEvents.PLACE_EXPLOSION:Sounds.play("sfx-explosion-1"),this.explosionPool.placeEffect(t);break;case GameEvents.PLACE_GLOBE_COLLECT_EFFECT:this.collectEffect.placeEffect(t);break;case GameEvents.GLOBE_LEVEL_LOSE:this.onLose();break;case GameEvents.GLOBE_LEVEL_WIN:case GameEvents.DUNE_PORTAL_ENTERED:this.onWin()}}})},function(t,e,i){"use strict";meta.class("View.GameRace","View.BaseGame",{playIntro:!1,sideImpacts:null,build:function(){this.basicBuild(),this.levelBuilder=new Utility.RaceLevelBuilder({game:this}),this.musicID="47_full_8-bits-racing-car-game-theme_0095"},addBulletImpacts:function(){this.bulletImpacts=new Entity.EffectPool(Entity.BulletHit),this.sideImpacts=new Entity.EffectPool(Entity.RaceCarSideHit)},addDecals:function(){this.decals=new Entity.RaceDecals({z:-9}),this.view.attach(this.decals)},addGround:function(){this.ground=new Entity.Ground("race-road1"),this.ground.options({tileX:1}),this.ground.height=1200,this.ground.scrollRate=this.scrollRate=650,this.ground.pivot(.5,0),this.ground.z=-10,this.view.attach(this.ground)},addHero:function(){var t=App.getProxy("ProgressProxy");this.hero=new Character.RaceHero({prefix:t.equippedVehicle.id,assetPivotX:t.equippedVehicle.pivotX,turnPivotX:t.equippedVehicle.turnX,turnPivotY:t.equippedVehicle.turnY,armor:t.equippedVehicle.armor,shadowX:t.equippedVehicle.shadowX,shadowY:t.equippedVehicle.shadowY,turnRate:t.equippedVehicle.turnRate,game:this,autoFire:!1,gameY:.5*meta.camera.height+300}),this.view.attach(this.hero)},addLevel:function(){App.getProxy("AnalyticsProxy").sendWorldEnter("race");var t=App.getProxy("OasisProxy"),e=t.generateRaceLevel();this.level=this.levelBuilder.build(e),this.level.addIntro(this.playIntro),this.level.reset(),this.playIntro&&this.unsubscribeFromInteraction(),this.level.ground=this.ground,this.explosionPool.container=this.level.fxContainer,this.bulletImpacts.container=this.level.fxContainer,this.sideImpacts.container=this.level.fxContainer,this.level.decals=this.decals,this.playIntro=!1,this.view.attach(this.level)},addUI:function(){null===this.ui&&(this.ui=new View.GameUI({id:ScreenConstants.GAME_RACE_UI,gameView:this.view}),this.ui.build()),this.view.attachView(this.ui.view),this.ui.onResize(),this.ui.hero=this.hero},stopLevel:function(){this.level.stopScroll(!0),this.unsubscribeFromEvents(),this.stopMusic()},onLose:function(){this.saveCoins(),this.stopLevel(),meta.createTimer(this,function(){this.tearDownView(!0),Screens.setView(ScreenConstants.SHOPPE)},1e3,1).play(),meta.createTimer(this,function(){this.transition.playOut()},500,1).play()},onWin:function(t){Sounds.play("sfx-portal-entered"),this.saveCoins(),this.stopLevel(),meta.createTimer(this,function(){this.tearDownView(!0),t===GameSettings.PORTAL_DUNE?Screens.setView(ScreenConstants.GAME_DUNE):Screens.setView(ScreenConstants.GAME_GLOBE)},500,1).play(),this.transition.playOut()},tearDownView:function(t){App.getProxy("AnalyticsProxy").sendWorldLeave("race"),App.getProxy("ProgressProxy").save(),this.view.detachView(this.ui.view),this.view.detachView(this.transition.view),this.hero.remove(),this.ground.remove(),this.decals.remove(),this.view.detach(this.level),this.level.destroy(),meta.camera._followEntity=null,meta.camera.y=0,meta.camera.bounds(GameSettings.cameraBounds.w,GameSettings.cameraBounds.h),this.hero.destroy(),this.ground.destroy(),this.cameraRig.remove(),this.hero=null,this.level=null,this.ground=null,this.cameraRig=null,meta.createTimer(this,function(){},1,1).play()},onEvent:function(t,e){switch(e){case GameEvents.PLACE_BULLET_HIT:Sounds.play("sfx-event-side-impact"),this.bulletImpacts.placeEffect(t);break;case GameEvents.PLACE_CAR_SIDE_HIT:Sounds.play("sfx-event-side-impact"),this.sideImpacts.placeEffect(t);break;case GameEvents.PLACE_EXPLOSION:this.explosionPool.placeEffect(t),Sounds.play("sfx-explosion-1");break;case GameEvents.RACE_GO_GO_GO:this.level.introGoGoGo();break;case GameEvents.RACE_LEVEL_LOSE:this.onLose();break;case GameEvents.RACE_PORTAL_ENTERED:this.onWin(t);break;case GameEvents.RACE_PICKUP:this.onPickup(t)}},onScreenEvent:function(t,e){switch(e){case ScreenEvents.ENABLE:this.enabled=this.id===t;break;case ScreenEvents.READY_RACE_INTRO:this.playIntro=t}}})},function(t,e,i){"use strict";meta.class("View.Home","View.BaseScreen",{background:null,logo:null,playButton:null,title:null,theaters:null,build:function(){this.view=meta.createView(this.id),this.background=new Entity.SimpleImage({texture:"ui-title-background",center:!0,centerOnScreen:!0,z:1}),this.logo=new Entity.Geometry({texture:"ui-title-logo",pivotY:0,pivotX:.5,anchorX:.5,anchorY:.46,z:2});var t=GameSettings.Strings.general,e=GameSettings.textType;this.strapline=new Entity.UILabel,this.strapline.color="white",this.strapline.pivot(.5,0),this.strapline.anchor(.5,.04),this.strapline.z=3,this.strapline.text=t.adventure,this.strapline.size=t["adventure"+e+"Size"],this.title=new Entity.Geometry({texture:"ui-title-firsttothekey",pivotX:.5,pivotY:0,anchorX:.5,anchorY:.705,z:4}),this.theaters=new Entity.UILabel,this.theaters.color="white",this.theaters.pivot(.5,1),this.theaters.anchor(.5,.96),this.theaters.z=5;var i=new Date,s=new Date(GameSettings.Strings.general.year,GameSettings.Strings.general.month,GameSettings.Strings.general.day);i.getTime()>=s.getTime()?(this.theaters.text=t.released,this.theaters.size=t["released"+e+"Size"]):(this.theaters.text=t.theaters,this.theaters.size=t["theaters"+e+"Size"]),this.playButton=new Entity.ClickableImage({texture:"ui-title-play",upState:"ui-title-play",downState:"ui-title-play-down",center:!0,anchorX:.5,anchorY:.86,eventChannel:HomeEventsChannel,clickEvent:HomeEvents.START_BUTTON,z:6,alpha:1});var n=new Entity.UILabel;n.anchor(.5),n.pivot(.5),n.color="#1180d8",n.text=t.play,n.size=t["play"+e+"Size"],n.y=t["play"+e+"Y"],n.z=7,this.playButton.attach(n),this.logo.scale(.9),this.strapline.scale(.9),this.title.scale(.9),this.theaters.scale(.9),this.playButton.scale(.9),this.view.attach(this.background),this.view.attach(this.logo),this.view.attach(this.strapline),this.view.attach(this.title),this.view.attach(this.theaters),this.view.attach(this.playButton),meta.createChannel(HomeEventsChannel),meta.subscribe(HomeEventsChannel,this.onEvent,this),meta.subscribe(ScreenEventsChannel,this.onScreenEvent,this)},showPlayButton:function(t){},clearTweens:function(){this.background.tween.clear(),this.logo.tween.clear(),this.strapline.tween.clear(),this.title.tween.clear(),this.theaters.tween.clear(),this.playButton.tween.clear()},transitionIn:function(){window.scrollTo(0,0),this.clearTweens(),App.getProxy("AnalyticsProxy").sendHome(),this.background.alpha=0,this.background.tween.to({alpha:1},500,this.transitionInComplete.bind(this)).play(),this.logo.y=-70,this.logo.alpha=0,this.logo.tween.wait(200).to({alpha:1,y:0},400).easing(meta.Tween.Easing.backOut).play(),this.strapline.y=-70,this.strapline.alpha=0,this.strapline.tween.wait(100).to({alpha:1,y:0},400).easing(meta.Tween.Easing.backOut).play(),this.theaters.y=70,this.theaters.alpha=0,this.theaters.tween.wait(300).to({alpha:1,y:0},600).easing(meta.Tween.Easing.backOut).play(),this.playButton.y=70,this.playButton.alpha=0,this.playButton.tween.wait(500).to({alpha:1,y:0},500).easing(meta.Tween.Easing.backOut).play(),Sounds.playMusic("144_full_old-scroll-game_0171",!0)},transitionInComplete:function(){this.enabled=!0},enable:function(){this.playButton.picking=!0,this.subscribeToEvents()},disable:function(){this.playButton.picking=!1,this.unsubscribeFromEvents()},handleStartButton:function(){this.transitionOut(),App.getProxy("AnalyticsProxy").sendInitialPlay(),meta.emit(GameEventsChannel,null,GameEvents.NEW_RUN),Sounds.play("sfx-button-play-now")},transitionOut:function(){this.enabled=!1,this.clearTweens(),this.background.tween.wait(150).to({alpha:0},550,this.transitionOutComplete.bind(this)).play(),this.logo.tween.wait(1).to({alpha:0},200).play(),this.strapline.tween.wait(1).to({alpha:0},100).play(),this.title.tween.wait(1).to({alpha:0},300).play(),this.theaters.tween.wait(1).to({alpha:0},200).play(),this.playButton.tween.wait(1).to({alpha:0},100).play()},transitionOutComplete:function(){Screens.setView(ScreenConstants.INTRO),this.tearDownView()},tearDownView:function(){this.view.detach(this.background),this.background=null},onEvent:function(t,e){if(this.isEnabled)switch(e){case HomeEvents.START_BUTTON:"up"===t&&this.handleStartButton()}},onScreenEvent:function(t,e){switch(e){case ScreenEvents.ENABLE:this.id===t&&this.transitionIn();break;case ScreenEvents.ROTATION_PORTRAIT:window.scrollTo(0,0)}}})},function(t,e,i){"use strict";meta.class("View.Intro","View.BaseScreen",{wade:null,goggles:null,collar:null,collarBack:null,transition:null,whiteOut:null,build:function(){this.view=meta.createView(this.id),this.wade=new Entity.Geometry({texture:"ui-wade-body",pivotX:.5,pivotY:.5,anchorX:.5,anchorY:.5,z:2}),this.goggles=new Entity.Geometry({texture:"ui-wade-goggles",pivotX:.5,pivotY:.5,anchorX:.5,anchorY:.3,z:3}),this.collar=new Entity.Geometry({texture:"ui-wade-scannertop",pivotX:.5,pivotY:.5,anchorX:.5,anchorY:.63,z:3}),this.collarBack=new Entity.Geometry({texture:"ui-wade-scannerback",pivotX:.5,pivotY:0,anchorX:.5,anchorY:.5,z:1}),this.transition=new Entity.TransitionEffect({orientation:"portrait"}),this.transition.container.anchor(.5),this.transition.container.z=-1,this.wade.attach(this.goggles),this.wade.attach(this.collar),this.view.attach(this.collarBack),this.view.attach(this.transition.container),this.view.attach(this.wade),meta.subscribe(ScreenEventsChannel,this.onScreenEvent,this)},removeAll:function(){},enable:function(){this.subscribeToEvents()},disable:function(){this.unsubscribeFromEvents()},transitionIn:function(){this.enabled=!0,this.wade.scale(1),this.wade.alpha=0,this.wade.tween.clear(),this.wade.tween.wait(500).to({alpha:1},1e3).play(),this.goggles.alpha=0,this.goggles.y=-350,this.goggles.tween.clear(),this.goggles.tween.wait(2e3).to({alpha:1},800).wait(1e3).to({y:0},1500,function(){Sounds.play("sfx-oasis-transition-goggles"),Sounds.play("sfx-oasis-transition-loop",!0)}).easing(meta.Tween.Easing.quadInOut).play(),this.collar.alpha=0,this.collar.y=-300,this.collar.tween.clear(),this.collar.tween.wait(2200).to({alpha:1},800).wait(700).to({y:0},1e3).easing(meta.Tween.Easing.quadInOut).play(),this.collarBack.alpha=0,this.collarBack.y=-314,this.collarBack.tween.clear(),this.collarBack.tween.wait(2200).to({alpha:1},800).wait(700).to({y:-14},1e3,function(){this.alpha=0}.bind(this)).easing(meta.Tween.Easing.quadInOut).play(),this.transition.scale(1),this.transition.container.alpha=0,this.transition.container.tween.clear(),this.transition.container.tween.wait(5300).to({alpha:1},150,function(){meta.createTimer(this,function(){this.transitionOut()},2e3,1).play()}.bind(this)).play(),App.getProxy("AnalyticsProxy").sendIntro()},transitionOut:function(){this.disable(),this.wade.tween.clear(),this.wade.tween.wait(0).to({alpha:0,scaleX:3,scaleY:3},500).easing(meta.Tween.Easing.quadIn).play(),this.transition.container.tween.clear(),this.transition.container.tween.to({alpha:0,scaleX:1.8,scaleY:1.8},500).easing(meta.Tween.Easing.quadIn).play(),meta.createTimer(this,this.transitionOutComplete,500,1).play(),null===this.whiteOut&&(this.whiteOut=Screens.findView(ScreenConstants.TRANSITION)),this.view.attachView(this.whiteOut.view),this.whiteOut.onResize(),this.whiteOut.playOut()},transitionInComplete:function(){},transitionOutComplete:function(){App.getProxy("AnalyticsProxy").sendRunStart(),Sounds.stop("sfx-oasis-transition-loop"),Sounds.stop("144_full_old-scroll-game_0171"),Sounds.stop("sfx-game-start"),this.view.detachView(this.whiteOut.view),this.whiteOut=null,meta.emit(ScreenEventsChannel,!0,ScreenEvents.READY_RACE_INTRO),Screens.setView(ScreenConstants.GAME_RACE)},onScreenEvent:function(t,e){switch(e){case ScreenEvents.ENABLE:this.id===t&&this.transitionIn()}}})},function(t,e,i){"use strict";meta.class("View.Loader","View.BaseScreen",{background:null,loaded:0,loaderBar:null,loaderBarMask:null,loaderBarBase:null,build:function(){this.view=meta.createView(this.id);var t=new Resource.SVG;t.resize(meta.camera.width,meta.camera.height),t.tileAuto("ui-preloader-bg",!0),this.background=new Entity.Geometry({texture:t,pivotX:.5,pivotY:.5,anchorX:.5,anchorY:.5}),this.loaderBarBase=new Entity.Geometry({texture:"ui-preloader-base",pivotX:.5,pivotY:.5,anchorX:.5,anchorY:.5}),this.loaderBar=new Entity.Geometry({texture:"ui-preloader-fill",pivotX:0,pivotY:.5,anchorX:0,anchorY:.5,x:4,y:-10,z:10});var e=new Resource.SVG;e.fillStyle="#322011",e.rect(0,0,540,52),this.loaderBarMask=new Entity.Geometry(e),this.loaderBarMask.pivot(0,.5),this.loaderBarMask.anchor(0,.5),this.loaderBarMask.x=4,this.loaderBarMask.y=-10,this.loaderBarMask.scaleX=0,this.loaderBar.clip(this.loaderBarMask),this.updateLoad(this.loaded),this.logo=new Entity.Geometry({texture:"ui-title-logo",pivotX:.5,pivotY:1,anchorX:.5,anchorY:.4,scaleX:.5,scaleY:.5}),this.title=new Entity.Geometry({texture:"ui-title-firsttothekey",pivotX:.5,pivotY:1,anchorX:.5,anchorY:.425,scaleX:.5,scaleY:.5}),this.loaderBarBase.attach(this.loaderBarMask),this.view.attach(this.background),this.view.attach(this.loaderBarBase),this.view.attach(this.logo),this.view.attach(this.title),this.loaderBarBase.attach(this.loaderBar),meta.createChannel(LoaderEventsChannel),meta.subscribe(LoaderEventsChannel,this.onEvent,this),meta.subscribe(ScreenEventsChannel,this.onScreenEvent,this)},updateLoad:function(t,e){this.loaderBarMask.tween.clear(),this.loaderBarMask.scaleX=t},loaderOut:function(){this.loaderBarBase.tween.to({y:300,alpha:0},800,this.outComplete).easing(meta.Tween.Easing.backIn).play()},outComplete:function(){Screens.setView(ScreenConstants.HOME),meta.device.mobile&&meta.rotationChecker()},enable:function(){this.isEnabled=!0},disable:function(){this.isEnabled=!1},onEvent:function(t,e){if(this.isEnabled)switch(e){case LoaderEvents.RESOURCE_LOADED:this.updateLoad(t.num,t.end)}},onScreenEvent:function(t,e){switch(e){case ScreenEvents.ENABLE:this.enabled=this.id===t}}})},function(t,e,i){"use strict";meta.class("View.Pause","View.BaseScreen",{bg:null,label:null,build:function(t){this.view=meta.createView(this.id),this.view.static=!0;var e=new Resource.SVG;e.fillStyle="#0f1217",e.fillRect(0,0,meta.camera.width,meta.camera.height),this.bg=new Entity.Geometry(e),this.bg.pivot(.5,.5),this.bg.anchor(.5,.5),this.bg.z=30001,this.bg.picking=!0,this.label=new Entity.UILabel,this.label.shadow=!1,this.label.pivot(.5),this.label.anchor(.5),this.label.color="#ffffff",this.label.scale0=this.label.scaleX,this.label.z=30002,this.view.attach(this.bg),this.view.attach(this.label),meta.subscribe(ScreenEventsChannel,this.onEvent,this)},handleResize:function(t,e){this.bg.scale(meta.camera.width*meta.camera.zoom,meta.camera.height*meta.camera.zoom),this.label.scale(meta.camera.zoom)},showPause:function(){meta.subscribe(meta.Event.CAMERA_RESIZE,this.handleResize,this),meta.engine.time.pause=!0;var t=new Resource.SVG;t.fillStyle="#0f1217",t.fillRect(0,0,meta.camera.width*meta.camera.zoom,meta.camera.height*meta.camera.zoom),this.bg.texture=t,this.label.text=meta.device.mobile?GameSettings.Strings.pauseScreen.resumeMobile:GameSettings.Strings.pauseScreen.resumeDesktop,this.label.size=GameSettings.Strings.pauseScreen["resume"+GameSettings.textType+"Size"],meta.attachView(this.view),this.label.scale(meta.camera.zoom),this.label.volume.maxX>.5*meta.camera.width&&this.label.scale(meta.camera.width/(this.label.volume.width+100)*meta.camera.zoom),this.label.scale0=this.label.scaleX,this.bg.owner=this,this.bg.onDown=function(){this.owner.hidePause()},this.handleResize()},hidePause:function(){meta.unsubscribe(meta.Event.CAMERA_RESIZE,this.handleResize),meta.engine.time.pause=!1,this.view.detachView()},onEvent:function(t,e){switch(e){case ScreenEvents.SHOW_PAUSE:this.showPause()}}})},function(t,e,i){"use strict";meta.class("View.Rotate","View.BaseScreen",{bg:null,label:null,build:function(t){this.view=meta.createView(this.id),this.view.static=!0;var e=new Resource.SVG;e.fillStyle="#0f1217",e.fillRect(0,0,500,500),this.bg=new Entity.Geometry(e),this.bg.pivot(.5,.5),this.bg.anchor(.5,.5),this.bg.z=30101,this.bg.picking=!0,this.label=new Entity.UILabel,this.label.shadow=!1,this.label.pivot(.5),this.label.anchor(.5),this.label.size=GameSettings.Strings.rotateWarning.rotateSize,this.label.font=GameSettings.Strings.settings.mainFont,this.label.color="#ffffff",this.label.z=30102,this.view.attach(this.bg),this.view.attach(this.label),this.onResize=function(t){this.label.position(0,0);var e=new Resource.SVG;e.fillStyle="#000000",e.fillRect(0,0,meta.camera.height,meta.camera.width),this.bg.texture=e,window.scrollTo(0,0)},this.onResize(),meta.camera.onResize.add(this.onResize,this)},setPortrait:function(t){this.bg.scale(meta.camera.zoom),this.label.text=GameSettings.Strings.rotateWarning.rotate,this.label.scale(meta.camera.zoom),this.bg.angle=t?90:0}})},function(t,e,i){"use strict";meta.class("View.Shoppe","View.BaseScreen",{isSnap:!1,buttonContinue:null,catalogueGun:null,catalogueCar:null,coins:null,coinsVal:null,confirm:null,wade:null,header:null,bgEffect:null,shareFacebook:null,shareTwitter:null,shareSnap:null,snapContent:null,build:function(){this.view=meta.createView(this.id),this.header=new Entity.Geometry({texture:"ui-header",pivotX:.5,pivotY:0,anchorX:.5,anchorY:0}),this.view.attach(this.header),this.coins=new Entity.Geometry({texture:"ui-element-coincount",x:20,y:20,z:10}),this.view.attach(this.coins),this.coinsVal=new Entity.UILabel,this.coinsVal.x=46,this.coinsVal.pivotY=.5,this.coinsVal.anchorY=.55,this.coinsVal.color="white",this.coins.attach(this.coinsVal),this.catalogueGun=new Entity.ShoppeCatalogue({catalogueType:"gun"}),this.view.attach(this.catalogueGun),this.catalogueGun.y=this.header.height,this.catalogueCar=new Entity.ShoppeCatalogue({catalogueType:"car"}),this.view.attach(this.catalogueCar),this.catalogueCar.y=this.catalogueGun.y+260,this.confirm=new Entity.ShoppeConfirm;var t=GameSettings.Strings.general,e=GameSettings.Strings.store,i=GameSettings.textType,s=new Entity.UILabel;s.anchor(.5),s.pivot(.5),s.color="#1180d8",s.text=t.play,s.size=e["play"+i+"Size"],s.y=e["play"+i+"Y"],s.z=7,this.buttonContinue=new Entity.Geometry({texture:"ui-button-play",pivotX:.5,pivotY:1,anchorX:.5,anchorY:1,z:2}),this.buttonContinue.label=s,this.buttonContinue.owner=this,this.buttonContinue.attach(s);var n=meta.camera.height-(this.catalogueCar.boundsY+(this.isSnap?160:0)),a=this.catalogueCar.boundsY+(this.isSnap?160:0)+.5*n;this.wade=new Entity.Geometry({texture:"ui-wade-body",pivotX:.5,pivotY:.5,anchorX:.5,y:a,z:0}),this.view.attach(this.wade);var h=new Entity.Geometry({texture:"ui-wade-goggles",pivotX:.5,pivotY:.5,anchorX:.5,anchorY:.3});this.wade.attach(h);var o=new Entity.Geometry({texture:"ui-wade-scannertop",pivotX:.5,pivotY:.5,anchorX:.5,anchorY:.63});this.wade.attach(o);var l=this.isSnap?360:520,r=n/l;n<l?(this.wade.scale(r),this.buttonContinue.scale(r),this.wade.y=this.catalogueCar.boundsY+(this.isSnap?160:0)+.5*(n-this.buttonContinue.height)+20*r):(this.wade.scale(1),this.buttonContinue.scale(1)),this.view.attach(this.buttonContinue),this.bgEffect=new Entity.TransitionEffect({orientation:"landscape",pivotX:.5,pivotY:.5,anchorX:.5,z:-1}),this.bgEffect.scale(r),this.bgEffect.y=a,this.view.attach(this.bgEffect.container);var c=GameSettings.Strings.share;if(this.isSnap){var u=new Resource.SVG;u.fillStyle="#000000",u.rect(0,0,meta.camera.width,160);var m=new Entity.Geometry({texture:u,pivotX:.5,anchorX:.5,z:10});m.y=this.catalogueCar.boundsY,this.view.attach(m),this.shareSnap=new Entity.ShareButton({texture:"ui-gameover-share-snapchat",callback:this.onShare.bind(this,"snap"),callbackDown:this.onSnapDown.bind(this,"snap"),label:c.shareSnap,textSize:c.shareSize,pivotX:.5,pivotY:.5,anchorX:.5,shareLabelY:c.shareLabelY,z:25}),this.shareSnap.y=m.y+m.volume.halfHeight,this.view.attach(this.shareSnap),this.snapContent=new Entity.Geometry({anchorX:.5});var d=new Entity.ShoppeSnapContent({catalogueType:"gun",z:20});this.snapContent.attach(d),this.snapContent.snapGun=d,d.y=this.header.height;var p=new Entity.ShoppeSnapContent({catalogueType:"car",z:20});this.snapContent.attach(p),this.snapContent.snapCar=p,p.y=d.boundsY,this.snapContent.hidden=!0,this.view.attach(this.snapContent)}else this.shareFacebook=new Entity.ShareButton({texture:"ui-gameover-share-facebook",callback:this.onShare.bind(this,"facebook"),pivotX:1,anchorX:1,z:25}),this.shareTwitter=new Entity.ShareButton({texture:"ui-gameover-share-twitter",callback:this.onShare.bind(this,"twitter"),pivotX:1,anchorX:1,z:25}),c.showFacebook&&this.view.attach(this.shareFacebook),c.showTwitter&&this.view.attach(this.shareTwitter),c.showFacebook&&!c.showTwitter?this.shareFacebook.x=-this.shareFacebook.halfW:!c.showFacebook&&c.showTwitter?this.shareTwitter.x=-this.shareTwitter.halfW:(this.shareTwitter.x=-this.shareTwitter.halfW,this.shareFacebook.x=this.shareTwitter.x-1.25*this.shareTwitter.volume.width);meta.createChannel(ShoppeEventsChannel),meta.subscribe(ShoppeEventsChannel,this.onEvent,this),meta.subscribe(ScreenEventsChannel,this.onScreenEvent,this),this.refresh()},refresh:function(){this.catalogueCar.enable(),this.catalogueGun.enable(),this.buttonContinue.label.refresh();var t=App.getProxy("ProgressProxy");if(this.coinsVal.text=t.coins,this.coinsVal.refresh(),this.coinsVal.scale(1),this.coinsVal.volume.maxX>this.coins.volume.maxX-10){var e=(this.coins.volume.maxX-this.coinsVal.volume.minX-10)/this.coinsVal.volume.width;this.coinsVal.scale(e)}},onSnapDown:function(t){this.catalogueCar.alpha=0,this.catalogueGun.alpha=0,this.wade.alpha=0,this.bgEffect.container.hidden=!0,this.buttonContinue.alpha=0,this.shareSnap.alpha=0,this.header.texture="ui-header-snap",this.snapContent.hidden=!1;var e=App.getProxy("ProgressProxy"),i=e._equippedVehicle.shoppe,s=e._equippedWeapon.shoppe;this.snapContent.snapCar.equipItem(i),this.snapContent.snapGun.equipItem(s),App.getProxy("AnalyticsProxy").sendGameShared(t)},onShare:function(t){switch(t){case"snap":this.catalogueCar.alpha=1,this.catalogueGun.alpha=1,this.wade.alpha=1,this.bgEffect.container.hidden=!1,this.buttonContinue.alpha=1,this.shareSnap.alpha=1,this.header.texture="ui-header",this.snapContent.hidden=!0;break;case"facebook":App.getProxy("ShareProxy").shareFB();break;case"twitter":App.getProxy("ShareProxy").shareTwitter()}},transitionIn:function(){App.getProxy("AnalyticsProxy").sendRunEnd(),meta.camera.y=0,meta.camera.x=0,this.header.alpha=0,this.header.tween.clear(),this.header.tween.wait(150).to({alpha:1},250,function(){this.tween.clear()}.bind(this.header)).play(),this.catalogueGun.transitionIn(250),this.catalogueCar.transitionIn(450),this.buttonContinue.alpha=0,this.buttonContinue.tween.clear(),this.buttonContinue.tween.wait(650).to({alpha:1},350,function(){this.tween.clear()}.bind(this.buttonContinue)).play(),this.bgEffect.container.alpha=0,this.wade.alpha=0,this.wade.tween.clear(),this.wade.tween.wait(500).to({alpha:1},500).play(),this.bgEffect.container.tween.clear(),this.bgEffect.container.tween.wait(600).to({alpha:1},750).play(),this.refresh(),this.enabled=!0,Sounds.play("144_full_old-scroll-game_0171",!0),this.isSnap&&(this.shareSnap.tween.clear(),this.shareSnap.alpha=0,this.shareSnap.tween.wait(500).to({alpha:1},700).play())},transitionOut:function(){App.getProxy("AnalyticsProxy").sendGameRestart(),App.getProxy("AnalyticsProxy").sendRunStart(),this.enabled=!1,Screens.setView(ScreenConstants.GAME_RACE),Sounds.stop("144_full_old-scroll-game_0171")},enable:function(){this.buttonContinue.onUp=function(t){this.texture="ui-button-play",this.owner.transitionOut(),meta.emit(GameEventsChannel,null,GameEvents.NEW_RUN),Sounds.play("sfx-button-play-now")},this.buttonContinue.onDown=function(t){this.texture="ui-button-play-down"},this.buttonContinue.picking=!0,this.isSnap?this.shareSnap.enableInteraction():(this.shareFacebook.enableInteraction(),this.shareTwitter.enableInteraction()),this.subscribeToEvents()},disable:function(){this.buttonContinue.onUp=null,this.buttonContinue.picking=!1,this.unsubscribeFromEvents(),this.isSnap?this.shareSnap.disableInteraction():(this.shareFacebook.disableInteraction(),this.shareTwitter.disableInteraction())},onEvent:function(t,e){switch(e){case ShoppeEvents.ITEM_SELECTED:case ShoppeEvents.CONFIRM_SHOW:this.confirm.enable(),this.confirm.setUpTransaction(t),this.confirm.transitionIn(),this.view.attach(this.confirm);break;case ShoppeEvents.CONFIRM_CLOSED:this.refresh()}},onScreenEvent:function(t,e){switch(e){case ScreenEvents.ENABLE:this.id===t&&this.transitionIn()}}})},function(t,e,i){"use strict";meta.class("AStar",{init:function(t,e,i,s){this.numOpenSize=4,this.open=new Array(this.numOpenSize),this.neighbors=new Array(4),t&&this.setup(t,e,i,s)},setup:function(t,e,i,s){if(t instanceof Entity.TilemapLayer){e instanceof Array&&(s=e);var n=t;t=n.data,e=n.tilesX,i=n.tilesY}this.data=t,this.cellsX=e,this.cellsY=i,s||(s=[0]),this.numNodes=t.length,this.nodes?this.nodes.length!==this.numNodes&&(this.nodes.length=this.numNodes):this.nodes=new Array(this.numNodes),this.walkableMap={};for(var a=s.length,h=0;h<a;h++)this.walkableMap[s[h]]=1;for(var o,l,r,c=0,u=0;u<i;u++)for(o=0;o<e;o++)l=t[c],void 0==l?this.nodes[c]=null:(r=this.nodes[c],r?(r.x=o,r.y=u):this.nodes[c]=new this.Node(o,u)),c++},search:function(t,e,i,s){this.searchIndex++;var n,a,h,o,l,r,c,u=this.getNode(t,e),m=this.getNode(i,s);if(!u)return null;if(!m)return null;for(this.numOpen=1,this.open[0]=u,u.parent=null,u.searchIndex=this.searchIndex,u.depth=0,u.g=0;this.numOpen>0;){if((n=this.open[--this.numOpen])===m)return this.generatePath(n);for(this.numOpen+4>=this.numOpenSize&&(this.numOpenSize*=2,this.open.length=this.numOpenSize),o=n.g+1,this.loadNeighbors(n.x,n.y),h=0;h<this.numNeighbors;h++)a=this.neighbors[h],(!a.visited||o<a.g)&&(a.parent=n,a.h=a.h||this.heuristic(a,m,0),a.g=o,a.f=a.g+a.h,a.searchIndex=this.searchIndex,a.depth=n.depth+1,a.visited=1,this.open[this.numOpen++]=a);for(l=0;l<this.numOpen;l++)for(h=l;h>0;h--)r=this.open[h],c=this.open[h-1],r.f>c.f&&(this.open[h]=c,this.open[h-1]=r)}return null},loadNeighbors:function(t,e){var i,s;this.numNeighbors=0,t-1!=-1&&(s=t-1+e*this.cellsX,i=this.nodes[s],i.searchIndex!==this.searchIndex&&this.walkableMap[this.data[s]]&&(i.h=0,i.g=0,i.visited=!1,this.neighbors[this.numNeighbors++]=i)),t+1!==this.cellsX&&(s=t+1+e*this.cellsX,i=this.nodes[s],i.searchIndex!==this.searchIndex&&this.walkableMap[this.data[s]]&&(i.h=0,i.g=0,i.visited=!1,this.neighbors[this.numNeighbors++]=i)),e-1!=-1&&(s=t+(e-1)*this.cellsX,i=this.nodes[s],i.searchIndex!==this.searchIndex&&this.walkableMap[this.data[s]]&&(i.h=0,i.g=0,i.visited=!1,this.neighbors[this.numNeighbors++]=i)),e+1!==this.cellsY&&(s=t+(e+1)*this.cellsX,i=this.nodes[s],i.searchIndex!==this.searchIndex&&this.walkableMap[this.data[s]]&&(i.h=0,i.g=0,i.visited=!1,this.neighbors[this.numNeighbors++]=i))},getNode:function(t,e){var i=t+e*this.cellsX;return i<0?null:i>=this.numNodes?null:this.nodes[i]},generatePath:function(t){for(var e=t.depth,i=new Array(e),s=0;s<e;s++)i[s]=t,t=t.parent;return i},Node:function(t,e){this.parent=null,this.searchIndex=0,this.depth=0,this.x=t,this.y=e,this.h=0,this.g=0,this.f=0,this.visited=0},Heuristic:{manhattan:function(t,e,i){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},euclidean:function(t,e,i){var s=t.x-e.x,n=t.y-e.y;return Math.sqrt(s*s+n*n)},diagonal:function(t,e,i,s){var n=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y),h=Math.min(n,a);return s*h+i*(n+a-2*h)}},heuristic:null,open:null,numOpen:0,numOpenSize:0,searchIndex:0,data:null,cellsX:0,cellsY:0,walkableMap:null,nodes:null,numNodes:0,neighbors:null,numNeighbors:0}),AStar.prototype.heuristic=AStar.prototype.Heuristic.euclidean},function(t,e,i){"use strict";meta.class("Entity.Background","Entity.Geometry",{cameraRig:null,cameraRange:0,heightRange:0,maxOffsetY:0,offsetY:0,camHeight:0,camHeightHalf:0,camHeightDoub:0,onCreate:function(t){var e=new Resource.SVG;e.resize(meta.camera.width,meta.camera.height),e.tileAuto(t.path,!0),this.background=new Entity.Geometry(e),this.attach(this.background)},addCameraRig:function(t){this.cameraRig=t,this.cameraRange=this.cameraRig.yMax-this.cameraRig.yMin,this.updating=!0},update:function(t){this.y=meta.camera.y}})},function(t,e,i){"use strict";meta.class("Character.BaseCharacter","Entity.Shadowed",{body:null,health:0,healthMax:0,isDead:!1,spritesheets:null,alignToFeet:function(){this.pivot(.5,1)},destroy:function(){},kill:function(){this.onKill()},onKill:function(){},playHitEffect:function(){},reduceHealth:function(t){return this.playHitEffect(),this.health-=t,this.health<=0},takeDamage:function(t){this.isDead=this.reduceHealth(t),this.isDead&&this.kill()}})},function(t,e,i){"use strict";meta.class("Entity.BulletHit","Entity.Geometry",{onCreate:function(t){this.texture="hit-outer",this.anim.loop=!1,this.anim.pauseLastFrame=!0,this.pivot(.5)},reset:function(){}})},function(t,e,i){"use strict";meta.class("Entity.CameraRig","Entity.Geometry",{playingIntro:!1,moveDist:0,panTime:0,xDiff:0,startX:0,time:0,targetY:0,yOffset:400,yMin:0,yMax:0,shaking:!1,shakeDur:0,endX:0,shakeFrame:!1,onCreate:function(t){this.anchor(0,.5),this.pivot(.5),this.endX=this.x,this.moveDist=GameSettings.LANE_WIDTH*GameSettings.CAMERA_MOVE_FACTOR,this.panTime=GameSettings.CAMERA_PAN_TIME,this.yMin=.5*meta.camera.height,this.yMax=2*meta.camera.height-this.yOffset,meta.subscribe(GameEventsChannel,this.onGameEvent,this)},destroy:function(){this.stopFollow(),this.playingIntro=null,this.moveDist=null,this.panTime=null,this.xDiff=null,this.startX=null,this.time=null,this.targetY=null,this.yOffset=null,this.yMin=null,this.yMax=null,this.shaking=null,this.shakeDur=null,this.endX=null},startFollow:function(){this.updating=!0},stopFollow:function(){this.updating=!1},moveToLane:function(t){this.shaking=!1,this.tween.stop(),this.tween.clear(),this.tween.to({x:(t-3)*this.moveDist},this.panTime,function(){this.tween.clear()}.bind(this)).easing("quadOut").play()},update:function(t){this.game.minY=this.y,this.game.maxY=this.y+meta.camera.height,this.shaking&&(this.shakeTime<this.shakeDur?(this.shakeTime+=t,this.shakeFrame&&this.position(this.startX+meta.random.number(-this.shakeAmp,this.shakeAmp),this.y),this.shakeFrame=!this.shakeFrame):(this.shaking=!1,this.position(this.startX,this.y)))},shake:function(t,e){this.shaking||(this.shaking=!0,this.shakeDur=t,this.shakeTime=0,this.startX=this.x,this.shakeAmp=e)},onGameEvent:function(t,e){switch(e){case GameEvents.LANE_CHANGE:this.moveToLane(t);break;case GameEvents.SHAKE_CAMERA:null!==t?this.shake(t.dur,t.dist):this.shake(.16,10)}}})},function(t,e,i){"use strict";meta.class("Entity.ClickableImage","Entity.SimpleImage",{upState:null,downState:null,onCreate:function(t){t&&(!0===t.center&&this.centerPivot(),t.centerOnScreen&&this.centerAnchors(),t.z?this.z=t.z:this.z=0,t.upState&&(this.upState=t.upState),t.downState&&(this.downState=t.downState),t.eventChannel&&t.clickEvent&&this.setUpClicks(t.eventChannel,t.clickEvent))},setUpClicks:function(t,e){this.eventChannel=t,this.clickEventID=e,this.onDown=function(t){this.texture=this.downState,meta.emit(this.eventChannel,"down",this.clickEventID)},this.onUp=function(t){this.texture=this.upState,meta.emit(this.eventChannel,"up",this.clickEventID)}},disable:function(){this.onClick=null,this.onDown=null,this.onUp=null},refresh:function(){this.texture=this.upState}})},function(t,e,i){"use strict";meta.class("Entity.EffectPool","Utility.Pool",{container:null,init:function(t){this.initArg(t),this.objectsCache=[],this.objectsInUse=[],this.addToPool(30,t)},placeEffect:function(t){var e=this.emit();void 0!=t.type&&e.setType(t.type),e.anim.reset(),e.x=t.x,e.y=t.y,e.z=t.z||5e3,t.scale&&e.scale(t.scale),t.flipX?e.flipX=-1:e.flipX=1,e.anim.onEnd=this.onAnimEnd.bind(this,e),e.owner=this,null!==this.container?(e.detachFrom=this.container,this.container.attach(e)):(e.detachFrom=t.container instanceof meta.View?"view":"parent",t.container.attach(e))},onAnimEnd:function(t){null!==this.container&&this.container.detach(t),this.recycle(t),t.anim.onEnd=null},cleanUp:function(){for(var t=this.objectsInUse.length,e=0;e<t;e++){var i=this.objectsInUse.splice(e,1);null!=i.view&&i.view.detach(i)}}})},function(t,e,i){"use strict";meta.class("Entity.Shadowed","Entity.Geometry",{shadow:null,onCreate:function(t){meta.resources.textures[t+"-shadow"]&&this._makeShadow(t)},_makeShadow:function(t,e,i,s){var n;null===this.shadow?(n=s?new Entity.Geometry(t):new Entity.Geometry(t+"-shadow"),s&&(n.alpha=.3),n.z=-3,this.attach(n),this.shadow=n):(n=this.shadow,n.texture=s?t:t+"-shadow"),e&&(n.x=e),i&&(n.y=i)}})},function(t,e,i){"use strict";meta.class("Entity.TextExt","Entity.Geometry",{onCreate:function(t){this.texture=new Resource.Texture,this._texture.resize(this._fontSize,this._fontSize),this._textBuffer=new Array(1),this.text=t},initArg:function(){},updateTxt:function(){var t,e,i,s=this._texture.ctx,n=0,a=0,h=0,o=this._textBuffer.length;if(this._bitmapFont){if(!this._bitmapFont.loaded)return;var l,r,c,u=this._bitmapFont.texture.canvas,m=this._bitmapFont.chars,d=null;for(i=this._bitmapFont.height,t=0;t<o;t++){for(c=this._textBuffer[t],l=c.length,r=0,e=0;e<l;e++)(d=m[c.charCodeAt(e)])&&(r+=d.kerning);r>n&&(n=r)}for(this._texture.clear(),this._texture.resize(n,i*o),t=0;t<o;t++){for(c=this._textBuffer[t],l=c.length,e=0;e<l;e++)(d=m[c.charCodeAt(e)])&&(d.width<1||d.height<1||(s.drawImage(u,d.x,d.y,d.width,d.height,a,h+d.offsetY,d.width,d.height),a+=d.kerning));h+=i,a=0}}else{s.font=this._style+" "+this._fontSizePx+" "+this._font;var p;for(t=0;t<o;t++)p=s.measureText(this._textBuffer[t]),p.width>n&&(n=p.width);this._shadow&&(n+=2*this._shadowBlur,a+=this._shadowBlur),i=1.3*this._fontSize;var f=i/("Noto Sans Thai"!=this._font)?10:2;for(h+=f,this._texture.resize(n,i*o+f*o+f),s.clearRect(0,0,this.volume.initWidth,this.volume.initHeight),s.font=this._style+" "+this._fontSizePx+" "+this._font,s.fillStyle=this._color,s.textBaseline="top",this._shadow&&(s.shadowColor=this._shadowColor,s.shadowOffsetX=this._shadowOffsetX,s.shadowOffsetY=this._shadowOffsetY,s.shadowBlur=this._shadowBlur),this._outline&&(s.lineWidth=this._outlineWidth,s.strokeStyle=this._outlineColor),t=0;t<o;t++)s.fillText(this._textBuffer[t],a,h),this._outline&&s.strokeText(this._textBuffer[t],a,h),h+=i}this.renderer.needRender=!0},set text(t){if(void 0!==t)if("number"==typeof t)this._text=t+"",this._textBuffer[0]=this._text;else{this._text=t;var e=t.indexOf("\n");-1!==e?this._textBuffer=t.split("\n"):this._textBuffer[0]=this._text}else this._text="",this._textBuffer[0]=this._text;this.updateTxt()},get text(){return this._text},set font(t){var e=meta.resources.fonts[t];if(e){if(this._bitmapFont=e,!e._loaded)return this._texture.clear(),void e.subscribe(this._onFontEvent,this)}else this._font=t,this._bitmapFont=null;this.updateTxt()},get font(){return this._font},set size(t){this._fontSize=t,this._fontSizePx=t+"px",this.updateTxt()},get size(){return this._fontSize},set color(t){this._color=t,this.updateTxt()},get color(){return this._color},set style(t){this._style!==t&&(this._style=t,this.updateTxt())},get style(){return this._style},set outlineColor(t){this._outlineColor!==t&&(this._outlineColor=t,this._outline=!0,this.updateTxt())},get outlineColor(){return this._outlineColor},set outlineWidth(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._outline=!0,this.updateTxt())},get outlineWidth(){return this._outlineWidth},set outline(t){this._outline!==t&&(this._outline=t,this.updateTxt())},get outline(){return this._outline},set shadow(t){this._shadow!==t&&(this._shadow=t,this.updateTxt())},get shadow(){return this._shadow},set shadowColor(t){this._shadowColor!==t&&(this._shadowColor=t,this._shadow=!0,this.updateTxt())},get shadowColor(){return this._shadowColor},set shadowBlur(t){this._shadowBlur!==t&&(this._shadowBlur=t,this._shadow=!0,this.updateTxt())},get shadowBlur(){return this._shadowBlur},set shadowOffsetX(t){this._shadowOffsetX!==t&&(this._shadowOffsetX=t,this._shadow=!0,this.updateTxt())},set shadowOffsetY(t){this._shadowOffsetY!==t&&(this._shadowOffsetY=t,this._shadow=!0,this.updateTxt())},get shadowOffsetX(){return this._shadowOffsetY},get shadowOffsetY(){return this._shadowOffsetY},_onFontEvent:function(t,e){this.updateTxt()},_bitmapFont:null,_text:"",_textBuffer:null,_font:"Tahoma",_fontSize:12,_fontSizePx:"12px",_color:"#fff",_style:"",_outline:!1,_outlineColor:"#000",_outlineWidth:1,_shadow:!0,_shadowColor:"#000",_shadowBlur:3,_shadowOffsetX:0,_shadowOffsetY:0})},function(t,e,i){"use strict";meta.class("Entity.TilemapLayer","Entity.Geometry",{updateFromData:function(){this.resize(this.tilesX*this.tileWidth+this.tileOffsetX,this.tilesY*this.tileHeight+this.tileOffsetY);var t=this._data.length;this._dataInfo?this._dataInfo.length!==t&&(this._dataInfo.length=t):this._dataInfo=new Array(t),this._tilesets=this.parent.tilesets,this._numTilesets=this._tilesets.length;for(var e=0;e<t;e++)this._updateDataInfoCell(e);this.renderer.needRender=!0},_updateDataInfoCell:function(t){var e=this._data[t];if(e){if(536870912&e||1073741824&e||2147483648&e){this._dataFlags||(this._dataFlags=new Uint32Array(this._data.length));var i=0;i|=536870912&e,i|=1073741824&e,i|=2147483648&e,this._dataFlags[t]=i,e&=536870911}for(var s=this._tilesets[0],n=1;n<this._numTilesets&&!(e<this._tilesets[n].gid);n++)s=this._tilesets[n];this._dataInfo[t]=s.getCell(e)}else this._dataInfo[t]=null},setGid:function(t,e,i){var s=t+e*this.tilesX;this._data[s]=i,this.parent.loaded&&(this._updateDataInfoCell(s),this.renderer.needRender=!0)},getGid:function(t,e){var i=t+e*this.tilesX;return i<0?0:i>=this.totalTiles?0:this.data[i]},getInfo:function(t,e){var i=t+e*this.tilesX;return i<0?null:i>=this.totalTiles?null:this._dataInfo[i]},getFlags:function(t,e){var i=t+e*this.tilesX;return i<0?null:i>=this.totalTiles?null:this._dataFlags[i]},saveData:function(){if(!this.data)return void console.warn("(Entity.Tilemap.saveData): No data available for saving");this.savedData?this.savedData.length!==this.totalTiles&&(this.savedData.length=this.totalTiles):this.savedData=new Uint32Array(this.totalTiles);for(var t=0;t<this.totalTiles;t++)this.savedData[t]=this.data[t]},restoreData:function(){if(!this.savedData)return void console.warn("(Entity.Tilemap.restoreData): No saved data available");if(this.savedData.length!==this.totalTiles)return console.warn("(Entity.Tilemap.restoreData): Incompatible data saved"),void(this.savedData=null);for(var t=0;t<this.totalTiles;t++)this.data[t]=this.savedData[t];this.updateFromData()},tileOffset:function(t,e){this.tileOffsetX=t,this.tileOffsetY=e,this.offset(t,-e)},set data(t){this._data=t,this.totalTiles=this.tilesX*this.tilesY,this.parent.flags&this.Flag.LOADED&&this.updateFromData()},get data(){return this._data},name:"Undefined",tilesX:0,tilesY:0,totalTiles:0,tileWidth:0,tileHeight:0,tileHalfWidth:0,tileHalfHeight:0,tileOffsetX:0,tileOffsetY:0,_data:null,_dataInfo:null,_dataFlags:null,_tilesets:null,_numTilesets:0}),meta.class("Entity.TilemapOrthoLayer","Entity.TilemapLayer",{gridFromPos:function(t,e){return[Math.floor((t-this.volume.minX)/this.tileWidth),Math.floor((e-this.volume.minY)/this.tileHeight)]},draw:function(t){if(0!=(this.parent.flags&this.Flag.LOADED)){var e=meta.camera.volume,i=Math.floor((e.minX-this.volume.minX)/this.tileWidth),s=Math.floor((e.minY-this.volume.minY)/this.tileHeight),n=Math.ceil((e.maxX-this.volume.minX)/this.tileWidth),a=Math.ceil((e.maxY-this.volume.minY)/this.tileHeight);i<0&&(i=0),s<0&&(s=0),n>this.tilesX&&(n=this.tilesX),a>this.tilesY&&(a=this.tilesY);var h,o=Math.floor(this.volume.minX+i*this.tileWidth),l=Math.floor(this.volume.minY+s*this.tileHeight),r=0,c=0|o,u=0|l;if(this._dataFlags)for(var m=0,d=s;d<a;d++){r=i+d*this.tilesX;for(var p=i;p<n;p++){if(h=this._dataInfo[r])if(m=this._dataFlags[r]){var f=1,g=1,y=0,E=0;t.save(),536870912&m?(t.rotate(Math.PI/2),2147483648&m&&1073741824&m?(f=-1,y=this.tileWidth,E=this.tileHeight):2147483648&m?E=this.tileWidth:1073741824&m?(f=-1,g=-1,y=this.tileWidth):g=-1):(2147483648&m&&(f=-1,y=this.tileWidth),1073741824&m&&(g=-1,E=this.tileHeight)),t.scale(f,g),t.drawImage(h.canvas,h.posX,h.posY,this.tileWidth,this.tileHeight,c*f-y,u*g-E,this.tileWidth,this.tileHeight),t.restore()}else t.drawImage(h.canvas,h.posX,h.posY,h.width,h.height,c,u,h.width,h.height);r++,c+=this.tileWidth}c=0|o,u+=this.tileHeight}else for(var d=s;d<a;d++){r=i+d*this.tilesX;for(var p=i;p<n;p++)h=this._dataInfo[r++],h&&t.drawImage(h.canvas,h.posX,h.posY,h.width,h.height,c,u,h.width,h.height),c+=this.tileWidth;c=o,u+=this.tileHeight}}}}),meta.class("Entity.TilemapIsoLayer","Entity.TilemapLayer",{gridFromPos:function(t,e){var i=t-this.tilesX*this.tileHalfWidth-(this.volume.x+this.offsetX),s=e-(this.volume.y-this.offsetY);return[Math.floor((s/this.tileHalfHeight+i/this.tileHalfWidth)/2),Math.floor((s/this.tileHalfHeight-i/this.tileHalfWidth)/2)]},draw:function(t){if(0!=(this.parent.flags&this.Flag.LOADED)){var e,i=(meta.camera.volume,0),s=this.tilesX,n=0,a=(this.tilesY,this.offsetY),h=0,o=0,l=0|a,r=.5*this.tileWidth,c=.5*this.tileHeight;i=0,n=0,s=this.tilesX,this.tilesY;var u=-1,m=1;if(u=0,m=0,this._dataFlags)for(var d=n;d<this.tilesY;d++){o=-d*r+(this.tilesX-1)*r+0,l=d*c-c+a;for(var p=i;p<s;p++)e=this._dataInfo[h++],e&&t.drawImage(e.canvas,e.posX,e.posY,e.width,e.height,o,l,e.width,e.height),o+=r,l+=c}else for(var d=n;d<this.tilesY;d++){o=this.tilesX*r-d*r-r,l=d*c+this.tileOffsetY;for(var p=i;p<this.tilesX;p++)e=this._dataInfo[h++],e&&t.drawImage(e.canvas,e.posX,e.posY,e.width,e.height,o,l-e.height+this.tileHeight,e.width,e.height),o+=r+u,l+=c+m}}}}),meta.class("Entity.Tilemap","Entity.Geometry",{initArg:function(t){t&&this.load(t)},load:function(t){if(!t)return void console.warn("(Entity.Tilemap.load): Invalid path specified");var e=t.lastIndexOf(".")+1,i=t.lastIndexOf("/"),s=t.substr(e);this.path=t,this.folderPath=t.substr(0,i+1),this.loaded=!1,this.tilesets=[];var n=this,a=this["_parse_"+s];if(!a)return void console.warn("(Entity.Tilemap.load): Unsupported file format: "+s);meta.resources.loadFile(t,function(t){a.call(n,t)})},create:function(t,e,i,s,n){this.tilesX=t,this.tilesY=e,this.tileWidth=i,this.tileHeight=s,this.type=n||"orthogonal",this.resize(t*i,e*s),this.tilesets=[],this.detachAll()},createTileset:function(t,e,i,s,n,a){if(t<1)return void console.warn("(Entity.Tilemap.createTileset): gid argument should be 1 or larger number");var h=new meta.Tileset(this,t,e,i||0,s||0,n,a);this.tilesets.push(h)},createLayer:function(t,e,i,s){var n;switch(this.type){case this.Type.ORTHOGONAL:n=new Entity.TilemapOrthoLayer;break;case this.Type.ISOMETRIC:n=new Entity.TilemapIsoLayer}return n.tilesX=t,n.tilesY=e,n.tileWidth=this.tileWidth,n.tileHeight=this.tileHeight,n.tileHalfWidth=.5*this.tileWidth,n.tileHalfHeight=.5*this.tileHeight,this.attach(n),n.data=i,s&&(n.name=s),n},finishLoading:function(){for(var t,e,i=0,s=this.tilesets.length,n=0;n<s;n++)t=this.tilesets[n],(e=t.tileHeight-this.tileHeight)>i&&(i=e);if(this.children)for(s=this.children.length,n=0;n<s;n++){var a=this.children[n];a instanceof Entity.TilemapLayer&&(a.tileOffset(0,i),a.updateFromData())}this.loaded=!0},_parse_json:function(t){var e=JSON.parse(t);this.create(e.width,e.height,e.tilewidth,e.tileheight);for(var i,s=e.tilesets,n=s.length,a=0;a<n;a++)i=s[a],this.createTileset(i.firstgid,this.folderPath+i.image,i.tileWidth,i.tileHeight);var h,o,l=e.layers;for(n=l.length,a=0;a<n;a++)o=l[a],h=this.createLayer(o.width,o.height,o.data,o.name),o.visible&&(h.visible=o.visible);0===this.numToLoad&&(this.loaded=!0)},_parse_tmx:function(t){var e=new DOMParser,i=e.parseFromString(t,"text/xml"),s=i.documentElement;this.create(parseInt(s.getAttribute("width")),parseInt(s.getAttribute("height")),parseInt(s.getAttribute("tilewidth")),parseInt(s.getAttribute("tileheight")),s.getAttribute("orientation"));for(var n=s.childNodes,a=n.length,h=0;h<a;h++)s=n[h],1===s.nodeType&&("tileset"===s.nodeName?this._parse_tmx_tileset(s):"layer"===s.nodeName?this._parse_tmx_layer(s):s.nodeName);0===this.numToLoad&&(this.loaded=!0)},_parse_tmx_tileset:function(t){for(var e,i="",s=t.childNodes,n=s.length,a=0;a<n;a++)e=s[a],1===e.nodeType&&"image"===e.nodeName&&(i=this.folderPath+e.getAttribute("source"));var h=t.getAttribute("spacing"),o=h?parseInt(h):0,l=t.getAttribute("margin"),r=l?parseInt(l):0;this.createTileset(parseInt(t.getAttribute("firstgid")),i,parseInt(t.getAttribute("tilewidth")),parseInt(t.getAttribute("tileheight")),r,o)},_parse_tmx_layer:function(t){var e=t.getAttribute("name"),i=parseInt(t.getAttribute("width")),s=parseInt(t.getAttribute("height")),n=!0;t.getAttribute("visible")&&(n=parseInt(n));var a,h=t.firstElementChild,o=h.getAttribute("encoding"),l=this.tilesX*s;if(o){var r=null;if("csv"===o){if(r=h.textContent.split(","),r.length!==l)return void console.warn("(Entity.Tilemap._parse_tmx): Layer resolution does not match with data size");a=new Uint32Array(l);for(var l=i*s,c=0;c<l;c++)a[c]=parseInt(r[c])}else{if("base64"!==o)return void console.warn("(Entity.Tilemap._parse_tmx): Unsupported layer encoding used: "+o);var u=h.getAttribute("compression");if(u)return void console.warn("(Entity.Tilemap._parse_tmx): Unsupported compression - "+u);a=meta.decodeBinaryBase64(h.textContent)}}else{var m=0,d=h.childNodes;for(l=d.length,a=new Uint32Array(l),c=0;c<l;c++)t=d[c],1===t.nodeType&&(a[m++]=parseInt(t.getAttribute("gid")))}this.createLayer(i,s,a,e).hidden=!n},getLayer:function(t){if(!t)return null;if(!this.children)return null;for(var e=this.children.length,i=0;i<e;i++)if(this.children[i].name===t)return this.children[i];return null},Type:{UNKNOWN:"",ORTHOGONAL:"orthogonal",ISOMETRIC:"isometric",HEXAGONAL:"hexagonal"},LayerFlag:{FLIP_HORIZONTALLY:2147483648,FLIP_VERTICALLY:1073741824,FLIP_DIAGONALLY:536870912},tilesets:null,path:"",folderPath:"",numToLoad:0,tilesX:0,tilesY:0,tileWidth:0,tileHeight:0,type:"orthogonal"}),meta.Tileset=function(t,e,i,s,n,a,h){this.parent=t,this.gid=e,this.tileWidth=s,this.tileHeight=n,this.margin=a||0,this.spacing=h||0,this.tilesX=0,this.tilesY=0,this._texture=null,this.cells=null,this.texture=i},meta.Tileset.prototype={_onTextureEvent:function(t,e){e===Resource.Event.LOADED&&(t.unsubscribe(this),this.updateTexture(),0===--this.parent.numToLoad&&this.parent.finishLoading())},updateTexture:function(){0===this.tileWidth?(this.tileWidth=this._texture.fullWidth,this.tilesX=1):this.tilesX=this._texture.fullWidth/this.tileWidth|0,0===this.tileHeight?(this.tileHeight=this._texture.fullHeight,this.tilesY=1):this.tilesY=this._texture.fullHeight/this.tileHeight|0,this.cells=new Uint32Array(this.tilesX*this.tilesY)},getCell:function(t){t-=this.gid;var e=this.cells[t];if(e)return e;var i=t%this.tilesX,s=t/this.tilesX|0,n=i*this.tileWidth+i*(2*this.margin)+this.margin,a=s*this.tileHeight+s*(2*this.margin)+this.margin;return e=new this.Cell(this._texture.canvas,n,a,this.tileWidth,this.tileHeight),this.cells[t]=e,e},set texture(t){if(t instanceof Resource.Texture)this._texture=t;else{var e=t.lastIndexOf("."),i=t.lastIndexOf("/");-1===i&&(i=0);var s=t.substr(i+1,e-i-1),n=meta.resources.textures[s];n||(n=new Resource.Texture(t)),this._texture=n}this._texture._loaded?this.updateTexture():(this.parent.numToLoad++,this.parent.flags&=~this.parent.Flag.LOADED,this._texture.subscribe(this._onTextureEvent,this))},get texture(){return this._texture},Cell:function(t,e,i,s,n){this.canvas=t,this.posX=e,this.posY=i,this.width=s,this.height=n}}},function(t,e,i){"use strict";meta.class("Entity.Explosion","Entity.Geometry",{types:["all-fx-explode1","all-fx-explode2","all-fx-explode3"],onCreate:function(t){this.texture="all-fx-explode2",this.anim.loop=!1,this.anim.pauseLastFrame=!0,this.pivot(.5)},setType:function(t){this.texture=this.types[t]},reset:function(){}})},function(t,e,i){"use strict";meta.class("Entity.Ground","Entity.Tiling",{d:0,game:null,scrollRate:100,onCreate:function(t){var e=(meta.camera.volume,new Resource.Texture);e.ctx.globalCompositeOperator="copy",this.texture=e,this.tile(t)},destroy:function(){this.d=null,this.game=null,this.scrollRate=null,this.texture=null},startScroll:function(){this.updating=!0},stopScroll:function(){this.updating=!1},extUpdate:function(t){this.d+=t,this.scroll(0,this.d)},update:function(t){this.d+=t*this.scrollRate,this.scroll(0,this.d)}})},function(t,e,i){"use strict";meta.class("Entity.Portal","Entity.Geometry",{active:!1,centerEvent:null,onCreate:function(t){this.setUpInit()},destroy:function(){this.active=null,this.centerEvent=null,this.texture=null,meta.unsubscribe(GameEventsChannel,this)},reset:function(){},assign:function(t,e,i,s,n,a){},setUpInit:function(){this.pivot(.5,1),this.z=4,this.hidden=!0,meta.subscribe(GameEventsChannel,this.onEvent,this)},setUp:function(){this.hidden=!1,this.active=!0,this.y=-200},update:function(t,e){this.active&&(this.y+=t,this.y>.5*meta.camera.height&&meta.emit(GameEventsChannel,null,this.centerEvent))},onEvent:function(t,e){}})},function(t,e,i){"use strict";meta.class("Procedural.Generator",{gen:function(t,e){this.cellsX=t,this.cellsY=e,this.cellsX<4&&(this.cellsX=4),this.cellsY<4&&(this.cellsY=4),this.data=new Uint32Array(t*e),this.rooms=[];var i=this.cellsX/2|0,s=this.cellsY/2|0;this._makeRoom(i,s,10,10,meta.random.number(0,3));var n=this.rooms[0];this.centerCellX=n.minX+Math.floor((n.maxX-n.minX)/2),this.centerCellY=n.minY+Math.floor((n.maxY-n.minY)/2);for(var a=0;a<this.numTries;a++){var h,o,l=meta.random.number(0,this.numRooms-1),r=this.rooms[l],c=meta.random.number(0,3);switch(c){case 0:h=meta.random.number(r.minX+1,r.maxX-1),o=r.minY;break;case 1:h=meta.random.number(r.minX+1,r.maxX-1),o=r.maxY;break;case 2:h=r.minX,o=meta.random.number(r.minY+1,r.maxY-1);break;case 3:h=r.maxX,o=meta.random.number(r.minY+1,r.maxY-1)}if(meta.random.number(0,99)<25){if(!this._makeCorridor(h,o,9,c))continue}else if(!this._makeRoom(h,o,10,10,c))continue;this.data[h+o*this.cellsX]=1}},_makeRoom:function(t,e,i,s,n){var a,h,o=meta.random.number(3,i),l=meta.random.number(3,s);switch(n){case 0:a=t-(o/2|0),h=e-l+1;break;case 1:a=t-(o/2|0),h=e;break;case 2:a=t-o+1,h=e-(l/2|0);break;case 3:a=t,h=e-(l/2|0)}return!!this._isAreaFree(a,h,o,l)&&(this._buildArea(a,h,o,l),!0)},_makeCorridor:function(t,e,i,s){var n,a,h=meta.random.number(6,i);switch(s){case 0:if(n=t-1,a=e-h+1,!this._isAreaFree(n,a,3,h))return!1;this._buildArea(n,a,3,h);break;case 1:if(n=t-1,a=e,!this._isAreaFree(n,a,3,h))return!1;this._buildArea(n,a,3,h);break;case 2:if(n=t-h+1,a=e-1,!this._isAreaFree(n,a,h,3))return!1;this._buildArea(n,a,h,3);break;case 3:if(n=t,a=e-1,!this._isAreaFree(n,a,h,3))return!1;this._buildArea(n,a,h,3)}return!0},_isAreaFree:function(t,e,i,s){if(t<0)return!1;if(e<0)return!1;var n=t+i,a=e+s;if(n>=this.cellsX)return!1;if(a>=this.cellsY)return!1;for(var h,o=e;o<a;o++){h=t+o*this.cellsX;for(var l=t;l<n;l++)if(1===this.data[h++])return!1}return!0},_buildArea:function(t,e,i,s){var n,a,h,o=t+i-1,l=e+s-1;for(a=e;a<=l;a++)for(h=t+a*this.cellsX,n=t;n<=o;n++)this.data[h++]=n===t||a===e||n===o||a===l?2:1;this.rooms.push(new this.Room(t,e,o,l)),this.numRooms++},Room:function(t,e,i,s){this.minX=t,this.minY=e,this.maxX=i,this.maxY=s},data:null,rooms:null,cellsX:0,cellsY:0,centerCellX:0,centerCellY:0,numTries:3e3,numRooms:0})},function(t,e,i){"use strict";meta.class("Entity.ResultHeader","Entity.Geometry",{onCreate:function(){this.pivot(.5,0),this.anchor(.5),this.y=-486,this.y0=-486,this.y1=-386,this.z=2}})},function(t,e,i){"use strict";meta.class("Entity.SimpleImage","Entity.Geometry",{onCreate:function(t){t&&(!0===t.center&&this.centerPivot(),t.centerOnScreen&&this.centerAnchors(),t.z?this.z=t.z:this.z=0,t.x&&(this.x=t.x),t.y&&(this.y=t.y))},centerPivot:function(){this.pivot(.5)},centerAnchors:function(){this.anchor(.5)}})},function(t,e,i){"use strict";meta.class("Entity.UIGeometry","Entity.Geometry",{startX:0,startY:0,newScaleX:1,newScaleY:1,onCreate:function(t){},refresh:function(){},updateScaleX:function(t){this.newScaleX=t},updateScaleY:function(t){this.newScaleY=t},updateToZoom:function(t){this.scale(t*this.newScaleX,t*this.newScaleY),this.x=this.startX*t,this.y=this.startY*t}})},function(t,e,i){"use strict";meta.class("Entity.UILabel","Entity.TextExt",{startX:0,startY:0,onCreate:function(t){this.texture=new Resource.Texture,this._texture.resize(this._fontSize,this._fontSize),this._textBuffer=new Array(1),this.text=t,this.size=16,this.color="red",this.font=GameSettings.Strings.settings.mainFont,this.shadow=!1},refresh:function(){var t=this.text;this.text=t},updateToZoom:function(t){this.scale(t),this.x=this.startX*t,this.y=this.startY*t}})},function(t,e,i){"use strict";meta.component("Component.DuneSquadPattern",{pattern:null,onAdd:function(){},set game(t){this.pattern.game=t},get game(){return this.pattern.game},setPattern:function(t,e){switch(t){case EnemyPatterns.BOSS:this.pattern=new Enemy.PatternBoss({members:this.owner.members,owner:this.owner}),this.owner.bufferY=400;break;case EnemyPatterns.CIRCLE_A:this.pattern=new Enemy.PatternCircleA({members:this.owner.members,owner:this.owner}),this.owner.bufferY=260;break;case EnemyPatterns.CIRCLE_B:this.pattern=new Enemy.PatternCircleB({members:this.owner.members,owner:this.owner}),this.owner.bufferY=320;break;case EnemyPatterns.LINE_A:this.pattern=new Enemy.PatternLineA({members:this.owner.members,owner:this.owner}),this.owner.bufferY=200;break;case EnemyPatterns.LINE_B:this.pattern=new Enemy.PatternLineB({members:this.owner.members,owner:this.owner}),this.owner.bufferY=200;break;case EnemyPatterns.LINE_C:this.pattern=new Enemy.PatternLineC({members:this.owner.members,owner:this.owner}),this.owner.bufferY=100;break;case EnemyPatterns.GRID:this.pattern=new Enemy.PatternGrid({members:this.owner.members,owner:this.owner}),this.owner.bufferY=400;break;case EnemyPatterns.TANK:this.pattern=new Enemy.PatternTank({members:this.owner.members,owner:this.owner}),this.owner.bufferY=300}this.pattern.setSide(e)},onUpdate:function(t){this.pattern.animate(t)}})},function(t,e,i){"use strict";meta.class("Component.LaneCollision",{_target:null,collided:!1,checkCollision:!1,distY:0,lane:null,targetY:0,set target(t){this._target=t,this.targetY=this._target.y+this._target.totalOffsetY},reset:function(){this.collided=!1,this.checkCollision=!0,this.distY=0,this.lane=-1,this.targetY=0},onLoad:function(){this.distY=0,this.lane=this.owner.lane,this.target=this.owner.game.hero},onUnload:function(){this._target=null,this.collided=null,this.checkCollision=null,this.distY=null,this.lane=null,this.targetY=null},onUpdate:function(t){this.collided||this.checkCollision&&this._target.lane===this.lane&&(this.distY=this.targetY-(this.owner.y+this.owner.totalOffsetY),this.distY<-5?this.checkCollision=!1:this.distY<90&&(this.collided=!0,this.checkCollision=!1,this.owner.onCollision()))}})},function(t,e,i){"use strict";meta.class("Component.LaneMovement",{ease:null,reset:function(){},onLoad:function(){this.ease=meta.Tween.Easing.quadInOut},onUnload:function(){},onUpdate:function(t){},resetLane:function(t){this.owner.tween.clear(),this.owner.lane=t||3,this.owner.position(this.getLaneX(),this.owner.gameY),this.owner.changingLanes=!1},getLaneX:function(){return this.owner.lane*this.owner.game.laneWidth-this.owner.game.lanePad},startLaneChanging:function(){this.owner.tween.clear(),this.owner.changingLanes=!0},endLaneChanging:function(){this.owner.tween.clear(),this.owner.changingLanes=!1},moveToLane:function(t,e){if(this.startLaneChanging(),this.owner.lane!==t){var i=Math.abs(t-this.owner.lane);this.owner.lane=t;var s=500*i;e&&(s=e),this.owner.tween.to({x:this.getLaneX()},s,this.onMoveComplete.bind(this)).easing(this.ease).play()}},onMoveComplete:function(){this.endLaneChanging()},animateToY:function(t,e,i){this.endLaneChanging(),this.owner.tween.to({y:t,angle:e},i).easing(this.ease).play()}})},function(t,e,i){"use strict";meta.class("Component.RaceMovement",{reset:function(){},onLoad:function(){},onUnload:function(){},onUpdate:function(t){},changeLane:function(t){if(this.owner.lane=this.owner.lane+t,this.owner.lane>5)return void(this.owner.lane=5);if(this.owner.lane<1)return void(this.owner.lane=1);this.owner.tween.clear(),this.owner.changingLanes=!0;var e=this.owner.game.laneTransition*(t>0?t:-t)*this.owner.turnRate,i=this.owner.lane*this.owner.game.laneWidth-this.owner.game.lanePad;this.owner.tween.to({x:i},e,this.onChangeLaneComplete.bind(this)).easing("quadOut").play()},onChangeLaneComplete:function(){this.owner.angle=0,this.owner.tween.clear(),this.owner.changingLanes=!1,this.owner.reactingToCollision=!1,this.owner.onChangeLaneComplete()},jump:function(){this.owner.jumping=!0,this.owner.asset.angle=0,this.owner.asset.tween.clear(),this.owner.asset.tween.wait(150).to({scaleX:1.5,scaleY:1.5,angle:30*Math.random()-15},300).easing(meta.Tween.Easing.quadInOut).wait(50).to({scaleX:1,scaleY:1,angle:0},300,this.onJumpComplete.bind(this)).easing(meta.Tween.Easing.quadIn).play()},onJumpComplete:function(){this.owner.asset.angle=0,this.owner.jumping=!1},sideBump:function(t){this.owner.tween.clear();var e=this.owner.lane;e>this.owner.lane+t?e-=.5:e+=.5,this.owner.lane+=t,meta.emit(GameEventsChannel,this.owner.lane,GameEvents.LANE_CHANGE),this.owner.tween.to({x:e*this.owner.game.laneWidth-this.owner.game.lanePad,angle:60*Math.random()-30},100).easing(meta.Tween.Easing.cubicIn).to({x:this.owner.lane*this.owner.game.laneWidth-this.owner.game.lanePad,angle:0},200,this.onChangeLaneComplete.bind(this)).easing(meta.Tween.Easing.expoOut).play()},bounceToLane:function(t,e){var i,s,n,a,h,o,l=this.owner.game.laneTransition*(e>0?e:-e),r=this.owner.game.level,c=r.groups;n=c.length;var u,m,d=!1,p=!1,f=this.owner.lane;for(i=0;i<n;i++)if(c[i].isOnScreen)for(a=c[i].objects.length,h=c[i].objects,s=0;s<a;s++)o=h[s],o.lane===this.owner.lane-1?"RaceObstacle"===o.__lastName__&&(u=this.owner.colliderL.components.Body,m=o.components.Body,d||(d=meta.physics.bodyVsBody(u,m))):o.lane===this.owner.lane+1&&"RaceObstacle"===o.__lastName__&&(u=this.owner.colliderR.components.Body,m=o.components.Body,p||(p=meta.physics.bodyVsBody(u,m)));if(d&&p)return void this.owner.kill(RaceCollisions.STATIC_OBSTACLE);if(d){if(5===this.owner.lane)return void this.owner.kill(RaceCollisions.STATIC_OBSTACLE);this.owner.lane++}else if(p){if(1===this.owner.lane)return void this.owner.kill(RaceCollisions.STATIC_OBSTACLE);this.owner.lane--}else d||p||(1===this.owner.lane?this.owner.lane=2:5===this.owner.lane?this.owner.lane=4:this.owner.lane=Math.random()>.5?this.owner.lane-1:this.owner.lane+1);f>this.owner.lane?f-=.5:f+=.5,meta.emit(GameEventsChannel,this.owner.lane,GameEvents.LANE_CHANGE),this.owner.tween.to({x:f*this.owner.game.laneWidth-this.owner.game.lanePad,angle:60*Math.random()-30},.5*l).easing(meta.Tween.Easing.cubicIn).to({x:this.owner.lane*this.owner.game.laneWidth-this.owner.game.lanePad,angle:0},l,this.onChangeLaneComplete.bind(this)).easing(meta.Tween.Easing.expoOut).play()}})},function(t,e,i){"use strict";meta.class("Enemy.BasePattern",{members:null,_game:null,isActive:!1,set game(t){this._game=t},get game(){return this._game},init:function(t){this.initArg(t),this.makeFormation()},initArg:function(t){for(var e in t)this[e]=t[e]},activate:function(){this.isActive=!0},deactivate:function(){this.isActive=!1},makeFormation:function(){},animate:function(t){},setSide:function(t){}})},function(t,e,i){"use strict";meta.class("Entity.Bullet","Entity.Geometry",{body:null,bulletType:null,bulletTypes:{AIMED:"aimed",UNAIMED:"unaimed"},camMin:0,checkMultiple:!1,lane:-1,pool:null,targetType:null,targetTypes:null,yRate:10,startX:0,startY:0,endX:0,endY:0,t:0,damage:null,_damageRadius:0,set damageRadius(t){this._damageRadius=t},onCreate:function(t){var e=new Resource.SVG;e.fillStyle="#ff0000",e.rect(0,0,10,50),this.body=this.addComponent(Physics.Body);var i=new meta.math.AABB(0,0,30,50);i.pivot(.5,1),this.body.volume=i,this.body.onCollision=this.onCollision.bind(this),this.texture=e,this.targetTypes=[],this.bulletType=this.bulletTypes.UNAIMED,this.damage=1,this.pivot(.5,1)},reset:function(){this.lane=-1,this.bulletType=this.bulletTypes.UNAIMED},setTargetTypes:function(t){this.targetTypes=t,this.checkMultiple=!0},setVectorAndFire:function(t){this.t=0,this.startX=this.absX,this.startY=this.absY,this.endX=t.absX,this.endY=t.absY,this.angle=this.getFireAngle(this.startX,this.startY,this.endX,this.endY),this.fire()},setVectorCoordsAndFire:function(t,e){this.t=0,this.startX=this.absX,this.startY=this.absY,this.endX=t,this.endY=e,this.angle=this.getFireAngle(this.startX,this.startY,this.endX,this.endY),this.fire()},getFireAngle:function(t,e,i,s){return 90+180*Math.atan2(s-e,i-t)/Math.PI},fire:function(){this.updating=!0},kill:function(){this.updating=!1,null!==this.view&&this.view.detach(this),this.pool.recycle(this)},destroy:function(){null!==this.view&&this.view.detach(),meta.physics.remove(this.components.Body),this.body=null,this.pool=null,this.targetType=null},onCollision:function(t){if(this.checkMultiple){for(var e,i,s=this.targetTypes.length;--s>=0;)e=this.targetTypes[s],t.entity.__lastName__===e&&(i||(i=!0),this.applyDamage(t.entity));i&&this.applyBlastRadius()}else t.entity.__lastName__===this.targetType&&(this.applyDamage(t.entity),this.applyBlastRadius())},applyBlastRadius:function(){this._damageRadius>0&&meta.emit(GameEventsChannel,{x:this.absX,y:this.absY,radius:this._damageRadius,damage:this.damage},GameEvents.PLACE_DAMAGE_RADIUS)},applyDamage:function(t){-1!==this.lane?t.takeDamage(this.damage,this.lane):t.takeDamage(this.damage,0),this.kill()},update:function(t){this.bulletType===this.bulletTypes.UNAIMED?this.y-=t*this.yRate*100:(this.t+=t,this.x=this.startX+(this.endX-this.startX)*this.t,this.y=this.startY+(this.endY-this.startY)*this.t),this.camMin=this.game.minY,(this.y<this.camMin||this.y>this.game.maxY)&&this.kill(),this.z=this.absY}})},function(t,e,i){"use strict";meta.class("Entity.BulletEmitter",{owner:null,pool:null,rate:.15,time:0,get damageRadius(){return this.pool.objectsCache[0].damageRadius},get moveRate(){return this.pool.objectsCache[0].yRate},set damageRadius(t){for(var e=this.pool.objectsCache.length;--e>=0;)this.pool.objectsCache[e].damageRadius=t},set moveRate(t){for(var e=this.pool.objectsCache.length;--e>=0;)this.pool.objectsCache[e].yRate=t},set bulletTexture(t){for(var e=this.pool.objectsCache.length;--e>=0;)this.pool.objectsCache[e].texture=t},init:function(t){this.initArg(t),this.onCreate()},initArg:function(t){for(var e in t)this[e]=t[e]},onCreate:function(){this.pool=new Utility.Pool,this.pool.addToPool(30,Entity.Bullet)},destroy:function(){this.owner=null,this.pool.destroy(),this.pool=null,this.rate=null,this.time=null},emitBullet:function(){return this.pool.emit()},update:function(t){this.time+=t,this.time>=this.rate&&(this.time=0,this.owner.onEmit(this.emitBullet()))}})},function(t,e,i){"use strict";meta.class("Entity.BulletHitEnemy","Entity.Geometry",{onCreate:function(t){this.texture="hit-yellow",this.anim.loop=!1,this.anim.pauseLastFrame=!0,this.pivot(.5)},reset:function(){}})},function(t,e,i){"use strict";meta.class("Entity.DuneBlastRadius","Entity.Geometry",{radius:null,onCreate:function(t){this.texture="dune-fx-rpg-radius",this.pivot(.5)},place:function(t,e,i,s,n){this.x=t,this.y=e,this.radius=.5*i;for(var a,h=s.length;--h>=0;)if(a=s[h],"DuneSquad"===a.__lastName__){if(!a.isOnScreen)continue;for(var o,l=a.members,r=l.length;--r>=0;)o=l[r],"DuneTank"!==o.__lastName__&&(o.isDead||this.withinRadius(o)&&o.takeDamage(n))}this.alpha=0,this.scale(.5),this.tween.clear(),this.tween.wait(1).to({scaleX:1,scaleY:1,alpha:1},50).to({scaleX:1.5,scaleY:1.5,alpha:0},100).play()},withinRadius:function(t){var e=t.absX-this.absX,i=t.absY-this.absY;return Math.sqrt(e*e+i*i)<this.radius}})},function(t,e,i){"use strict";meta.class("Character.DuneBoss","Character.DuneEnemy",{cannon:null,gun:null,legs:null,radar:null,shootTime:5,onCreate:function(t){this.texture="dune-enemy-boss-body",this.pivot(.5),this.body=this.addComponent(Physics.Body),this.x=600,this.z=9,this.health=10,this._makeShadow("dune-enemy-boss",90,330),this.legs=new Entity.Geometry({texture:"dune-enemy-boss-legs",y:140,z:-1}),this.legs.anim.onEnd=this.onStep.bind(this),this.legs.anim.pause(),this.attach(this.legs),this.cannon=new Entity.Geometry({texture:"dune-enemy-boss-frontgun",x:70,y:168}),this.cannon.onEnd=this.onAnimEnd.bind(this),this.cannon.anim.loop=!1,this.cannon.anim.pauseLastFrame=!1,this.cannon.anim.pause(),this.attach(this.cannon),this.radar=new Entity.Geometry({texture:"dune-enemy-boss-radar",x:38,y:-10,z:11}),this.attach(this.radar),this.gun=new Entity.Geometry({texture:"dune-enemy-boss-topgun",x:136,y:16,z:12}),this.gun.anim.pause(),this.attach(this.gun)},destroy:function(){this.body=null,this.components=null,this.health=null,this.isDead=null,this.spritesheets=null},kill:function(t){this.isPlayingDeath||null!==this.squad&&(t&&-1!==t&&meta.emit(GameEventsChannel,{x:this.absX,y:this.absY+this.assetOffsetY,type:this.explosionType},GameEvents.PLACE_EXPLOSION),this.isDead=!0,this.isPlayingDeath=!0,this.legs.anim.pause(),this.radar.anim.pause(),this.cannon.anim.pause(),this.gun.anim.pause(),meta.createTimer(this,function(){meta.emit(GameEventsChannel,{x:this.absX+(200*Math.random()-100),y:this.absY+(300*Math.random()-200),type:2},GameEvents.PLACE_EXPLOSION),this.squad.emitPowerup(this,Math.ceil(5*Math.random()))},400,6).play(),this.tween.clear(),this.tween.wait(1800).to({alpha:0},2e3,this.bossOut.bind(this)).play())},bossOut:function(){this.squad.onEnemyKill(this),this.squad.game.level&&(this.squad.game.level.returnSquad(this.squad),this.squad.game.level.bossComplete(this.squad),this.squad.game.level.onWaveComplete(this.squad.lastWave,!0))},onStep:function(){this.legs.anim.resume()},reset:function(){this.health=10,this.alpha=1,this.isPlayingDeath=!1,this.isDead=!1,this.legs.pivotX=0,this.legs.flip(1,1),this.radar.anim.resume(),this.cannon.anim.resume(),this.gun.anim.resume(),this.stepStartX=600,this.stepDiffX=0,this.stepDur=1,this.stepDirection=-1,this.stepCount=0,this.stepTime=0,this.curFrame=0},easeLinear:function(t,e,i,s){return i*t/s+e},isPlayingDeath:!1,stepStartX:600,stepDiffX:0,stepDur:1,stepDirection:-1,stepCount:0,stepTime:0,curFrame:0,onAnimEnd:function(){},shakeSent:!1,shooting:!1,playShoot:function(t){this.shootCallback=t,this.shooting=!0,this.cannon.anim.frame=0,this.cannon.anim.resume(),this.anim.onEnd=this.onAnimEnd.bind(this)},update:function(t){if(!this.isDead){this.shooting&&4===this.cannon.anim.frame&&(this.shootCallback(this.absX,this.absY+199),this.shooting=!1,Sounds.play("sfx-dune-weapon-drone")),this.stepTime+=t,this.x=this.easeLinear(this.stepTime,this.stepStartX,this.stepDiffX,this.stepDur),this.x>300||this.x<-300?this.squad.canFire=!1:this.squad.canFire=!0;var e=Math.floor(this.stepTime/this.stepDur*6);e>=6&&(e=5),this.legs.anim.frame=e,0===e||2===e?this.shakeSent||(this.shakeSent=!0,meta.emit(GameEventsChannel,{dur:.005,dist:15},GameEvents.SHAKE_CAMERA),Sounds.play("sfx-dune-footstep-boss")):this.shakeSent=!1,this.stepTime>=this.stepDur&&(this.stepTime=0,this.stepStartX=this.x,this.x<-270&&-1===this.stepDirection?(this.stepDirection=1,this.stepDiffX=250*this.stepDirection,this.legs.flip(-1,1),this.legs.pivotX=.7):this.x>270&&1===this.stepDirection?(this.stepDirection=-1,this.stepDiffX=250*this.stepDirection,this.legs.flip(1,1),this.legs.pivotX=0):this.stepDiffX=250*this.stepDirection),this.z=this.absY+this.legs.height}}})},function(t,e,i){"use strict";meta.class("Entity.DuneBulletCasing","Entity.Geometry",{isDead:null,life:null,xForce:null,yForce:null,friction:.95,onCreate:function(t){this.texture="dune-object-bulletcasing",this.pivot(.5),this.reset()},reset:function(){this.isDead=!1,this.life=.7,this.xForce=4.5,this.yForce=-1,this.aForce=15},destroy:function(){this.isDead=null,this.life=null,this.xForce=null,this.yForce=null,this.friction=null},update:function(t){this.aForce*=this.friction,this.angle+=this.aForce,this.life-=t,this.xForce*=this.friction,this.yForce+=10*t,this.x+=this.xForce,this.y+=this.yForce,this.life<=0&&(this.isDead=!0)}})},function(t,e,i){"use strict";meta.class("Entity.DuneDecal","Entity.Shadowed",{_offScreen:!1,id:null,isHive:null,side:0,energy:null,pod:null,offScreenAtY:null,get offScreen(){return this._offScreen},set offScreen(t){this._offScreen=t},onCreate:function(t){this.pivot(.5,1),this.offScreenAtY=meta.camera.height+this.height},setUp:function(t){},update:function(t,e){this.y+=t,this.absY-this.height>=this.offScreenAtY&&(this._offScreen=!0)}})},function(t,e,i){"use strict";meta.class("Entity.DuneDecals","Entity.Geometry",{decals:null,onCreate:function(t){this.decals=[];for(var e,i=0;i<2;i++)e=new Entity.DuneDecal("dune-road-rock"),this.decals.push(e),this.attach(e);e=new Entity.DuneDecal("dune-road-t1"),this.attach(e),this.decals.unshift(e),e=new Entity.DuneDecal("dune-road-t2"),this.attach(e),this.decals.push(e),this.layOut()},layOut:function(){for(var t,e=0,i=0;i<this.decals.length;i++)t=this.decals[i],t.y=e,e+=t.height},loopDecals:function(t,e,i){if(0===t&&e.offScreen)for(var s,n=Math.floor(i-meta.camera.height-206*(Math.floor(i/206)+1)),a=0;a<4;a++)s=this.decals[a],s.offScreen=!1,s.y=n,n+=s.height},update:function(t,e,i){for(var s,n=4;--n>=0;)s=this.decals[n],s.update(t,e),this.loopDecals(n,s,i)}})},function(t,e,i){"use strict";meta.class("Character.DuneDrone","Character.DuneEnemy",{altitudeZ:200,onCreate:function(t){this.texture="dune-enemy-drone-idle",this._makeShadow("dune-enemy-drone",30,50),this.pivot(.5,1),this.body=this.addComponent(Physics.Body),this.explosionType=0,this.z=10}})},function(t,e,i){"use strict";meta.class("Character.DuneEnemy","Character.BaseCharacter",{assetOffsetY:0,explosionType:0,squad:null,shootTime:0,onCreate:function(t){this.pivot(.5,1),this.body=this.addComponent(Physics.Body),this.z=10},reset:function(){this.isDead=!1,this.health=0},activate:function(){},deactivate:function(){},playShoot:function(t){},kill:function(t){null!==this.squad&&(t&&-1!==t&&meta.emit(GameEventsChannel,{x:this.absX,y:this.absY+this.assetOffsetY,type:this.explosionType},GameEvents.PLACE_EXPLOSION),this.isDead=!0,this.squad.onEnemyKill(this,t),this.onKill(),meta.emit(GameEventsChannel,25,GameEvents.ENEMY_KILLED))},playHitEffect:function(){meta.emit(GameEventsChannel,{scale:2,x:this.absX+(50*Math.random()-25),y:this.absY+-50*Math.random(),container:this.view},GameEvents.PLACE_BULLET_HIT_ENEMY)},takeDamage:function(t,e){this.isDead=this.reduceHealth(t),this.isDead&&this.kill(e)}})},function(t,e,i){"use strict";meta.class("Entity.DuneGun",{autofire:null,casings:null,emitter:null,fireSound:null,flash:null,type:null,init:function(t){this.initArg(t),this.onCreate(t)},initArg:function(t){for(var e in t)this[e]=t[e]},onCreate:function(t){this.emitter=new Entity.BulletEmitter({owner:t.owner}),this.casings=new Utility.Pool,this.casings.addToPool(20,"Entity.DuneBulletCasing"),this.flash=new Entity.DuneMuzzleFlash,t.owner.attach(this.flash),this.type=t.type,this.setGunType(this.type)},destroy:function(){this.casings.destroy(),this.flash.parent.detach(this.flash),this.flash=null,this.type=null},setGunType:function(t){this.fireSound=t.sound,this.flash.texture=t.muzzleFlash,this.flash.x=t.muzzleX,this.flash.y=t.muzzleY,this.emitter.damageRadius=t.radius,this.emitter.moveRate=t.moveRate,this.emitter.rate=t.fireRate,this.emitter.bulletTexture=t.bullet},emitCasing:function(){return this.casings.emit()},playFlash:function(){this.flash.play(),Sounds.play(this.fireSound)},update:function(t){this.autoFire&&this.emitter.update(t);for(var e,i=this.casings.objectsInUse,s=i.length;--s>=0;)if(e=i[s],e.update(t),e.isDead){e.view.detach(e),this.casings.recycle(e);break}this.flash.update(t)}})},function(t,e,i){"use strict";meta.class("Character.DuneHero","Character.BaseCharacter",{autoFire:!0,body:null,changingLanes:!1,xDest:0,yDest:0,xRate:4,yRate:4,xTime:0,yTime:0,xDura:0,yDura:0,game:null,lane:3,gameY:380,gun:null,gunType:null,onCreate:function(t){this.health=100,this.gunType=t.gunType,this.texture=this.gunType.texture,this.alignToFeet(),this.gun=new Entity.DuneGun({type:this.gunType,owner:this,autoFire:!0}),this.body=this.addComponent(Physics.Body),this.body.onCollision=this.onCollision.bind(this);var e=new meta.math.AABB(0,0,70,110);e.pivot(.5,1),this.body.volume=e,this.y=this.gameY,this.z=this.absY,this.resetLane(),this._makeShadow("dune-player",10,160),this.updating=!0},destroy:function(){meta.physics.remove(this.components.Body),this.body=null,this.components={},this.texture=null,this.spritesheets=null,this.anim.onEnd=null,this.gun.destroy(),this.gunType=null},onEmit:function(t){if(t){var e=this.gun.flash.absX,i=this.gun.flash.absY;if(t.z=this.z-10,t.game=this.game,t.setTargetTypes(["DuneDrone","DuneTroop","DuneTank","DuneBoss","DuneSpaceInvader"]),t.x=e,t.y=i,t.lane=this.lane,t.fire(),t.damageRadius=this.gun.type.radius,this.view.attach(t),this.gunType.id===DuneGunTypes.ARMOR_PIERCING.id){var s=this.gun.emitter.emitBullet(),n=this.gun.emitter.emitBullet();s.setTargetTypes(["DuneDrone","DuneTroop","DuneTank","DuneBoss","DuneSpaceInvader"]),n.setTargetTypes(["DuneDrone","DuneTroop","DuneTank","DuneBoss","DuneSpaceInvader"]),s.x=n.x=e,s.y=n.y=i,s.z=n.z=this.z-10,s.game=n.game=this.game,s.bulletType=n.bulletType=t.bulletTypes.AIMED,s.setVectorCoordsAndFire(e+270,0),n.setVectorCoordsAndFire(e-270,0),this.view.attach(s),this.view.attach(n)}this.gun.playFlash();var a=this.gun.emitCasing();a&&(a.x=e,a.y=i+65,this.view.attach(a))}},startLaneChanging:function(){this.tween.clear(),this.changingLanes=!0},endLaneChanging:function(){this.tween.clear(),this.changingLanes=!1},getLaneX:function(){return this.lane*this.game.laneWidth-this.game.lanePad},moveToLane:function(t){if(this.startLaneChanging(),this.lane!==t){var e=Math.abs(t-this.lane);this.lane=t,this.tween.to({x:this.getLaneX()},500*e,this.onMoveComplete.bind(this)).easing(meta.Tween.Easing.quadInOut).play()}},onMoveComplete:function(){this.endLaneChanging()},changeLane:function(t){if(this.lane=this.lane+t,this.lane>5)return void(this.lane=5);if(this.lane<1)return void(this.lane=1);this.startLaneChanging();var e=this.game.laneTransition*(t>0?t:-t);this.tween.to({x:this.getLaneX()},e,this.endLaneChanging.bind(this)).easing("quadOut").play()},resetLane:function(){this.tween.clear(),this.lane=3,this.position(this.getLaneX(),this.gameY),this.changingLanes=!1},animateToY:function(t){this.endLaneChanging(),this.tween.to({y:t-this.totalOffsetY},750,function(){meta.emit(GameEventsChannel,null,GameEvents.DUNE_PORTAL_ENTERED)}).play()},kill:function(){this.updating=!1,this.tween.clear(),this.anim.pause(),meta.emit(GameEventsChannel,{scale:2,x:this.absX+(50*Math.random()-25),y:this.absY-110,z:1001,type:1},GameEvents.PLACE_EXPLOSION),meta.emit(GameEventsChannel,null,GameEvents.DUNE_LEVEL_LOSE)},handleDeath:function(){},handlePickup:function(t){switch(t){case PlayerStats.COINS:break;case PlayerStats.HEALTH:this.healDamage();break;case PlayerStats.SHIELD:}},healDamage:function(){this.health=100},win:function(){},reduceHealth:function(t){return this.playHitEffect(),this.health-=t,this.health>=0&&meta.emit(GameEventsChannel,this.health,GameEvents.UPDATE_UI_HEALTH),this.health<=0},playHitEffect:function(){meta.emit(GameEventsChannel,{scale:2,x:this.absX+(50*Math.random()-25),y:this.absY+-50*Math.random(),z:1001},GameEvents.PLACE_BULLET_HIT),meta.emit(GameEventsChannel,{dur:.05,dist:10},GameEvents.SHAKE_CAMERA)},onCollision:function(t){switch(t.entity.__lastName__){case"Bullet":return;case"Enemy":this.kill();break;case"DuneSpaceInvader":t.entity.canKill&&(meta.emit(GameEventsChannel,{scale:1,x:this.absX+(50*Math.random()-25),y:this.absY+-50*Math.random(),z:1001,type:0},GameEvents.PLACE_EXPLOSION),t.entity.kill(),this.takeDamage(DamageRatings.ENEMY_INVADER_COLLISION))}},update:function(t){this.gun.update(t)}})},function(t,e,i){"use strict";meta.class("Entity.DuneLevel","Entity.Geometry",{game:null,bossSquad:null,bossChance:null,ground:null,scrollables:null,bossPool:null,dronePool:null,pickupPool:null,portalPool:null,squadPool:null,tankPool:null,troopPool:null,waves:null,fullData:null,curY:0,globalY:0,canScroll:!1,decals:null,fxContainer:null,onCreate:function(t){this.updating=!0,this.pivot(.5,0),this.anchor(0,0),this.waves=[],this.bossChance=0,this.bossPool=new Utility.Pool,this.bossPool.addToPool(1,Character.DuneBoss),this.dronePool=new Utility.Pool,this.dronePool.addToPool(40,Character.DuneDrone),this.pickupPool=new Utility.Pool,this.pickupPool.addToPool(20,Entity.DunePickup),this.portalPool=new Utility.Pool,this.portalPool.addToPool(5,Entity.DunePortal),this.squadPool=new Utility.Pool,this.squadPool.addToPool(30,Entity.DuneSquad),this.tankPool=new Utility.Pool,this.tankPool.addToPool(5,Character.DuneTank),this.troopPool=new Utility.Pool,this.troopPool.addToPool(40,Character.DuneTroop),this.z=2,this.scrollables=[],this.canScroll=!0,this.fxContainer=new Entity.Geometry({z:25}),this.attach(this.fxContainer)},stop:function(){this.updating=!1},destroy:function(){this.game=null,this.ground=null;for(var t=this.scrollables.length;--t>=0;)this.scrollables[t].destroy();if(null!==this.fxContainer.children||void 0!=this.fxContainer.children)for(t=this.fxContainer.children.length;--t>=0;)this.fxContainer.children[t].remove();this.bossChance=null,this.scrollables=null,this.curY=null,this.globalY=null,this.canScroll=null,this.fullData=null},requestItem:function(t){switch(t){case"boss":return this.bossPool.emit();case"drone":return this.dronePool.emit();case"pickup":return this.pickupPool.emit();case"tank":return this.tankPool.emit();case"troop":return this.troopPool.emit();case"portal":return this.portalPool.emit()}},returnItem:function(t){switch(t.__lastName__){case"DuneBoss":this.bossPool.recycle(t);break;case"DuneDrone":this.dronePool.recycle(t);break;case"DunePickup":this.pickupPool.recycle(t);break;case"DuneTank":this.tankPool.recycle(t);break;case"DuneTroop":this.troopPool.recycle(t);break;case"DunePortal":this.portalPool.recycle(t)}},requestSquad:function(t){var e=this.squadPool.emit();e.triggerY=t.triggerY,e.fireRate=t.fireRate,e.enemyClass=t.class;var i,s,n=t.num;switch(t.type){case EnemyPatterns.BOSS:s=this.bossPool,e.setUpFiring("dune-fx-bullet-walker");break;case EnemyPatterns.LINE_A:case EnemyPatterns.LINE_B:case EnemyPatterns.LINE_C:case EnemyPatterns.CIRCLE_A:case EnemyPatterns.CIRCLE_B:s=this.dronePool,e.setUpFiring("dune-fx-bullet-drone");break;case EnemyPatterns.GRID:s=this.troopPool,e.setUpFiring("dune-fx-bullet-ioi");break;case EnemyPatterns.TANK:s=this.tankPool,e.setUpFiring("dune-fx-bullet-invader")}for(var a=0;a<n;a++)i=s.emit(),i.squad=e,e.addMember(i);return e.triggered=!1,e.setUpPattern(t.type,t.side),e},returnSquad:function(t){this.squadPool.recycle(t)},addWave:function(t){this.waves.push(t)},getWaveData:function(){var t=Math.floor(Math.random()*(this.fullData.length-1));return this.fullData[t]},activateWave:function(t){this.waves[t].activated=!0},addScrollable:function(t){this.scrollables.push(t)},removeScrollable:function(t){for(var e=this.scrollables.length;--e>=0;)if(this.scrollables[e]===t)return void this.scrollables.splice(e,1)},bossComplete:function(t){this.game.view.detach(t),this.bossSquad=null},onWaveComplete:function(t,e){!0===t.activated&&(t.activated=!1);var i=Math.random()<this.bossChance;if(e&&(i=!1),i)this.canScroll=!1,this.bossChance=-.5,this.bossSquad=this.requestSquad(this.fullData[this.fullData.length-1].data[0]),this.bossSquad.game=this.game,this.bossSquad.y=0,this.bossSquad.lastWave=t,this.game.view.attach(this.bossSquad),meta.emit(GameEventsChannel,null,GameEvents.PAUSE_FOLLOW),meta.emit(GameEventsChannel,3,GameEvents.LANE_CHANGE);else{this.canScroll=!0,this.bossChance+=.1;var s=t.id+1;s>=this.waves.length&&(s=0),this.waves[s].activated=!0;var n=this.portalPool.emit();n.level=this,n.setUp(),this.game.view.attach(n),this.addScrollable(n),meta.emit(GameEventsChannel,null,GameEvents.RESUME_FOLLOW)}},update:function(t){this.canScroll?this.curY=this.game.scrollRate*t:this.curY=0,this.globalY+=this.curY;for(var e=this.waves.length;--e>=0;)this.waves[e].update(this.curY,this.globalY,t);this.decals.update(this.curY,t,this.globalY),null!==this.bossSquad&&this.bossSquad.update(this.curY,this.globalY,t),e=this.scrollables.length;for(var i;--e>=0;)i=this.scrollables[e],i.update(this.curY,t);if(this.fxContainer.children){e=this.fxContainer.children.length;for(var s;--e>=0;)s=this.fxContainer.children[e],s.y+=this.curY,s.z=s.absY,s.update&&s.update(this.curY,t)}this.ground.extUpdate(this.curY)}})},function(t,e,i){"use strict";meta.class("Utility.DuneLevelBuilder",{game:null,init:function(t){this.initArg(t)},initArg:function(t){for(var e in t)this[e]=t[e]},build:function(t){for(var e,i=t.data,s=new Entity.DuneLevel({game:this.game,fullData:i}),n=0;n<3;n++)e=new Entity.DuneWave({id:n,game:this.game,level:s}),s.addWave(e);return s.activateWave(0),this.game.view.attach(s),s}})},function(t,e,i){"use strict";meta.class("Entity.DuneMuzzleFlash","Entity.Geometry",{life:null,playing:null,onCreate:function(t){this.pivot(.5),this.playing=!1,this.hidden=!0,this.z=10},play:function(){this.playing=!0,this.life=.1,this.hidden=!1},update:function(t){this.playing&&(this.life-=t,this.life<=0&&(this.playing=!1,this.hidden=!0))}})},function(t,e,i){"use strict";meta.class("Entity.DunePickup","Entity.Shadowed",{collected:!1,distY:-1,eventType:null,game:null,hero:null,lane:-1,pickupType:null,scrollRate:0,str:0,onCreate:function(t){this.eventType=GameEvents.DUNE_PICKUP,this.basicSetup()},basicSetup:function(){void 0===this.components.LaneCollision&&this.addComponent("LaneCollision"),this.pickupType=Math.random()>.85?PlayerStats.HEALTH:PlayerStats.COINS,this.setPickupTexture(),this.pivot(.5,1)},destroy:function(){null!==this.view&&this.remove(),this.collected=null,this.distY=null,this.eventType=null,this.game=null,this.hero=null,this.lane=null,this.pickupType=null,this.scrollRate=null},setPickupTexture:function(){this.hidden=!0,this.pickupType===PlayerStats.HEALTH?(this.texture="shared-object-health",this._makeShadow("shared-object-boost",12,90)):(this.texture="all-coin",this._makeShadow("shared-object-boost",6,56)),this.anim.pauseLastFrame=!1,this.anim.loop=!0,this.anim.onEnd=null,this.anim.resume()},reset:function(){this.collected=!1,this.setPickupTexture()},enable:function(){this.components.LaneCollision.target=this.hero,this.components.LaneCollision.lane=this.lane,this.components.LaneCollision.checkCollision=!0,this.components.LaneCollision.collided=!1},launch:function(){this.str=0,this.hidden=!1,this.shadow.hidden=!1},onAnimEnd:function(){this.onComplete()},onCollision:function(){this.collected||(this.collected=!0,this.shadow.hidden=!0,this.texture="all-coin-collect",this.anim.frame=1,this.anim.pauseLastFrame=!0,this.anim.loop=!1,this.anim.onEnd=this.onAnimEnd.bind(this),meta.emit(GameEventsChannel,this.pickupType,this.eventType))},onComplete:function(){this.view.detach(this),this.game&&(this.game.level.removeScrollable(this),this.game.level.returnItem(this))},onRemove:function(){this.updating=!1,this.collected=null,this.distY=null,this.eventType=null,this.game=null,this.hero=null,this.lane=null,this.pickupType=null,this.scrollRate=null},update:function(t,e){this.y+=t+this.str,this.components.LaneCollision.onUpdate(e),this.y-this.height>=meta.camera.height&&this.onComplete(),this.z=this.absY}})},function(t,e,i){"use strict";meta.class("Entity.DunePortal","Entity.Portal",{lane:null,level:null,portalType:null,setUp:function(t){this.hidden=!1,this.active=!0,this.y=-200,this.pivot(.5,1),this.anchor(0,0),this.lane=t||Math.ceil(5*Math.random()),this.x=this.lane*GameSettings.LANE_WIDTH-GameSettings.LANE_PAD,this.addLaneCollision(),Math.random()>.2?(this.portalType=GameSettings.PORTAL_RACE,this.texture="all-portal-race"):(this.portalType=GameSettings.PORTAL_GLOBE,this.texture="all-portal-globe")},addLaneCollision:function(){void 0===this.components.LaneCollision&&this.addComponent("LaneCollision"),this.components.LaneCollision.reset(),this.components.LaneCollision.lane=this.lane,this.components.LaneCollision.target=this.level.game.hero},onCollision:function(){meta.emit(GameEventsChannel,this.portalType,GameEvents.DUNE_PORTAL_ENTERED)},update:function(t,e){this.active&&(this.y+=t,this.components.LaneCollision.onUpdate(e),this.y-this.height>meta.camera.height&&(this.active=!1,this.view.detach(this),this.level.removeScrollable(this),this.level.returnItem(this)),this.z=this.absY)}})},function(t,e,i){"use strict";meta.class("Character.DuneSpaceInvader","Character.DuneEnemy",{direction:0,moveLimit:30,startX:0,limitX:0,onCreate:function(t){this.pivot(.5,1),this.body=this.addComponent(Physics.Body),this.z=10,this.anim.onEnd=this.move.bind(this)},setLimits:function(){this.limitX=this.startX+this.moveLimit*this.direction},move:function(){this.x+=10*this.direction;var t=this.limitX-this.x;0===Math.abs(t)&&(this.direction=-this.direction,this.setLimits())},onKill:function(){meta.emit(GameEventsChannel,{x:this.absX,y:this.absY,type:0},GameEvents.PLACE_EXPLOSION)}})},function(t,e,i){"use strict";meta.class("Entity.DuneSquad","Entity.Geometry",{allDead:!1,bulletEmitter:null,canFire:!0,canScroll:!0,enemies:null,enterFrom:-1,_fireRate:.55,fireCount:0,_game:null,isBoss:!1,isOnScreen:!1,nextShooter:0,owner:null,previewing:!1,pattern:null,posY:0,_pickup:null,_bufferY:0,deadMembers:null,members:null,_triggerY:null,_wave:null,triggered:null,deadCount:null,_enemyClass:null,set bufferY(t){this._bufferY=t,this.y=-t},set game(t){this._game=t,this.components.DuneSquadPattern.game=this._game},set wave(t){this._wave=t},set triggerY(t){this._triggerY=t},get game(){return this._game},set pickup(t){this._pickup=t},get enemyClass(){return this._enemyClass},set enemyClass(t){this._enemyClass=t},get fireRate(){return this._fireRate},set fireRate(t){this._fireRate=t,this._fireRate<0&&(this.canFire=!1)},onCreate:function(t){this.deadMembers=[],this.members=[],this.addComponent("DuneSquadPattern",{}),this.triggered=!1,this.z=3,this.deadCount=0,this.bulletEmitter=new Entity.BulletEmitter({owner:this})},destroy:function(){this.allDead=null,this.bulletEmitter.destroy(),this.bulletEmitter=null,this.canFire=null,this.canScroll=null,this.enemies.length>0&&this.detachEnemies(),this.enemies=null,this.enterFrom=null,this._fireRate=null,this.fireCount=null,this._game=null,this.isBoss=null,this.isOnScreen=null,this.nextShooter=null,this.owner=null,this.previewing=null,this.pattern=null,this.posY=null,this._pickup=null,this._bufferY=null},reset:function(){this.deadCount=0,this.deadMembers=[],this.members=[],this.allDead=!1},addMember:function(t){this.attach(t),this.members.push(t)},setUpFiring:function(t){this.bulletEmitter.bulletTexture=t},setUpPattern:function(t,e){this.components.DuneSquadPattern.setPattern(t,e)},recycle:function(){this.triggered=!1,this.hidden=!1},emitPowerup:function(t,e){if(!(Math.random()>.5)&&null!==this.game.level){this._pickup=this.game.level.requestItem("pickup"),this._pickup.basicSetup(),this._pickup.x=t.absX,this._pickup.y=t.absY,this._pickup.hero=this.game.hero;var i=Math.floor(e+(2*Math.random()-1));i<1?i=1:i>5&&(i=5),this._pickup.lane=i,this._pickup.game=this.game,this.game.level.addScrollable(this._pickup),this.view.attach(this._pickup);var s=this._pickup.lane*this.game.laneWidth-this.game.lanePad,n=.5*(s-this._pickup.x);this._pickup.launch(this._pickup.absY),this._pickup.tween.clear(),this._pickup.tween.to({alpha:1,x:this._pickup.x+n,str:-10},250).to({x:s,str:0},250,this._pickup.enable.bind(this._pickup)).play(),Sounds.play("sfx-dune-pickup-emit")}},onComplete:function(){for(var t=this.members.length;--t>=0;)this.detach(this.members[t]),this.deadMembers.push(this.members[t]);this.members=[],this._pickup=null,this.allDead=!0,this.returnDeadItems(),this.deadMembers=[],this.components.DuneSquadPattern.pattern.deactivate(),this._wave.squadKilled(this)},returnDeadItems:function(){for(var t=this.deadMembers.length;--t>=0;)this.game.level&&this.game.level.returnItem(this.deadMembers[t])},onEnemyKill:function(t,e){(e||0!==e)&&this.emitPowerup(t,e),t.parent===this&&this.detach(t),this.deadCount++,this.deadMembers.push(t),this.allDead=this.deadCount===this.members.length,this.allDead&&(this.components.DuneSquadPattern.pattern.deactivate(),this.returnDeadItems(),this._wave&&this._wave.squadKilled(this))},detachEnemies:function(){for(var t=this.members.length;--t>=0;)this.members[t].parent===this?this.detach(this.members[t]):console.log("???",this.members[t].__lastName__)},onEnemyFire:function(){if(0!==this.members.length){++this.nextShooter,this.nextShooter>=this.members.length&&(this.nextShooter=0);var t=this.members[this.nextShooter],e=t.absX,i=t.absY+25;t.isDead||(t.shootTime>0?t.playShoot(function(t,e){this.onEmit(this.bulletEmitter.emitBullet(),t,e)}.bind(this)):(t.playShoot(null),this.onEmit(this.bulletEmitter.emitBullet(),e,i),Sounds.play("sfx-dune-weapon-drone")))}},onEmit:function(t,e,i){if(t){switch(t.z=this.z+5,t.game=this._game,t.targetType="DuneHero",t.x=e,t.y=i,t.yRate=-6,t.damageRadius=0,t.scale(1),this._enemyClass){case"Character.DuneTank":t.damage=DamageRatings.ENEMY_DRONE_BULLET,t.bulletType="unaimed",t.scale(3);break;case"Character.DuneBoss":t.damage=DamageRatings.ENEMY_BOSS_BULLET,t.bulletType="aimed";break;case"Character.DuneDrone":t.damage=DamageRatings.ENEMY_DRONE_BULLET,t.bulletType="unaimed";break;default:t.damage=DamageRatings.ENEMY_TROOPER_BULLET,t.bulletType="unaimed"}"unaimed"===t.bulletType?t.fire():t.setVectorAndFire(this._game.hero),null!==this.view?this.view.attach(t):t.kill()}},onScreen:function(){return this.y<0-this._bufferY&&this.isOnScreen?(this.isOnScreen=!1,this.hidden=!0,!1):this.y>meta.camera.height+this._bufferY&&this.isOnScreen?(this.onComplete(),this.isOnScreen=!1,!1):this.y>0-this._bufferY&&this.posY<meta.camera.height+this._bufferY&&!this.isOnScreen?(this.isOnScreen=!0,this.hidden=!1,this.components.DuneSquadPattern.pattern.activate(),!0):void 0},update:function(t,e,i){if(e>=this._triggerY&&!this.triggered&&(this.triggered=!0,this.game.view.attach(this)),this.triggered){if(this.y+=t,this.components.DuneSquadPattern.onUpdate(i),this.onScreen(),!this.canFire)return;this.isOnScreen&&!this.allDead&&this.y<meta.camera.height-100&&(this.fireCount+=i,this.fireCount>=this._fireRate&&(this.fireCount=0,this.onEnemyFire()))}}})},function(t,e,i){"use strict";meta.class("Character.DuneTank","Character.DuneEnemy",{invaders:null,killCount:0,shootTime:1,onCreate:function(t){this.z=11,this.invaders=[];for(var e,i,s=0,n=0,a=0;a<12;a++)e=new Character.DuneSpaceInvader({texture:"dune-enemy-spaceinvader",pivotX:.5,pivotY:1,scaleX:1.5,scaleY:1.5,squad:this}),e._makeShadow("dune-enemy-spaceinvader",25,25,!0),i=new meta.math.AABB(0,0,0,0),i.pivot(.5,1.25),e.components.Body.volume=i,this.invaders.push(e),4===s&&(s=0,++n),e.x=e.startX=100*s-150,e.y=80*n-80,e.direction=n%2==0?-1:1,e.setLimits(),n%2==0&&(e.anim.frame=1,e.shadow.anim.frame=1),++s,this.attach(e)},canKill:function(t){var e,i;if(t)for(e=this.invaders.length;--e>=0;)i=this.invaders[e],i.components.Body.volume.set(0,0,60,60),i.canKill=!0;else for(e=this.invaders.length;--e>=0;)i=this.invaders[e],i.components.Body.volume.set(0,0,1,1),i.canKill=!1},onEnemyKill:function(t,e){this.detach(t),++this.killCount>=12&&this.squad.onComplete()},playShoot:function(t){for(var e,i,s=this.invaders.length;--s>=0;)if(e=this.invaders[s],!e.isDead&&(i=this.invaders[s],Math.random()>.5)){t(e.absX,e.absY);break}t(i.absX,i.absY)},reset:function(){var t,e=this.invaders.length;this.killCount=0,meta.createTimer(this,function(){for(;--e>=0;)t=this.invaders[e],t.isDead&&(t.isDead=!1,this.attach(t))},100,1).play()}})},function(t,e,i){"use strict";meta.class("Character.DuneTroop","Character.DuneEnemy",{shootTime:3,shootCallback:null,onCreate:function(t){this.texture="dune-enemy-troop-run",this._makeShadow("dune-enemy-troop",17,94),this.pivot(.5,1),this.body=this.addComponent(Physics.Body),this.assetOffsetY=-65,this.explosionType=2,this.z=10},reset:function(){this.alpha=1,this.texture="dune-enemy-troop-run",this.anim.loop=!0,this.anim.pauseLastFrame=!1,this.isDead=!1,this.health=0,this.shadow.hidden=!1},onOutComplete:function(t){t?this.squad.onEnemyKill(this,t):this.squad.onEnemyKill(this),this.onKill()},onAnimEnd:function(){this.texture="dune-enemy-troop-run",this.pivot(.5,1),this.anim.onEnd=null},playShoot:function(t){this.shootCallback=t,this.texture="dune-enemy-troop-shoot2",this.pivot(.5,.88),this.anim.onEnd=this.onAnimEnd.bind(this),this.updating=!0},kill:function(t){null!==this.squad&&"dune-enemy-troop-kill"!==this.texture.name&&(t&&-1!==t&&meta.emit(GameEventsChannel,{x:this.absX,y:this.absY+this.assetOffsetY,type:this.explosionType},GameEvents.PLACE_EXPLOSION),this.texture="dune-enemy-troop-kill",this.anim.loop=!1,this.anim.frame=Math.floor(4*Math.random()),this.anim.pauseLastFrame=!0,this.tween.clear(),this.tween.wait(240).to({alpha:0},160,this.onOutComplete.bind(this,t)).play(),this.isDead=!0,this.shadow.hidden=!0)},update:function(t){this.anim.frame===this.shootTime&&(this.shootCallback(this.absX,this.absY),this.shootCallback=null,this.updating=!1,Sounds.play("sfx-dune-weapon-troop"))}})},function(t,e,i){"use strict";meta.class("Entity.DuneWave",{_activated:null,difficulty:null,game:null,id:null,level:null,percentComplete:null,deadSquads:null,squads:null,offsetY:null,squadCount:null,get activated(){return this._activated},set activated(t){this._activated=t,this._activated&&(this.setUp(),this.offsetY=this.level.globalY)},init:function(t){this.initArg(t),this.onCreate(t)},initArg:function(t){for(var e in t)this[e]=t[e]},onCreate:function(t){this._activated=!1,this.difficulty=0,this.percentComplete=0,this.deadSquads=[],this.squads=[],this.squadCount=0},reset:function(){this.difficulty=0,this.percentComplete=0,this.squadCount=0},setUp:function(){this.deadSquads=[],this.squads=[],this.squadCount=0,this.data=this.level.getWaveData();for(var t,e=this.data.data,i=e.length,s=0;s<i;s++)t=this.level.requestSquad(e[s]),t.wave=this,t.game=this.game,this.addSquad(t)},addSquad:function(t){this.squads.push(t),++this.squadCount},recycleSquads:function(){for(var t,e=this.deadSquads.length;--e>=0;)t=this.deadSquads[e],this.level.returnSquad(t);for(e=this.squads.length;--e>=0;)t=this.squads[e],this.level.returnSquad(t)},squadKilled:function(t){var e=this.squads.length;for(null!=t.view&&t.view.detach(t);--e>=0;)if(this.squads[e]===t){var i=this.squads.splice(e,1)[0];this.deadSquads.push(i);break}this.percentComplete=this.deadSquads.length/this.squadCount,console.log("percent complete",this.percentComplete),this.percentComplete>=1&&(this._activated=!1,this.level.onWaveComplete(this),this.recycleSquads())},update:function(t,e,i){if(this._activated)for(var s=this.squads.length;--s>=0;)this.squads[s].update(t,e-this.offsetY,i)}})},function(t,e,i){"use strict";meta.class("Enemy.PatternBoss","Enemy.BasePattern",{arrived:!1,diffX:0,dur:2,lane:0,moveRate:400,startY:0,stopPoint:-200,t:0,boss:null,set game(t){this._game=t},makeFormation:function(){this.boss=this.members[0],this.boss.x=600,this.boss.y=130},setSide:function(t){},activate:function(){this.boss.x=600,this.isActive=!0},easeInOutSine:function(t,e,i,s){return-i/2*(Math.cos(Math.PI*t/s)-1)+e},animate:function(t){this.boss.update(t)}})},function(t,e,i){"use strict";meta.class("Enemy.PatternCircleA","Enemy.BasePattern",{angleTemp:0,radius:250,rT:250,rD:-1,step:0,makeFormation:function(){var t=0,e=0;this.step=2*Math.PI/this.members.length;for(var i=0;i<this.members.length;i++)e=this.members[i],e.x=this.radius*Math.cos(t),e.y=this.radius*Math.sin(t),t+=this.step},animate:function(t){this.rT+=this.rD,(this.rT<=100||this.rT>=this.radius)&&(this.rD=-this.rD),this.angleTemp+=2.5*t;for(var e,i=this.members.length;--i>=0;)e=this.members[i],e.x=this.rT*Math.cos(this.angleTemp),e.y=this.rT*Math.sin(this.angleTemp),this.angleTemp+=this.step,e.z=e.absY+e.altitudeZ}})},function(t,e,i){"use strict";meta.class("Enemy.PatternCircleB","Enemy.BasePattern",{angleTemp:0,radius:300,rT:300,rD:-1,step:0,rotMult:1,minRadius:250,makeFormation:function(){var t=0,e=0;this.step=2*Math.PI/this.members.length;for(var i=0;i<this.members.length;i++)e=this.members[i],e.x=this.radius*Math.cos(t),e.y=this.radius*Math.sin(t),t+=this.step},animate:function(t){this.rT+=this.rD,(this.rT<=this.minRadius||this.rT>=this.radius)&&(this.rD=-this.rD),this.angleTemp+=t*this.rotMult;for(var e,i=this.members.length;--i>=0;)e=this.members[i],e.x=this.rT*Math.cos(this.angleTemp),e.y=this.rT*Math.sin(this.angleTemp),this.angleTemp+=this.step,e.z=e.absY+e.altitudeZ}})},function(t,e,i){"use strict";meta.class("Enemy.PatternGrid","Enemy.BasePattern",{angleTemp:0,dir:1,p0:{x:0,y:0},p1:{x:0,y:0},progress:0,step:0,tP:null,walkRate:50,followPoint:null,makeFormation:function(){for(var t,e=2+Math.ceil(3*Math.random()),i=-e/2*50,s=i,n=0,a=0;a<this.members.length;a++)t=this.members[a],this.progress=.5*a/(this.members.length-1),t.offX=s,t.offY=n,s+=75,a%e==0&&(i+=25,s=i,n+=100),t.pos=this.progress;this.step=2*Math.PI/this.members.length},setSide:function(t){this.followPoint=new Entity.Geometry;var e;t<0?(this.p0={x:-270,y:0},this.p1={x:270,y:0},e=this.p0,this.tP=this.p1):(this.p0={x:270,y:0},this.p1={x:-270,y:0},e=this.p0,this.tP=this.p1),this.followPoint.x=e.x,this.followPoint.y=e.y,this.makeFormation()},animate:function(t){this.dir>0?this.progress+=.2*t:this.progress-=.2*t,this.progress<=0&&-1===this.dir?(this.dir=1,this.tP=this.p1):this.progress>=1&&1===this.dir&&(this.dir=-1,this.tP=this.p0);var e,i=this.members.length;for(this.dir>0?(this.followPoint.x=this.p0.x+(this.tP.x-this.p0.x)*this.progress,this.followPoint.y=this.p0.y+(this.tP.y-this.p0.y)*this.progress):(this.followPoint.x=this.p1.x+(this.tP.x-this.p1.x)*(1-this.progress),this.followPoint.y=this.p1.y+(this.tP.y-this.p1.y)*(1-this.progress));--i>=0;)e=this.members[i],e.isDead||(e.x=this.followPoint.x+e.offX,e.y=this.followPoint.y+e.offY,e.z=e.absY)}})},function(t,e,i){"use strict";meta.class("Enemy.PatternLineA","Enemy.BasePattern",{angleTemp:0,dir:1,p0:{x:0,y:0},p1:{x:0,y:0},progress:0,step:0,tP:null,makeFormation:function(){this.p1.x=.5*meta.camera.width;for(var t,e=0;e<this.members.length;e++)t=this.members[e],this.progress=.5*e/(this.members.length-1),t.x=this.p0.x+(this.p1.x-this.p0.x)*this.progress,t.y=this.p0.y+(this.p1.y-this.p0.y)*this.progress,t.pos=this.progress;this.step=2*Math.PI/this.members.length,this.tP=this.p1},animate:function(t){this.angleTemp+=7.5*t,this.dir>0?this.progress+=.5*t:this.progress-=.5*t,this.progress<=0&&-1===this.dir?(this.dir=1,this.tP=this.p1):this.progress>=1.5&&1===this.dir&&(this.dir=-1,this.tP=this.p0);for(var e,i,s,n=this.members.length;--n>=0;)s=this.members[n],e=s.pos,i=10*Math.sin(this.angleTemp),this.dir>0?(s.x=this.p0.x+(this.tP.x-this.p0.x)*(this.progress-e),s.y=this.p0.y+(this.tP.y-this.p0.y)*(this.progress-e)+i):(s.x=this.p1.x+(this.tP.x-this.p1.x)*(1-(this.progress-e)),s.y=this.p1.y+(this.tP.y-this.p1.y)*(1-(this.progress-e))+i),this.angleTemp+=this.step,s.z=s.absY+s.altitudeZ}})},function(t,e,i){"use strict";meta.class("Enemy.PatternLineB","Enemy.BasePattern",{angleTemp:0,dir:1,p0:{x:0,y:0},p1:{x:0,y:0},progress:0,step:0,tP:null,makeFormation:function(){this.p0.x=.5*meta.camera.width;for(var t,e=0;e<this.members.length;e++)t=this.members[e],this.progress=.5*e/(this.members.length-1),t.x=this.p0.x+(this.p1.x-this.p0.x)*this.progress,t.y=this.p0.y+(this.p1.y-this.p0.y)*this.progress,t.pos=this.progress;this.step=2*Math.PI/this.members.length*2,this.tP=this.p1},animate:function(t){this.angleTemp+=7.5*t,this.dir>0?this.progress+=.25*t:this.progress-=.25*t,this.progress<=0&&-1===this.dir?(this.dir=1,this.tP=this.p1):this.progress>=1.5&&1===this.dir&&(this.dir=-1,this.tP=this.p0);for(var e,i,s,n=this.members.length;--n>=0;)s=this.members[n],e=s.pos,i=10*Math.sin(this.angleTemp+this.progress),this.dir>0?(s.x=this.p0.x+(this.tP.x-this.p0.x)*(this.progress-e),s.y=this.p0.y+(this.tP.y-this.p0.y)*(this.progress-e)+i):(s.x=this.p1.x+(this.tP.x-this.p1.x)*(1-(this.progress-e)),s.y=this.p1.y+(this.tP.y-this.p1.y)*(1-(this.progress-e))+i),this.angleTemp+=this.step,s.z=s.absY+s.altitudeZ}})},function(t,e,i){"use strict";meta.class("Enemy.PatternLineC","Enemy.BasePattern",{angleTemp:0,finished:!1,dir:1,originalNum:0,p0:{x:0,y:0},p1:{x:0,y:0},progress:0,step:0,tP:null,makeFormation:function(){for(var t,e=0;e<this.members.length;e++)t=this.members[e],this.progress=.5*-e/(this.members.length-1),t.x=this.p0.x+(this.p1.x-this.p0.x)*this.progress,t.y=this.p0.y+(this.p1.y-this.p0.y)*this.progress,t.pos=this.progress;this.originalNum=this.members.length,this.step=2*Math.PI/this.members.length,this.tP=this.p1},setSide:function(t){t<0?(this.p0={x:.5*-meta.camera.width,y:0},this.p1={x:.5*meta.camera.width,y:300}):(this.p0={x:.5*meta.camera.width,y:0},this.p1={x:.5*-meta.camera.width,y:300}),this.makeFormation()},animate:function(t){if(!this.finished){this.angleTemp+=7.5*t,this.dir>0?this.progress+=.5*t:this.progress-=.5*t,this.progress>=1&&this.progress<3?this.owner.canFire=!1:this.progress>=3&&(this.finished=!0,this.owner.onComplete());for(var e,i,s,n=this.originalNum;--n>=0;)void 0!==this.members[n]&&(s=this.members[n],e=s.pos,i=10*Math.sin(this.angleTemp),this.dir>0&&(s.x=this.p0.x+(this.tP.x-this.p0.x)*(this.progress-e),s.y=this.p0.y+(this.tP.y-this.p0.y)*(this.progress-e)+i),this.angleTemp+=this.step,s.z=s.absY+s.altitudeZ)}}})},function(t,e,i){"use strict";meta.class("Enemy.PatternTank","Enemy.BasePattern",{arrived:null,diffY:0,dur:2,lane:0,moveRate:400,startY:0,stopPoint:-200,t:0,tank:null,set game(t){this._game=t,this.tank.x=this.lane*this._game.laneWidth-this._game.lanePad},makeFormation:function(){this.arrived=!1,this.tank=this.members[0],this.tank.y=this.startY=meta.camera.height+300,this.tank.canKill(!1),this.diffY=-200-this.startY,this.lane=2+Math.ceil(2*Math.random())},easeOutSine:function(t,e,i,s){return i*Math.sin(t/s*(Math.PI/2))+e},animate:function(t){this.t+=t,this.t>=this.dur?this.arrived||(this.arrived=!0,this.tank.canKill(!0)):this.tank.y=this.easeOutSine(this.t,this.startY,this.diffY,this.dur),this.tank.z=this.tank.absY+130}})},function(t,e,i){"use strict";meta.class("Entity.GlobeCollectible","Entity.Geometry",{body:null,collected:!1,collectibleGroup:null,container:null,emitOffscreen:!0,isOnScreen:!1,onCreate:function(t){this.texture="all-coin",this.anim.loop=!0,this.pivot(.5,1),this.z=19,this.addCollider()},set group(t){this.collectibleGroup=t},reset:function(){this.z=19,this.texture="all-coin",this.anim.loop=!0,this.anim.pauseLastFrame=!1,this.collected=!1,this.container=null},destroy:function(){this.removeCollider(),this.collected=null,this.collectibleGroup=null,this.container=null,this.emitOffscreen=null,this.isOnScreen=null},onCollision:function(t){switch(t.entity.__lastName__){case"GlobeHero":this.kill(t.entity)}},addCollider:function(){if(null===this.body){this.body=this.addComponent(Physics.Body),this.body.onCollision=this.onCollision.bind(this);var t=new meta.math.AABB(0,0,70,50);t.pivot(.5,1),this.body.volume=t}},removeCollider:function(){this.body&&meta.physics.remove(this.body),this.body=null},kill:function(t){this.collected||(meta.emit(GameEventsChannel,5,GameEvents.GLOBE_COLLECTIBLE_COLLECTED),this.texture="all-coin-collect",this.anim.loop=!1,this.anim.pauseLastFrame=!0,this.collected=!0,t.onCollision(this.__lastName__))},onComplete:function(){this.collected=!0},update:function(t){this.absY>meta.camera.height?(this.emitOffscreen&&this.collected,this.hidden||this.collected||(this.setOnScreen(!1),this.onComplete())):this.absY<0?this.setOnScreen(!1):this.setOnScreen(!0)},setOnScreen:function(t){this.collected||(t?this.isOnScreen||(this.hidden=!1,this.isOnScreen=!0):this.isOnScreen&&(this.hidden=!0,this.isOnScreen=!1))}})},function(t,e,i){"use strict";meta.class("Entity.GlobeCollectibleGroup","Entity.Geometry",{fullH:null,game:null,id:0,items:null,set:null,loopCount:0,completed:!1,onCreate:function(t){this.items=[],this.parseData(),this.fullH=675},parseData:function(){var t;this.clearOut();for(var e=0;e<this.data.length;e++)for(var i=0;i<this.data[e].length;i++)1===this.data[e][i]?(t=this.set.requestItem("collectible"),t.gid=1):this.data[e][i],null!=t&&(t.x=(i+1)*this.game.laneWidth-3*this.game.laneWidth,t.y=e*this.game.laneWidth,t.game=this.game,t.container=this,t.hidden=!1,t.lane=i+1,this.attach(t),this.items.push(t)),t=null},clearOut:function(){if(0!==this.items.length)for(var t=this.items.length;--t>=0;)this.items[t].parent===this&&this.detach(this.items[t]),this.set.returnItem(this.items[t]);this.items=[]},destroy:function(){this.clearOut(),this.fullH=null,this.game=null,this.id=null,this.items=null,this.set=null,this.loopCount=null,this.completed=null},setUpNew:function(){var t=this.set.requestNewData(this.id,this.loopCount);null!==t?(this.data=t,this.parseData()):(this.clearOut(),this.completed=!0,this.set.completedSection(this))},reset:function(){},update:function(t){this.y+=t;for(var e=this.items.length;--e>=0;)this.items[e].update(this.y);this.y>=meta.camera.height&&(++this.loopCount,this.setUpNew(),this.set.setNewY(this))}})},function(t,e,i){"use strict";meta.class("Entity.GlobeDecal","Entity.Geometry",{_offScreen:!1,id:null,isHive:null,side:0,energy:null,pod:null,offScreenAtY:null,podX:null,podY:null,podOffsetX:null,podOffsetY:null,amp:10,freq:.5,time:0,decal_config:[{id:"booth",data:{texture:"globe-object-booth",height:268}},{id:"lights",data:{texture:"globe-decal-light",height:200}},{id:"pit",data:{texture:"globe-object-pit",height:402}},{id:"hive",data:{texture:"globe-object-hive-base",height:364}}],get offScreen(){return this._offScreen},set offScreen(t){this._offScreen=t},onCreate:function(t){this.pivot(1,1),this.setUp(this.decal_config[Math.floor(3*Math.random())]),this.offScreenAtY=meta.camera.height+800},setAsHive:function(){this.setUp(this.decal_config[3])},setUp:function(t){this.id=t.id,this.texture=t.data.texture,this.flip(-this.side,1),this.x=this.side>0?420:-420,this.id===this.decal_config[3].id?(this.isHive=!0,this.energy=new Entity.Geometry({texture:"globe-decal-hive-energy",pivotY:1,y:250,z:11,scaleX:2,scaleY:2}),this.energy.flip(-this.side,1),this.energy.x=this.side>0?320:-160,this.attach(this.energy),this.pod=new Entity.Geometry({texture:"globe-object-hive-pod",pivotX:.5,pivotY:1,y:-220,z:10}),this.pod.x=this.side>0?140:30,this.podX=this.pod.x,this.podY=this.pod.y,this.podOffsetX=0,this.podOffsetY=0,this.attach(this.pod)):this.isHive=!1},update:function(t,e){this.y+=t,this.isHive&&(this.time+=e,this.podOffsetX=this.amp*Math.cos(this.time*this.freq*Math.PI*2),this.pod.x=this.podX+this.podOffsetX,this.podOffsetY=this.amp*Math.sin(this.time*this.freq*Math.PI*2),this.pod.y=this.podY+this.podOffsetY),this.absY-this.height>=this.offScreenAtY&&(this._offScreen=!0)}})},function(t,e,i){"use strict";meta.class("Entity.GlobeDecals","Entity.Geometry",{decalsL:null,decalsR:null,onCreate:function(t){this.decalsL=[],this.decalsR=[];for(var e,i,s=0;s<20;s++)i=s%2==0?-1:1,e=new Entity.GlobeDecal({side:i}),i>0?this.decalsR.push(e):this.decalsL.push(e),this.attach(e);var n=Math.floor(10*Math.random());this.decalsL[n].setAsHive(),n=Math.floor(10*Math.random()),this.decalsR[n].setAsHive(),this.layOut()},layOut:function(){for(var t,e=meta.camera.height,i=0,s=0,n=0;n<10;n++)t=this.decalsL[n],t.y=e-i,i+=t.height,t=this.decalsR[n],t.y=e-s,s+=t.height},loopDecals:function(t,e,i){e.offScreen&&(e.y=0===t?i[9].y-i[9].height:i[t-1].y-i[t-1].height,e.offScreen=!1)},update:function(t,e){for(var i,s,n=10;--n>=0;)i=this.decalsL[n],s=this.decalsR[n],i.update(t,e),s.update(t,e),this.loopDecals(n,i,this.decalsL),this.loopDecals(n,s,this.decalsR)}})},function(t,e,i){"use strict";meta.class("Character.GlobeHero","Character.BaseCharacter",{autoFire:!0,body:null,changingLanes:!1,xDest:0,yDest:0,xRate:4,yRate:4,xTime:0,yTime:0,xDura:0,yDura:0,game:null,lane:3,gameY:380,onCreate:function(t){this.health=100,this.z=20,this.alignToFeet(),this.anchor(0,0),this.body=this.addComponent(Physics.Body),this.addComponent(Component.LaneMovement);var e=new meta.math.AABB(0,0,55,70);e.pivot(.5,1.3),this.body.volume=e,this.y=this.gameY,this.components.LaneMovement.resetLane()},destroy:function(){meta.physics.remove(this.components.Body),this.body=null,this.components={},this.texture=null,this.spritesheets=null,this.anim.onEnd=null},moveToLane:function(t){this.components.LaneMovement.moveToLane(t)},animateToY:function(t,e,i){this.components.LaneMovement.animateToY(t-this.totalOffsetY,e,i)},changeLane:function(t){5===this.lane&&t>0||1===this.lane&&t-1||this.components.LaneMovement.moveToLane(this.lane+t,this.game.laneTransition*(t>0?t:-t))},kill:function(){},handleDeath:function(){},win:function(){},onCollision:function(t){"GlobeObstacle"===t&&(this.health-=DamageRatings.ENEMY_MINE,this.health<=0&&(this.health=0),meta.emit(GameEventsChannel,this.health,GameEvents.UPDATE_UI_HEALTH),0===this.health&&meta.emit(GameEventsChannel,null,GameEvents.HERO_DEATH))},playHitEffect:function(){meta.emit(GameEventsChannel,{scale:2,x:this.absX+(50*Math.random()-25),y:this.absY+-50*Math.random(),z:1001,container:this.view},GameEvents.PLACE_EXPLOSION)}})},function(t,e,i){"use strict";meta.class("Entity.GlobeLevel","Entity.Geometry",{minelayer:null,game:null,groups:null,collectPool:null,obstaclePool:null,fullData:null,completedSections:null,curY:0,portal:null,decals:null,fxContainer:null,markers:null,onCreate:function(t){this.updating=!0,this.anchor(0,0),this.collectPool=new Utility.Pool,this.collectPool.addToPool(20,Entity.GlobeCollectible),this.obstaclePool=new Utility.Pool,this.obstaclePool.addToPool(20,Entity.GlobeObstacle),this.groups=[],this.completedSections=[],this.minelayer=new Entity.GlobeMineLayer({game:this.game,hero:this.game.hero}),this.attach(this.minelayer);var e,i,s;this.markers=[];for(var n=0;n<5;n++)s=new Entity.Geometry({lane:n+1,x:this.minelayer.getLaneX(n+1),y:this.minelayer.bY}),this.attach(s),i=s.addComponent(Physics.Body),e=new meta.math.AABB(0,0,5,50),e.pivot(.5),i.volume=e,this.markers.push(s);this.portal=new Entity.DunePortal({level:this,z:5}),this.fxContainer=new Entity.Geometry({z:25}),this.attach(this.fxContainer)},addGroup:function(t){this.groups.push(t),this.attach(t)},layOut:function(){for(var t=0;t<this.groups.length;t++)this.groups[t].y=-(t+1)*this.groups[t].fullH},setNewY:function(t){var e;e=0===t.id?this.groups[this.groups.length-1].y:this.groups[t.id-1].y,t.y=e-t.fullH},requestItem:function(t){switch(t){case"collectible":return this.collectPool.emit();case"obstacle":return this.obstaclePool.emit()}},returnItem:function(t){"GlobeCollectible"===t.__lastName__?this.collectPool.recycle(t):"GlobeObstacle"===t.__lastName__&&this.obstaclePool.recycle(t)},requestNewData:function(t,e){var i=t+4*e;return i>=this.fullData.length?null:this.fullData[i]},completedSection:function(t){for(var e=!0,i=this.completedSections.length;--i>=0;)if(this.completedSections[t]===t){e=!1;break}e&&this.completedSections.push(t),this.completedSections.length===this.groups.length&&(this.minelayer.flyOut(),meta.createTimer(this,function(){null===this.portal&&(this.portal=new Entity.DunePortal({level:this,z:5})),this.portal.setUp(3),this.portal.texture="all-portal-dune",this.attach(this.portal),this.game.hero.moveToLane(3),this.game.unsubscribeFromInteraction(),this.game.cameraRig.moveToLane(3)},1e3,1).play())},reset:function(){},cleanUp:function(){for(var t=this.groups.length;--t>=0;)this.groups[t].destroy();if(null!==this.fxContainer.children||void 0!=this.fxContainer.children)for(t=this.fxContainer.children.length;--t>=0;)this.fxContainer.children[t].remove();for(t=this.markers.length;--t>=0;)this.markers[t].remove();this.collectPool.destroy(),this.obstaclePool.destroy(),this.detach(this.minelayer),this.detach(this.portal),this.game=null,this.groups=null,this.collectPool=null,this.obstaclePool=null,this.fullData=null,this.completedSections=null,this.curY=null,this.minelayer=null,this.portal=null},update:function(t){var e=this.groups.length;for(this.curY=this.game.scrollRate*t;--e>=0;)this.groups[e].update(this.curY);if(this.decals.update(this.curY,t),this.minelayer.update(t),this.portal.active&&this.portal.update(this.curY,t),this.fxContainer.children){e=this.fxContainer.children.length;for(var i;--e>=0;)i=this.fxContainer.children[e],i.y+=this.curY,i.update&&i.update(this.curY,t)}}})},function(t,e,i){"use strict";meta.class("Utility.GlobeLevelBuilder",{game:null,init:function(t){this.initArg(t)},initArg:function(t){for(var e in t)this[e]=t[e]},build:function(t){for(var e,i=t.data,s=new Entity.GlobeLevel({game:this.game,fullData:i}),n=0;n<4;n++)e=new Entity.GlobeCollectibleGroup({game:this.game,data:i[n],set:s,id:n}),s.addGroup(e);return s.layOut(),this.game.view.attach(s),s}})},function(t,e,i){"use strict";meta.class("Entity.GlobeMineLayer","Entity.Shadowed",{body:null,game:null,hero:null,time:null,lane:null,targetTime:null,canCollide:!1,changingLanes:!1,animating:!1,bY:null,bOffsetY:null,amp:20,freq:.75,t:0,droppedAt:0,dropping:!1,state:null,states:{DROPPING_MINES:"dropping",STRAFING:"strafing",WAITING:"waiting"},mineDelay:.65,mineCount:0,mineSalvo:5,startX:0,diffX:0,moveMult:.35,moveTime:0,onCreate:function(t){this.texture="dune-enemy-drone-idle",this._makeShadow("dune-enemy-drone",30,50),this.time=0,this.targetTime=.3,this.y=-100,this.bY=260,this.z=30,this.pivot(.5,1),this.addComponent(Component.LaneMovement),this.components.LaneMovement.ease=meta.Tween.Easing.quadInOut,this.body=this.addComponent(Physics.Body),this.body.onCollision=this.onCollision.bind(this);var e=new meta.math.AABB(0,0,50,70);e.pivot(.5,1),this.body.volume=e,this.state=this.states.WAITING,this.flyIn()},getLaneX:function(t){return t*this.game.laneWidth-this.game.lanePad},onCollision:function(t){this.canCollide&&"Geometry"===t.entity.__lastName__&&this.droppedAt!==t.entity.lane&&(Math.random()<.5&&this.dropMine(this.getLaneX(t.entity.lane)),this.droppedAt=t.entity.lane)},dropMine:function(t){++this.mineCount;var e=this.game.level.requestItem("obstacle");e.x=t,e.y=this.y,e.game=this.game,e.tween.clear(),e.tween.to({y:e.y+60},250).easing(meta.Tween.Easing.bounceOut).play(),this.game.level.fxContainer&&this.game.level.fxContainer.attach(e),Sounds.play("sfx-mine-place")},flyIn:function(){this.animating=!0,this.tween.clear(),this.tween.wait(1e3).to({y:this.bY},1e3,this.flyInComplete.bind(this)).easing(meta.Tween.Easing.backOut).play()},flyInComplete:function(){this.animating=!1},flyOut:function(){this.animating=!0,this.tween.clear(),this.tween.wait(200).to({y:-100},1e3,this.flyOutComplete.bind(this)).easing(meta.Tween.Easing.backIn).play()},flyOutComplete:function(){},chooseNewLane:function(){var t=Math.ceil(5*Math.random());if(t===this.lane)this.time=this.mineDelay,this.mineCount=0,this.mineSalvo=5,this.state=this.states.DROPPING_MINES;else{var e=Math.abs(t-this.lane);this.time=0,this.diffX=this.getLaneX(t)-this.x,this.moveTime=e*this.moveMult,this.lane=t,this.canCollide=!0,this.startX=this.x,this.state=this.states.STRAFING}},easeInOutSine:function(t,e,i,s){return-i/2*(Math.cos(Math.PI*t/s)-1)+e},update:function(t){if(!this.animating)switch(this.t+=t,this.bOffsetY=this.amp*Math.sin(this.t*this.freq*Math.PI*2),this.y=this.bY+this.bOffsetY,this.time+=t,this.state){case this.states.DROPPING_MINES:this.time>=this.mineDelay&&(this.time=0,this.dropMine(this.getLaneX(this.lane)),this.mineCount===this.mineSalvo&&(this.time=0,this.state=this.states.WAITING));break;case this.states.STRAFING:this.x=this.easeInOutSine(this.time,this.startX,this.diffX,this.moveTime),this.time>=this.moveTime&&(this.time=0,this.canCollide=!1,this.droppedAt=0,this.state=this.states.WAITING);break;case this.states.WAITING:this.time>=this.targetTime&&(this.time=0,this.chooseNewLane())}}})},function(t,e,i){"use strict";meta.class("Entity.GlobeObstacle","Entity.GlobeCollectible",{body:null,onCreate:function(t){this.texture="globe-enemy-mine",this.pivot(.5,1),this.z=20,this.emitOffscreen=!1,this.addCollider()},onComplete:function(){this.collected=!0,this.game.level.fxContainer&&(this.game.level.fxContainer.detach(this),this.game.level.returnItem(this))},reset:function(){this.hidden=!1,this.collected=!1},kill:function(t){this.collected||(meta.emit(GameEventsChannel,{x:this.absX,y:this.absY},GameEvents.PLACE_EXPLOSION),meta.emit(GameEventsChannel,null,GameEvents.GLOBE_COLLECTIBLE_MISSED),this.hidden=!0,this.collected=!0,this.onComplete(),t.onCollision(this.__lastName__))}})},function(t,e,i){"use strict";meta.class("Entity.RaceCarSideHit","Entity.Geometry",{onCreate:function(t){this.texture="hit-white-2",this.anim.loop=!1,this.anim.pauseLastFrame=!0,this.pivot(.5)},reset:function(){}})},function(t,e,i){"use strict";meta.class("Entity.RaceChaseEnemy","Entity.RaceEnemy",{introAnim:!1,out:null,_speed:null,set speed(t){this._speed=t},onCreate:function(t){this.texture="race-enemy-car-idle",this.pivot(.5,.5),this.z=3,this.body=this.addComponent(Physics.Body),this.body.onCollision=this.onCollision.bind(this),this.out=!1,this.addComponent("LaneMovement"),this._makeShadow("race-enemy-car",0,0)},reset:function(){this.introAnim=!1,this.out=!1,this.count=0,this.blocked=!1,this.game&&(this.heroY=this.game.hero.y+this.game.hero.totalOffsetY),this.rT=0,this.lH=0,this.cH=0,this.rotMult=1+.5*Math.random(),this.angle=0,this.isDead=!1,this.shadow.alpha=1},onCollision:function(t){if(!this.isDead)switch(t.entity.__lastName__){case"RaceHero":t.entity.takeDamage(RaceCollisions.CHASE_ENEMY);case"RaceObstacle":case"RaceChaseEnemy":case"RaceEnemy":this.kill();break;case"RacePortal":this.blocked=!0,this._speed=0,this.skid()}},kill:function(){this.game.level.fxContainer&&null!=this.view&&this.isOnScreen&&meta.emit(GameEventsChannel,{x:this.absX,y:this.absY,container:this.game.level.fxContainer},GameEvents.PLACE_EXPLOSION),this.isDead=!0,this.skid()},skid:function(){this.tween.clear(),this.tween.to({angle:90*Math.random()-45},50).easing(meta.Tween.Easing.quadOut).play(),this.shadow.tween.to({alpha:0},100,function(){this.shadow.tween.clear()}.bind(this)).play()},update:function(t,e){this.out||(this.introAnim?(this.y-=this._speed,this.positionUpdate(t),this.isOnScreen||(this.container.onChaseEnemyOut(this),this.out=!0,this.container.detach(this))):(this.isDead||this.blocked?this.y+=t:this.y-=this._speed,this.positionUpdate(t)),this.z=this.absY)}})},function(t,e,i){"use strict";meta.class("Entity.RaceChaseGroup","Entity.Geometry",{cars:null,delay:2,c:0,level:null,onCreate:function(t){this.cars=[],this.pivot(.5)},addChaser:function(){for(var t,e,i,s=Math.ceil(2*Math.random()),n=0;n<s;n++)t=this.level.requestItem("chase"),e=Math.ceil(5*Math.random()),e===i&&--e,e<1&&(e=2),i=e,t.assign(e*GameSettings.LANE_WIDTH-GameSettings.LANE_PAD,meta.camera.height+100,this.level.game,this,e,RaceGIDs.CHASE_ENEMY),t.speed=Math.ceil(1+2*Math.random()),t.introAnim=!1,this.cars.push(t)},removeChaser:function(t){this.detach(t),this.level.returnItem(t)},update:function(t,e){this.c+=e,this.c>=this.delay&&(this.c=0,this.delay=1+2*Math.random(),this.addChaser());for(var i,s=this.cars.length;--s>=0;)i=this.cars[s],i.update(t,e),i.y>=meta.camera.height+200&&(this.removeChaser(i),this.cars.splice(s,1),--s)}})},function(t,e,i){"use strict";meta.class("Entity.RaceDecal","Entity.RaceObstacle",{gid:-1,onCreate:function(t){this.pivot(0,1),this.gid=t.gid,this.assignTexture(t.gid)},assignTexture:function(){switch(this.gid){case RaceGIDs.LAMP_POST:this.texture="race-decal-lampost"}},setUp:function(){this.assignTexture(),this.z=2e3,this.x<0?(this.flip(1,1),this.x=-412):(this.flip(-1,1),this.x=412)},reset:function(){}})},function(t,e,i){"use strict";meta.class("Entity.RaceDecals","Entity.Geometry",{decalsL:null,onCreate:function(t){this.decalsL=[];for(var e,i,s=0;s<8;s++)i=s%2==0?-1:1,e=new Entity.DuneDecal({texture:"race-decal-buildings",side:i}),i>0||(e.pivot(1,1),e.flip(1,1),e.x=-440,this.decalsL.push(e),Math.random()>.3&&(e._makeShadow("race-decal-buildings",120,Math.floor(200*Math.random())),e.z=510)),this.attach(e);this.layOut()},layOut:function(){for(var t,e=meta.camera.height,i=0,s=0;s<4;s++)t=this.decalsL[s],t.y=e-i,i+=t.height},loopDecals:function(t,e,i){e.offScreen&&(e.y=0===t?i[3].y-i[3].height:i[t-1].y-i[t-1].height,e.offScreen=!1)},update:function(t,e){for(var i,s=4;--s>=0;)i=this.decalsL[s],i.update(t,e),this.loopDecals(s,i,this.decalsL)}})},function(t,e,i){"use strict";meta.class("Entity.RaceEnemy","Entity.RaceEntity",{_delay:0,_speed:4,angleToHero:0,angleDiff:0,blocked:!1,count:0,heroY:0,lockOn:!1,lockOnHUD:null,turret:null,missileEmitter:null,rT:0,lH:0,cH:0,rotMult:1.25,isDead:!1,set delay(t){this._delay=.001*t},set speed(t){this._speed=t},onCreate:function(t){this.texture="race-enemy-heavy-idle",this.pivot(.5,.5),this.z=7,this.body=this.addComponent(Physics.Body),this.body.onCollision=this.onCollision.bind(this);var e=new meta.math.AABB(0,0,100,160);e.pivot(.5,.3),this.body.volume=e,this.turret=new Entity.Geometry("race-enemy-heavy-barrel"),this.turret.pivot(.85,.5),this.turret.x=61,this.turret.y=31,this.turret.angle=270,this.attach(this.turret);var i=new Resource.SVG;i.fillStyle="#993a00",i.rect(0,0,60,10),this.lockOnHUD=new Entity.Geometry,this.lockOnHUD.texture=i,this.lockOnHUD.pivot(0,.5),this.lockOnHUD.anchor(.5),this.lockOnHUD.scaleX=0,this.lockOnHUD.x=-30,this.lockOnHUD.y=-120,this.missileEmitter=new Utility.Pool,this.missileEmitter.addToPool(10,Entity.RaceMissile),this._makeShadow("race-enemy-heavy",20)},reset:function(){this.count=0,this.blocked=!1,this.game&&(this.heroY=this.game.hero.absY),this.rT=0,this.lH=0,this.cH=0,this.rotMult=1+.5*Math.random(),this.angle=0,this.isDead=!1,this.pivotX=.5,this.shadow.alpha=1,this.texture="race-enemy-heavy-idle",this.anim.loop=!0,this.anim.pauseLastFrame=!1,this.anim.resume()},setUp:function(){},onCollision:function(t){if(!this.isDead)switch(t.entity.__lastName__){case"RaceObstacle":case"RacePortal":if(!this.blocked){this.blocked=!0,this.anim.pause(),this.tween.clear();var e=this.y+5;this.tween.to({y:e,angle:30*Math.random()-15},300).easing(meta.Tween.Easing.quadOut).play()}}},fire:function(){return},kill:function(){this.isDead=!0,this.texture="race-enemy-heavy-crash",this.anim.loop=!1,this.anim.pauseLastFrame=!0,this.pivotX=.25,this.shadow.tween.to({alpha:0},100,function(){this.shadow.tween.clear()}.bind(this)).play()},update:function(t,e){this.positionUpdate(t),this.count+=e,this.count>this._delay&&this.container.isOnScreen&&(this.blocked||(this.y+=this._speed)),this.z=this.absY,this.z<1&&(this.z=1)}})},function(t,e,i){"use strict";meta.class("Entity.RaceEntity","Entity.Shadowed",{body:null,game:null,hitBox:null,isOnScreen:!1,lane:-1,obsType:null,init:function(t){this.volume=new meta.math.AABBext,this.anim=new Component.Anim,this.anim.owner=this,this.initArg(t),this.pivot(.5,0),this.hitBox=new meta.math.AABB(0,0,1,1),this.onCreate&&this.onCreate(t),this.reset()},onCreate:function(t){},reset:function(){},setUp:function(){},destroy:function(){},assign:function(t,e,i,s,n,a){this.x=t,this.y=e,this.game=i,this.container=s,this.lane=n,this.gid=a},addLaneCollision:function(){void 0===this.components.LaneCollision&&this.addComponent("LaneCollision"),this.components.LaneCollision.reset(),this.components.LaneCollision.lane=this.lane,this.components.LaneCollision.target=this.game.hero},setOnScreen:function(t){t?this.isOnScreen||(this.parent!==this.container&&this.container.attach(this),this.isOnScreen=!0):this.isOnScreen&&(this.isOnScreen=!1)},positionUpdate:function(t){t+this.y-this.height>meta.camera.height?(this.setOnScreen(!1),!this.hidden&&this.emitOffscreen&&(this.hidden=!0)):t+this.y+this.height<0?this.setOnScreen(!1):this.setOnScreen(!0)},update:function(t,e){this.positionUpdate(t)}})},function(t,e,i){"use strict";meta.class("Entity.RaceGroup","Entity.Geometry",{game:null,level:null,levelBuilder:null,objects:null,fullH:null,id:0,isOnScreen:!1,loopCount:0,completed:!1,onCreate:function(t){this.objects=[],this.setUpNew(),this.fullH=1350,this.pivot(.5)},clearOut:function(t){if(0!==this.objects.length){var e=this.objects.length;for(this.detachAll();--e>=0;)this.level.returnItem(this.objects[e])}this.objects=[]},destroy:function(){this.clearOut(!1),this.fullH=null,this.game=null,this.id=null,this.objects=null,this.level=null,this.loopCount=null,this.completed=null},setUpNew:function(){this.data=this.level.requestNewData(this.id,this.loopCount),this.showWreckingBall=this.level.wreckingBallOn===this.id,this.showWreckingBall&&(this.showWreckingBall=Math.random()>.5),this.clearOut(!0),this.levelBuilder.buildGroup(this.data,this)},reset:function(){},update:function(t,e){this.y+=t;for(var i=this.objects.length;--i>=0;)this.objects[i].update(this.y,e);this.y+1350>=0&&(this.isOnScreen=!0,this.showWreckingBall&&(this.level.addWreckingBall(),this.showWreckingBall=!1)),this.y>=meta.camera.height&&(this.isOnScreen=!1,++this.loopCount,this.setUpNew(),this.level.setNewY(this))}})},function(t,e,i){"use strict";meta.class("Character.RaceHero","Character.BaseCharacter",{armor:1,jumping:!1,reactingToCollision:!1,turnRate:null,asset:null,assetPivots:{x:.5,y:.5},turnPivots:{x:.5,y:.5},laneColliderL:null,laneColliderR:null,texturePrefix:null,onCreate:function(t){this.health=100,this.pivot(.5,.5),this.anchor(0,0),this.asset=new Entity.Geometry,this.asset.pivot(t.assetPivotX,.5),this.attach(this.asset),this.assetPivots.x=t.assetPivotX,this.assetPivots.y=.5,this.turnPivots.x=t.turnPivotX,this.turnPivots.y=t.turnPivotY,this.texturePrefix="race-player-"+t.prefix,this.setTexture("idle"),this._makeShadow(this.texturePrefix,t.shadowX,t.shadowY),this.body=this.addComponent(Physics.Body),this.body.onCollision=this.onCollision.bind(this),this.addComponent(Component.LaneMovement),this.addComponent(Component.RaceMovement);var e=new meta.math.AABB(0,0,55,140);e.pivot(.5,.5),this.body.volume=e,this.y=this.gameY,this.z=this.absY,this.components.LaneMovement.resetLane(),this.laneColliderL=new meta.math.AABB(0,0,60,40),this.laneColliderL.pivot(1,1),this.laneColliderR=new meta.math.AABB(0,0,60,40),this.laneColliderR.pivot(0,1),this.colliderL=new Entity.Geometry,this.colliderL.addComponent(Physics.Body),this.colliderL.components.Body.volume=this.laneColliderL,this.colliderL.x=-72.5,this.colliderL.y=-80,this.colliderR=new Entity.Geometry,this.colliderR.addComponent(Physics.Body),this.colliderR.components.Body.volume=this.laneColliderR,this.colliderR.x=80,this.colliderR.y=-80,this.attach(this.colliderL),this.attach(this.colliderR)},setTexture:function(t,e){switch(this.asset.texture=this.texturePrefix+"-"+t,this.asset.flipX=e,t){case"idle":this.asset.anim.loop=!0,this.asset.anim.pauseLastFrame=!1,this.asset.anim.resume(),this.asset.anim.onEnd=null,this.asset.pivot(this.assetPivots.x,this.assetPivots.y);break;case"turn":this.asset.anim.loop=!1,this.asset.anim.pauseLastFrame=!0,this.asset.anim.onEnd=this.setTexture.bind(this,"idle",1),this.asset.pivot(this.turnPivots.x,this.turnPivots.y)}},setUpForIntro:function(){this.asset.anim.pause()},goGoGo:function(){this.setTexture("idle")},moveToLane:function(t){this.components.LaneMovement.moveToLane(t)},animateToY:function(t,e,i){this.components.LaneMovement.animateToY(t-this.totalOffsetY,e,i)},tryJump:function(){this.jumping||this.changingLanes||(this.components.RaceMovement.jump(),Sounds.play("sfx-race-jump"))},changeLane:function(t){this.isDead||this.jumping||this.reactingToCollision||this.changingLanes||(this.components.RaceMovement.changeLane(t),this.setTexture("turn",t))},onChangeLaneComplete:function(){},bounceToLane:function(t){this.changingLanes=!0,this.reactingToCollision=!0,this.tween.clear(),this.components.RaceMovement.bounceToLane(this.lane+t,t),meta.emit(GameEventsChannel,{x:this.absX,y:this.absY-70,scale:2,container:this.view},GameEvents.PLACE_BULLET_HIT)},sideBump:function(t){this.reactingToCollision=!0,this.tween.clear(),this.components.RaceMovement.sideBump(t);var e=t<0?35:-35,i=t>0;meta.emit(GameEventsChannel,{x:this.absX+e,y:this.absY,scale:1,flipX:i,container:this.view},GameEvents.PLACE_CAR_SIDE_HIT),this.takeDamage(RaceCollisions.STATIC_OBSTACLE_SIDE)},onCollision:function(t){switch(t.entity.__lastName__){case"RaceObstacle":return void(t.entity.gid!==RaceGIDs.HOLE&&this.handleCollision(t.normal,t.entity));case"RaceEnemy":return void this.handleEnemyCollision(t.normal,t.entity)}},handleCollision:function(t,e){if(!this.jumping&&!this.isDead)return 14===e.gid?void this.tryJump():e.killOnCollision?void this.kill(RaceCollisions.STATIC_OBSTACLE):void(this.reactingToCollision||(this.prefix!==RaceVehiclesTypes.UPGRADE_3.id||e.gid<3||e.gid>5)&&(0===t.x?this.bounceToLane(-t.y):0===t.y&&this.sideBump(-t.x),this.takeDamage(RaceCollisions.STATIC_OBSTACLE)))},handleEnemyCollision:function(t,e){if(!this.jumping&&!this.isDead&&!e.isDead){if(0===t.x){if(this.reactingToCollision)return;this.takeDamage(RaceCollisions.TANK)}else if(0===t.y){if(this.reactingToCollision)return;this.sideBump(-t.x)}this.prefix===RaceVehiclesTypes.UPGRADE_3.id&&(meta.emit(GameEventsChannel,null,GameEvents.SHAKE_CAMERA),e.kill())}},playDeathSkid:function(){var t=this.asset.y;this.asset.tween.clear(),this.asset.tween.to({angle:180*Math.random()-90,y:t+60},150,function(){meta.emit(GameEventsChannel,null,GameEvents.RACE_LEVEL_LOSE)}).easing(meta.Tween.Easing.bounceOut).play()},handlePickup:function(t){switch(t){case PlayerStats.COINS:break;case PlayerStats.HEALTH:this.healDamage()}},takeDamage:function(t){switch(t){case RaceCollisions.MISSILE:this.health-=DamageRatings.ENEMY_MISSILE*this.armor;break;case RaceCollisions.STATIC_OBSTACLE:this.health-=DamageRatings.STATIC_OBSTACLE*this.armor;break;case RaceCollisions.STATIC_OBSTACLE_SIDE:this.health-=DamageRatings.STATIC_OBSTACLE_SIDE*this.armor;break;case RaceCollisions.CHASE_ENEMY:this.health-=DamageRatings.ENEMY_LIGHT_COLLISION*this.armor;break;case RaceCollisions.TANK:this.prefix===RaceVehiclesTypes.UPGRADE_3.id?this.health-=DamageRatings.ENEMY_HEAVY_COLLISION*this.armor:this.health=0}this.health=Math.ceil(this.health),this.health<=0&&(this.health=0,this.kill(t)),meta.emit(GameEventsChannel,this.health,GameEvents.UPDATE_UI_HEALTH),meta.emit(GameEventsChannel,null,GameEvents.SHAKE_CAMERA)},healDamage:function(){this.health=100},kill:function(t,e){if(!this.isDead){switch(this.tween.clear(),t){case"RaceWreckingBall":meta.emit(GameEventsChannel,null,GameEvents.SHAKE_CAMERA);var i=this.y,s=e>0?160:-260;this.tween.to({angle:3*(360*Math.random()-180),y:i+s},2.5*Math.abs(s),function(){meta.emit(GameEventsChannel,null,GameEvents.RACE_LEVEL_LOSE)}).easing(meta.Tween.Easing.quadOut).play(),this.game.level.fxContainer&&meta.emit(GameEventsChannel,{x:this.absX,y:this.absY,z:1e3,container:this.game.level.fxContainer},GameEvents.PLACE_EXPLOSION);break;case RaceCollisions.MISSILE:this.playDeathSkid(),this.game.level.fxContainer&&meta.emit(GameEventsChannel,{x:this.absX,y:this.absY,z:1e3,container:this.game.level.fxContainer},GameEvents.PLACE_EXPLOSION);break;case RaceCollisions.CHASE_ENEMY:case RaceCollisions.STATIC_OBSTACLE:case RaceCollisions.STATIC_OBSTACLE_SIDE:case RaceCollisions.TANK:this.playDeathSkid(),this.game.level.fxContainer&&meta.emit(GameEventsChannel,{x:this.absX,y:this.absY,z:1e3,container:this.game.level.fxContainer},GameEvents.PLACE_EXPLOSION)}this.isDead=!0,this.asset.anim.pause(),this.shadow.tween.to({alpha:0},80,function(){this.shadow.tween.clear()}.bind(this)).play()}}})},function(t,e,i){"use strict";meta.class("Entity.RaceIntro","Entity.RaceGroup",{lights:null,offCount:null,setUp:function(){this.lights=new Entity.RaceStartLine,this.lights.introComplete=this.introComplete.bind(this),this.attach(this.lights);for(var t,e=1,i=600,s=1,n=0;n<15;n++)2!==n?(t=this.level.requestItem("chase"),t.assign(0,i,this.game,this,e,RaceGIDs.CHASE_ENEMY),t.speed=5-s+2*Math.random(),t.introAnim=!0,t.anim.pause(),t.components.LaneMovement.resetLane(e),t.y=i,++e>5&&(e=1,i+=200,++s),this.attach(t),this.objects.push(t)):++e;this.offCount=0},gogogo:function(){for(var t=this.objects.length;--t>=0;)this.objects[t].anim.resume()},onChaseEnemyOut:function(t){++this.offCount>=this.objects.length||this.offCount===this.objects.length/2&&this.level.introHeroMove()},introComplete:function(){this.level.introComplete(),meta.createTimer(this,function(){this.objects=null},300,1).play()},setUpNew:function(){},clearOut:function(t){if(0!==this.objects.length){var e,i=this.objects.length;for(this.detachAll();--i>=0;)e=this.objects[i],this.level.returnItem(e)}this.objects=[]},update:function(t,e){if(this.y+=t,null!==this.objects)for(var i=this.objects.length;--i>=0;)this.objects[i].update(this.y,e)}})},function(t,e,i){"use strict";meta.class("Entity.RaceLevel","Entity.Geometry",{game:null,ground:null,chasers:null,groups:null,chasePool:null,enemyPool:null,lampPostPool:null,obstaclePool:null,pickupPool:null,portalPool:null,wreckingBall:null,wreckingBallPlaying:!1,fullData:null,curY:0,globalY:0,maximumY:0,introGroup:null,introPlaying:!1,lightsGreen:!1,fxContainer:null,onCreate:function(t){this.updating=!0,this.pivot(.5,0),this.anchor(0,0),this.chasePool=new Utility.Pool,this.chasePool.addToPool(20,Entity.RaceChaseEnemy),this.enemyPool=new Utility.Pool,this.enemyPool.addToPool(20,Entity.RaceEnemy),this.obstaclePool=new Utility.Pool,this.obstaclePool.addToPool(100,Entity.RaceObstacle),this.pickupPool=new Utility.Pool,this.pickupPool.addToPool(20,Entity.RacePickup),this.lampPostPool=new Utility.Pool,this.lampPostPool.addToPool(10,Entity.RaceDecal,{gid:RaceGIDs.LAMP_POST}),this.portalPool=new Utility.Pool,this.portalPool.addToPool(10,Entity.RacePortal),this.wreckingBall=new Entity.RaceWreckingBall({game:this.game,container:this}),this.z=2,this.groups=[],this.chasers=new Entity.RaceChaseGroup({level:this}),this.attach(this.chasers),this.fxContainer=new Entity.Geometry({z:25}),this.attach(this.fxContainer)},requestItem:function(t){switch(t){case"chase":return this.chasePool.emit();case"decal":return this.lampPostPool.emit();case"enemy":return this.enemyPool.emit();case"obstacle":return this.obstaclePool.emit();case"pickup":return this.pickupPool.emit();case"portal":return this.portalPool.emit()}},returnItem:function(t){switch(t.__lastName__){case"RaceChaseEnemy":this.chasePool.recycle(t);break;case"RaceDecal":this.lampPostPool.recycle(t);break;case"RaceEnemy":this.enemyPool.recycle(t);break;case"RaceObstacle":this.obstaclePool.recycle(t);break;case"RacePickup":this.pickupPool.recycle(t);break;case"RacePortal":this.portalPool.recycle(t)}},addGroup:function(t){this.groups.push(t),this.attach(t)},addIntro:function(t){this.introPlaying=t,this.introPlaying&&(this.game.hero.y=600,this.game.hero.setUpForIntro(),this.introGroup=new Entity.RaceIntro({game:this.game,data:null,level:this,levelBuilder:null,id:-1}),this.introGroup.setUp(),this.attach(this.introGroup))},introGoGoGo:function(){this.lightsGreen=!0,this.introGroup.gogogo(),this.game.hero.goGoGo()},introHeroMove:function(){this.game.hero.animateToY(this.game.hero.gameY,0,1200),meta.createTimer(this,this.introComplete,1200,1).play()},introComplete:function(){this.detach(this.introGroup),this.introGroup=null,this.introPlaying=!1,this.game.subscribeToInteractionEvents()},addWreckingBall:function(){this.wreckingBallPlaying=!0,this.wreckingBall.setUp()},layOut:function(){for(var t=this.groups.length,e=0;e<t;e++)this.groups[e].y=-(e+1)*this.groups[e].fullH;this.maximumY=1350*this.fullData.length+meta.camera.height},setNewY:function(t){var e;e=0===t.id?this.groups[this.groups.length-1].y:this.groups[t.id-1].y,t.y=e-t.fullH},requestNewData:function(t,e){var i=Math.floor(Math.random()*this.fullData.length);return this.fullData[i]},stopScroll:function(t){t&&(this.updating=!1)},reset:function(){},destroy:function(){this.detach(this.chasers);for(var t=this.groups.length;--t>=0;)this.groups[t].destroy(),this.detach(this.groups[t]),this.groups[t].remove();if(null!==this.fxContainer.children||void 0!=this.fxContainer.children)for(t=this.fxContainer.children.length;--t>=0;)this.fxContainer.children[t].remove();this.enemyPool.destroy(),this.lampPostPool.destroy(),this.obstaclePool.destroy(),this.pickupPool.destroy(),this.portalPool.destroy(),this.chasers=null,this.ground=null,this.chasePool=null,this.game=null,this.groups=null,this.enemyPool=null,this.lampPostPool=null,this.obstaclePool=null,this.portalPool=null,this.fullData=null,this.curY=null,this.introPlaying=null,this.lightsGreen=null,this.wreckingBall=null,this.fxContainer=null},update:function(t){if(this.introPlaying)this.lightsGreen?(this.curY=this.game.scrollRate*t,this.introGroup.update(this.curY,t),this.decals.update(this.curY,t,this.globalY)):this.curY=0;else{this.curY=this.game.scrollRate*t;for(var e,i=this.groups.length;--i>=0;)e=this.groups[i],e.update(this.curY,t);if(this.chasers.update(this.curY,t),this.decals.update(this.curY,t,this.globalY),this.fxContainer.children)for(i=this.fxContainer.children.length;--i>=0;)this.fxContainer.children[i].y+=this.curY}this.globalY+=this.curY,this.ground.extUpdate(this.curY)}})},function(t,e,i){"use strict";meta.class("Utility.RaceLevelBuilder",{game:null,level:null,init:function(t){this.initArg(t)},initArg:function(t){for(var e in t)this[e]=t[e]},build:function(t){var e=t.data;this.level=new Entity.RaceLevel({game:this.game,fullData:e,wreckingBallOn:t.wreckingBallOn});for(var i,s=0;s<4;s++)i=new Entity.RaceGroup({game:this.game,data:e[s],level:this.level,levelBuilder:this,id:s}),this.level.addGroup(i);return this.level.layOut(),this.level},buildGroup:function(t,e){var i=t.collision,s=t.item;this.parseCollisions(i,e),this.parseItems(s,e);for(var n=e.objects.length;--n>=0;)e.objects[n].setUp()},parseCollisions:function(t,e){for(var i,s=[],n=-1,a=0;a<t.length;a++)for(var h=0;h<t[a].length;h++)t[a][h]>0&&t[a][h]<=RaceGIDs.JUMP?(i={},i.row=a,i.col=h,i.gid=t[a][h],s.push(i)):t[a][h]===RaceGIDs.HOLE?0===h&&a-n>2&&(n=a,u=t[a][h],o=this.newObstacle("obstacle",2,a,u,e),o.increaseXBounds(5),o.increaseYBounds(1),e.objects.push(o)):t[a][h]===RaceGIDs.BARRICADE&&(i={},i.row=a,i.col=h,i.gid=t[a][h],s.push(i)),i=null;var o,l=t.length,r=0,c=0,u=-1;for(a=0;a<l;a++){for(h=0;h<s.length;h++)s[h].col===a&&(s[h].gid!==u?(u=s[h].gid,o=this.newObstacle("obstacle",a,s[h].row,u,e),r=s[h].row,c=0,e.objects.push(o)):(c=s[h].row-r,c>1?(u=s[h].gid,o=this.newObstacle("obstacle",a,s[h].row,u,e),r=s[h].row,c=0,e.objects.push(o)):o.increaseYBounds(),r=s[h].row));u=-1}var m=this.newObstacle("decal",0,5,RaceGIDs.LAMP_POST,e);m&&e.objects.push(m);var d=this.newObstacle("decal",4,5,RaceGIDs.LAMP_POST,e);d&&e.objects.push(d)},newObstacle:function(t,e,i,s,n){var a=this.level.requestItem(t);return a.reset(),a.assign((e+1)*this.game.laneWidth-3*this.game.laneWidth,i*this.game.laneWidth,this.game,n,e+1,s),a},parseItems:function(t,e){for(var i,s,n,a=3*this.game.laneWidth,h=null,o=t.length,l=0;l<o;l++){s=t[l].length;for(var r=0;r<s;r++)if(0!==(n=t[l][r]))if(n instanceof Object)switch(n.gid){case RaceGIDs.ENEMY:i=this.level.requestItem("enemy"),i.assign((r+1)*this.game.laneWidth-a,l*this.game.laneWidth,this.game,e,r+1,n.gid),i.reset(),i.delay=n.delay,i.speed=n.speed,e.objects.push(i)}else{switch(n){case 98:h=this.level.requestItem("portal"),h.assign((r+1)*this.game.laneWidth-a,l*this.game.laneWidth+this.game.laneHalfWidth,this.game,e,r+1,n);break;case 99:h=null;break;default:h=this.level.requestItem("pickup"),h.assign((r+1)*this.game.laneWidth-a,l*this.game.laneWidth+this.game.laneHalfWidth,this.game,e,r+1,n)}null!==h&&e.objects.push(h),h=null}}}})},function(t,e,i){"use strict";meta.class("Entity.RaceMissile","Entity.Geometry",{body:null,camMin:0,lane:-1,pool:null,targetTypeA:null,targetTypeB:null,target:null,tX:-1,tY:-1,yRate:10,onCreate:function(t){var e=new Resource.SVG;e.fillStyle="#ff0000",e.circle(10),this.body=this.addComponent(Physics.Body);var i=new meta.math.AABB(0,0,10,10);i.pivot(.5),this.body.volume=i,this.body.onCollision=this.onCollision.bind(this),this.texture=e,this.pivot(.5),this.targetTypeA="RaceStaticObstacle",this.targetTypeB="RaceHero"},reset:function(){},fire:function(t,e,i,s){this.x=e.absX,this.y=e.absY+50,this.tX=i.absX,this.tY=i.absY,this.explosionContainer=s,this.target=i,this.tween.clear(),this.tween.to({x:this.tX,y:this.tY},400,this.kill.bind(this)).play()},kill:function(t){this.tween.clear(),null!==this.view&&this.view.detach(this),this.pool.recycle(this);var e,i;t?(e=t.x-(this.explosionContainer.x+this.explosionContainer.totalOffsetX),i=t.y-(this.explosionContainer.y+this.explosionContainer.totalOffsetY)):(e=this.tX-(this.explosionContainer.x+this.explosionContainer.totalOffsetX),i=this.tY-(this.explosionContainer.y+this.explosionContainer.totalOffsetY));var s={x:e,y:i,container:this.explosionContainer};meta.emit(GameEventsChannel,s,GameEvents.PLACE_EXPLOSION)},destroy:function(){null!==this.view&&this.view.detach(),meta.physics.remove(this.components.Body),this.body=null,this.pool=null,this.targetTypeA=null,this.targetTypeB=null},onCollision:function(t){switch(t.entity.__lastName__){case this.targetTypeA:t.entity.gid!==RaceGIDs.HOLE&&this.kill(this);break;case this.targetTypeB:this.kill(this),t.entity.takeDamage(RaceCollisions.MISSILE)}}})},function(t,e,i){"use strict";meta.class("Entity.RaceObstacle","Entity.RaceEntity",{xBounds:0,yBounds:0,extraImg:null,hitBox:null,killOnCollision:!1,reset:function(){this.xBounds=this.yBounds=GameSettings.LANE_WIDTH,this.pivot(.5,0),this.killOnCollision=!1,null!==this.extraImg&&this.extraImg.parent===this&&(this.extraImg.texture=null,this.detach(this.extraImg)),null!==this.shadow&&this.shadow.parent===this&&(this.shadow.texture=null,this.detach(this.shadow))},destroy:function(){null!==this.extraImg&&this.extraImg.parent===this&&this.detach(this.extraImg),null!==this.shadow&&this.shadow.parent===this&&this.detach(this.shadow),this.xBounds=null,this.yBounds=null,this.extraImg=null,this.hitBox=null,this.shadow=null},setUp:function(){var t=this.y;switch(this.gid){case RaceGIDs.BARRICADE:this.texture="race-obstacle-barricade-single",this.pivot(.5,1),this.y=t+this.game.laneWidth,this.z=5,this.hitBox.set(0,0,this.xBounds-2,this.yBounds-2),this.hitBox.pivot(.5,1),this.addEndCap(),this.killOnCollision=!0;break;case RaceGIDs.JUMP:this.texture="race-obstacle-ramp",this.pivot(.5,1),this.y=t+this.game.laneWidth,this.z=6,this.hitBox.set(0,0,this.xBounds-2,this.yBounds-2),this.hitBox.pivot(.5,1),this.addEndCap();break;case RaceGIDs.HOLE:this.texture="race-obstacle-jumpedge",this.pivot(.5,0),this.z=2,this.hitBox.set(0,0,this.xBounds-2,this.yBounds-2),this.hitBox.pivot(.5,0),this.hitBox.set(0,0,this.xBounds,20);break;case RaceGIDs.OBSTACLE_1:default:this.hitBox.set(0,0,this.xBounds-2,this.yBounds-2),this.hitBox.pivot(.5,0),this.makeWalls();break;case RaceGIDs.OBSTACLE_3:this.texture="race-obstacle-cone1",this.hitBox.set(0,0,this.xBounds-60,this.yBounds-30),this.hitBox.pivot(.5,0),this._makeShadow("race-obstacle-cone1",0,0);break;case RaceGIDs.OBSTACLE_4:this.texture="race-obstacle-cone2",this.hitBox.set(0,0,this.xBounds-40,this.yBounds-30),this.hitBox.pivot(.5,0),this._makeShadow("race-obstacle-cone2",0,0);break;case RaceGIDs.OBSTACLE_5:this.texture="race-obstacle-barrel1",this.hitBox.set(0,0,this.xBounds-60,this.yBounds-30),this.hitBox.pivot(.5,0),this._makeShadow("race-obstacle-barrel1",27,36);break;case RaceGIDs.OBSTACLE_6:this.texture="race-obstacle-barrel2",this.hitBox.set(0,0,this.xBounds-20,this.yBounds-30),this.hitBox.pivot(.5,0),this._makeShadow("race-obstacle-barrel2",25,36);break;case RaceGIDs.OBSTACLE_7:this.texture="race-obstacle-barricade",this.pivot(.3,0),this.hitBox.set(0,0,this.xBounds-20,this.yBounds-30),this.hitBox.pivot(.5,0),this._makeShadow("race-obstacle-barricade",0,66)}this.hitBox&&(null===this.body&&(this.body=this.addComponent(Physics.Body)),this.body.volume=this.hitBox)},addEndCap:function(){var t=!1;1===this.lane?(null===this.extraImg&&(this.extraImg=new Entity.Geometry),this.extraImg.texture="race-obstacle-barricade-endL",this.extraImg.pivot(1,1),this.extraImg.anchor(0,1),this.extraImg.x=5,this.extraImg.y=-30,t=!0):5===this.lane&&(null===this.extraImg&&(this.extraImg=new Entity.Geometry),this.extraImg.texture="race-obstacle-barricade-endR",this.extraImg.pivot(0,1),this.extraImg.anchor(1,1),this.extraImg.x=-5,this.extraImg.y=-30,t=!0),t&&this.attach(this.extraImg)},makeWalls:function(){var t=this.yBounds/135;t%3==0?(this.texture="race-obstacle-wallL",this._makeShadow(this.texture.name,55,52)):1===t&&(this.texture="race-obstacle-wallS",this._makeShadow(this.texture.name,55,52))},increaseXBounds:function(t){t?this.xBounds=GameSettings.LANE_WIDTH*t:this.xBounds+=GameSettings.LANE_WIDTH},increaseYBounds:function(t){t?this.yBounds=GameSettings.LANE_WIDTH*t:this.yBounds+=GameSettings.LANE_WIDTH}})},function(t,e,i){"use strict";meta.class("Entity.RacePickup","Entity.RaceEntity",{collected:!1,pickupType:null,onCreate:function(t){this.eventType=GameEvents.RACE_PICKUP,this.z=5},assign:function(t,e,i,s,n,a){this.x=t,this.y=e,this.game=i,this.container=s,this.lane=n,this.gid=a,this.addLaneCollision(),this.pickupType=Math.random()>.75?PlayerStats.HEALTH:PlayerStats.COINS,this.pickupType===PlayerStats.HEALTH?(this.texture="shared-object-health",this._makeShadow("shared-object-boost",12,90)):(this.texture="all-coin",this._makeShadow("shared-object-boost",6,56)),this.pivot(.5,1)},reset:function(){this.collected=!1,this.distY=0,this.components.LaneCollision&&this.components.LaneCollision.reset(),this.hidden=!1,null!==this.shadow&&(this.shadow.hidden=!1)},onAnimEnd:function(){this.anim.loop=!0,this.anim.pauseLastFrame=!1,this.anim.onEnd=null,this.hidden=!0},onCollision:function(){this.collected=!0,this.shadow.hidden=!0,this.texture="all-coin-collect",this.anim.frame=2,this.anim.loop=!1,this.anim.pauseLastFrame=!0,this.anim.onEnd=this.onAnimEnd.bind(this),meta.emit(GameEventsChannel,this.pickupType,this.eventType)},update:function(t,e){this.collected||(this.positionUpdate(t),this.isOnScreen&&this.components.LaneCollision.onUpdate(e),this.z=this.absY,this.z<1&&(this.z=1))}})},function(t,e,i){"use strict";meta.class("Entity.RacePortal","Entity.RaceEntity",{portalType:null,onCreate:function(t){this.texture="all-portal-dune",this.z=7,this.body=this.addComponent(Physics.Body)},setUp:function(){},reset:function(){this.pivot(.5,0)},assign:function(t,e,i,s,n,a){this.x=t,this.y=e,this.game=i,this.container=s,this.lane=n,this.gid=a,Math.random()>.2?(this.portalType=GameSettings.PORTAL_DUNE,this.texture="all-portal-dune"):(this.portalType=GameSettings.PORTAL_GLOBE,this.texture="all-portal-globe"),this.addLaneCollision()},onCollision:function(){meta.emit(GameEventsChannel,this.portalType,GameEvents.RACE_PORTAL_ENTERED)},update:function(t,e){this.positionUpdate(t),this.isOnScreen&&this.components.LaneCollision.onUpdate(e),this.z=this.absY,this.z<1&&(this.z=1)}})},function(t,e,i){"use strict";meta.class("Entity.RaceStartLine","Entity.Shadowed",{count:0,r1:null,r2:null,y1:null,g1:null,lights:null,timer:null,confetti:null,particles:null,instructions:null,green:null,onCreate:function(t){this.texture="race-decal-startingline",this.pivot(.5,0),this.y=70,this.z=1801,this._makeShadow(this.texture.name,10,360),this.lights=[],this.r1=new Entity.Geometry({texture:"race-decal-startingline-red",x:333,y:92,pivotX:.5,pivotY:.5}),this.attach(this.r1),this.r2=new Entity.Geometry({texture:"race-decal-startingline-red",x:369,y:92,pivotX:.5,pivotY:.5}),this.attach(this.r2),this.y1=new Entity.Geometry({texture:"race-decal-startingline-yellow",x:406,y:92,pivotX:.5,pivotY:.5}),this.attach(this.y1),this.g1=new Entity.Geometry({texture:"race-decal-startingline-green",x:443,y:92,pivotX:.5,pivotY:.5}),this.attach(this.g1),this.lights.push(this.r1),this.lights.push(this.r2),this.lights.push(this.y1),this.lights.push(this.g1),this.confetti=new Utility.Pool,this.green=new Resource.SVG,this.green.fillStyle="#00ff00",this.green.rect(0,0,8,8),this.confetti.addToPool(50,Entity.Geometry,{texture:this.green,pivotX:.5,pivotY:.5}),this.confetti.x=0,this.confetti.y=300,this.particles=[],this.instructions=new Entity.Instructions({owner:this,anchorX:.5,anchorY:0,pivotX:.5,pivotY:0}),this.attach(this.instructions),this.setAllOff(),this.instructions.enableInteraction()},setAllOff:function(){for(var t=this.lights.length;--t>=0;)this.lights[t].alpha=0},onCloseInstructions:function(){this.startCountdown(),this.instructions.tween.clear(),this.instructions.tween.to({y:this.instructions.y+800,alpha:0},1e3,function(){this.detach(this.instructions)}.bind(this)).easing(meta.Tween.Easing.backIn).play()},startCountdown:function(){this.timer=meta.createTimer(this,this.nextLight,1e3,4).play()},nextLight:function(){if(this.count>=this.lights.length-1){this.lights[this.count].alpha=1,meta.emit(GameEventsChannel,null,GameEvents.RACE_GO_GO_GO),Sounds.play("sfx-race-gogogo");for(var t,e,i,s=50;--s>=0;)t=this.confetti.emit(),i=Math.random(),e=this.green,t.texture=e,s>25?(t.x=this.confetti.x,t.strX=10*Math.random()):(t.x=this.confetti.x+70+675,t.strX=-10*Math.random()),t.y=this.confetti.y,t.strY=10*i,this.attach(t),this.particles.push(t);this.updating=!0}else this.lights[this.count].alpha=1,++this.count,Sounds.play("sfx-race-light")},update:function(t){for(var e,i=50;--i>=0;)e=this.particles[i],e.x+=e.strX,e.y-=e.strY,e.strY*=.98}})},function(t,e,i){"use strict";meta.class("Entity.RaceWreckingBall","Entity.Geometry",{dir:1,t:0,d:1.4,container:null,game:null,lane:3,shadow:null,s:1,stage:-1,stages:{WARNING:0,ATTACK:1},swings:0,warning:null,warnCount:0,canCollide:null,onCreate:function(t){this.texture="race-obstacle-wreckingball",this.startSwing(),this.pivot(.5,0),this.z=5001;var e=new Resource.SVG;e.fillStyle="#000000",e.circle(100),this.shadow=new Entity.Geometry(e),this.shadow.z=7,this.shadow.alpha=.25,this.shadow.pivot(.5),this.shadow.minY=0,this.flip(1,-1),this.y=meta.camera.height,this.startY=this.y,this.endY=this.startY-300,this.warning=new Entity.Geometry({texture:"race-ui-wbwarning",z:3e3}),this.warning.pivot(.5),this.warning.y=200;var i=new Entity.Geometry({x:100,y:100});this.attach(i),i.addComponent(Physics.Body);var s=new meta.math.AABB(0,0,100,100);s.pivot(.5),i.components.Body.volume=s,i.components.Body.onCollision=this.onCollision.bind(this)},setUp:function(){this.stage=this.stages.WARNING,this.warnCount=0,this.canCollide=!1,this.container.attach(this.warning),this.container.attach(this),this.container.attach(this.shadow),this.alpha=0,this.warning.hidden=!1,this.shadow.hidden=!0,this.updating=!0,this.swings=0,this.lane=Math.ceil(5*Math.random()),this.x=this.warning.x=this.lane*this.game.laneWidth-this.game.lanePad,Sounds.play("sfx-race-wrecking-ball-warning")},startSwing:function(){},endSwing:function(){this.updating=!1,this.container.detach(this.warning),this.container.detach(this),this.container.detach(this.shadow),this.game.level.wreckingBallPlaying=!1},distanceToHero:function(){return this.game.hero.y+this.game.hero.totalOffsetY-(this.y+this.totalOffsetY-this.height)},easeInOutSine:function(t,e,i,s){return-i/2*(Math.cos(Math.PI*t/s)-1)+e},easeOutSine:function(t,e,i,s){return i*Math.sin(t/s*(Math.PI/2))+e},onCollision:function(t){if(this.canCollide&&t.entity.lane===this.lane)switch(t.entity.__lastName__){case"RaceHero":t.entity.isDead||(Sounds.play("sfx-race-wrecking-ball-impact"),t.entity.kill(this.__lastName__,this.dir));break;case"RaceEnemy":t.entity.isDead||(Sounds.play("sfx-race-wrecking-ball-impact"),t.entity.kill(),this.game.level.fxContainer&&meta.emit(GameEventsChannel,{x:this.absX,y:this.absY,z:1e3,container:this.game.level.fxContainer},GameEvents.PLACE_EXPLOSION));break;case"RaceChaseEnemy":t.entity.isDead||(Sounds.play("sfx-race-wrecking-ball-impact"),t.entity.kill())}},update:function(t){this.stage===this.stages.WARNING?this.dir>0?(this.warning.alpha+=2.5*t,this.warning.alpha>=1&&(this.warning.alpha=1,this.dir=-1,Sounds.play("sfx-race-wrecking-ball-warning"))):(this.warning.alpha-=2.5*t,this.warning.alpha<0&&(this.warning.alpha=0,this.dir=1,++this.warnCount>=3&&(Sounds.play("sfx-race-wrecking-ball-swing"),this.stage=this.stages.ATTACK,this.warning.hidden=!0,this.shadow.hidden=!1,this.alpha=1))):(this.t+=t,this.dir>0?(this.y=this.easeInOutSine(this.t,this.startY,this.endY,this.d),this.scale(this.easeInOutSine(this.t,2,-1.65,this.d)),this.shadow.scale(this.easeInOutSine(this.t,2,-2,this.d)),this.t>=this.d&&(this.dir=-1,this.t=0,++this.swings>1?this.endSwing():Sounds.play("sfx-race-wrecking-ball-swing")),this.shadow.y=this.easeInOutSine(this.t,this.startY-1e3,this.endY+500,this.d)):(this.y=this.easeInOutSine(this.t,this.startY+this.endY,-this.endY,this.d),this.scale(this.easeInOutSine(this.t,.35,1.65,this.d)),this.shadow.scale(this.easeInOutSine(this.t,0,2,this.d)),this.t>=this.d&&(this.dir=1,this.t=0,Sounds.play("sfx-race-wrecking-ball-swing")),this.shadow.y=this.easeInOutSine(this.t,this.startY-1e3+this.endY+500,-(this.endY+500),this.d)),this.scaleX<1.35&&this.scaleX>1?this.canCollide=!0:this.canCollide=!1,this.shadow.x=this.x)}})},function(t,e,i){"use strict";meta.class("Entity.ShoppeCatalogue","Entity.Geometry",{bgLines:null,items:null,page:0,pages:0,pageL:null,pageR:null,pageW:0,catalogueType:null,header:null,ticker:null,tickerLabel:null,get boundsY(){return this.absY+this.ticker.y},onCreate:function(t){this.pivot(.5),this.anchor(.5,0),this.catalogueType=t.catalogueType,this.header=new Entity.Geometry({texture:"ui-header-"+this.catalogueType,pivotX:.5,pivotY:0,anchorX:.5,anchorY:0}),this.bgLines=new Entity.Geometry({texture:"ui-bg-"+this.catalogueType,pivotX:.5,pivotY:.9,anchorX:.5,anchorY:0,z:-1,scaleX:4}),this.addItems();var e,i=GameSettings.Strings.store,s=GameSettings.textType;i.useText?(e=new Entity.UILabel,e.color=i[this.catalogueType+"Color"],e.size=i[this.catalogueType+s+"Size"],e.text=i[this.catalogueType],e.pivot(.5,1),e.anchor(.5,1),e.y=i[this.catalogueType+s+"Y"]):e=new Entity.Geometry({texture:"ui-header-"+this.catalogueType+"-text",pivotX:.5,pivotY:1,anchorX:.5,anchorY:1}),this.header.attach(e),this.bgLines.y=this.items[0].y+this.items[0].height,this.ticker=new Entity.Geometry({texture:"ui-element-nameticker",pivotX:.5,pivotY:0}),this.ticker.y=this.bgLines.y+11,this.tickerLabel=new Entity.UILabel,this.tickerLabel.pivot(.5),this.tickerLabel.anchor(.5),this.tickerLabel.y=2,this.tickerLabel.z=3,this.tickerLabel.size=GameSettings.Strings.store[this.catalogueType+"LabelSize"],this.attach(this.bgLines),this.attach(this.header),meta.subscribe(ShoppeEventsChannel,this.onEvent,this)},addItems:function(){this.items=[];for(var t,e=-384,i=0,s="gun"===this.catalogueType?DuneGunTypesArray:RaceVehiclesTypesArray,n=0;n<4;n++)t=new Entity.ShoppeItem({id:s[n].id,itemType:this.catalogueType,props:s[n]}),t.x=e,t.y=this.header.height+10,this.attach(t),this.items.push(t),e+=t.width,i+=t.width;var a=meta.camera.width;if(i>a){var h=a/i,o=192*h*2;for(e=-o,n=0;n<4;n++)t=this.items[n],t.x=e,t.scale(h),e+=t.width}},transitionIn:function(t){this.alpha=0,this.tween.clear(),this.tween.wait(t).to({alpha:1},350,function(){this.tween.clear()}.bind(this)).play()},refreshCatalogue:function(){for(var t=App.getProxy("ProgressProxy"),e="gun"===this.catalogueType?t.purchasedWeapons:t.purchasedVehicles,i=t.coins,s="gun"===this.catalogueType?t.equippedWeapon:t.equippedVehicle,n=0;n<e.length;n++)for(var a=this.items.length;--a>=0;){var h=this.items[a];e[n].id===h.id&&h.updateState(h.states.PURCHASED)}for(a=this.items.length;--a>=0;)h=this.items[a],h.id!==s.id?h.state!==h.states.PURCHASED&&(h.priceVal>i?h.updateState(h.states.LOCKED):h.updateState(h.states.UNLOCKED)):h.updateState(h.states.EQUIPPED)},equipItem:function(t){this.tickerLabel.text=t.description;for(var e,i=0;i<this.items.length;i++)if(e=this.items[i],e.id!==t.id&&e.state===e.states.EQUIPPED)e.updateState(e.states.PURCHASED);else if(e.id===t.id){e.updateState(e.states.EQUIPPED);break}var s=App.getProxy("ProgressProxy");"gun"===this.catalogueType?s.equippedWeapon=e:s.equippedVehicle=e,this.updateTicker(e.description),this.refreshCatalogue()},updateTicker:function(t){this.tickerLabel.alpha=0,this.tickerLabel.x=300,this.tickerLabel.tween.clear(),this.tickerLabel.tween.wait(150).to({alpha:1,x:0},500,function(){this.tween.clear()}.bind(this.tickerLabel)).easing(meta.Tween.Easing.backOut).play(),this.tickerLabel.text=t},enable:function(){this.enableItems(),this.refreshCatalogue()},disable:function(){this.disableItems()},enableItems:function(){for(var t=this.items.length;--t>=0;)this.items[t].enable()},disableItems:function(){for(var t=this.items.length;--t>=0;)this.items[t].disable()},scrollToPage:function(t){this.disableItems();var e=this.page+t;e>this.pages?e=this.pages:e<0&&(e=0),this.page=e,this.tween.clear(),this.tween.to({x:-this.page*this.pageW},1e3,this.onScrollComplete.bind(this)).easing(meta.Tween.Easing.backOut).play()},onScrollComplete:function(){this.enableItems()},onInputUp:function(t){this.owner.scrollToPage(this.dir)},onEvent:function(t,e){switch(e){case ShoppeEvents.ITEM_EQUIPPED:t.catalogue===this.catalogueType&&this.equipItem(t);break;case ShoppeEvents.ITEM_SELECTED:t.catalogue===this.catalogueType&&this.updateTicker(t.label),this.disable();break;case ShoppeEvents.CONFIRM_CLOSED:this.enable()}}})},function(t,e,i){"use strict";meta.class("Entity.ShoppeItem","Entity.Geometry",{id:0,border:null,icon:null,iconTexture:null,description:null,price:null,priceVal:0,purchased:!1,state:-1,states:{UNLOCKED:0,LOCKED:1,PURCHASED:2,EQUIPPED:3},onCreate:function(t){this.itemType=t.itemType,this.border=new Entity.Geometry({z:0}),this.border.texture="ui-item-frame-"+this.itemType,this.attach(this.border),this.icon=new Entity.Geometry({texture:t.props.shoppe,pivotX:.5,pivotY:.5,anchorX:.5,anchorY:.5,z:1}),this.attach(this.icon),this.description=GameSettings.Strings.store[this.itemType+t.props.numID],this.iconTexture=t.props.shoppe,this.price=new Entity.UILabel,this.price.pivot(.5,.95),this.price.anchor(.5,1),this.price.color="white",this.price.text=t.props.price,this.priceVal=t.props.price,this.attach(this.price),this.anchor(.5,0),this.updateState(this.states.LOCKED)},refresh:function(){this.price.refresh()},enable:function(){this.state===this.states.PURCHASED?this.onDown=function(t){Sounds.play("sfx-button-positive"),meta.emit(ShoppeEventsChannel,{id:this.id,label:this.description,texture:this.iconTexture,price:this.priceVal,catalogue:this.itemType},ShoppeEvents.ITEM_EQUIPPED)}:this.state===this.states.UNLOCKED&&(this.onDown=function(t){Sounds.play("sfx-button-positive"),meta.emit(ShoppeEventsChannel,{id:this.id,label:this.description,texture:this.iconTexture,price:this.priceVal,catalogue:this.itemType},ShoppeEvents.ITEM_SELECTED)}),this.refresh(),this.picking=!0},disable:function(){this.onDown=null,this.picking=!1},updateState:function(t){switch(this.state=t,this.price.hidden=!1,this.border.hidden=!1,this.icon.alpha=1,t){case this.states.UNLOCKED:this.texture="ui-item-locked",this.price.color="white",this.enable();break;case this.states.LOCKED:this.texture="ui-item-locked",this.price.color="red",this.icon.alpha=.5,this.disable();break;case this.states.PURCHASED:this.texture="ui-item-unlocked",this.price.hidden=!0,this.enable();break;case this.states.EQUIPPED:this.texture="ui-item-equipped",this.price.hidden=!0,this.disable()}this.price.refresh()}})},function(t,e,i){"use strict";meta.class("Entity.ShoppeSnapContent","Entity.Geometry",{bgLines:null,item:null,page:0,pages:0,pageL:null,pageR:null,pageW:0,catalogueType:null,header:null,buffer:10,get boundsY(){return this.absY+this.item.y+this.item.height+this.buffer},onCreate:function(t){this.pivot(.5),this.anchor(.5,0),this.buffer=this.buffer*meta.camera.zoom,this.catalogueType=t.catalogueType,this.header=new Entity.Geometry({texture:"ui-header-"+this.catalogueType,pivotX:.5,pivotY:0,anchorX:.5,anchorY:0}),this.bgLines=new Entity.Geometry({texture:"ui-bg-"+this.catalogueType,pivotX:.5,pivotY:.9,anchorX:.5,anchorY:0,z:-1,scaleX:4});var e,i=GameSettings.Strings.store,s=GameSettings.textType;i.useText?(e=new Entity.UILabel,e.color=i[this.catalogueType+"Color"],e.size=i[this.catalogueType+s+"Size"],e.text=i[this.catalogueType],e.pivot(.5,1),e.anchor(.5,1),e.y=i[this.catalogueType+s+"Y"]):e=new Entity.Geometry({texture:"ui-header-"+this.catalogueType+"-text",pivotX:.5,pivotY:1,anchorX:.5,anchorY:1}),this.header.attach(e),this.item=new Entity.ShoppeSnapItem({itemType:this.catalogueType}),this.item.y=this.header.height+this.buffer,this.attach(this.item),this.bgLines.y=this.item.y+.5*this.item.height,this.attach(this.bgLines),this.attach(this.header)},equipItem:function(t){this.item.setIcon(t)}})},function(t,e,i){"use strict";meta.class("Entity.ShoppeSnapItem","Entity.Geometry",{id:0,border:null,icon:null,purchased:!1,state:-1,states:{UNLOCKED:0,LOCKED:1,PURCHASED:2,EQUIPPED:3},onCreate:function(t){this.itemType=t.itemType,this.border=new Entity.Geometry({z:0}),this.border.texture="ui-item-frame-"+this.itemType,this.attach(this.border),this.icon=new Entity.Geometry({pivotX:.5,pivotY:.5,anchorX:.5,anchorY:.5,z:100}),this.attach(this.icon),this.pivot(.5,0),this.anchor(.5,0),this.scale(1.75),this.updateState(this.states.EQUIPPED)},setIcon:function(t){this.icon.texture=t},updateState:function(t){this.state=t,this.border.hidden=!1,this.texture="ui-item-equipped"}})},function(t,e,i){"use strict";window.GameEventsChannel="GameEventsChannel.",window.GameEvents={COIN_COLLECTED:GameEventsChannel+"coinCollected",SHIELD_COLLECTED:GameEventsChannel+"shieldCollected",ENEMY_KILLED:GameEventsChannel+"duneEnemyKilled",DUNE_LEVEL_LOSE:GameEventsChannel+"duneLevelLose",DUNE_PICKUP:GameEventsChannel+"dunePickup",DUNE_PORTAL_ENTERED:GameEventsChannel+"dunePortalEntered",HERO_DEATH:GameEventsChannel+"heroDeath",NEW_RUN:GameEventsChannel+"newRun",GLOBE_COLLECTIBLE_COLLECTED:GameEventsChannel+"globeCollectibleCollected",GLOBE_COLLECTIBLE_MISSED:GameEventsChannel+"globeCollectibleMissed",GLOBE_LEVEL_LOSE:GameEventsChannel+"globeLevelLose",GLOBE_LEVEL_WIN:GameEventsChannel+"globeLevelWin",PLACE_GLOBE_COLLECT_EFFECT:GameEventsChannel+"placeGlobeCollectEffect",LANE_CHANGE:GameEventsChannel+"laneChange",SHAKE_CAMERA:GameEventsChannel+"shakeCamera",PAUSE_FOLLOW:GameEventsChannel+"stopFollow",RESUME_FOLLOW:GameEventsChannel+"resumeFollow",PLACE_BULLET_HIT:GameEventsChannel+"placeBulletHit",PLACE_BULLET_HIT_ENEMY:GameEventsChannel+"placeBulletHitEnemy",PLACE_CAR_SIDE_HIT:GameEventsChannel+"placeCarSideHit",PLACE_EXPLOSION:GameEventsChannel+"placeExplosion",PLACE_DAMAGE_RADIUS:GameEventsChannel+"placeDamageRadius",RACE_LEVEL_LOSE:GameEventsChannel+"raceLevelLose",RACE_PICKUP:GameEventsChannel+"racePickup",RACE_PORTAL_ENTERED:GameEventsChannel+"racePortalEntered",RACE_SHOW_INTRO:GameEventsChannel+"raceShowIntro",RACE_GO_GO_GO:GameEventsChannel+"raceGoGoGo",UPDATE_UI_HEALTH:GameEventsChannel+"updateUIHealth",TRANSITION_IN_COMPLETE:GameEventsChannel+"transitionInComplete",TRANSITION_OUT_COMPLETE:GameEventsChannel+"transitionOutComplete"}},function(t,e,i){"use strict";window.HomeEventsChannel="HomeEvents.",window.HomeEvents={START_BUTTON:HomeEventsChannel+"startButton"}},function(t,e,i){"use strict";window.LoaderEventsChannel="LoaderEvents.",window.LoaderEvents={RESOURCE_LOADED:LoaderEventsChannel+"resourceLoaded",TMX_LOADED:LoaderEventsChannel+"tmxLoaded"}},function(t,e,i){"use strict";window.RespawnEventsChannel="RespawnEvents.",window.RespawnEvents={RESPAWN:RespawnEventsChannel+"respawn",QUIT:RespawnEventsChannel+"quit"}},function(t,e,i){"use strict";window.ScreenEventsChannel="ScreenEvents.",window.ScreenEvents={ENABLE:ScreenEventsChannel+"enable",TRANSITION_POINT:ScreenEventsChannel+"transitionPoint",PLAY_TRANSITION_IN:ScreenEventsChannel+"playTransitionIn",PLAY_TRANSITION_OUT:ScreenEventsChannel+"playTransitionOut",READY_RACE_INTRO:ScreenEventsChannel+"readyRaceIntro",SHOW_PAUSE:ScreenEventsChannel+"showPause",ROTATION_PORTRAIT:ScreenEventsChannel+"rotationPortrait"}},function(t,e,i){"use strict";window.ShoppeEventsChannel="ShoppeEventsChannel.",window.ShoppeEvents={BUTTON_EVENT:ShoppeEventsChannel+"buttonEvent",CONFIRM_CLOSED:ShoppeEventsChannel+"confirmClosed",CONFIRM_SHOW:ShoppeEventsChannel+"confirmShow",ITEM_EQUIPPED:ShoppeEventsChannel+"itemEquipped",ITEM_SELECTED:ShoppeEventsChannel+"itemSelected"}},function(t,e,i){"use strict";window.StacksEventsChannel="StacksEvents.",window.StacksEvents={ITEM_SELECT:StacksEventsChannel+"itemSelect"}},function(t,e,i){"use strict";window.WinEventsChannel="WinEvents.",window.WinEvents={PLAY_BUTTON:WinEventsChannel+"playButton"}},function(t,e,i){"use strict";meta.class("Entity.Instructions","Entity.Geometry",{button:null,frame1:null,frame2:null,frame:null,owner:null,onCreate:function(t){this.texture="ui-howto-frame",this.frame=0,this.frame1=new Entity.Geometry({z:50,pivotX:.5,anchorX:.5,anchorY:.72});var e=new Entity.Geometry({texture:"ui-howto-goldcoins",pivotX:.5,pivotY:.5,anchorX:.5}),i=GameSettings.Strings.instructions,s=GameSettings.textType,n=new Entity.UILabel;n.pivot(.5,0),n.anchor(.5,0),n.y=70,n.color="#89bedb",n.text=i.instructions1,n.size=i["instructions1"+s+"Size"],this.frame1.attach(e),this.frame1.attach(n),this.attach(this.frame1),this.frame2=new Entity.Geometry({z:50,pivotX:.5,anchorX:.5,anchorY:.72});var a=new Entity.UILabel;a.pivot(.5,0),a.anchor(.5,0),a.y=70,a.color="#89bedb",a.text=i["instructions2"+s],a.size=i["instructions2"+s+"Size"],this.frame2.attach(a),this.y+=this.volume.minY+(meta.camera.height-this.volume.height)/2},enableInteraction:function(){meta.createTimer(this,this.nextFrame,2500,2).play()},disableInteraction:function(){},nextFrame:function(){0===this.frame?(this.frame1.tween.to({alpha:0},500,function(){this.detach(this.frame1)}.bind(this)).play(),this.frame2.alpha=0,this.attach(this.frame2),this.frame2.tween.to({alpha:1},500).play(),++this.frame):this.closePanel()},closePanel:function(){this.disableInteraction(),this.owner.onCloseInstructions()}})},function(t,e,i){"use strict";meta.class("Entity.ShoppeConfirm","Entity.Geometry",{overlay:null,panel:null,cost:null,icon:null,buttonY:null,buttonN:null,selectedItem:null,coin:null,userCoins:null,userLabel:null,onCreate:function(){this.pivot(.5),this.anchor(.5);var t=new Resource.SVG;t.fillStyle="#000000",t.rect(0,0,meta.camera.width,meta.camera.height),this.overlay=new Entity.Geometry(t),this.overlay.alpha=.5,this.overlay.pivot(.5),this.overlay.anchor(.5),this.attach(this.overlay),this.panel=new Entity.Geometry("ui-buybox-box"),this.panel.pivot(.5),this.attach(this.panel),this.cost=new Entity.UILabel,this.cost.size=18,this.cost.color="white",this.cost.pivot(.5,-.1),this.cost.anchorX=.5,this.attach(this.cost),this.buttonY=new Entity.ShoppePanelButton({labelText:"BUY",buttonType:!0}),this.buttonN=new Entity.ShoppePanelButton({labelText:"BACK",buttonType:!1}),this.buttonY.x=60,this.buttonY.y=60,this.buttonN.x=-60,this.buttonN.y=60,this.icon=new Entity.Geometry({pivotX:.5,pivotY:.9}),this.coin=new Entity.Geometry({texture:"ui-buybox-coin",y:24,pivotX:.5,pivotY:.5,anchorX:.5,anchorY:.5}),this.userCoins=new Entity.Geometry({texture:"ui-element-coincount",pivotX:1,pivotY:1,x:-50,y:-70}),this.userLabel=new Entity.UILabel,this.userLabel.anchorY=.55,this.userLabel.pivot(0,.5),this.userLabel.x=48,this.userLabel.color="white",this.userLabel.size=14,this.attach(this.buttonY),this.attach(this.buttonN),this.attach(this.icon),this.attach(this.coin),this.attach(this.userCoins),this.userCoins.attach(this.userLabel),this.z=500,this.cost.z=this.z+4,this.buttonY.z=this.z+5,this.buttonN.z=this.z+6,meta.subscribe(ShoppeEventsChannel,this.onEvent,this)},setUpTransaction:function(t){this.icon.texture=t.texture;var e=App.getProxy("ProgressProxy");if(parseInt(t.price)>e.coins?(this.buttonY.disable(),this.buttonY.hidden=!0):this.buttonY.hidden=!1,this.userLabel.text=e.coins,this.selectedItem=t,this.cost.text=t.price,this.coin.x=.5*-this.cost.width-20,this.userLabel.scale(1),this.userLabel.volume.maxX>this.userCoins.volume.maxX-10){var i=(this.userCoins.volume.maxX-this.userLabel.volume.minX-10)/this.userLabel.volume.width;this.userLabel.scale(i)}},enable:function(){this.buttonY.enable(),this.buttonN.enable()},disable:function(){this.buttonY.disable(),this.buttonN.disable()},transitionIn:function(){this.alpha=0,this.tween.clear(),this.tween.to({alpha:1},250,function(){this.tween.clear()}.bind(this)).play()},transitionOut:function(){this.tween.clear(),this.tween.to({alpha:0},250,function(){this.tween.clear(),this.view.detach(this),meta.emit(ShoppeEventsChannel,null,ShoppeEvents.CONFIRM_CLOSED)}.bind(this)).play()},handleButtonEvent:function(t){this.disable();var e=App.getProxy("ProgressProxy");!0===t?(e.purchaseItem(this.selectedItem),this.userLabel.tween.clear(),this.userLabel.tween.to({alpha:0},150,function(){this.text=e.coins}.bind(this.userLabel)).to({alpha:1},150).play(),meta.createTimer(this,function(){this.transitionOut()},900,1).play(),Sounds.play("sfx-shoppe-purchase")):(this.transitionOut(),Sounds.play("sfx-button-negative"))},onEvent:function(t,e){switch(e){case ShoppeEvents.BUTTON_EVENT:this.handleButtonEvent(t)}}})},function(t,e,i){"use strict";meta.class("Entity.ShoppePanelButton","Entity.Geometry",{buttonType:null,textureName:null,onCreate:function(t){this.pivot(.5),t.buttonType?this.textureName="ui-buybox-accept":this.textureName="ui-buybox-deny",this.texture=this.textureName},enable:function(){this.onDown=function(t){this.texture=this.textureName+"-press"},this.onUp=function(t){this.texture=this.textureName,meta.emit(ShoppeEventsChannel,this.buttonType,ShoppeEvents.BUTTON_EVENT)},this.picking=!0},disable:function(){this.onDown=null,this.onUp=null,this.picking=!1}})},function(t,e,i){"use strict";meta.class("UI.Flurry","Entity.Geometry",{amount:null,animTime:0,duration:0,particle:null,particles:null,onCreate:function(){this.particles=[],this.anchor(.5,0);for(var t,e=0;e<this.amount;e++)t=new Entity.Geometry({texture:this.particle,hidden:!0,pivotX:.5,pivotY:.5}),this.particles.push(t),this.attach(t)},emit:function(t,e,i,s,n,a,h,o){for(var l,r,c,u=this.amount;--u>=0;)r=o?10*Math.random():0,c=o?10*Math.random():0,l=this.particles[u],l.sX=h-a,l.sY=e-20,l.x=h-a,l.y=e,l.dX=i-l.absX-r,l.dY=s-l.absY-c,l.dur=n+.1*u,l.scaleX=0,l.scaleY=0,l.alpha=0,l.hidden=!1,l.tween.clear(),l.tween.wait(50).to({alpha:1,scaleX:1.5,scaleY:1.5},200).wait(50).to({scaleX:1,scaleY:1,alpha:0},200).play();this.animTime=0,this.updating=!0},easeInOutQuad:function(t,e,i,s){return(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},update:function(t){this.animTime+=t;for(var e,i=this.amount,s=!0;--i>=0;)e=this.particles[i],this.animTime<e.dur?(e.x=this.easeInOutQuad(this.animTime,e.sX,e.dX,e.dur),e.y=this.easeInOutQuad(this.animTime,e.sY,e.dY,e.dur),s=!1):(e.scale(0),e.hidden=!0);s&&(this.updating=!1)}})},function(t,e,i){"use strict";meta.class("View.GameTransition","View.BaseScreen",{whiteOut:null,t:null,build:function(){this.view=meta.createView(this.id),this.view.static=!0,this.view.z=2e4;var t=new Resource.SVG;t.fillStyle="#ffffff",t.rect(0,0,meta.camera.width,meta.camera.height),this.t=t,this.whiteOut=new Entity.Geometry(t),this.whiteOut.pivot(.5),this.whiteOut.anchor(.5),this.view.attach(this.whiteOut),meta.camera.onResize.add(this.onResize,this)},onResize:function(){this.cameraZoom=meta.camera.zoom,this.whiteOut.scale(this.cameraZoom)},playOut:function(){this.whiteOut.hidden=!1,this.whiteOut.alpha=0,this.whiteOut.tween.clear(),this.whiteOut.tween.wait(1).to({alpha:1},250,this.playOutComplete.bind(this)).play()},playOutComplete:function(){meta.emit(GameEventsChannel,null,GameEvents.TRANSITION_OUT_COMPLETE)},playIn:function(){this.whiteOut.alpha=1,this.whiteOut.hidden=!1,this.whiteOut.tween.clear(),this.whiteOut.tween.wait(1).to({alpha:0},500,this.playInComplete.bind(this)).play()},playInComplete:function(){this.whiteOut.hidden=!0,meta.emit(GameEventsChannel,null,GameEvents.TRANSITION_IN_COMPLETE)}})},function(t,e,i){"use strict";meta.class("View.GameUI","View.BaseScreen",{cameraZoom:1,coins:null,coinIcon:null,coinFlurry:null,gameView:null,health:null,healthIcon:null,healthFlurry:null,healthPulseDir:.1,score:null,scoreVal:0,tDiff:0,tZ:"0",tStr:null,logo:null,build:function(){this.view=meta.createView(this.id),this.view.static=!0,this.view.z=1e4,this.coinIcon=new Entity.Geometry({texture:"ui-coincount",pivotX:0,pivotY:1,startX:20,startY:76}),this.coins=new Entity.UILabel,this.coins.pivot(0,1),this.coins.anchor(0,0),this.coins.startX=69,this.coins.startY=85,this.coins.size=24,this.coins.color="white",this.coins.shadow=!0,this.coins.shadowBlur=0,this.coins.shadowOffsetY=2,this.coins.text=App.getProxy("ProgressProxy").coins,this.coinFlurry=new UI.Flurry({particle:"ui-buybox-coin",amount:5}),this.logo=new Entity.Geometry({texture:"ui-title-logo",pivotX:.5,pivotY:0,anchorX:.5,anchorY:0,y:10}),this.health=new Entity.UILabel,this.health.pivot(1,1),this.health.anchor(1,0),this.health.color="white",this.health.startX=-76,this.health.startY=85,this.health.size=24,this.health.shadow=!0,this.health.shadowBlur=0,this.health.shadowOffsetY=2,this.health.text="100",this.healthIcon=new Entity.Geometry({texture:"ui-healthcount",pivotX:.5,pivotY:.5,anchorX:1,anchorY:0,startX:-45,startY:55,startScale:1,zoomedScale:1}),this.healthFlurry=new UI.Flurry({particle:"ui-healthcount",amount:1}),this.score=new Entity.UILabel,this.score.pivot(.5,1),this.score.anchor(.5,0),this.score.color="white",this.score.startX=0,this.score.startY=80,this.score.size=30,this.score.shadow=!0,this.score.shadowBlur=0,this.score.shadowOffsetY=2,this.score.text="points",this.view.attach(this.logo),this.view.attach(this.coins),this.view.attach(this.coinIcon),this.view.attach(this.coinFlurry),this.view.attach(this.health),this.view.attach(this.healthIcon),this.view.attach(this.healthFlurry),meta.camera.onResize.add(this.onResize,this),this.onResize(),meta.subscribe(GameEventsChannel,this.onEvent,this)},onResize:function(){this.coins.refresh(),this.health.refresh(),this.score.refresh(),this.cameraZoom=meta.camera.zoom,this.coins.updateToZoom(this.cameraZoom),this.score.updateToZoom(this.cameraZoom),this.health.updateToZoom(this.cameraZoom),this.coinIcon.scale(this.cameraZoom),this.coinIcon.x=this.coinIcon.startX*this.cameraZoom,this.coinIcon.y=this.coinIcon.startY*this.cameraZoom,this.healthIcon.zoomedScale=this.cameraZoom*this.healthIcon.startScale,this.healthIcon.scale(this.healthIcon.zoomedScale),this.healthIcon.x=this.healthIcon.startX*this.cameraZoom,this.healthIcon.y=this.healthIcon.startY*this.cameraZoom,this.logo.scale(.325*this.cameraZoom),this.stopLowHealthPulse()},resetAll:function(){this.coins.text=App.getProxy("ProgressProxy").coins,this.updateHealth(100)},updateCoins:function(t){var e=parseInt(this.coins.text);t instanceof Object?(e+=t.coins,this.coinFlurry.emit(t.srcX*GameSettings.LANE_WIDTH*this.cameraZoom,t.srcY*this.cameraZoom,this.coinIcon.absX+5,this.coinIcon.absY+25,.5,t.camX,t.heroX,!0)):e+=t,this.coins.text=e},updateHealth:function(t){t instanceof Object?(this.health.text=t.health,100===t.health&&Sounds.play("sfx-collect-health"),this.healthFlurry.emit(t.srcX*GameSettings.LANE_WIDTH*this.cameraZoom,t.srcY*this.cameraZoom,this.healthIcon.absX-5,this.healthIcon.absY+25,.5,t.camX,t.heroX,!0),t.health<25?this.startLowHealthPulse():this.stopLowHealthPulse()):(this.health.text=t,100!==t?this.playDamageEffect():Sounds.play("sfx-collect-health"),t<25?this.startLowHealthPulse():this.stopLowHealthPulse())},updateScore:function(t){t>0&&(this.scoreVal+=t),this.score.text=this.formatLabel(this.scoreVal,6)},formatLabel:function(t,e){this.tStr=t.toString(),this.tDiff=e-this.tStr.length,this.tZ="";for(var i=this.tDiff;--i>=0;)this.tZ+="0";return this.tZ+this.tStr},playDamageEffect:function(){this.healthIcon.scale(2*this.healthIcon.zoomedScale),this.healthIcon.angle=360*Math.random(),this.healthIcon.tween.clear(),this.healthIcon.tween.to({scaleX:this.healthIcon.zoomedScale,scaleY:this.healthIcon.zoomedScale,angle:0},300).easing(meta.Tween.Easing.elasticOut).play()},startLowHealthPulse:function(){this.healthIcon.updating||(this.healthIcon.updating=!0,this.healthIcon.update=this.update.bind(this))},stopLowHealthPulse:function(){this.healthIcon.updating&&(this.healthIcon.updating=!1,this.healthIcon.alpha=1,this.healthPulseDir=.1)},update:function(t){this.healthIcon.alpha-=this.healthPulseDir,this.healthIcon.alpha<0?(this.healthPulseDir=-this.healthPulseDir,this.healthIcon.alpha=0):this.healthIcon.alpha>1&&(this.healthPulseDir=-this.healthPulseDir,this.healthIcon.alpha=1)},onEvent:function(t,e){switch(e){case GameEvents.COIN_COLLECTED:Sounds.play("sfx-collect-coin"),this.updateCoins(t);break;case GameEvents.ENEMY_KILLED:this.updateScore(t);break;case GameEvents.UPDATE_UI_HEALTH:this.updateHealth(t);break;case GameEvents.GLOBE_COLLECTIBLE_COLLECTED:Sounds.play("sfx-collect-coin"),this.updateCoins(t),this.updateScore(5);break;case GameEvents.GLOBE_COLLECTIBLE_MISSED:this.updateScore(-10);break;case GameEvents.RACE_LEVEL_LOSE:case GameEvents.DUNE_LEVEL_LOSE:this.updateHealth(0),this.stopLowHealthPulse();break;case GameEvents.RACE_PORTAL_ENTERED:case GameEvents.DUNE_PORTAL_ENTERED:this.stopLowHealthPulse();break;case GameEvents.NEW_RUN:this.resetAll()}}})},function(t,e,i){"use strict";meta.class("Entity.ShareButton","Entity.Geometry",{halfW:null,hitbox:null,callback:null,callbackDown:null,label:null,useHitBox:null,onCreate:function(t){t.label?(this.label=new Entity.UILabel,this.label.text=t.label,this.label.size=t.textSize,this.label.color="white",this.label.pivot(0,.5),this.label.anchorX=1,this.label.anchorY=.5,this.label.x=20,this.label.y=t.shareLabelY,this.label.z=5,this.attach(this.label),this.halfW=.5*(this.volume.width+this.label.volume.width),this.x=-this.halfW,this.hitbox=new Entity.Geometry,this.hitbox.owner=this,this.hitbox.callback=t.callback,this.hitbox.callbackDown=t.callbackDown,this.hitbox.resize(this.label.x+this.label.width+this.width,this.height+2),this.attach(this.hitbox),this.useHitBox=!0):(this.halfW=.5*this.volume.width,this.useHitBox=!1),this.y=this.halfW},enableInteraction:function(){this.useHitBox?(this.hitbox.picking=!0,this.hitbox.onUp=function(){this.callback()},this.hitbox.onDown=function(){this.callbackDown()}):(this.picking=!0,this.onUp=function(){this.callback()})},disableInteraction:function(){this.useHitBox?(this.hitbox.picking=!1,this.hitbox.onUp=!1):(this.picking=!1,this.onUp=!1)}})},function(t,e,i){"use strict";meta.class("Entity.TransitionEffect",{container:null,init:function(t){this.container=new Entity.Geometry(t),this.initArg(t),this.onCreate(t)},initArg:function(t){for(var e in t)this[e]=t[e]},scale:function(t){this.container.scale(t)},set y(t){this.container.y=t},onCreate:function(t){var e,i,s,n;e=new Entity.Geometry("ui-oasis-transition-"+t.orientation),i=new Entity.Geometry("ui-oasis-transition-"+t.orientation),s=new Entity.Geometry("ui-oasis-transition-"+t.orientation),n=new Entity.Geometry("ui-oasis-transition-"+t.orientation),e.z=-1,i.z=-1,s.z=-1,n.z=-1,i.flip(1,-1),s.flip(-1,-1),n.flip(-1,1),this.container.attach(e),this.container.attach(n),this.container.attach(s),this.container.attach(i),e.anchor(.5,.5),n.anchor(.5,.5),i.anchor(.5,.5),s.anchor(.5,.5)}})},function(module,exports,__webpack_require__){"use strict";meta.class("Utility.Pool",{objectsCache:null,objectsInUse:null,init:function(t){this.initArg(t),this.objectsCache=[],this.objectsInUse=[],this.onCreate(t)},initArg:function(t){for(var e in t)this[e]=t[e]},onCreate:function(t){},addToPool:function(num,className,opts){var obj,args={};opts&&(args=opts),args.pool=this;for(var i=0;i<num;i++){if("string"==typeof className){var constructor=eval(className);obj=new constructor(args)}else obj=new className(args);this.objectsCache.push(obj)}},emit:function(t){if(this.objectsCache.length>0){var e;if(t&&t<=this.objectsCache.length){for(var i=0;i<t;i++)e=this.objectsCache.shift(),this.objectsInUse.push(e);return this.objectsInUse}return e=this.objectsCache.shift(),this.objectsInUse.push(e),e}console.warn("(Utility.Pool) no objects left in cache to emit")},recycle:function(t){for(var e=this.objectsInUse.length;--e>=0;)if(this.objectsInUse[e]===t){var i=this.objectsInUse.splice(e,1);null!==i[0].reset&&i[0].reset(),this.objectsCache.push(i[0]);break}},destroy:function(){for(var t,e=this.objectsCache.length;--e>=0;)t=this.objectsCache[e],t.updating=!1,null!==t.destroy&&t.destroy();for(e=this.objectsInUse.length;--e>=0;)(t=this.objectsCache[e])&&(t.updating=!1,null!==t.destroy&&t.destroy());this.objectsCache=null,this.objectsInUse=null}})},function(t,e,i){t.exports=i(2)}]);